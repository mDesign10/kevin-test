/*! Copyright (c) 2021 CommonTime Ltd */
/*! Build date: Mon May 17 2021 11:18:33 GMT+0100 (British Summer Time) */
/*! ================================= */
/*! Commit hash: fd72fea3 (fd72fea3eb44dc5ebf6ca426143a978729bb48e8) */
/*! Commit date: Mon Nov 25 2019 09:38:08 GMT+0000 (Greenwich Mean Time) */
/*! Commit branch: hotfix/3.2.0-beta7 */
/*! ================================= */

(function(l){function h(R){if(E[R])return E[R].exports;var A=E[R]={i:R,l:!1,exports:{}};return l[R].call(A.exports,A,A.exports,h),A.l=!0,A.exports}var E={};return h.m=l,h.c=E,h.i=function(R){return R},h.d=function(R,A,N){h.o(R,A)||Object.defineProperty(R,A,{configurable:!1,enumerable:!0,get:N})},h.n=function(R){var A=R&&R.__esModule?function(){return R['default']}:function(){return R};return h.d(A,'a',A),A},h.o=function(R,A){return Object.prototype.hasOwnProperty.call(R,A)},h.p='',h(h.s=102)})([function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R=E(47);h.prop=R.prop;var A=E(46);h.Stroolean=A.Stroolean,h.NullableNumber=A.NullableNumber;var N=E(23);h.CTBaseComponent=N.CTBaseComponent;var M=E(44);h.CTLayerComponent=M.CTLayerComponent;var I=E(43);h.BaseLayer=I.BaseLayer;var D=E(9);h.Logger=D.Logger},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R=E(83);h.CTAlertModalManager=R.CTAlertModalManager;var A=E(84);h.CTAlertModal=A.CTAlertModal;var N=E(29);h.CTButton=N.CTButton;var M=E(86);h.CTFilePicker=M.CTFilePicker;var I=E(87);h.CTIcon=I.CTIcon;var D=E(89);h.CTLoginForm=D.CTLoginForm;var L=E(90);h.CTOnlineIndicator=L.CTOnlineIndicator;var B=E(91);h.CTSelectionList=B.CTSelectionList;var H=E(92);h.CTTextbox=H.CTTextbox;var z=E(93);h.CTUserDisplay=z.CTUserDisplay;var $=E(88);h.CTImg=$.CTImg;var Y=E(85);h.CTAudio=Y.CTAudio},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R=E(58);h.AppMode=R.AppMode;var A=E(26);h.DefaultAlerts=A.DefaultAlerts;var N=E(59);h.ConnectionStatus=N.ConnectionStatus;var M=E(60);h.DisconnectionStatus=M.DisconnectionStatus;var I=E(27);h.Icons=I.Icons;var D=E(61);h.RoomRole=D.RoomRole;var L=E(62);h.UserAdditionalDetailsType=L.UserAdditionalDetailsType},function(l,h){'use strict';function A(L,B,H){return L?B:H}function M(L){const B=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;L=L.replace(B,function(z,$,Y,J){return $+$+Y+Y+J+J});const H=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(L);return H?{r:parseInt(H[1],16),g:parseInt(H[2],16),b:parseInt(H[3],16)}:null}Object.defineProperty(h,'__esModule',{value:!0}),h.renderIf=function(L,B){return A(L,B,null)},h.renderIfElse=A,h.buildStyles=function(L){const B=document.createElement('div');return Object.assign({},B.style,L)},h.hexToRgbaString=function(L){const B=M(L);return`rgba(${B.r}, ${B.g}, ${B.b}, 1)`},h.decideTextColorFromBgColor=function(L){const B=M(L);return 186<0.299*B.r+0.587*B.g+0.114*B.b?'#000000':'#ffffff'}},function(l,h,E){'use strict';function M(ae,se){return null===ae||void 0===ae?'':ee(ae).format(se)}function B(ae){return ae.map((se)=>{return se instanceof Array?B(se):'object'==typeof se?Object.assign({},se):se})}function z(ae){return ae&&'object'==typeof ae&&!Array.isArray(ae)}function $(ae,...se){if(!se.length)return ae;const oe=se.shift();if(z(ae)&&z(oe))for(const ie in oe)z(oe[ie])?(ae[ie]||Object.assign(ae,{[ie]:{}}),$(ae[ie],oe[ie])):Object.assign(ae,{[ie]:oe[ie]});return $(ae,...se)}function J(ae){return-1<ae.indexOf('@')?ae.substring(0,ae.indexOf('@')):ae}var Z=this&&this.__awaiter||function(ae,se,oe,ie){return new(oe||(oe=Promise))(function(de,le){function ue(ge){try{pe(ie.next(ge))}catch(me){le(me)}}function ce(ge){try{pe(ie['throw'](ge))}catch(me){le(me)}}function pe(ge){ge.done?de(ge.value):new oe(function(me){me(ge.value)}).then(ue,ce)}pe((ie=ie.apply(ae,se||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const ee=E(101),te=E(15),ne=E(14);h.padLeft=function(ae,se,oe=' '){let ie=ae;const de=se-ae.length;return 0<de&&(ie=Array(de+1).join(oe)+ie),ie},h.generateRandomSixString=function(){let ae=0|46656*Math.random(),se=0|46656*Math.random();return ae=('000'+ae.toString(36)).slice(-3),se=('000'+se.toString(36)).slice(-3),ae+se},h.tokenReplace=function(ae,se){if(!ae)return'';if(void 0===se||null===se)return ae;if(-1===ae.indexOf('${'))return ae;const oe=(ie,de)=>{const le=de.split('.');do;while(le.length&&(ie=ie[le.shift()]));return ie};return ae.replace(/\${([^{}]*)}/g,(ie,de)=>{const le=oe(se,de);return'string'==typeof le||'number'==typeof le?le:ie})},h.formatDate=M,h.formatDateForTimeOrDate=function(ae,se=!1,oe=!1){if(null===ae||ae===void 0)return'';const ie=ee().date(),de=ee(ae).date();return ie===de?(se&&'Today, '||'')+M(ae,oe?'HH:mm:ss':'HH:mm'):M(ae,oe?'DD/MM/YYYY HH:mm:ss':'DD/MM/YYYY HH:mm')},h.prettyDuration=function(ae){if(1e3>ae)return'< 1s';const se=~~(ae/1e3);if(60>se)return`${se}s`;const oe=~~(ae/1e3/60),ie=~~((ae-1e3*(60*oe))/1e3);if(60>oe)return`${oe}m`+(ie&&` ${ie}s`||'');const de=~~(ae/1e3/60/60),le=~~((ae-1e3*(60*(60*de)))/1e3/60);if(24>de)return`${de}h`+(le&&` ${le}m`||'');return`${~~(ae/1e3/60/60/24)} days`},h.enumFromString=function(ae){return ae||null},h.deepCloneArray=B,h.deepCloneObject=function(ae){return JSON.parse(JSON.stringify(ae))},h.isObject=z,h.mergeDeep=$,h.getMessageType=function(ae){const se=Object.keys(ae);return se[0]||null},h.getUsernameFromJid=J,h.getVCardNameOrUsername=function(ae,se,oe=!1,ie=null){if(!(ie&&oe)){const de=se.find((le)=>le.jid===ae);if(de&&de.vCard&&de.vCard.name&&de.vCard.name.given)return`${de.vCard.name.given} ${de.vCard.name.family||''}`.trim()}else if(ie.name&&ie.name.given)return`${ie.name.given} ${ie.name.family||''}`.trim();return J(ae)},h.validateVCardObject=function(ae){return ae&&0<Object.keys(ae).length},h.randomNumberBetween=function(ae,se){return Math.floor(Math.random()*se)+ae},h.sleep=function(ae){return Z(this,void 0,void 0,function*(){return new Promise((se)=>{setTimeout(se,ae)})})},h.displayImage=function(ae){return new Promise((se,oe)=>{if(ne.isDevice()){const ie=te.getSource('fileEncryption');if(ie)ie.viewEncryptedImage(se,oe,ae);else{const de=te.getSource('fileopener');de.openFile(se,oe,ae)}}else se()})}},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R=E(12);h.BaseEventArgs=R.BaseEventArgs;var A=E(25);h.CommsEventArgs=A.CommsEventArgs;var N=E(51);h.UserActivityEventArgs=N.UserActivityEventArgs;var M=E(52);h.UserConnectionStatusEventArgs=M.UserConnectionStatusEventArgs;var I=E(50);h.RoomParticipantUpdateEventArgs=I.RoomParticipantUpdateEventArgs;var D=E(48);h.ConnectionStatusEventArgs=D.ConnectionStatusEventArgs;class L{}L._Request_RaiseAlert='request-raise-alert',L._Request_CloseAlert='request-close-alert',L._Request_UpdateUISuppression='request-update-ui-suppression',L._Request_RedrawAllUIs='_request-redraw-all-uis',L._Request_Logout='request-logout',L._Request_Component_Clear_Data='request-component-clear-data',L._Request_ThemeChange='request-theme-change',L.ConnectionStatusChange='connection-status-change',L.OtherUserConnectionStatusChange='other-user-connection-status-change',L.CurrentUserVCardUpdate='current-user-vcard-update',L.RoomParticipantUpdate='room-participant-update',L.UserActivity='user-activity',L.LoginResult='login-result',L.LogoutResult='logout-result',L.LoginFormResult='login-form-result',h.BaseEvents=L},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(5);var A=E(65);h.BasePageEventArgs=A.BasePageEventArgs;var N=E(66);h.ReadPageDetailEventArgs=N.ReadPageDetailEventArgs;var M=E(67);h.SendNewPageEventArgs=M.SendNewPageEventArgs;var I=E(68);h.SendPageResponseEventArgs=I.SendPageResponseEventArgs;class D extends R.BaseEvents{}D._Request_SendNewPage='request-send-new-page',D._Request_ReadPageDetail='request-read-page-detail',D._Request_OpenClientReadModal='request-open-client-read-modal',D._Request_OpenBroadcasterReadModal='request-open-broadcaster-read-modal',D._Request_CheckForPendingPages='request-check-for-pending-pages',D._Request_CloseSendNewPageModal='request-close-send-new-page-modal',D.NewPageReceived='new-page-received',D.PageUpdate='page-update',D.PageResponse='page-response',D.SendingPageError='sending-page-error',D.ProcessMamMessages='process-mam-messages',D.ProcessMamPages='process-mam-pages',D.RespondedToPage='responded-to-page',D.RespondedToAllPages='responded-to-all-pages',D.LogoutRequestConfirmed='logout-request-confirmed',D.Mute='mute',D.DatabasesAutoDestroyed='databases-auto-destroyed',D.RequestMakeAudioNotification='request-make-audio-notification',h.PagerEvents=D},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R=E(78);h.DeviceType=R.DeviceType;var A=E(28);h.Icons=A.Icons;var N=E(80);h.ResponseStatus=N.ResponseStatus;var M=E(77);h.ContactResponseType=M.ContactResponseType;var I=E(79);h.FilterType=I.FilterType;var D;(function(L){L[L.Up='Up']='Up',L[L.Down='Down']='Down'})(D=h.TimerDirection||(h.TimerDirection={}))},function(l,h,E){'use strict';function H(W){return W?W.firstName&&W.lastName?`${W.firstName} ${W.lastName}`.trim():Y.validateVCardObject(W.vCard)&&Y.validateVCardObject(W.vCard.name)&&W.vCard.name.given?`${W.vCard.name.given||''} ${W.vCard.name.family||''}`.trim():Y.getUsernameFromJid(W.jid):''}Object.defineProperty(h,'__esModule',{value:!0});const $=E(7),Y=E(4),J=E(11),G=[$.ResponseStatus.NotReceivedNotification,$.ResponseStatus.Received,$.ResponseStatus.Displayed,$.ResponseStatus.Acknowledged,$.ResponseStatus.Unable,$.ResponseStatus.Attending];h.getMessageType=function(W){const X=Object.keys(W);if(0<X.length){const K=Object.values(J.PagerMessageTypes).filter((Q,Z)=>0==Z%2);return X.find((Q)=>K.includes(Q))}return null},h.getResponse=function(W,X){const K=W.responses.find((Q)=>Q.type===X);return K||null},h.convertContactsIntoAddressList=function(W){const X=[];return W.map((K)=>{X.push({type:'to',jid:K.id})}),X},h.createAddressFromJid=function(W){return{type:'to',jid:W}},h.addAttachmentsToPage=function(W,X){return X.image=[],X.audio=[],X.attachmentsLoaded=!0,W.attachments.map((K)=>{if(K.type&&1<Object.keys(K.type).length){const Q=K.path||K.get;0===Q.indexOf('http')&&(X.attachmentsLoaded=!1),K.type&&'string'==typeof K.type&&K.type.includes('image')?X.image.push(Q):X.audio.push(Q)}}),X},h.createNewPage=function(W,X,K,Q,Z){return{_id:null,sender:X,to:W.to,individuals:[],openedDate:Z,expirationDate:null,closedDate:null,pageType:K,replyTemplate:Q,subject:W.subject,message:W.message,messageSplit:[],image:W.image,audio:W.audio,attachments:0<W.image.length||0<W.audio.length,attachmentsLoaded:!1,messageId:null,ts:null}},h.convertContacts=function(W,X,K=!1){const Q=[],Z=[];for(const ee in W)W[ee].selected&&Z.push(W[ee]);return Z.map((ee)=>{const te=[];te.map((ne)=>{ne.groups.includes(ee.id)&&!ne.alreadyAdded&&(ne.alreadyAdded=!0,te.push(ne))}),0<te.length&&Q.push({name:ee.id,contacts:te,displayName:ee.id,isGroup:!0})}),X.filter((ee)=>!0===ee.selected||K).map((ee)=>{ee.alreadyAdded||(!ee.responses&&(ee.responses=[]),Q.push({name:ee.id,contacts:[ee],displayName:H(ee),isGroup:!1}))}),Q},h.parseMessageContent=function(W){const X=W.split(/\r?\n/),K=X.filter((Q)=>''!==Q);return K},h.getNameFromContact=H,h.getContactNameFromContacts=function(W,X){if(!W||!X)return'';const K=X[W];return K?H(K):''}},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(4);var A;(function(M){M[M.Connectivity='connectivity']='Connectivity',M[M.MessageSent='message-sent']='MessageSent',M[M.MessageReceived='message-received']='MessageReceived',M[M.MessageUpdated='message-updated']='MessageUpdated',M[M.MessageChatMarker='message-chat-marker']='MessageChatMarker',M[M.IQSent='iq-sent']='IQSent',M[M.ProcessingReceived='processing-received']='ProcessingReceived',M[M.ProcessingUpdated='processing-updated']='ProcessingUpdated',M[M.ProcessingChatMarker='processing-chat-marker']='ProcessingChatMarker',M[M.Status='status']='Status',M[M.Presence='presence']='Presence',M[M.Participation='participation']='Participation',M[M.Mam='mam']='Mam',M[M.CleanUp='clean-up']='CleanUp',M[M.XmppClient='xmpp-client']='XmppClient',M[M.Events='events']='Events',M[M.DataStorage='data-storage']='DataStorage',M[M.Other='other']='Other'})(A=h.LoggerTypes||(h.LoggerTypes={}));h.Logger=class{constructor(M=null){this._types=M}log(M,...I){this.shouldLog(M)&&console.log.call(null,...I)}info(M,...I){this.shouldLog(M)&&console.info.call(null,...I)}debug(M,...I){this.shouldLog(M)&&console.debug.call(null,...I)}error(...M){console.error.call(null,...M)}getTypes(){return this._types}getTypesAsEnumValues(){return this._types.map((M)=>R.enumFromString(M))}setTypes(M){this._types=M||[]}shouldLog(M){return this._types&&this._types.length&&(!!this._types.includes('_all_')||this._types.includes(M.toString()))}}},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});h.BaseMessageType=class{};h.BaseBotCommand=class{},h.get=function(){return[]};var M=E(53);h.BaseHandler=M.BaseHandler},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const A=E(69),N=E(72),M=E(73),I=E(74),D=E(75),L=E(10),B=E(76),H=E(71),z=E(70);class $ extends L.BaseMessageType{}$.DiagnosticsRequest='diagnosticsrequest',$.DiagnosticsResponse='diagnosticsresponse',$.NewPage='newpage',$.PageResponse='pageresponse',$.StartTest='starttest',h.PagerMessageTypes=$,h.get=function(Y){return[new A.ConnectivityHandler(Y),new z.DiagnosticsRequestHandler(Y),new N.ReadPageDetailHandler(Y),new M.ReceiveNewPageHandler(Y),new I.SendNewPageHandler(Y),new D.SendPageResponseHandler(Y),new B.StartTestModeHandler(Y),new H.PushNotificationResponseHandler(Y)]}},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});h.BaseEventArgs=class{constructor(){this.eventDate=new Date().getTime()}}},function(l){l.exports=skate},function(l,h){'use strict';function R(){const B=window.navigator.userAgent;return /Android/i.test(B)?'android':/iPhone|iPad|iPod/i.test(B)?'ios':/Electron/i.test(B)?'electron':/Chrome/i.test(B)?'chrome':/Safari/i.test(B)?'safari':/Edge/i.test(B)?'edge':D.MSInputMethodContext&&L.documentMode?'ie':null}Object.defineProperty(h,'__esModule',{value:!0});const D=window,L=document;h.getPlatformName=R,h.isElectron=function(){return'electron'===R()},h.isWindows=function(){return-1!==navigator.userAgent.toUpperCase().indexOf('WINDOWS')},h.isDevice=function(){const B=R();return'android'===B||'ios'===B},h.isBrowser=function(){const B=R();return'chrome'===B||'safari'===B||'ie'===B||'edge'===B}},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const A=window,N=window;h.getSource=function(M){if(A[M]!==void 0)return A[M];if(void 0!==A.cordova&&void 0!==A.cordova[M])return A.cordova[M];if(void 0!==A.cordova&&void 0!==A.cordova.plugins&&void 0!==A.cordova.plugins[M])return A.cordova.plugins[M];if(void 0!==A.plugins&&void 0!==A.plugins[M])return A.plugins[M];if(void 0!==navigator&&void 0!==navigator[M])return navigator[M];if(void 0!==N.require){let I=!1;try{return I=N.require(M),I}catch(D){if(!1==I||void 0===I){const L=M.replace(/\-/g,'').toLowerCase();try{return N.require('@commontimeltd/com.commontime.'+L)}catch(B){return!1}}return!1}}else return console.warn(`Plugin '${M}' is not available.`),!1}},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(21),A=E(18),N=E(40),M=E(14),I=E(15),D=E(42),L=E(39),B=E(41),H=E(22);if(!window.Promise)throw new Error('ct-xmpp-client.js has a dependency on Promise, did you forget to include the polyfill?');if(!window.PouchDB)throw new Error('ct-xmpp-client.js has a dependency on PouchDB, please ensure PouchDB is included before ct-xmpp-client.js');class z{constructor($,Y,J){if(this._userDirectory=null,this._includeStanzaFilters=[],this._excludeStanzaFilters=[],this._pushNodeName=null,this._lastStatusId=null,this._pingInterval=null,this._pingTimeout=null,this._alreadyReLoggingIn=!1,this._reLoginTimeout=null,this._reLoginBackOff=3e3,this._forcedLogout=!1,this._sendTimeouts={},this._sendStanzaPromises={},this._destroyingDbs=!1,this._joinedRooms={},this._saveDebounce={},this._botCommandTimeouts={},this._botCommandPromises={},this._initialised=!1,!$)throw new Error('An instance ID must be provided.');this._instanceId=$;let G=localStorage.getItem(`${this._instanceId}_last_archive_id`);if(null===G&&(G='0'),this._lastArchiveId=G,!Y)throw new Error('XMPP server hostname must be provided.');this._serverTimeDiff=null,this._eventListeners={},this._options=z._merge({sendTimeout:3e5,debug:!1,perfLogging:!1,mucHost:null,uploadHost:null,echoHost:null,authAttachments:!1,mam:{auto:!0,defaultTimeLimit:2.628e9,pageSize:250},push:{androidEnabled:!1,packageId:'',senderId:'',iosEnabled:!1},enablePing:!0,pingInterval:5e3,pingTimeout:1e4,connectTimeout:7e3,autoLogin:!1,autoReconnect:!0,autoMarkMessages:!0,encryption:!1,fileEncryption:!1,autoDownloadAttachmentTime:-1,autoPurgeOldMessagesAge:-1,autoPurgeOldMessagesCount:-1,streamResumption:!0,useEncodedJidAsResource:!1,adSpn:null,adSecurityPackage:null,adTokenPlaceholder:'[[AD_PASSWORD_TOKEN]]',updateUserDirectoryOnLogin:!1,enableMessageCarbons:!1,maxReconnectBackoff:3e5,stropheLogging:!1,forceIndexedDb:!1,bringToForegroundOnVoipPush:!0,updateUserDirectoryInterval:1800000,useConnectionEvents:!0,autoResumeTimers:!0,maxStreamResumptionTime:null,alwaysSendPresence:!1,updateRosterOnLogin:!0},J),this._endpoint=Y,this._connection=null,this.connected=!1,this.loggedIn=!1,this._reLoggingIn=!1,this._loggingOut=!1,this._jid=null,this.resource=null,this._bareJid=null,this.username=null,this._userDirectory=new L.UsersDirectory(this._instanceId,this._options.debug),!0===this._options.stropheLogging&&(H.default.Strophe.log=(W,X)=>{this._log(`[${W}]: ${X}`)}),R.Promise.all([this._getInstallId(),this._initDbs()]).then(()=>{if(this._initialised=!0,this._log('XMPP client successfully initialised.'),this._dispatchEvent(z.EVENT_TYPES.INITIALISED,null),!0===this._options.autoLogin){const W=[this._getCacheItem('user_jid'),this._getCacheItem('user_password')];R.Promise.all(W).then((X)=>{const K=X[0],Q=X[1];void 0!==K&&void 0!==Q&&this._reLogin()}).catch((X)=>{this._onError('Unable to get jid/pw: '+X)})}}).catch((W)=>{throw new Error(W)}),this._options.useConnectionEvents&&(document.addEventListener('offline',()=>{this._onOffline()},!1),document.addEventListener('online',()=>{this._onOnline()},!1))}set sendTimeout($){$===this._options.sendTimeout||(this._options.sendTimeout=$)}get status(){return this._isMethodReady(!0),this._getCacheItem('connection_status')}get bareJid(){return this._bareJid}addIncludeStanzaFilter($){this._includeStanzaFilters.push($)}addExcludeStanzaFilter($){this._excludeStanzaFilters.push($)}_onOffline(){this._connection._doDisconnect()}_onOnline(){this.connected||this.reLoginNow()}_getInstallId(){const $='install_id';return new R.Promise((Y,J)=>{const G=localStorage.getItem(`${this._instanceId}_install_id`);if(null===G){let W=this;if('ios'===M.getPlatformName()){const X=I.getSource('securesettings');X.get((K)=>{if('string'==typeof K)W._installId=K,localStorage.setItem(`${W._instanceId}_install_id`,W._installId),Y();else{const Q=A.generateGuid();X.set(()=>{W._installId=Q,localStorage.setItem(`${W._instanceId}_install_id`,W._installId),Y()},(Z)=>{J(Z)},$,Q)}},(K)=>{W._log('Secure settings error:',K),J(K)},$)}else if('android'===M.getPlatformName()){const X=I.getSource('device');this._installId=X.uuid,localStorage.setItem(`${this._instanceId}_install_id`,this._installId),Y()}else{const X=A.generateGuid();W._installId=X,localStorage.setItem(`${this._instanceId}_install_id`,this._installId),Y()}}else return this._installId=G,Y()})}_initDbs(){return new R.Promise(($,Y)=>{const J={auto_compaction:!1,revs_limit:1};this._msgDb=new window.PouchDB(`${this._instanceId}_messages`,J),this._contactDb=new window.PouchDB(`${this._instanceId}_contacts`,J),this._cacheDb=new window.PouchDB(`${this._instanceId}_cache`,J),this._cache={},this._roomDb=new window.PouchDB(`${this._instanceId}_rooms`,J),this._participantDb=new window.PouchDB(`${this._instanceId}_participants`,J);const G=[];G.push(this._msgDb.compact()),G.push(this._contactDb.compact()),G.push(this._cacheDb.compact()),G.push(this._roomDb.compact()),G.push(this._participantDb.compact()),R.Promise.all(G).then((W)=>{this._log(`Compaction results: ${W}`),!0===this._options.encryption?A.getEncryptionKey(this._instanceId).then((X)=>{this._cacheDb.crypto({key:X}),this._msgDb.crypto({key:X}),this._contactDb.crypto({key:X}),this._roomDb.crypto({key:X}),this._participantDb.crypto({key:X}),$()}).catch(Y):(console.warn('Encryption has not been enabled! If you have auto-reconnect, auto-login or authenticated attachments enabled your password will be stored unencrypted! \uD83D\uDE31'),$())}).catch((W)=>{this._log(`Compaction errors: ${W}`),Y(W)})})}_setStatus($,Y=!0,J=null){return new R.Promise((G,W)=>{if(this._lastStatusId===$)G();else{const X={id:$,label:null,reason:J};$===H.default.Strophe.Status.CONNECTING?X.label='Connecting':$===H.default.Strophe.Status.CONNFAIL?X.label='Connection failed':$===H.default.Strophe.Status.DISCONNECTING?X.label='Disconnecting':$===H.default.Strophe.Status.DISCONNECTED?X.label='Disconnected':$===H.default.Strophe.Status.CONNECTED?X.label='Connected':$===H.default.Strophe.Status.AUTHFAIL?X.label='Authentication failed.':$===H.default.Strophe.Status.ERROR?X.label=J||'An unknown error occurred.':void 0;this._lastStatusId!==X.id&&!1!==Y&&this._dispatchEvent(z.EVENT_TYPES.STATUS,X),this._lastStatusId=X.id,this._setCacheItem('connection_status',X).then(G).catch(W)}})}static _isReasonToReconnect($){if(!$||'string'!=typeof $)return!0;let Y=!0;switch($.toLowerCase()){case'kicked by administrator':case'replaced by new connection':case'conflict':Y=!1;}return Y}static _translateCondition($){if(!$)return null;switch($.toLowerCase()){case'conflict':return'You already have an active session. Please log out of any previous sessions or wait for the previous login attempt to timeout.';case'system-shutdown':return'Remote server was shut down.';case'connection-timeout':return'The connection to the server timed out.';case'socket closed, probably due to no network connectivity.':case'invalid username or password':case'kicked by administrator':return $;default:return'Connection closed unexpectedly.';}}_connect($,Y){return new R.Promise((J,G)=>{this._connection&&this._connection.connected&&this._connection._doDisconnect(),this._connection=new H.default.Strophe.Connection(this._endpoint,{instance_id:this._instanceId}),this._connection.addHandler(this._onStanza.bind(this),null,'message'),this._connection.addHandler((K)=>{return this._onPresence(z.xmlToJson(K))},null,'presence');const W=setTimeout(()=>{this._connection._doDisconnect(),G('Connection took more than 5 seconds to be established, connection closed.')},this._options.connectTimeout),X=!0===this._options.streamResumption?this._getCacheItem('stream_management_id'):R.Promise.resolve();X.then((K)=>{this._connection.streamManagement.prevId=K;let Q=!1;this._forcedLogout&&(!0===this._options.useEncodedJidAsResource&&(this._connection.override=!0),this._forcedLogout=!1),this._connection.connect($,Y,(Z,ee)=>{if(!0!==this._reLoggingIn&&this._setStatus(Z,!0,ee),!0==Q)return!1;switch(Z){case H.default.Strophe.Status.ERROR:case H.default.Strophe.Status.AUTHFAIL:case H.default.Strophe.Status.CONNFAIL:case H.default.Strophe.Status.DISCONNECTED:const te=z._translateCondition(ee);let ne='Connection Disconnected';Z===H.default.Strophe.Status.ERROR&&(ne='Connection Error',this._onError(ne,te)),Z===H.default.Strophe.Status.AUTHFAIL&&(ne='Authentication Failed'),Z===H.default.Strophe.Status.CONNFAIL&&(ne='Connection Failed'),null!==te&&(ne+=': '+te);const ae=(se,oe)=>{const ie=oe[se];ie.pauseable?!ie.paused&&(this._log(`Pausing timer for request with ID '${se}'...`),ie.pause()):(this._log(`Ending timer for request with ID '${se}'...`),ie.end())};0<Object.keys(this._sendTimeouts).length&&Object.keys(this._sendTimeouts).forEach((se)=>ae(se,this._sendTimeouts)),0<Object.keys(this._botCommandTimeouts).length&&Object.keys(this._botCommandTimeouts).forEach((se)=>ae(se,this._botCommandTimeouts)),clearTimeout(W),this.connected=!1,this._stopPing(),this._log('Disconnected:',ee),this._alreadyReLoggingIn=!1,!1===this._loggingOut&&!0===this._options.autoReconnect&&Z!==H.default.Strophe.Status.AUTHFAIL&&!0===z._isReasonToReconnect(ee)&&(this._log('Attempting to re-login...'),this._reLogin()),Q=!0,G({msg:ne,status:Z,condition:ee});break;case H.default.Strophe.Status.CONNECTED:clearTimeout(W),this.connected=!0,J(ee);}})})})}_enableStreamManagement(){return new R.Promise(($,Y)=>{const J=(G)=>{G.id===H.default.Strophe.Status.DISCONNECTED&&(this.removeEventListener(z.EVENT_TYPES.STATUS,J),Y(`Disconnected during stream management enabling.`))};if(this.addEventListener(z.EVENT_TYPES.STATUS,J),!1===this.connected||null===this._connection)Y('You must have an active connection to enable stream management');else{if(!this._connection.streamManagement)throw new Error('Stream management is required.');try{this._connection.addHandler((G)=>{return this._log('Stream resumption enabled!'),this._setCacheItem('stream_management_id',G.getAttribute('id')).then(()=>{this.removeEventListener(z.EVENT_TYPES.STATUS,J),$()}),!1},'urn:xmpp:sm:3','enabled'),this._connection.streamManagement.enable(this._options.maxStreamResumptionTime)}catch(G){console.error(G),Y()}}})}_enableMessageCarbons(){return this.sendIq(null,'set',{enable:{$attributes:{xmlns:z.NAMESPACES.CARBONS},$value:''}})}_initialisePing(){return new R.Promise(($)=>{!0===this._options.enablePing&&(null!==this._pingInterval&&clearInterval(this._pingInterval),this._pingInterval=setTimeout(()=>{this._sendPing().then(()=>{this._initialisePing()}).catch(()=>{this._log('Ping failed.'),!0===this._options.autoReconnect&&(this._log('Auto-reconnect enabled, so let\'s try and reconnect!'),this._connection&&this._connection._doDisconnect(),this._reLogin())})},this._options.pingInterval)),$()})}_sendPing(){return new R.Promise(($,Y)=>{this._pingTimeout=setTimeout(()=>{return this.connected?void(this.connected=!1,this._setStatus(H.default.Strophe.Status.DISCONNECTED),!0===this._options.autoReconnect&&this._setStatus(H.default.Strophe.Status.CONNECTING),Y()):void $()},this._options.pingTimeout),this.sendIq(this._domain,'get',{ping:{$attributes:{xmlns:z.NAMESPACES.PING}}},this._options.pingTimeout).then(()=>{clearTimeout(this._pingTimeout),$()}).catch(Y)})}_makeParticipantsOffline(){return new R.Promise(($,Y)=>{this._participantDb.allDocs({include_docs:!0}).then((J)=>{const G=J.rows.filter((W)=>{return!W.doc.language}).map((W)=>{return W.doc.online=!1,W.doc});this._participantDb.bulkDocs(G).then($).catch((W)=>{this._onError(`Unable to bulk update participants to offline status.`,W),Y(W)})}).catch((J)=>{this._onError(`Unable to get participants from database.`,J),Y(J)})})}_makeContactsOffline(){return new R.Promise(($,Y)=>{this.getContacts().then((J)=>{J.forEach((G)=>{G.online=!1}),this._contactDb.bulkDocs(J).then(function(){$()}).catch((G)=>{this._onError(`Unable to bulk update contacts to offline status.`,G),Y(G)})}).catch((J)=>{this._onError(`Unable to get contacts from database.`,J),Y(J)})})}resumeTimers(){0<Object.keys(this._sendTimeouts).length&&Object.keys(this._sendTimeouts).forEach(($)=>{const Y=this._sendTimeouts[$];Y.paused&&(this._log(`Resuming send timer for request with ID '${Y.id}'...`),Y.resume())}),0<Object.keys(this._botCommandTimeouts).length&&Object.keys(this._botCommandTimeouts).forEach(($)=>{const Y=this._botCommandTimeouts[$];Y.paused&&(this._log(`Resuming bot command timer for request with ID '${Y.id}'...`),Y.resume())})}reLoginNow(){if(this._alreadyReLoggingIn)return void this._log('Not executing reLoginNow() because _alreadyReLoggingIn is currently \'true\'.');this._alreadyReLoggingIn=!0,this._clearReLoginTimeout();const $=[this._getCacheItem('user_jid'),this._getCacheItem('user_password')];R.Promise.all($).then((Y)=>{const J=Y[0],G=Y[1];J!==void 0&&G!==void 0&&(this._log(`Auto-logging in with JID '${J}'.`),this._setStatus(H.default.Strophe.Status.CONNECTING),this._login(J,G,!0).then((W)=>{this._reLoginBackOff=3e3,this._log(`Auto-login success.`),this._reLoggingIn=!1,this.connected=!0;const X=[];for(let K in this._joinedRooms)X.push(this.joinRoom(K));R.Promise.all(X).then(()=>{this._setStatus(H.default.Strophe.Status.CONNECTED).then(()=>{!1!==this._options.autoResumeTimers&&this.resumeTimers(),this._dispatchEvent(z.EVENT_TYPES.AUTO_RECONNECTED,{resumed:W}),this._alreadyReLoggingIn=!1}).catch((K)=>{this._alreadyReLoggingIn=!1,console.error('Couldn\'t set connection status:',K)})}).catch((K)=>{this._onError('Couldn\'t join all rooms on re-login, logging out.',K),this.logout(),this._alreadyReLoggingIn=!1})}).catch((W)=>{if(this._alreadyReLoggingIn=!1,W.status==H.default.Strophe.Status.AUTHFAIL){const X={id:H.default.Strophe.Status.DISCONNECTED,label:'Authentication Failed.',wontReconnect:!0,reason:W.condition};this._dispatchEvent(z.EVENT_TYPES.STATUS,X)}else this._reLoginBackOff+=3e3,this._reLoginBackOff>this._options.maxReconnectBackoff&&(this._reLoginBackOff=this._options.maxReconnectBackoff),this._log(`Couldn't re-login, trying again in ${this._reLoginBackOff/1e3} seconds...`),this._reLogin()}))}).catch((Y)=>{this._onError('Couldn\'t get user JID or user password for re-login!',Y)})}_reLogin(){if(!0===this._loggingOut)return void this._log('Not executing _reLogin because _loggingOut is currently \'true\'.');if(this._reLoggingIn=!0,this._clearReLoginTimeout(),this._log('Re-login back off time is:',this._reLoginBackOff),0<this._reLoginBackOff){const $={id:H.default.Strophe.Status.DISCONNECTED,label:'Disconnected',reconnectTime:this._reLoginBackOff};this._dispatchEvent(z.EVENT_TYPES.STATUS,$)}this._reLoginTimeout=setTimeout(()=>{this._log('Calling reLoginNow()...'),this.reLoginNow()},this._reLoginBackOff)}_clearReLoginTimeout(){null!==this._reLoginTimeout&&(clearTimeout(this._reLoginTimeout),this._reLoginTimeout=null)}_stopPing(){null!==this._pingTimeout&&clearTimeout(this._pingTimeout),null!==this._pingInterval&&clearInterval(this._pingInterval)}_createPresenceObject(){return new R.Promise(($,Y)=>{const J={$attributes:{from:this._jid,xmlns:z.NAMESPACES.JABBER_CLIENT}};J.show='chat',J.status='Available',this._getCacheItem('chat_status').then((G)=>{G!==void 0&&(G.status&&(J.show=G.status),G.label&&(J.status=G.label),G.metadata&&(J.metadata=z._merge({$attributes:{xmlns:z.NAMESPACES.CT_METADATA}},G.metadata))),$(J)}).catch((G)=>{this._onError('Couldn\'t get chat status to construct presence object!',G),Y(G)})})}sendPresence(){return this._sendPresence()}_sendPresence(){return this._log(`Sending presence...`),new R.Promise(($,Y)=>{this._log(`Creating presence object...`),this._createPresenceObject().then((J)=>{this._log(`Presence object created:`,J),this.sendStanza(J,!1,'presence',!1,!1).then(()=>{this._log(`Presence sent!`),this._log(`Sending presence for all rooms...`);const G=[];for(let W in this._joinedRooms)J.$attributes.to=`${W}@${this._options.mucHost}`,J.x={$attributes:{xmlns:z.NAMESPACES.MUC}},G.push(this.sendStanza(J,!1,'presence',!1,!1));R.Promise.all(G).then(()=>{this._log(`Finished sending presence(s).`),$()}).catch((W)=>{this._onError('Couldn\'t send all presence objects:',W),Y(W)})}).catch((G)=>{this._onError('Couldn\'t send initial presence object:',G),Y(G)})}).catch((J)=>{this._onError('Couldn\'t create presence object:',J),Y(J)})})}getServerTime(){return this._isMethodReady(!0,!0),new R.Promise(($,Y)=>{this.sendIq(this._domain,'get',{time:{$attributes:{xmlns:z.NAMESPACES.TIME}}}).then((J)=>{if(void 0!==J.iq.time&&J.iq.time.utc){const G=new Date(J.iq.time.utc).valueOf(),W=Date.now();this._serverTimeDiff=G-W}$(this._serverTimeDiff)}).catch(Y)})}getSyncedTimestamp($){if(null===this._serverTimeDiff)return $;const Y=Math.abs(this._serverTimeDiff);return 0<=this._serverTimeDiff?$+Y:$-Y}login($,Y){return this._login($,Y,!1)}_login($,Y,J=!1){if(this._isMethodReady(!0),!$)throw new Error('Parameter \'jid\' must be provided.');if(!Y)throw new Error('Parameter \'password\' must be provided.');return!0===this._reLoggingIn&&!1===J&&(this._clearReLoginTimeout(),this._reLoggingIn=!1),this._loggingOut=!1,new R.Promise((G,W)=>{this._getInstallId().then(()=>{this._getCacheItem('user_jid').then((X)=>{if(!0===this.connected&&!0===this.loggedIn&&X===H.default.Strophe.getBareJidFromJid($))G(!1);else{const K=H.default.Strophe.getResourceFromJid($);if(null!==K)this.resource=K,this._jid=$,this._bareJid=H.default.getBareJidFromJid(this._jid);else{if(this._bareJid=$,!0===this._options.useEncodedJidAsResource)this.resource=btoa(this._bareJid);else{const ee=localStorage.getItem(`${this._instanceId}_resource`);null===ee?(this.resource=this._installId,localStorage.setItem(`${this._instanceId}_resource`,this.resource)):this.resource=ee}this._jid=this._bareJid+'/'+this.resource}const Q=()=>{this.loggedIn=!0,localStorage.removeItem(`${this._instanceId}_logging_in`)};this.username=H.default.Strophe.getNodeFromJid(this._jid),this._domain=this._bareJid.split('@')[1];const Z=()=>{let ee=!1;const te=null!==localStorage.getItem(`${this._instanceId}_logging_in`);te&&this._log('Previous login attempt failed, calling a force logout to clean-up.'),this.logout(te,!0).then(()=>{return this._embellishPasswordWithAdToken(Y)}).then((ne)=>{return this._connect(this._jid,ne).then((ae)=>{ee='resumed'===ae,localStorage.setItem(`${this._instanceId}_logging_in`,'true')})}).then(()=>{return!1==ee?this._enableStreamManagement():R.Promise.resolve()}).then(()=>{return!1==ee&&!0===this._options.enableMessageCarbons?this._enableMessageCarbons():R.Promise.resolve()}).then(()=>{return!1==ee?this.getServerTime():R.Promise.resolve()}).then(()=>{return!1==ee?this._setCacheItem('user_jid',this._bareJid):R.Promise.resolve()}).then(()=>{return new R.Promise((ne,ae)=>{!1==ee&&(!0===this._options.autoReconnect||!0===this._options.autoLogin||!0===this._options.authAttachments)?this._setCacheItem('user_password',Y,!0).then(ne).catch(ae):ne()})}).then(()=>{return ee?void 0:R.Promise.all([this._makeContactsOffline(),this._makeParticipantsOffline()])}).then(()=>{return new R.Promise((ne)=>{!ee&&this.isPushEnabled()?this._getPushToken().then((se)=>{return this.registerForPush(se)}).then(()=>{ne()}).catch((se)=>{this._log('Failed to register for push: '+se),ne()}):ne()})}).then(()=>{return this._initialisePing()}).then(()=>{return!0===this._options.updateUserDirectoryOnLogin?this.updateUserDirectory():R.Promise.resolve()}).then(()=>{return!1==ee&&!1!==this._options.updateRosterOnLogin?this._getCacheItem('roster_version').then((ne)=>{return this.sendIq(this._bareJid,'get',{query:{$attributes:{xmlns:'jabber:iq:roster',ver:ne||''}}})}):R.Promise.resolve()}).then((ne)=>{return this._processRoster(ne)}).then(()=>{return new R.Promise((ne,ae)=>{if(!1==ee&&!1!==this._options.mam.auto){const se=this.getLastArchiveId();this.listSubscriptions().then((oe)=>{const ie=[];oe.forEach((de)=>{ie.push(this.queryMamByRoomName(de.name,!0,se))}),R.Promise.all(ie).then(()=>{this.queryMam(null,se).then(ne).catch((de)=>{this._onError(`Unable to query the MAM for missed messages.`,de),ae(de)})}).catch((de)=>{this._onError(`Unable to query the MAM for missed messages in a subscribed room.`,de),ae(de)})}).catch((oe)=>{this._onError(`Unable to get a list of subscriptions.`,oe),ae(oe)})}else ne()})}).then(()=>{Q(),G(ee)}).catch((ne)=>{null!==this._connection&&!0===this._connection.connected&&(this._connection._doDisconnect(),this._connection=null),this._onError(`Unable to complete login process with JID '${$}'.`,ne.msg),W(ne)})};void 0!==X&&X!==this._bareJid?this._clearDbsForNewUser().then(()=>{Z()}):Z()}}).catch(W)}).catch(W)})}isPushEnabled(){return this._options.push.androidEnabled&&'android'===M.getPlatformName()||this._options.push.iosEnabled&&'ios'===M.getPlatformName()}logout($=!1,Y=!1){return new R.Promise((J,G)=>{const W=()=>{this._joinedRooms={},this._reLoggingIn=!1,this.connected=!1,this.loggedIn=!1,this._stopPing(),this._clearReLoginTimeout(),localStorage.removeItem(`${this._instanceId}_logging_in`);const X=[this._deleteCacheItem('stream_management_id')];!0!==Y&&X.push(this._deleteCacheItem('user_password')),R.Promise.all(X).then(()=>{this._loggingOut=!1,J()}).catch(G)};if(!0!==$&&(!1===this.connected||!0===this._loggingOut))J();else if(null!==this._connection&&!0===this._connection.connected&&!1===this._loggingOut){this._loggingOut=!0;const X=()=>{this._stopPing(),this._clearReLoginTimeout(),this._connection.disconnect('user_logout'),this._connection=null,W()};this.isPushEnabled()?this.disablePush().then(()=>{X()}).catch((K)=>{this._log(`Unable to disable push notifications: ${K}`),X()}):X()}else W()})}forceLogout(){return new R.Promise(($,Y)=>{this._forcedLogout=!0,this._loggingOut=!0,this._joinedRooms={},this._reLoggingIn=!1,this.connected=!1,this.loggedIn=!1,this._stopPing(),this._clearReLoginTimeout(),localStorage.removeItem(`${this._instanceId}_logging_in`),this._connection&&(this._connection.disconnect('user_logout'),this._connection=null),R.Promise.all([this._deleteCacheItem('stream_management_id'),this._deleteCacheItem('user_password')]).then(()=>{this._loggingOut=!1,$()}).catch(Y)})}resendMessage($){return this._isMethodReady(!0,!0),new R.Promise((Y,J)=>{this.getMessageById($).then((G)=>{this._log(`Resending message with ID '${$}':`,G);const W={$attributes:{id:G._id,to:G.recipient_id,from:G.sender_id,type:G.type,xmlns:z.NAMESPACES.JABBER_CLIENT},markable:{$attributes:{xmlns:z.NAMESPACES.CHAT_MARKERS}},body:G.body,data:G.data,attachments:[]};void 0!==G.addresses&&(W.addresses={$attributes:{xmlns:z.NAMESPACES.ADDRESS},address:G.addresses}),G.attachments.forEach((X)=>{W.attachments.push({name:X.name,type:X.type,size:''+X.size,get:X.get})}),this.sendStanza(W).then(()=>{Y(G)}).catch(J)}).catch(J)})}_stanzaResponseHandler($,Y){this._sendTimeouts[$]&&(this._log(`Clearing send timeout for message with ID '${$}'.`),this._sendTimeouts[$].cancel(),delete this._sendTimeouts[$]),Y?this._rejectSendStanzaPromise($,Y):this._resolveSendStanzaPromise($)}_resolveSendStanzaPromise($,Y){this._sendStanzaPromises[$]&&(this._log(`Resolving send stanza promise for message with ID '${$}'.`),this._sendStanzaPromises[$].resolve(Y),delete this._sendStanzaPromises[$],this._sendTimeouts[$]&&delete this._sendTimeouts[$])}_rejectSendStanzaPromise($,Y){this._sendStanzaPromises[$]&&(this._log(`Rejecting send stanza promise for message with ID '${$}'.`),this._sendStanzaPromises[$].reject(Y),delete this._sendStanzaPromises[$],this._sendTimeouts[$]&&delete this._sendTimeouts[$])}sendStanza($,Y=!0,J='message',G=!0,W=!0){return this._isMethodReady(!0,!0),new R.Promise((X,K)=>{$.$attributes||($.$attributes={}),void 0===$.$attributes.id&&($.$attributes.id=this.getUniqueId());let Q=$.$attributes.id;if(!0===this.connected&&null!==this._connection){this._sendStanzaPromises[Q]={resolve:X,reject:K},this._sendTimeouts[Q]=new B.default(Q,()=>{const Z=`${J.replace(/^\w/,(ee)=>ee.toUpperCase())} with ID '${Q}' was not received by the server within ${this._options.sendTimeout}ms.`;this._log(Z,$),this._rejectSendStanzaPromise(Q,Z)},this._options.sendTimeout,W);try{void 0===$.$attributes&&($.$attributes={}),void 0===$.$attributes.from&&($.$attributes.from=this._jid),!0===Y&&($.store={$attributes:{xmlns:z.NAMESPACES.HINTS},$value:''}),!0===G&&($.timestamp={$attributes:{xmlns:z.NAMESPACES.CT_CLIENT_TIMESTAMP},$value:Date.now()});const Z=z.jsonToXml(J,$);this._connection.send(Z)}catch(Z){const ee=`Unable to send XMPP ${J}`;this._onError(ee,Z),this._rejectSendStanzaPromise(Q,ee)}}else{const Z='You\'re not currently connected, please connect and try again.';this._onError(Z),this._rejectSendStanzaPromise(Q,Z)}})}_sendMessageWithAttachments($,Y){if(!this._options.uploadHost)throw new Error('Cannot send attachments without a upload host configured.');this._log(`Sending message with ID ${$._id} with attachments:`,Y);let J=R.Promise.resolve({});return Y.forEach((G,W)=>{J=J.then(()=>{return new R.Promise((X,K)=>{N.getFileSize(G).then((Q)=>{const Z={$attributes:{id:this.getUniqueId(),to:this._options.uploadHost,from:this._jid,type:'get',xmlns:z.NAMESPACES.JABBER_CLIENT},request:{$attributes:{xmlns:z.NAMESPACES.HTTP_UPLOAD},filename:G.name.replace('.encrypted',''),size:''+Q,"content-type":G.type}};this.sendIq(this._options.uploadHost,'get',Z).then(X).catch(K)}).catch((Q)=>{console.error(`Couldn't get file size for file with name '${G.name}'.`,Q),K(Q)})})}).then((X)=>{return new R.Promise((K)=>{!0===this._options.authAttachments?this._getCacheItem('user_password').then((Q)=>{return this._embellishPasswordWithAdToken(Q)}).then((Q)=>{K([X,{Authorization:'Basic '+btoa(this._bareJid+':'+Q),"Content-Type":G.type}])}):K([X,{"Content-Type":G.type}])})}).then((X)=>{const K=X[0],Q=X[1];return new R.Promise((Z,ee)=>{const te=K.iq.slot.put,ne=K.iq.slot.get;N.upload(G.path,te,ne,Q).then(()=>{this._dispatchEvent(z.EVENT_TYPES.UPLOAD_SUCCESS,$),Z(['transferred',ne,te])}).catch((ae)=>{this._dispatchEvent(z.EVENT_TYPES.UPLOAD_FAILED,$);const se=`Couldn't successfully upload file '${G.path}' to the server:`;this._onError(se,ae),ee({error:se,message:$})})})}).then((X)=>{const K=X[0],Q=X[1],Z=X[2];return new R.Promise((ee,te)=>{this.saveMessage($._id,(ne)=>{return ne.attachments[W].state=K,ne.attachments[W].get=Q,ne.attachments[W].put=Z,M.isBrowser()&&(ne.attachments[W].path=Q),ne}).then(ee).catch(te)})})}),J.then(()=>{return this.resendMessage($._id)})}_prepareMessageAttachmentsForSend($,Y){return this._log('Preparing to send the following attachments:',Y),new R.Promise((J,G)=>{const W=[];Y.forEach((X)=>{W.push(new R.Promise((K,Q)=>{this._log('Getting file information for file:',X),N.getFileInfo(X).then((Z)=>{this._log('Got file info for file:',Z),K(Object.assign({get:'',put:'',state:'transferring'},Z))}).catch(Q)}))}),R.Promise.all(W).then((X)=>{this._messageStanzaToDbObject({message:$},{mine:!0,attachments:X}).then((K)=>{this._dispatchEvent(z.EVENT_TYPES.UPLOAD_STARTED,K),this._sendMessageWithAttachments(K,X).then(J).catch(G)}).catch(G)})})}sendChatMessage($,Y,J,G=[],W=!0){if(this._isMethodReady(!0,!0),!$)throw new Error('Parameter \'to\' is required.');if(this._options.mucHost&&-1<$.indexOf(this._options.mucHost))throw new Error('You are trying to send a peer-to-peer chat message to a room, please use the \'sendGroupChatMessage\' method instead.');return new R.Promise((X,K)=>{const Q={$attributes:{id:this.getUniqueId(),from:this._jid,to:$,type:'chat',xmlns:z.NAMESPACES.JABBER_CLIENT}};!0===W&&(Q.markable={$attributes:{xmlns:z.NAMESPACES.CHAT_MARKERS}}),null!==Y&&(Q.body=Y),null!==J&&(Q.data=J),1>G.length?this.sendMessage(Q).then(X).catch(K):this._prepareMessageAttachmentsForSend(Q,G).then(X).catch(K)})}sendMulticastMessage($,Y,J,G=[],W=!0){return this._isMethodReady(!0,!0),new R.Promise((X,K)=>{const Q={$attributes:{id:this.getUniqueId(),from:this._jid,to:`${this._options.multicastHost}`,type:'chat',xmlns:z.NAMESPACES.JABBER_CLIENT},addresses:{$attributes:{xmlns:z.NAMESPACES.ADDRESS},address:$.map((Z)=>{return{$attributes:Z}})}};!0===W&&(Q.markable={$attributes:{xmlns:z.NAMESPACES.CHAT_MARKERS}}),null!==Y&&(Q.body=Y),null!==J&&(Q.data=J),1>G.length?this.sendMessage(Q).then(X).catch(K):this._prepareMessageAttachmentsForSend(Q,G).then(X).catch(K)})}sendGroupChatMessage($,Y,J,G=[],W=!0,X=!1){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');if(!$)throw new Error('Parameter \'roomName\' is required.');return new R.Promise((K,Q)=>{const Z={$attributes:{id:this.getUniqueId(),from:this._jid,to:`${$}@${this._options.mucHost}`,type:'groupchat',xmlns:z.NAMESPACES.JABBER_CLIENT}};!0===W&&(Z.markable={$attributes:{xmlns:z.NAMESPACES.CHAT_MARKERS}}),null!==Y&&(Z.body=Y),null!==J&&(Z.data=J),!0!==X&&(Z.exclude={$attributes:{xmlns:z.NAMESPACES.INFINITY_MAM,archive:'user'}}),1>G.length?this.sendMessage(Z).then(K).catch(Q):this._prepareMessageAttachmentsForSend(Z,G).then(K).catch(Q)})}sendMessage($){return new R.Promise((Y,J)=>{this._messageStanzaToDbObject({message:$},{state:{sent:!1},mine:!0}).then((G)=>{this.sendStanza($).then(()=>{this.saveMessage(G._id,(W)=>{return W.state.sent=!0,W}).then(Y).catch(J)}).catch(J)}).catch(J)})}sendIq($,Y,J,G=this._options.sendTimeout||5e3,W){this._isMethodReady(!0,!0);const X=W===void 0?this.getUniqueId():W;return new R.Promise((K,Q)=>{const Z=(te)=>{te.id===H.default.Strophe.Status.DISCONNECTED&&(this.removeEventListener(z.EVENT_TYPES.STATUS,Z),Q(`Disconnected during IQ request.`))};this.addEventListener(z.EVENT_TYPES.STATUS,Z);let ee=null;try{for(let te in ee={$attributes:{id:X,type:Y,from:this._connection.jid}},$&&(ee.$attributes.to=$),J)ee[te]=J[te]}catch(te){this._onError('Couldn\'t construct IQ message:',te),Q(te)}if(null!==ee){const te=z.jsonToXml('iq',ee);this._connection.sendIQ(te,(ne)=>{try{this.removeEventListener(z.EVENT_TYPES.STATUS,Z),K(z.xmlToJson(ne))}catch(ae){this._onError('Couldn\'t convert IQ response to JSON.',ae),Q(ae)}},Q,G)}})}getPrivateData(){this._isMethodReady(!0,!0),this._log('Fetching Private XML Data for:',this._bareJid);const $={privatexmldata:{$attributes:{xmlns:z.NAMESPACES.CT_PRIVATE_XML_STORAGE}}};return new R.Promise((Y,J)=>{return this._getPrivateXMLStorage($).then((G)=>{G!==void 0&&G.privatexmldata!==void 0&&G.privatexmldata.json!==void 0?Y(JSON.parse(G.privatexmldata.json)):J('No private data found, or unable to fetch')})})}_getPrivateXMLStorage($){return this._log('Fetching Private XML Storage Data for: ',this._bareJid),new R.Promise((Y,J)=>{this.sendIq(this._bareJid,'get',{query:Object.assign({$attributes:{xmlns:z.NAMESPACES.PRIVATE_XML_STORAGE}},$)}).then((G)=>{this._log('Fetched Private XML Storage Data for:',this._bareJid),Y(G.iq.query)}).catch(()=>{J('Unable to send IQ for Private XML Storage')})})}setPrivateData($){this._isMethodReady(!0,!0),this._log('Setting Private XML data for:',this._bareJid);const Y=JSON.stringify($),J={privatexmldata:{$attributes:{xmlns:z.NAMESPACES.CT_PRIVATE_XML_STORAGE},json:Y}};return this._setPrivateXMLStorage(J)}_setPrivateXMLStorage($){const Y={query:Object.assign({$attributes:{xmlns:z.NAMESPACES.PRIVATE_XML_STORAGE}},$)};return new R.Promise((J,G)=>{this.sendIq(null,'set',Y).then(()=>{J(),this._log('Set Private XML Storage for:',this._bareJid)}).catch(G)})}_getvCard($){return this._log('\uD83C\uDCA1 Fetching vCard for:',$),new R.Promise((Y,J)=>{this.sendIq($,'get',{vCard:{$attributes:{xmlns:'vcard-temp'}}}).then((G)=>{this._log('Fetched vCard for:',$),Y(G.iq.vCard)}).catch(()=>{J('Unable to send IQ for vCard')})})}_setvCard($,Y){this._log('\uD83C\uDCA1 Setting vCard for:',$);const J=new DOMParser().parseFromString(Y,'text/xml'),G=z.xmlToJson(J);return new R.Promise((W,X)=>{this.sendIq(null,'set',G['#document']).then(()=>{W(),this._log('\uD83C\uDCA1 Set vCard for:',$)}).catch(X)})}addEventListener($,Y){if(!z._validateEventType($))throw new Error('Invalid event type provided.');$===z.EVENT_TYPES.INITIALISED&&!0===this._initialised?Y(null):(this._eventListeners[$]===void 0&&(this._eventListeners[$]=[]),this._eventListeners[$].push(Y))}removeEventListener($,Y){if(!z._validateEventType($))throw new Error('Invalid event type provided.');this._eventListeners[$]!==void 0&&this._eventListeners[$].forEach((J,G)=>{J===Y&&this._eventListeners[$].splice(G,1)})}_searchDb($,Y,J,G,W,X){return new R.Promise((K,Q)=>{const Z=[];for(let ee in Y)0===ee.indexOf('$')?-1<['$or','$and','$not','$nor','$all'].indexOf(ee)&&Array.isArray(Y[ee])&&0<Y[ee].length&&Y[ee].forEach((te)=>{for(let ne in te)Z.push(ne)}):Z.push(ee);0<Z.length&&$.createIndex({index:{fields:Z}}).then(()=>{let ee={selector:Y};Array.isArray(J)&&0<J.length&&(ee.sort=J),Array.isArray(G)&&0<G.length&&(ee.fields=G),X&&(ee.skip=X),W&&(ee.limit=W),$.find(ee).then((te)=>{K(te.docs)}).catch(Q)}).catch(Q)})}findMessages($,Y,J,G,W){return this._isMethodReady(!0),this._searchDb(this._msgDb,$,Y,J,G,W)}getAllMessageIds(){return this._isMethodReady(!0),new R.Promise(($,Y)=>{this._msgDb.allDocs().then((J)=>{let G=[];J.rows&&0<J.rows.length&&(G=J.rows.map((W)=>{return W.id})),$(G)}).catch(Y)})}getChatHistory($,Y,J,G,W){this._isMethodReady(!0);let X={$or:[{sender_id:$},{recipient_id:$}]};return!0===J&&(X['state.read']=!0),new R.Promise((K,Q)=>{this.findMessages(X,Y,null,G,W).then((Z)=>{const ee=Z.sort((te,ne)=>{return te.ts-ne.ts});K(ee)}).catch(Q)})}getMessagesById($){return this._msgDb.allDocs({include_docs:!0}).then((Y)=>{return Y.rows.filter((J)=>{return $.includes(J.id)})})}getMessageById($){if(this._isMethodReady(!0),!$)throw new Error(`A message ID must be provided.`);return this._msgDb.get($)}deleteMessage($,Y=!0){return this._isMethodReady(!0),new R.Promise((J,G)=>{if(!$)J();else{const W=[];Y&&void 0!==$.attachments&&$.attachments.forEach((X)=>{void 0!==X.path&&W.push(new R.Promise((K)=>{return'ios'!==M.getPlatformName()||X.path.includes('file://')||(X.path=`file://${X.path}`),N.deleteFile(X.path).then(K).catch((Q)=>{this._onError(`Couldn't delete attachment: '${X.name}':`,Q),K()})}))}),R.Promise.all(W).then(()=>{this._msgDb.remove($).then(()=>{this._log('Message successfully deleted with ID:',$._id),J()}).catch((X)=>{this._onError(`Couldn't delete message with ID '${$._id}'.`,X),G(X)})}).catch((X)=>{this._onError(`Couldn't delete attachment(s) for message with ID '${$._id}':`,X),G(X)})}})}deleteMessageById($,Y=!0){return this._isMethodReady(!0),this._log('Deleting message with ID:',$),new R.Promise((J,G)=>{this.getMessageById($).then((W)=>{this.deleteMessage(W,Y).then(J).catch(G)}).catch((W)=>{this._onError(`Couldn't get message with ID '${$}' to delete it.`,W),G(W)})})}deleteMessages($){return this._isMethodReady(!0),new R.Promise((Y,J)=>{this._searchDb(this._msgDb,$).then((G)=>{this._log('\uD83D\uDDD1\uFE0F There are '+G.length+' messages to delete');const W=[];G.forEach((X)=>{W.push(this.deleteMessage(X))}),R.Promise.all(W).then(Y).catch((X)=>{this._onError(`Couldn't delete messages from database.`,X),J(X)})})})}deleteMessagesByRoom($){return console.warn('This method is going to be DEPRECATED, please use \'deleteMessagesByRoomName\' instead.'),this.deleteMessages({$or:[{sender_id:$},{recipient_id:$}]})}deleteMessagesByRoomName($){if(!this._options.mucHost)throw new Error('mucHost must be provided as an option.');return this.deleteMessages({$or:[{sender_id:`${$}@${this._options.mucHost}`},{recipient_id:`${$}@${this._options.mucHost}`}]})}saveMessage($,Y){return this._isMethodReady(!0),new R.Promise((J,G)=>{this._saveObject(z.OBJECT_TYPES.MESSAGE,$,Y,(W)=>{J(W)},(W)=>{G(W)})})}_clearDbsForNewUser(){return new R.Promise(($,Y)=>{this.destroyDbs(!1).then(()=>{this._dispatchEvent(z.EVENT_TYPES.AUTO_DBS_DESTROYED,null),$()}).catch(Y)})}destroyDbs($=!0,Y=!1){return new R.Promise((J,G)=>{if(this._destroyingDbs)return void J();this._log('\uD83D\uDCA3 Destroying all databases and data...'),this._destroyingDbs=!0,this._lastArchiveId=null,localStorage.removeItem(`${this._instanceId}_last_archive_id`),this.resource=null,localStorage.removeItem(`${this._instanceId}_resource`),localStorage.removeItem(`${this._instanceId}_counters`),!0!==Y&&localStorage.removeItem(`${this._instanceId}_key`),localStorage.removeItem(`${this._instanceId}_logging_in`),localStorage.removeItem(`${this._instanceId}_presence_needed`);const W=[this._msgDb.destroy(),this._contactDb.destroy(),this._roomDb.destroy(),this._participantDb.destroy()];!1!==I.getSource('file')&&W.push(N.deleteAttachments()),!0!==Y&&W.push(this._cacheDb.destroy()),W.push(new R.Promise((X,K)=>{this._userDirectory.initialised?(localStorage.removeItem(`${this._instanceId}_ud_iv`),this._userDirectory.destroy().then(()=>{X()}).catch(K)):X()})),R.Promise.all(W).then(()=>{this._initDbs().then(()=>{!0===$&&this._dispatchEvent(z.EVENT_TYPES.DBS_DESTROYED,null),this._log('\u2705 Successfully destroyed all data.'),this._destroyingDbs=!1,J()}).catch((X)=>{this._destroyingDbs=!1,G(X)})}).catch((X)=>{this._destroyingDbs=!1,G(X)})})}deleteAttachments(){return N.deleteAttachments()}setChatStatus($,Y,J,G){return this._isMethodReady(!0),new R.Promise((W,X)=>{if(z._validateChatStatus($)){const K={status:$,label:Y,metadata:G};K.label||($===z.CHAT_STATUSES.CHAT?K.label='Available':$===z.CHAT_STATUSES.AWAY?K.label='Away':$===z.CHAT_STATUSES.XA?K.label='Extended Away':$===z.CHAT_STATUSES.DND?K.label='Do Not Disturb':void 0),this._setCacheItem('chat_status',K).then(()=>{!0===J?this._sendPresence().then(()=>W(K)).catch(X):W(K)}).catch(X)}else X('Invalid chat status provided, one of \'away\', \'chat\', \'dnd\' or \'xa\' should be specified.')})}getChatStatus(){return this._isMethodReady(!0),this._getCacheItem('chat_status')}setClientState($){if(this._isMethodReady(!0,!0),!z._validateConstants(z.CLIENT_STATES,$))throw new Error('Invalid client state specified.');const Y=z.jsonToXml($,{$attributes:{xmlns:z.NAMESPACES.CLIENT_STATE_INDICATION}});return this._connection.send(Y)}findContacts($,Y,J,G,W){return this._isMethodReady(!0),this._searchDb(this._contactDb,$,Y,J,G,W)}getContacts(){return this._isMethodReady(!0),new R.Promise(($,Y)=>{this._contactDb.allDocs({include_docs:!0}).then((J)=>{const G=J.rows.filter((W)=>{return!W.doc.language}).map((W)=>{return W.doc});$(G)}).catch((J)=>{this._onError(`Unable to get contacts from database.`,J),Y(J)})})}_embellishPasswordWithAdToken($){if(!$)throw new Error('Password must be provided.');return new R.Promise((Y,J)=>{if(!0===M.isElectron()&&!0===M.isWindows()&&this._options.adTokenPlaceholder&&this._options.adSecurityPackage&&this._options.adSpn&&-1<$.indexOf(this._options.adTokenPlaceholder)){const G=I.getSource('sspiclient');!1===G?J('Couldn\'t access sspiclient plugin.'):G.Helper.getUserToken((W)=>{Y($.replace(this._options.adTokenPlaceholder,W))},J,this._options.adSpn,this._options.adSecurityPackage)}else Y($)})}_shouldMarkMessage($,Y){let J=!0;return!1!==$.markable&&($.state.markers.every((G)=>{if(G.type===Y){if('groupchat'===$.type&&G.sender_resource===this.username)return J=!1,!1;if(G.sender_id===this._jid)return J=!1,!1}return!0}),J)}_markMessage($,Y,J=!0){return new R.Promise((G,W)=>{if(!0===$.mine||!1===this._shouldMarkMessage($,Y))G($);else{const X={$attributes:{id:this.getUniqueId(),to:H.default.Strophe.getBareJidFromJid($.stanza.message.$attributes.from),from:this._connection.jid},timestamp:{$attributes:{xmlns:z.NAMESPACES.CT_CLIENT_TIMESTAMP},$value:Date.now()}};X[Y]={$attributes:{xmlns:z.NAMESPACES.CHAT_MARKERS,id:$._id}},'groupchat'===$.type&&(X.$attributes.type='groupchat'),this.sendStanza(X).then(()=>{this.saveMessage($._id,(K)=>{return K.state[Y]=!0,K}).then((K)=>{!1!==J&&this._dispatchEvent(z.EVENT_TYPES.MESSAGE_UPDATED,K),G(K)}).catch(W)}).catch(W)}})}markMessageRead($){return this._isMethodReady(!0,!0),this._markMessage($,z.MARKER_TYPES.READ)}markMessageReadById($){return this._isMethodReady(!0,!0),this.getMessageById($).then((Y)=>{return this.markMessageRead(Y)})}markMessageAcknowleged($){return this._isMethodReady(!0,!0),this._markMessage($,z.MARKER_TYPES.ACKNOWLEDGED)}markMessageAcknowledgedById($){return this._isMethodReady(!0,!0),this.getMessageById($).then((Y)=>{return this.markMessageAcknowleged(Y)})}_dispatchEvent($,Y){if(!z._validateEventType($))throw new Error('Invalid event type provided.');this._eventListeners[$]!==void 0&&this._eventListeners[$].forEach((J)=>{J(Y)})}createRoom($){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('mucHost must be provided as an option.');return new R.Promise((Y,J)=>{const G=`${$}@${this._options.mucHost}`;let W={$attributes:{to:`${G}/${this.username}`,xmlns:z.NAMESPACES.JABBER_CLIENT},x:{$attributes:{xmlns:z.NAMESPACES.MUC}}};this._connection.addHandler((X)=>{const K=z.xmlToJson(X);if(void 0!==K.$attributes&&'error'===K.$attributes.type){const Q=new Error(`Failed to create room '${$}'.`);this._onError(`Unable to create room with name '${$}'.`,Q),J(Q)}else this.sendIq(G,'get',{query:{$attributes:{xmlns:z.NAMESPACES.MUC_OWNER}}}).then(()=>{this.sendIq(G,'set',{query:{$attributes:{xmlns:z.NAMESPACES.MUC_OWNER},x:{$attributes:{xmlns:z.NAMESPACES.X_DATA,type:'submit'},field:[{$attributes:{var:'muc#roomconfig_whois'},value:'anyone'}]}}}).then(()=>{this._log(`Room '${$}' successfully created.`),Y()}).catch(()=>J)}).catch(()=>J);return!1},z.NAMESPACES.MUC,'presence',null,null,`${G}/${this.username}`,{ignoreNamespaceFragment:!0}),this._connection.send(z.jsonToXml('presence',W))})}destroyRoom($){if(this._isMethodReady(!0,!0),!$)throw new Error('Parameter \'roomName\' must be provided.');if(!this._options.mucHost)throw new Error('mucHost must be provided as an option.');return new R.Promise((Y,J)=>{this.sendIq(`${$}@${this._options.mucHost}`,'set',{query:{$attributes:{xmlns:z.NAMESPACES.MUC_OWNER},destroy:{}}}).then(()=>{Y()}).catch(()=>J)})}listRooms($){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('mucHost must be provided as an option.');return new R.Promise((Y,J)=>{const G=()=>{this._roomDb.allDocs({include_docs:!0}).then((W)=>{const X=W.rows.map((K)=>{return K.doc});Y(X)}).catch((W)=>{this._onError(`Couldn't fetch list of rooms from database.`,W),J(W)})};!0===this.connected&&!1!==$?this.sendIq(this._options.mucHost,'get',{query:{$attributes:{xmlns:'http://jabber.org/protocol/disco#items'}}}).then((W)=>{if(W.iq&&W.iq.query&&W.iq.query.item){let X=[];X=Array.isArray(W.iq.query.item)?W.iq.query.item.map((K)=>{return{_id:K.$attributes.jid,name:H.default.Strophe.getNodeFromJid(K.$attributes.jid)}}):[{_id:W.iq.query.item.$attributes.jid,name:H.default.Strophe.getNodeFromJid(W.iq.query.item.$attributes.jid)}],this._roomDb.allDocs({include_docs:!0}).then((K)=>{const Q=[];K.rows.forEach((Z)=>{let ee=Z.doc,te=null;X.every((ne)=>{return ne._id!==ee._id||(te=ne,!1)}),null===te&&Q.push(this._roomDb.remove(ee))}),X.forEach((Z)=>{const ee=new R.Promise((te,ne)=>{this.saveRoom(Z._id,(ae)=>{return void 0===ae._id?ae={_id:Z._id,name:Z.name,ts:this.getSyncedTimestamp(Date.now()),updated_at:null}:(ae.name!==Z.name&&(ae.name=Z.name),ae.updated_at=this.getSyncedTimestamp(Date.now())),ae}).then(te).catch(ne)});Q.push(ee)}),R.Promise.all(Q).then(()=>{G()}).catch((Z)=>{this._onError('Couldn\'t merge list of rooms from server with locally stored list of rooms.',Z),J(Z)})}),Y(X)}else Y([])}).catch(J):G()})}listSubscriptions(){return this._isMethodReady(!0,!0),new R.Promise(($,Y)=>{this._options.mucHost?this.sendIq(this._options.mucHost,'get',{subscriptions:{$attributes:{xmlns:z.NAMESPACES.MUC_SUB}}}).then((J)=>{let G=[];J.iq&&J.iq.subscriptions&&J.iq.subscriptions.subscription&&(Array.isArray(J.iq.subscriptions.subscription)?G=J.iq.subscriptions.subscription.map((W)=>{if(W.$attributes&&W.$attributes.jid)return{name:H.default.Strophe.getNodeFromJid(W.$attributes.jid),jid:W.$attributes.jid}}):J.iq.subscriptions.subscription.$attributes&&J.iq.subscriptions.subscription.$attributes.jid&&(G=[{name:H.default.Strophe.getNodeFromJid(J.iq.subscriptions.subscription.$attributes.jid),jid:J.iq.subscriptions.subscription.$attributes.jid}])),$(G)}).catch(Y):$([])})}joinRoom($){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');if(!$)throw new Error('Parameter \'roomName\' must be provided.');return new R.Promise((Y,J)=>{const G=`${$}@${this._options.mucHost}`;this._createPresenceObject().then((W)=>{W.$attributes.to=`${G}/${this.username}`,W.x={$attributes:{xmlns:z.NAMESPACES.MUC},history:{$attributes:{maxchars:0}}},this._connection.addHandler((X)=>{try{const K=z.xmlToJson(X);K.presence&&void 0===K.presence.error?this.saveRoom(G,(Q)=>{return void 0===Q._id?Q={_id:G,name:$,ts:this.getSyncedTimestamp(Date.now()),updated_at:null}:Q.name!==$&&(Q.name=$,Q.updated_at=this.getSyncedTimestamp(Date.now())),Q}).then((Q)=>{this._joinedRooms[$]=Date.now(),!1===this._options.mam.auto?Y(Q):this.queryMamByRoomName($).then(()=>{Y(Q)}).catch(J)}).catch(J):(this._onError(`Couldn't join room '${$}' with nick '${this.username}'.`,X),J(X))}catch(K){this._onError('Couldn\'t convert stanza XML to JSON',K),J(K)}return!1},z.NAMESPACES.JABBER_CLIENT,'presence',null,null,`${$}@${this._options.mucHost}/${this.username}`,{ignoreNamespaceFragment:!0}),this._connection.send(z.jsonToXml('presence',W))})})}leaveRoom($){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');if(!$)throw new Error('Parameter \'roomName\' must be provided.');return new R.Promise((Y)=>{const J={$attributes:{from:this._jid,xmlns:z.NAMESPACES.JABBER_CLIENT,to:`${$}@${this._options.mucHost}/${this.username}`,type:'unavailable'}};this._connection.send(z.jsonToXml('presence',J)),delete this._joinedRooms[$],Y()})}subscribeToRoom($,Y){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('mucHost must be provided as an option.');if(!$)throw new Error('Parameter \'roomName\' must be provided.');return new R.Promise((J,G)=>{const W={subscribe:{$attributes:{xmlns:z.NAMESPACES.MUC_SUB,nick:this.username}}};if(!Y)for(let X in Y=[],z.MUC_NODES)Y.push(z.MUC_NODES[X]);0<Y.length&&(W.subscribe.event=[],Y.forEach((X)=>{W.subscribe.event.push({$attributes:{node:X}})})),this.sendIq(`${$}@${this._options.mucHost}`,'set',W).then((X)=>{X.iq&&X.iq.subscribe?J(X):this._onError(`Couldn't subscribe to room '${$}.'`,X)}).catch(G)})}listSubscribedUsersForRoom($){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('mucHost must be provided as an option.');return new R.Promise((Y,J)=>{this.sendIq(`${$}@${this._options.mucHost}`,'get',{subscriptions:{$attributes:{xmlns:z.NAMESPACES.MUC_SUB}}}).then((G)=>{let W=[];if(G.iq&&void 0!==G.iq.subscriptions)if(Array.isArray(G.iq.subscriptions.subscription))W=G.iq.subscriptions.subscription.map((X)=>{if(X.$attributes&&void 0!==X.$attributes.jid)return X.$attributes.jid});else if(void 0!==G.iq.subscriptions.subscription){const X=G.iq.subscriptions.subscription;X.$attributes&&void 0!==X.$attributes.jid&&(W=[X.$attributes.jid])}Y(W)}).catch(J)})}unsubscribeFromRoom($){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('mucHost must be provided as an option.');return new R.Promise((Y,J)=>{this.sendIq(`${$}@${this._options.mucHost}`,'set',{unsubscribe:{$attributes:{xmlns:z.NAMESPACES.MUC_SUB}}}).then(Y).catch(J)})}getRoomById($){if(this._isMethodReady(!0),!$)throw new Error(`A room ID must be provided.`);return this._log('Getting room with ID:',$),this._roomDb.get($)}findRooms($,Y,J,G,W){return this._isMethodReady(!0),this._searchDb(this._roomDb,$,Y,J,G,W)}saveRoom($,Y){return this._isMethodReady(!0),new R.Promise((J,G)=>{this._saveObject(z.OBJECT_TYPES.ROOM,$,Y,(W)=>{J(W)},(W)=>{G(W)})})}saveParticipant($,Y){return this._isMethodReady(!0),new R.Promise((J,G)=>{this._saveObject(z.OBJECT_TYPES.PARTICIPANT,$,Y,(W)=>{J(W)},(W)=>{G(W)})})}listParticipantsByRoom($){return this._isMethodReady(!0),this._searchDb(this._participantDb,{room_name:$})}getParticipantByRoomAndJid($,Y){return this._isMethodReady(!0),new R.Promise((J,G)=>{return this._searchDb(this._participantDb,{room_name:$,jid:Y}).then((W)=>{0<W.length?J(W[0]):J(null)}).catch(G)})}purgeParticipantsByUpdatedAt($){return this._isMethodReady(!0),new R.Promise((Y,J)=>{this._searchDb(this._participantDb,{updated_at:{$lt:$}}).then((G)=>{const W=G.map((X)=>{return this._participantDb.remove(X)});R.Promise.all(W).then(Y).catch(J)}).catch((G)=>{console.error(G)})})}_requestMessagesFromMam($,Y=null,J=!1,G=null,W,X=this._options.mam.pageSize){const K=(ee,te,ne,ae,se,oe=[],ie=null)=>{const de={query:{$attributes:{xmlns:z.NAMESPACES.MAM,queryid:ne},x:{$attributes:{xmlns:'jabber:x:data',type:'submit'},field:[{$attributes:{var:'FORM_TYPE',type:'hidden'},value:z.NAMESPACES.MAM}]},set:{$attributes:{xmlns:z.NAMESPACES.RESULT_SET_MANAGEMENT},max:''+X}}};if(this._log(`Querying the message archive for start date '${ae}' and end date '${se}'.`),null!==ae||!0===J){let le='';!0===J&&(le+='inf_conv_mode'),null!==ae&&(le+=ae.toISOString()),de.query.x.field.push({$attributes:{var:'start'},value:le})}null!==se&&de.query.x.field.push({$attributes:{var:'end'},value:se.toISOString()}),null!==ie&&(de.query.set[!0===J?'before':'after']=ie),null!==G&&de.query.x.field.push({$attributes:{var:'with'},value:G}),this._connection.addHandler((le)=>{const ue=z.xmlToJson(le);try{if(void 0!==ue.message.result&&void 0!==ue.message.result.forwarded&&void 0!==ue.message.result.forwarded.message){const pe=ue.message.result.forwarded;void 0===ue.message.result.forwarded.message.archived&&void 0!==ue.message.result&&void 0!==ue.message.result.$attributes&&void 0!==ue.message.result.$attributes.id&&(pe.message.archived={$attributes:{by:H.default.Strophe.getBareJidFromJid(pe.message.$attributes.from),id:ue.message.result.$attributes.id,xmlns:z.NAMESPACES.MAM_TMP}}),oe.push(pe)}}catch(pe){return te(pe),!1}const ce=void 0!==ue.message.fin&&void 0!==ue.message.fin.$attributes&&ue.message.fin.$attributes.xmlns===z.NAMESPACES.MAM;return!0==ce&&('true'==ue.message.fin.$attributes.complete||!0===J?(this._log(`Finished paging through result set, got a total of '${oe.length}' items.`),ee(oe)):(this._log(`Paging through result set to get a total of '${ue.message.fin.set.count}' items.`),this._log(`Got '${oe.length}' items so far...`),K(ee,te,ne,ae,se,oe,ue.message.fin.set.last))),!ce},z.NAMESPACES.JABBER_CLIENT,'message',null,null,$),this.sendIq($,'set',de,null).catch((le)=>{this._onError('Couldn\'t query the MAM:',le),te(le)})};let Q=null,Z=null;if(null!==W){const ee=Date.now();if(W>=ee)throw new Error(`The start timestamp (${W}) cannot be equal to or larger than the end timestamp (${ee}).`);Q=new Date(W),Z=new Date(ee)}return new R.Promise((ee,te)=>{K(ee,te,this.getUniqueId(),Q,Z,[],Y)})}queryMam($,Y=null,J=null,G,W=!0){return this._isMethodReady(!0,!0),new R.Promise((X,K)=>{const Q=G||this._options.mam.defaultTimeLimit,Z=Date.now()-Q,ee=this.getSyncedTimestamp(Z-6e4);this._log(`Starting the MAM query process...`),this._perfStart('requestMessagesFromMam','Starting the first request for MAM messages','color: blue;'),this._requestMessagesFromMam($,Y,!1,J,ee).then((te)=>{this._perfEnd('requestMessagesFromMam','Finished getting all messages from the MAM','color: blue;'),this._processMamStanzas(te,W,!1).then(X).catch(K)}).then(()=>{if(0<this._options.autoPurgeOldMessagesAge)return this.purgeMessagesOlderThan(this._options.autoPurgeOldMessagesAge)}).then(()=>{if(0<this._options.autoPurgeOldRetainMessageCount)return this.purgeOldestMessagesLeavingCount(this._options.autoPurgeOldRetainMessageCount)}).catch(K)})}_processMamStanzas($,Y=!0,J=!1,G=!1){return new R.Promise((W,X)=>{const K=[],Q=[];if(0===$.length)W([]);else{this._perfStart('processMamMessages','Starting to process all messages received from the MAM','color: yellow; background: black;'),this._perfStart('preProcessMamMessages','Starting to pre-process all messages received from the MAM','color: darkgreen; background: grey;');let Z='0';$.forEach((ae)=>{const se={state:{sent:!0},fromMam:!1===J,injected:!0===J};let oe=!1;try{oe=void 0!==ae.message.timestamp}catch(de){}if(!1==oe&&ae.delay&&ae.delay.$attributes.stamp){let de=null;try{de=new Date(ae.delay.$attributes.stamp).getTime()}catch(le){console.error('Couldn\'t parse stanza timestamp to integer.')}null!==de&&(se.ts=de)}const ie=this._getArchiveIdFromStanza(ae);ie>Z&&(Z=ie),z._isMarkerMessage(ae)?(this._stanzaResponseHandler(ae.message.$attributes.id),Q.push(ae)):ae.message.$attributes&&'chat'===ae.message.$attributes.type?K.push(this._messageDelta(ae,{},se)):ae.message.$attributes&&'groupchat'===ae.message.$attributes.type?(this._stanzaResponseHandler(ae.message.$attributes.id),K.push(this._messageDelta(ae,{},se))):ae.message.call&&ae.message.call.$attributes&&ae.message.call.$attributes.xmlns===z.NAMESPACES.INFINITY_BOT?(this._log(`Processing bot command response from the MAM with request ID '${ae.message.call.$attributes['request-id']}':`,ae),this._botCommandResponseHandler(ae.message.call.$attributes['request-id'],ae)):ae.message.error&&ae.message.error.$attributes&&ae.message.error.$attributes.xmlns===z.NAMESPACES.INFINITY_BOT?this._botCommandResponseHandler(ae.message.error.$attributes['request-id'],ae):ae.message.ack&&ae.message.ack.$attributes&&ae.message.ack.$attributes.xmlns===z.NAMESPACES.INFINITY_ACK&&this._stanzaResponseHandler(ae.message.ack.$attributes['original-id'])}),this._perfEnd('preProcessMamMessages','Finished pre-processing messages from the MAM.','color: darkgreen; background: grey;'),this._perfStart('postProcessMamMessages','Start post-processing messages received from the MAM','color: lightgreen; background: grey;'),this._perfStart('addMarkersToMamMessages','Adding markers to messages','color: brown; background: #E1E1E1;');const ee=[];let te={};const ne={};for(let ae in Q.forEach((ae)=>{const se=z._getMarkerType(ae),oe=z._getMarkerMessageId(ae,se);ne[oe]||(ne[oe]=[]),ne[oe].push(ae)}),ne){const se=ne[ae];let oe=null;K.every((ie)=>{return ie._id!==ae||(oe=ie,!1)}),null===oe?ee.push(new R.Promise((ie)=>{this.getMessageById(ae).then((de)=>{se.forEach((le)=>{const ue=z._getMarkerType(le),ce=z._getMarkerMessageId(le,ue),pe=this._updateMessageMarkers(le,ue,de);!1===pe?this._setLastArchiveId(this._getArchiveIdFromStanza(le)):K.push(pe)}),ie()}).catch(()=>{this._log(`Not found message with id '${ae}', creating message placeholder...`);let de=Object.assign({},z._messageSkeleton(),{_id:ae,placeholder:!0,markable:!0,type:null});se.forEach((le)=>{const ue=z._getMarkerType(le),ce=z._getMarkerMessageId(le,ue),pe=this._updateMessageMarkers(le,ue,de);!1!==pe&&(de=pe)}),K.push(de),ie()})})):se.forEach((ie)=>{const de=z._getMarkerType(ie),le=z._getMarkerMessageId(ie,de),ue=this._updateMessageMarkers(ie,de,oe);!1!==ue&&(te[oe._id]=!0,oe=ue)})}R.Promise.all(ee).then(()=>{if(this._log('Messages to save from the MAM:',K),0===K.length)W([]);else{this._perfEnd('addMarkersToMamMessages','Finished adding markers to messages','color: brown; background: #E1E1E1;');const ae=[];!0===G&&K.forEach((se,oe,ie)=>ae.push(this.saveMessage(se._id,(de)=>{if(de._id)return ie.splice(oe,1),delete se.state,Object.assign({},de,se)}))),R.Promise.all(ae).then(()=>{this._msgDb.bulkDocs(K).then((oe)=>{this._setLastArchiveId(Z),this._msgDb.bulkGet({docs:oe}).then((ie)=>{const de=ie.results.map((le)=>{const ue=le.docs[0].ok;return void 0===ue?null:(!1!==Y&&(null===ue.updated_at||!0===te[ue._id]?this._dispatchEvent(z.EVENT_TYPES.NEW_MESSAGE,ue):this._dispatchEvent(z.EVENT_TYPES.MESSAGE_UPDATED,ue)),!0===this._options.autoMarkMessages&&this._markMessage(ue,z.MARKER_TYPES.RECEIVED,Y),ue)});te={},this._perfEnd('postProcessMamMessages','Finished post-processing messages received from the MAM','color: lightgreen; background: grey;'),this._perfEnd('processMamMessages','Finished processing messages received from the MAM','color: yellow; background: black;'),W(de.filter((le)=>{return null!==le}))})}).catch((oe)=>{console.error(oe),X(oe)})})}})}})}processXmlStanzaStringsFromMam($,Y=!0){const J=new DOMParser,G=$.map((Q)=>J.parseFromString(Q,'text/xml').childNodes[0]),W=G.map((Q)=>z.xmlToJson(Q)),X={};W.forEach((Q)=>{try{const Z=Q.message.$attributes.id,ee=Q.message.$attributes.to.split('@')[0];X[ee]===void 0&&(X[ee]=[]),X[ee].push(Z)}catch(Z){console.error('The stanza wasn\'t in the expected format:',Z)}});const K=Object.keys(X).map((Q)=>{return this.getMessagesById(X[Q]).then((Z)=>{if(!(0<Z.length))return this._log(`Deleting all messages in room '${Q}' because it looks like there might be a gap in history...`),this.deleteMessagesByRoomName(Q)})});return R.Promise.all(K).then(()=>{return this._processMamStanzas(W,Y,!0)})}purgeOldMessages(){return this._isMethodReady(!0),this.purgeMessagesOlderThan(this._options.autoPurgeOldMessagesAge)}purgeMessagesOlderThan($){return this._isMethodReady(!0),this._log('\uD83D\uDDD1\uFE0F Removing messages older than: '+$),this.purgeMessagesFromBefore(this.getSyncedTimestamp(Date.now())-$)}purgeMessagesFromBefore($){return this._isMethodReady(!0),this._log('\uD83D\uDDD1\uFE0F Removing messages with timestamp before: '+new Date().toISOString()),this.deleteMessages({ts:{$lt:$}})}purgeOldestMessagesLeavingCount($){return this._isMethodReady(!0),this._log('\uD83D\uDDD1\uFE0F Want to restrict to: '+$+' messages in DB'),this._msgDb.info().then((Y)=>{this._log('\uD83D\uDDD1\uFE0F There are: '+Y.doc_count+' messages in DB');const J=Y.doc_count-$;if(0<J)return this._log('\uD83D\uDDD1\uFE0F Going to delete: '+J+' messages from DB'),this.purgeOldestMessagesCount(J)})}purgeOldestMessagesCount($){return this._isMethodReady(!0),this._msgDb.createIndex({index:{fields:['ts']}}).then(()=>{this._msgDb.find({selector:{},sort:['ts'],limit:$,fields:['_id']}).then((Y)=>{let J=R.Promise.resolve();return Y.docs.forEach((G)=>{J=J.then(()=>{return this._log('\uD83D\uDDD1\uFE0F Deleting message: '+G._id),this.deleteMessageById(G._id).then(()=>{this._log('\uD83D\uDDD1\uFE0F Deleted message: '+G._id)})})}),J})})}_setLastArchiveId($){$>this._lastArchiveId&&(this._lastArchiveId=$,localStorage.setItem(`${this._instanceId}_last_archive_id`,$))}getLastArchiveId(){return this._lastArchiveId}getLastArchiveIdForRoom($){if(this._isMethodReady(!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');return new R.Promise((Y,J)=>{const G=`${$}@${this._options.mucHost}`;let W='0';this.getChatHistory(G).then((X)=>{if(0<X.length){const K=X.sort((Z,ee)=>{const te=ee.updated_at-Z.updated_at;return 0==te?ee.ts-Z.ts:te}),Q=K[0];W=Q.archive_id}Y(W)}).catch(J)})}getFirstArchiveIdForRoom($){if(this._isMethodReady(!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');return new R.Promise((Y,J)=>{const G=`${$}@${this._options.mucHost}`;let W='0';this.getChatHistory(G).then((X)=>{if(0<X.length){const K=X.sort((Z,ee)=>{return Z.ts-ee.ts}),Q=K[0];W=Q.archive_id}Y(W)}).catch(J)})}queryMamByRoomName($,Y=!0,J=null){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');return this._perfStart('queryMamByRoomName',`- Querying the MAM for room '${$}'`,'color: green;'),new R.Promise((G,W)=>{const X=`${$}@${this._options.mucHost}`,K=(Q)=>{this.queryMam(X,Q,null,null,Y).then((Z)=>{this._perfEnd('queryMamByRoomName',`- Finished querying the MAM for message in room '${$}'.`,'color: green;'),G(Z)}).catch(W)};null===J?this.getLastArchiveIdForRoom($).then((Q)=>{K(Q)}).catch(G):K(J)})}queryMamRoomHistoryByName($,Y=null,J=5,G=!0){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');return this._perfStart('queryMamRoomHistoryByName',`Querying MAM history for room '${$}'`,'color: purple;'),new R.Promise((W,X)=>{const K=`${$}@${this._options.mucHost}`;this._requestMessagesFromMam(K,Y,!0,null,null,J).then((Q)=>{this._perfEnd('queryMamRoomHistoryByName',`Finished querying the MAM history for '${J}' messages in the '${$}' room.`,'color: purple;'),this._processMamStanzas(Q,G,!1,!0).then(W).catch(X)}).then(()=>{if(0<this._options.autoPurgeOldMessagesAge)return this.purgeMessagesOlderThan(this._options.autoPurgeOldMessagesAge)}).then(()=>{if(0<this._options.autoPurgeOldRetainMessageCount)return this.purgeOldestMessagesLeavingCount(this._options.autoPurgeOldRetainMessageCount)}).catch(X)})}queryMamByRecipient($,Y=!0){return this._isMethodReady(!0,!0),new R.Promise((J,G)=>{this.getChatHistory($).then((W)=>{let X=null;if(0<W.length){const K=W.sort((Z,ee)=>{const te=ee.updated_at-Z.updated_at;return 0==te?ee.ts-Z.ts:te}),Q=K[0];X=Q.archive_id}this.queryMam(null,X,$,null,Y).then(J).catch(G)}).catch(()=>console.error)})}_saveObject($,Y,J,G,W){if(this._destroyingDbs)return this._log(`Couldn't save '${$}' because the databases are being destroyed.`),void(W&&W(z.ERROR_CODES.DESTROYING_DBS));let X=null;if($===z.OBJECT_TYPES.MESSAGE?X=this._msgDb:$===z.OBJECT_TYPES.CONTACT?X=this._contactDb:$===z.OBJECT_TYPES.ROOM?X=this._roomDb:$===z.OBJECT_TYPES.PARTICIPANT?X=this._participantDb:$===z.OBJECT_TYPES.CACHE_ITEM?X=this._cacheDb:void 0,null===X)throw new Error(`The object type provided (${$}) is not valid.`);void 0===this._saveDebounce[$]&&(this._saveDebounce[$]={}),this._saveDebounce[$][Y]?setTimeout(()=>{this._saveObject($,Y,J,G,W)},250):(this._saveDebounce[$][Y]=!0,X.upsert(Y,J).then((K)=>{void 0===K.rev?(delete this._saveDebounce[$][Y],G&&G(null)):X.get(Y).then((Q)=>{delete this._saveDebounce[$][Y],G&&G(Q)}).catch((Q)=>{this._onError(`Couldn't get ${$} with ID '${Y}' after performing an update.`,Q),delete this._saveDebounce[$][Y],W&&W(Q)})}).catch((K)=>{this._log(`Couldn't update ${$} with ID '${Y}'.`,K),delete this._saveDebounce[$][Y],W&&W(K)}))}doDownload($){return new R.Promise((Y,J)=>{const G=(W)=>{N.download($,W).then((X)=>{var K=I.getSource('fileEncryption');M.isDevice()&&this._options.fileEncryption&&K?K.encrypt(function(Q){X.source=Q,Y(X)},function(Q){J(Q)},X.source):Y(X)}).catch(J)};!0===this._options.authAttachments?this._getCacheItem('user_password').then((W)=>{return this._embellishPasswordWithAdToken(W)}).then((W)=>{G({Authorization:'Basic '+btoa(this._bareJid+':'+W)})}):G(null)})}downloadAttachment($,Y,J=!0){return this._isMethodReady(!0,!0),new R.Promise((G,W)=>{if(Y>$.attachments.length-1)return W('No such attachment: '+Y);const X=$.attachments[Y];void 0===X.path?this.doDownload(X.get).then((K)=>{X.path=K.source,X.state='transferred',this.saveMessage($._id,(Q)=>{return Q.attachments[Y]=X,Q}).then((Q)=>{!1!==J&&this._dispatchEvent(z.EVENT_TYPES.MESSAGE_UPDATED,Q),G()})}).catch(W):G()})}initUserDirectory(){return new R.Promise(($,Y)=>{if(!0===this._userDirectory.initialised)$();else{let J=null,G=localStorage.getItem(`${this._instanceId}_ud_iv`);if(null==G){J=window.crypto.getRandomValues(new Uint8Array(16));let W=[];for(let K=0;16>K;K++)W.push(String.fromCharCode(J[K]));const X=W.join('');localStorage.setItem(`${this._instanceId}_ud_iv`,X)}else{const W=new Uint8Array(16);for(let X=0;X<G.length;X++)W[X]=G.charCodeAt(X);J=W}A.getEncryptionKey(this._instanceId).then((W)=>{this._userDirectory.initialise(W,J,this._options.userDirectoryEncryptionBlockSize||2e3).then($).catch(Y)})}})}_updateUserDirectoryTimer(){setTimeout(()=>{this.updateUserDirectory().then(($)=>{this._log(` Updated user directory: ${$}`)}).catch(($)=>{this._log(` Couldn't update user directory: ${$.message}`)})},this._options.updateUserDirectoryInterval)}updateUserDirectory(){return this.initUserDirectory().then(()=>{return this._log('\uD83D\uDC71\uD83C\uDFFC Updating user directory...'),this._getCacheItem('user_directory_hash').then(($)=>{const Y={query:{$attributes:{xmlns:z.NAMESPACES.DIRECTORY}}};return $&&(Y.query.$attributes.hash=$),this.sendIq(this._domain,'get',Y).then((J)=>{try{const G=J.iq.query.$attributes.url;return void 0===G?(this._updateUserDirectoryTimer(),`No change since last update.`):this._getCacheItem('user_password').then((W)=>{return this._embellishPasswordWithAdToken(W)}).then((W)=>{return this._userDirectory.update(this._bareJid,W,G).then((X)=>{return this._setCacheItem('user_directory_hash',X.hash).then(()=>{return this._log('\u2705 User directory successfully updated.'),this._updateUserDirectoryTimer(),X.msg})})})}catch(G){return this._updateUserDirectoryTimer(),R.Promise.reject('Couldn\'t obtain directory URL from server.')}})})}).catch(($)=>{return this._getCacheItem('user_directory_hash').then((Y)=>{return void 0===Y?R.Promise.reject($):this._deleteCacheItem('user_directory_hash').then(()=>{return this.updateUserDirectory().then((J)=>{return R.Promise.resolve(J)}).catch((J)=>{return R.Promise.reject(J)})})})})}searchUsers($,Y){return this.initUserDirectory().then(()=>{return this._userDirectory.search($,Y)})}getAllUsers($=!1){return this.initUserDirectory().then(()=>{return this._userDirectory.getAllUsers($)})}getUsersInGroups($,Y){return this.initUserDirectory().then(()=>{return this._userDirectory.getUsersInGroups($,Y)})}getUserByJid($){return this.initUserDirectory().then(()=>{return this._userDirectory.getUserByJid($)})}downloadAttachments($,Y=!0){return new R.Promise((J,G)=>{if(Array.isArray($.attachments)&&0<$.attachments.length){let W=R.Promise.resolve({});$.attachments.forEach((X,K)=>{W=W.then(()=>{return new R.Promise((Q,Z)=>{X.path===void 0?this.doDownload(X.get).then((ee)=>{$.attachments[K].path=ee.source,$.attachments[K].mediaType=N.getMediaTypeFromExtension(ee.source),$.attachments[K].state='transferred',Q()}).catch(Z):Q()})})}),W.then(()=>{this.saveMessage($._id,()=>{return $}).then((X)=>{!1!==Y&&this._dispatchEvent(z.EVENT_TYPES.MESSAGE_UPDATED,X),this._log(`Successfully updated message '${X._id}' with attachments.`,X),J(X)}).catch((X)=>{this._onError(`Unable to update message '${$._id}' with attachments:`,X),G(X)})}).catch((X)=>{this._onError('Unable to download all message attachments:',X),G(X)})}else J($)})}_processNewMessage($,Y,J=!0,G=!0){return this._perfStart(`processNewMessage (${$.message.$attributes.id.split('-')[0]})`,'Starting to process a new message','color: purple;'),new R.Promise((W,X)=>{this._setLastArchiveId(this._getArchiveIdFromStanza($)),this._messageStanzaToDbObject($,Y).then((K)=>{!1!==G&&(null===K.updated_at?this._dispatchEvent(z.EVENT_TYPES.NEW_MESSAGE,K):this._dispatchEvent(z.EVENT_TYPES.MESSAGE_UPDATED,K));const Q=this.getSyncedTimestamp(new Date().getTime())-K.ts;return Q<this._options.autoDownloadAttachmentTime||-1==this._options.autoDownloadAttachmentTime?this.downloadAttachments(K,G):K}).then((K)=>{$.message.markable&&!0===J&&!0===this._options.autoMarkMessages?this._markMessage(K,z.MARKER_TYPES.RECEIVED,G).then((Q)=>{this._perfEnd(`processNewMessage (${$.message.$attributes.id.split('-')[0]})`,'Finished processing a new message','color: purple;'),W(Q)}).catch(X):(this._perfEnd(`processNewMessage (${$.message.$attributes.id.split('-')[0]})`,'Finished processing a new message','color: purple;'),W(K))}).catch(X)})}_processGroupMessage($,Y,J=!0,G=!0){const W=z._merge({type:'groupchat',mine:H.default.Strophe.getBareJidFromJid($.message.$attributes.from)===this._bareJid||H.default.Strophe.getResourceFromJid($.message.$attributes.from)===this.username},Y);try{this._stanzaResponseHandler($.message.$attributes.id)}catch(X){this._onError(`Couldn't process stanza response handler for stanza:`,$)}return this._processNewMessage($,W,J,G)}_updateMessageMarkers($,Y,J){if(!J._id)return!1;if(!J.markable)return!1;const G=H.default.Strophe.getBareJidFromJid($.message.$attributes.from),W=H.default.Strophe.getResourceFromJid($.message.$attributes.from),X=J.state.markers.some((Q)=>{if(Q.type===Y&&(Q.sender_id===G&&Q.sender_resource===W||Q.sender_resource===this.bareJid))return!0});if(!0===X)return!1;const K={type:Y,sender_id:G,sender_resource:W,recipient_id:$.message.$attributes.to,ts:this._getTimestampFromStanza($),priority:z.MARKER_PRIORITIES[Y]};return J.state.markers.push(K),J.state.markers=J.state.markers.sort(function(Q,Z){return Q.priority===Z.priority?null!==Z.ts&&null!==Q.ts?Z.ts-Q.ts:void 0:Q.priority-Z.priority}),J.state[Y]=!0,!0!==J.state.sent&&(J.state.sent=!0),J.updated_at=this.getSyncedTimestamp(Date.now()),J}static _getMarkerType($){let Y=null;return $.message.received?Y=z.MARKER_TYPES.RECEIVED:$.message.read?Y=z.MARKER_TYPES.READ:$.message.acknowledged&&(Y=z.MARKER_TYPES.ACKNOWLEDGED),Y}static _getMarkerMessageId($,Y){return $.message[Y].$attributes!==void 0&&$.message[Y].$attributes.id!==void 0?$.message[Y].$attributes.id:null}_processMarkerMessage($,Y=!0){return new R.Promise((J,G)=>{this._setLastArchiveId(this._getArchiveIdFromStanza($));const W=z._getMarkerType($);if(null!==W){const X=z._getMarkerMessageId($,W);if(null!==X){this._log(`Processing marker of type '${W}' for message with ID '${X}':`,$),this._stanzaResponseHandler($.message.$attributes.id);const K=H.default.Strophe.getBareJidFromJid($.message.$attributes.from),Q=H.default.Strophe.getResourceFromJid($.message.$attributes.from);this.saveMessage(X,(Z)=>{return this._updateMessageMarkers($,W,Z)}).then((Z)=>{if(null!==Z){const ee={message_id:Z._id,message:Z,type:W,sender_id:K,sender_resource:Q};!1!==Y&&this._dispatchEvent(z.EVENT_TYPES.RECEIPT_RECEIVED,ee),!1!==Y&&this._dispatchEvent(z.EVENT_TYPES.MESSAGE_UPDATED,Z),J(ee)}else J(null)}).catch(G)}}})}_processErrorMessage($){return new R.Promise((Y,J)=>{const G=$.message.$attributes&&$.message.$attributes.id?$.message.$attributes.id:null;if(null!==G){const W=$.message.error&&$.message.error.text&&$.message.error.text.$value?$.message.error.text.$value:`The server returned an error for stanza with ID '${G}'.`;this._onError(W,Object.assign({},$.message.error,{messageId:G})),this._stanzaResponseHandler(G,W),this.saveMessage(G,(X)=>{return void 0!==X._id&&(!0!==X.state.read&&!0!==X.state.received&&!0!==X.state.acknowledged?X.state.sent=!1:!0!==X.state.sent&&(X.state.sent=!0),X)}).then(()=>{Y({id:G,msg:W})}).catch(J)}else Y()})}_processAckMessage($){return new R.Promise((Y,J)=>{if($.message.ack&&$.message.ack.$attributes&&$.message.ack.$attributes['original-id']){const G=$.message.ack.$attributes['original-id'];this._stanzaResponseHandler(G),this._dispatchEvent(z.EVENT_TYPES.ACK_RECEIVED,G),this.saveMessage(G,(W)=>{return void 0!==W._id&&(!0!==W.state.sent&&(W.state.sent=!0),W)}).then(Y).catch(J)}else Y()})}_onStanza($){this.connected=!0,this._setStatus(H.default.Strophe.Status.CONNECTED);try{const Y=z.xmlToJson($);if(this._isFilteredOut(Y))return!0;if(this._log(`[1] - Processing stanza with ID '${Y.message.$attributes.id}':`,Y),Y.message.$attributes&&'chat'===Y.message.$attributes.type&&void 0!==Y.message.sent&&void 0!==Y.message.sent.$attributes&&Y.message.sent.$attributes.xmlns===z.NAMESPACES.CARBONS&&void 0!==Y.message.sent.forwarded)this._processNewMessage(Y.message.sent.forwarded,{state:{sent:!0}});else if(Y.message.$attributes&&'chat'===Y.message.$attributes.type)this._processNewMessage(Y);else if(Y.message.event&&Y.message.event.items){const J=(G)=>{z._isMarkerMessage(G)?(this._log(`[2] - Processing stanza with ID '${Y.message.$attributes.id}':`,Y),this._processMarkerMessage(G)):this._processGroupMessage(G)};Array.isArray(Y.message.event.items.item)?Y.message.event.items.forEach((G)=>{G.message&&G.message.$attributes&&'groupchat'===G.message.$attributes.type?J(G):G.presence&&this._onPresence(G)}):'object'==typeof Y.message.event.items.item&&Y.message.event.items.item.message&&Y.message.event.items.item.message.$attributes&&'groupchat'===Y.message.event.items.item.message.$attributes.type?J(Y.message.event.items.item):'object'==typeof Y.message.event.items.item&&Y.message.event.items.item.presence&&this._onPresence(Y.message.event.items.item)}else z._isMarkerMessage(Y)?(this._log(`[3] - Processing stanza with ID '${Y.message.$attributes.id}':`,Y),this._processMarkerMessage(Y)):Y.message.$attributes&&'groupchat'===Y.message.$attributes.type&&Y.message.$attributes.id?this._processGroupMessage(Y):Y.message.$attributes&&'error'===Y.message.$attributes.type?this._processErrorMessage(Y):void 0===Y.message.ack?Y.message.call&&Y.message.call.$attributes&&Y.message.call.$attributes.xmlns===z.NAMESPACES.INFINITY_BOT?(this._log(`Processing bot command response with request ID '${Y.message.call.$attributes['request-id']}':`,Y),this._botCommandResponseHandler(Y.message.call.$attributes['request-id'],Y)):Y.message.error&&Y.message.error.$attributes&&Y.message.error.$attributes.xmlns===z.NAMESPACES.INFINITY_BOT&&this._botCommandResponseHandler(Y.message.error.$attributes['request-id'],Y):this._processAckMessage(Y)}catch(Y){this._onError('An error occurred when processing an incoming message stanza:',Y)}return!0}_isFilteredOut($){let Y=!0;return 0<this._includeStanzaFilters.length&&(Y=!1,this._includeStanzaFilters.some((J)=>{try{return J($)}catch(G){return this._log('Include filter function failed: '+G),this._onError('Include filter function failed: '+G),!1}})&&(Y=!0)),this._excludeStanzaFilters.some((J)=>{try{return J($)}catch(G){return this._log('Exclude filter function failed: '+G),this._onError('Exclude filter function failed: '+G),!1}})&&(Y=!1),!Y}_messageIsGroupChat($){return this._options.mucHost&&$.$attributes&&'string'==typeof $.$attributes.from&&-1<$.$attributes.from.indexOf(this._options.mucHost)}_onPresence($){if($.presence!==void 0){const Y=$.presence;if(Y.$attributes!==void 0&&Y.$attributes.from!==void 0){if('error'===Y.$attributes.type)return this._onError('An error from the server was received in a presence stanza:',Y),!0;const J=H.default.Strophe.getBareJidFromJid(Y.$attributes.from);if(!J)return!0;if(J===this._bareJid)this.setChatStatus(Y.show,Y.status,!1,Y.metadata);else{const G=z.getDomainFromJid(J);this._options.mucHost===G?this.saveParticipant(Y.$attributes.from,(W)=>{if(void 0!==W._id)try{if(W.show=Y.show,W.status=Y.status,W.online='unavailable'!==Y.$attributes.type,W.affiliation=Y.x.item.$attributes.affiliation,W.room_role=Y.x.item.$attributes.role,W.last_stanza=Y,void 0!==Y.metadata){const X=Y.metadata;delete X.$attributes,W.metadata=X}W.updated_at=this.getSyncedTimestamp(Date.now())}catch(X){this._onError(`Presence stanza wasn't in the expected format when trying to update participant with ID '${W._id}' and JID '${W.jid}'.`,X)}else try{if(W._id=Y.$attributes.from,W.jid=H.default.Strophe.getBareJidFromJid(Y.x.item.$attributes.jid),W.is_current_user=W.jid===this._jid,W.username=H.default.Strophe.getNodeFromJid(W.jid),W.room_name=H.default.Strophe.getNodeFromJid(Y.$attributes.from),W.affiliation=Y.x.item.$attributes.affiliation,W.room_role=Y.x.item.$attributes.role,W.online='unavailable'!==Y.$attributes.type,W.show=Y.show,W.status=Y.status,W.ts=this.getSyncedTimestamp(Date.now()),void 0!==Y.metadata){const X=Y.metadata;delete X.$attributes,W.metadata=X}W.updated_at=null,W.last_stanza=Y}catch(X){this._onError(`Presence stanza wasn't in the expected format when trying to create a new participant with ID '${W._id}' and JID '${W.jid}'.`,X)}return W}).then((W)=>{null===W.updated_at?this._dispatchEvent(z.EVENT_TYPES.NEW_PARTICIPANT,W):this._dispatchEvent(z.EVENT_TYPES.PARTICIPANT_UPDATED,W)}).catch((W)=>{this._onError('Couldn\'t upsert participant database.',W)}):this._saveObject(z.OBJECT_TYPES.CONTACT,J,(W)=>{if(void 0!==W&&(W.online='unavailable'!==Y.$attributes.type,void 0!==Y.show&&(W.show=Y.show),void 0!==Y.status&&(W.status=Y.status),void 0!==Y.metadata)){const X=Y.metadata;delete X.$attributes,W.metadata=X}return W},(W)=>{let X=!1;Y.x&&Y.x.$attributes&&Y.x.$attributes.xmlns&&Y.x.$attributes.xmlns===z.NAMESPACES.VCARD_UPDATE&&void 0!==Y.x.photo&&'string'==typeof Y.x.photo&&(void 0===W.avatarHash||W.avatarHash!==Y.x.photo)&&(X=!0,this._log('\uD83C\uDCA1 Avatar update for:',J),this._log('\uD83C\uDCA1 New avatar hash:',Y.x.photo),this.updatevCardForContact(J).then(()=>{this._saveObject(z.OBJECT_TYPES.CONTACT,J,(K)=>{return K.avatarHash=Y.x.photo,K},(K)=>{this._dispatchEvent(z.EVENT_TYPES.PRESENCE_UPDATE,K)},(K)=>{this._onError('Couldn\'t update contact with vCard: ',K)})}).catch((K)=>{this._onError('Couldn\'t get updated vCard for contact: ',K)})),!1==X&&this._dispatchEvent(z.EVENT_TYPES.PRESENCE_UPDATE,W)},(W)=>{this._onError('Couldn\'t upsert contacts database.',W)})}}}return!0}getContactByJid($){return this._isMethodReady(!0),new R.Promise((Y,J)=>{this.findContacts({id:$}).then((G)=>{let W=G[0];void 0===W?J('No contact found: '+$):Y(W)}).catch(J)})}updatevCardForContact($){return this._isMethodReady(!0,!0),this._log('\uD83C\uDCA1 Updating vCard for Contact:',$),new R.Promise((Y,J)=>{this.findContacts({id:$}).then((G)=>{let W=G[0];return void 0===W?void(this._log('\uD83C\uDCA1 No contact:',$),J('No contact found: '+$)):W}).then(()=>{this._getvCard($).then((W)=>{if(void 0!==W){const X=D.VCardSimple.fromXml(W);void 0===X?(this._log('\uD83C\uDCA1 Bad vCard:',$),J('Bad vCard')):this._saveObject(z.OBJECT_TYPES.CONTACT,$,(K)=>{return K.vCard=X.toJSON(),K},(K)=>{this._log('\uD83C\uDCA1 vCard Updated:',$),Y(K)},(K)=>{this._log('\uD83C\uDCA1 Couldn\'t save contact:',$),J('Couldn\'t save contact: '+K)})}else this._log('\uD83C\uDCA1 No vCard:',$),Y(null)}).catch(J)}).catch(J)})}_processRoster($){return new R.Promise((Y,J)=>{if(void 0===$||void 0===$.iq||void 0===$.iq.query)Y();else if(void 0!==$.iq.query.$attributes&&void 0!==$.iq.query.$attributes.ver&&this._setCacheItem('roster_version',$.iq.query.$attributes.ver).catch(J),void 0!==$.iq.query.item){const G=Array.isArray($.iq.query.item)?$.iq.query.item:[$.iq.query.item],W=[];G.forEach((X)=>{if(void 0!==X.$attributes.jid){const K={id:X.$attributes.jid,subscription:X.$attributes.subscription,online:!1};void 0!==X.group&&('string'==typeof X.group?K.groups=[X.group]:Array.isArray(X.group)&&(K.groups=X.group)),W.push(K)}}),this._contactDb.allDocs({include_docs:!0}).then((X)=>{const K=[];X.rows.forEach((Q)=>{let Z=Q.doc,ee=null;W.every((te,ne)=>{return te.id!==Z.id||(ee=te,delete W[ne],!1)}),null===ee?K.push(this._contactDb.remove(Z)):(Z.subscription!==ee.subscription||!z._arraysEqual(Z.groups,ee.groups))&&(Z=z._merge(Z,ee),this._log('MERGED CONTACT:',Z),K.push(this._contactDb.post(Z)))}),W.forEach((Q)=>{this._log('ADDING NEW CONTACT:',Q),K.push(new R.Promise((Z,ee)=>{this._saveObject(z.OBJECT_TYPES.CONTACT,Q.id,()=>{return Q},(te)=>{this._log('CONTACT ADDED:',Q.id),Z(te)},(te)=>{this._log('CONTACT ADD FAILED:'+Q.id+': '+te),ee(te)})}))}),R.Promise.all(K).then(Y).catch((Q)=>{this._onError('Couldn\'t merge contacts from server with locally sorted contacts.',Q),J(Q)})})}else Y()})}getvCardsForAllContacts(){return this._isMethodReady(!0,!0),this._log('\uD83C\uDCA1 Fetching all vCards...'),new R.Promise(($,Y)=>{this.getContacts().then((J)=>{const G=[];J.forEach((W)=>{this._log('\uD83C\uDCA1 Fetching vCard for:',W.id),G.push(new R.Promise((K)=>{this.updatevCardForContact(W.id).then(()=>{this._log('\uD83C\uDCA1 Fetched vCard for:',W.id),K()}).catch(()=>{K()})}))}),R.Promise.all(G).then($).catch(Y)})})}getOurvCard(){return this._isMethodReady(!0,!0),this._log('\uD83C\uDCA1 Fetching vCard for:',this._bareJid),new R.Promise(($,Y)=>{this._getvCard(this._bareJid).then((J)=>{if(void 0===J||1>J.length)return Y('No vCard');const G=D.VCardSimple.fromXml(J);void 0===G?(this._log('\uD83C\uDCA1 Bad vCard: ',this._bareJid),Y('Bad vCard')):(this._log('\uD83C\uDCA1 Fetched vCard: ',G.toJSON()),$(G.toJSON()))}).catch(Y)})}saveOurvCard($){return this._isMethodReady(!0,!0),this._log('\uD83C\uDCA1 Saving vCard for:',this._bareJid),new R.Promise((Y,J)=>{const G=D.VCardSimple.fromJSON($);this._setvCard(this._bareJid,G.toXML(!0)).then(()=>{this._log('\uD83C\uDCA1 Saved vCard for:',this._bareJid),Y()}).catch(J)})}_onError($,Y){console.error($,Y||''),this._dispatchEvent(z.EVENT_TYPES.ERROR,Y)}_setCacheItem($,Y,J=!1){return new R.Promise((G,W)=>{const X=()=>{this._saveObject(z.OBJECT_TYPES.CACHE_ITEM,$,(K)=>{return K.value!==Y&&(K.value=Y,K.secret=!0===J,K)},(K)=>{const Q=K.value;!1===K.secret&&(this._cache[$]=Q),G(K.value)},(K)=>{K===z.ERROR_CODES.DESTROYING_DBS?G():(this._onError(`Couldn't set cache item '${$}' with value '${Y}'.`),W(K))})};this._getCacheItem($).then((K)=>{K===Y?G(K):X()}).catch(X)})}_getCacheItem($,Y=0){return new R.Promise((G)=>{this._cache[$]===void 0?this._cacheDb.get($).then((W)=>{if(this._options.encryption&&!W.hasOwnProperty('value'))++Y,Y===5?G():setTimeout(()=>{this._getCacheItem($,Y).then(G)},100);else{const X=W.value;!1===W.secret&&(this._cache[$]=X),G(X)}}).catch(()=>{G()}):G(this._cache[$])})}_deleteCacheItem($){return new R.Promise((Y,J)=>{this._cacheDb.get($).then((G)=>{this._cacheDb.remove(G).then(()=>{delete this._cache[$],Y()}).catch(J)}).catch(()=>{Y()})})}_messageDelta($,Y,J){const G=$.message.$attributes.from,W=H.default.Strophe.getBareJidFromJid(G),X=H.default.Strophe.getResourceFromJid(G);if(void 0!==Y._id)$!==Y.stanza&&(Y.stanza=$),void 0!==$.message.body&&$.message.body!==Y.body&&(Y.body=$.message.body),null===Y.type&&(Y.type=$.message.$attributes.type),'groupchat'===Y.type&&(Y.state.sent=!0),null===Y.jid&&(Y.jid=G),null===Y.sender_id&&(Y.sender_id=W),null===Y.sender_resource&&(Y.sender_resource=X),null===Y.recipient_id&&(Y.recipient_id=$.message.$attributes.to),void 0!==$.message.data&&$.message.data!==Y.data&&(Y.data=$.message.data),(null===Y.ts||$.message.timestamp&&1<$.message.timestamp.length)&&(Y.ts=this._getTimestampFromStanza($)),null===Y.mine&&(Y.mine=W===this._bareJid),Y.placeholder=!1,Y.archive_id=this._getArchiveIdFromStanza($),Y.updated_at=this.getSyncedTimestamp(Date.now()),Y=z._merge(Y,J);else{let K=[];void 0!==$.message.attachments&&(Array.isArray($.message.attachments)?K=$.message.attachments:K.push($.message.attachments));let Q={_id:$.message.$attributes.id,stanza:$,archive_id:this._getArchiveIdFromStanza($),jid:G,sender_id:W,sender_resource:X,recipient_id:$.message.$attributes.to,body:$.message.body||null,updated_at:null,ts:this._getTimestampFromStanza($),state:{sent:null,markers:[],received:null,read:null,acknowledged:null},data:$.message.data||{},attachments:K,type:$.message.$attributes.type||'chat',mine:W===this._bareJid,markable:void 0!==$.message.markable,fromMam:!1,injected:!1,placeholder:!1},Z=[];void 0!==$.message.addresses&&(Array.isArray($.message.addresses.address)?Z=$.message.addresses.address:Z.push($.message.addresses.address)),Y=Object.assign({},z._messageSkeleton(),{_id:$.message.$attributes.id,stanza:$,archive_id:this._getArchiveIdFromStanza($),jid:G,sender_id:W,sender_resource:X,recipient_id:$.message.$attributes.to,body:$.message.body,ts:this._getTimestampFromStanza($),data:$.message.data,attachments:K,type:$.message.$attributes.type,mine:W===this._bareJid,markable:void 0!==$.message.markable,addresses:Z})}return $.message.$attributes&&'groupchat'===$.message.$attributes.type&&(Y.type='groupchat',Y.mine=H.default.Strophe.getBareJidFromJid($.message.$attributes.from)===this._bareJid||H.default.Strophe.getResourceFromJid($.message.$attributes.from)===this.username),z._merge(Y,J)}static _messageSkeleton(){return{_id:null,stanza:null,archive_id:null,jid:null,sender_id:null,sender_resource:null,recipient_id:null,body:null,updated_at:null,ts:null,state:{sent:null,markers:[],received:null,read:null,acknowledged:null},data:{},attachments:[],type:'chat',mine:null,markable:!1,fromMam:!1,placeholder:!1,injected:!1}}_messageStanzaToDbObject($,Y){return new R.Promise((J,G)=>{if($.message!==void 0&&$.message.$attributes!==void 0)this.saveMessage($.message.$attributes.id,(W)=>{return this._messageDelta($,W,Y)}).then(J).catch((W)=>{this._onError('Unable to convert message stanza to DB object.',W),G(W)});else{const W='No message part present in the stanza.';this._onError(W),G(W)}})}_getTimestampFromStanza($){let Y=null;if(void 0!==$.message&&void 0!==$.message.timestamp)if(Array.isArray($.message.timestamp)){const J=$.message.timestamp.filter((G)=>{return void 0!==G.$attributes&&G.$attributes.xmlns===z.NAMESPACES.CT_SERVER_TIMESTAMP});void 0!==J[0]&&(Y=parseInt(J[0].$value))}else void 0!==$.message.timestamp.$value&&(Y=parseInt($.message.timestamp.$value));return null===Y&&(Y=this.getSyncedTimestamp(Date.now())),Y}_getArchiveIdFromStanza($){let Y=null;if($.message.archived!==void 0){const J=Array.isArray($.message.archived)?$.message.archived[0]:$.message.archived;J.$attributes!==void 0&&J.$attributes.id!==void 0&&(Y=J.$attributes.id)}return Y}_log($,Y){!0===this._options.debug&&console.debug('['+new Date().toString()+'] ',$,Y||'')}getUniqueId(){return this._isMethodReady(!0,!0),this._connection.getUniqueId(`${this._instanceId}-${performance.now()}`)}_clearBotTimeout($){this._botCommandTimeouts[$]&&(this._log(`Bot command response verified, removing bot timeout for request '${$}'.`),this._botCommandTimeouts[$].cancel(),delete this._botCommandTimeouts[$])}_clearBotPromise($){this._botCommandPromises[$]&&(this._log(`Clearing bot command promise for request '${$}'.`),delete this._botCommandPromises[$])}_botCommandResponseHandler($,Y){if(!this._botCommandPromises[$])return!1;if(void 0!==Y.message&&void 0!==Y.message.$attributes&&'error'===Y.message.$attributes.type){const J=void 0!==Y.message.error&&void 0!==Y.message.error.$attributes&&Y.message.error.$attributes['request-id']?Y.message.error.$attributes['request-id']:null;if(J===$){this._clearBotTimeout(J);const G=void 0!==Y.message.error&&void 0!==Y.message.error.text?Y.message.error.text.$value:'An unexpected error occurred';this._botCommandPromises[$].reject(G),this._clearBotPromise($)}}else if(void 0!==Y.message&&void 0!==Y.message.call&&void 0!==Y.message.call.$attributes&&'result'===Y.message.call.$attributes.type&&Y.message.call.$attributes['request-id']===$){if(this._clearBotTimeout($),void 0!==Y.message.call.json&&void 0!==Y.message.call.json.$value){let J=null;try{J=JSON.parse(Y.message.call.json.$value)}catch(G){this._onError('Couldn\'t parse JSON from bot command response:',G),this._botCommandPromises[$].reject(G),this._clearBotPromise($)}null!==J&&(this._botCommandPromises[$].resolve(J),this._clearBotPromise($))}return!1}return!0}sendBotCommand($,Y,J,G=5e3){return this._isMethodReady(!0,!0),new R.Promise((W,X)=>{const K=this.getUniqueId(),Q={$attributes:{to:$,type:'normal'},call:{$attributes:{xmlns:z.NAMESPACES.INFINITY_BOT,"request-id":K,type:'get',name:Y}}};let Z=null;try{Z=JSON.stringify(J)}catch(ee){this._onError('Couldn\'t stringify JSON:',ee)}null!==Z&&(Q.call.json={$attributes:{xmlns:'urn:xmpp:json:0'},$value:Z}),this._botCommandPromises[K]={resolve:W,reject:X},this.sendStanza(Q,!1).then(()=>{this._log(`Creating bot command timer for request '${K}'...`),this._botCommandTimeouts[K]=new B.default(K,()=>{this._log(`Bot command timer finished for request '${K}'.`),this._onError(`Didn't get a response from the bot within ${G}ms.`,{operationName:Y}),this._botCommandPromises[K].reject('Your request took longer then expected, please try again.')},G)}).catch((ee)=>{this._onError('Couldn\'t send bot command:',ee),X(ee)})})}_pushHandler($){this._log('Push Received: ',$)}_getPushToken(){return new R.Promise(($,Y)=>{var J=null;if('android'===M.getPlatformName()?J={senderID:this._options.push.senderId}:'ios'===M.getPlatformName()&&(J={badge:'true',sound:'true',alert:'true'}),null!==J)if(this._options.push.voip&&'ios'===M.getPlatformName()){const G=this,W=I.getSource('VoIPPushNotification');if(!1!==W){const X=W.init();X.on('registration',function(K){G._log('Registered for push: ',K.deviceToken),G._setCacheItem('push_token',K.deviceToken).then(()=>{$(K.deviceToken)})}),X.on('notification',function(K){const Q=I.getSource('insomnia');Q&&!1!==G._options.bringToForegroundOnVoipPush&&(Q.switchOnScreenAndForeground(),G._pushHandler(K)),G._options.push.reLoginOnPushiOS&&!G.connected&&G.reLoginNow()}),X.on('error',function(K){G._log('VOIP Push Error: '+K)})}else this._log('Could not find VOIP Push plugin'),Y('Could not find VOIP Push plugin')}else{const G=I.getSource('notification');if(!1!==G){this._log('Registering for push notifications...');const W=this;G.registerForPush(function(X){W._log('Registered for push:',X),G.on('pushReceived',function(K){W._pushHandler(K),W._options.push.reLoginOnPushAndroid&&!W.connected&&W.reLoginNow()}),W._setCacheItem('push_token',X).then(()=>{$(X)})},function(X){W._log('Error registering for push:',X),Y(X)},J)}else this._log('Could not find Push plugin'),Y('Could not find Push plugin')}})}registerForPush($){if(!M.isDevice())throw new Error('This platform does not support push notifications.');return new R.Promise((Y,J)=>{this.sendIq(null,'set',{push:{$attributes:{xmlns:z.NAMESPACES.CT_PUSH},notification:{package:this._options.push.packageId,type:'ios'===M.getPlatformName()?'apns':'gcm',token:$,installation_id:this._installId}}}).then((G)=>{let W=null;try{W=G.iq.push.notification.$attributes.jid,this._pushNodeName=G.iq.push.notification.$attributes.node}catch(X){this._onError('Couldn\'t enable push notifications.',X),J(X)}null!==W&&this._setCacheItem('push_jid',W).then(()=>{this.enablePush().then(Y).catch(J)})}).catch((G)=>{this._onError('Couldn\'t register for push notifications:',G),J(G)})})}enablePush(){return new R.Promise(($,Y)=>{this._getCacheItem('push_jid').then((J)=>{J===void 0?(this._onError('\'registerForPush\' must be called before \'enablePush\'.'),Y()):this.sendIq(null,'set',{enable:{$attributes:{xmlns:z.NAMESPACES.PUSH,jid:J,node:this._pushNodeName}}}).then($).catch((G)=>{this._onError('Unable to enable push notifications:',G),Y(G)})})})}disablePush(){return new R.Promise(($,Y)=>{this._getCacheItem('push_jid').then((J)=>{J===void 0?$():this.sendIq(null,'set',{disable:{$attributes:{xmlns:z.NAMESPACES.PUSH,jid:J,node:this._pushNodeName}}}).then($).catch((G)=>{this._onError('Unable to disable push notifications:',G),Y(G)})})})}_perfStart($,Y,J){!0!==this._options.perfLogging||(console.log(`%c[START: ${$}] ${Y}`,J),console.time($))}_perfEnd($,Y,J){!0!==this._options.perfLogging||(console.log(`%c[END: ${$}] ${Y}`,J),console.timeEnd($))}static jsonToXml($,Y){return z._parseJsonNode(Y,z._createElement($,Y.$attributes))}static _parseJsonNode($,Y){for(let J in $){let G=$[J];if(0!==J.indexOf('$')){if(Array.isArray(G)&&0<G.length)G.forEach((W)=>{let X=z._createElement(J,W.$attributes);X=z._parseJsonNode(W,X),Y.appendChild(X)});else{const W='object'==typeof G&&null!==G?G.$attributes:void 0;let X=z._createElement(J,W);if('object'==typeof G&&null!==G&&0<Object.keys(G).length)X=z._parseJsonNode(G,X);else if('string'==typeof G){const K=z.doc.createTextNode(G);X.appendChild(K)}Y.appendChild(X)}}else if('$value'==J){const W=z.doc.createTextNode(G);Y.appendChild(W)}else if('$cdata'==J){const W=z.doc.createCDATASection(G);Y.appendChild(W)}}return Y}static xmlToJson($){return z._parseXmlNode($,{})}static _parseXmlNode($,Y){let J={};if(void 0!==$.attributes&&0<$.attributes.length){J.$attributes={};for(let G=0;G<$.attributes.length;G++){const W=$.attributes[G];J.$attributes[W.nodeName]=W.value}}if(0<$.childNodes.length)for(let G=0;G<$.childNodes.length;G++){const W=$.childNodes[G];if(3===W.nodeType)void 0===J.$attributes?J=W.textContent:J.$value=W.textContent;else if(4===W.nodeType)J.$cdata=W.textContent;else{if('\n'===J)continue;z._parseXmlNode(W,J)}}return void 0!==Y[$.nodeName]&&!1===Array.isArray(Y[$.nodeName])&&(Y[$.nodeName]=[Y[$.nodeName]]),Array.isArray(Y[$.nodeName])?Y[$.nodeName].push(J):Y[$.nodeName]=J,Y}static _createElement($,Y){null===z.doc&&(z.doc=document.implementation.createDocument('ct:xmpp:client','infinity',null));const J=z.doc.createElement($);if(Y!==void 0&&0<Object.keys(Y).length)for(let G in Y)J.setAttribute(G,Y[G]);return J}static _getContactFromRosterByJid($,Y){let J=null;return void 0!==Y&&void 0!==Y.contacts&&0<Y.contacts.length&&Y.contacts.forEach((G)=>{G.jid===$&&(J=G)}),J}static _isObject($){return $&&'object'==typeof $&&!Array.isArray($)}static _merge($,...Y){if(!Y.length)return $;const J=Y.shift();if(z._isObject($)&&z._isObject(J))for(const G in J)z._isObject(J[G])?($[G]||Object.assign($,{[G]:{}}),z._merge($[G],J[G])):Object.assign($,{[G]:J[G]});return z._merge($,...Y)}static _arraysEqual($,Y){if(!Array.isArray($)||!Array.isArray(Y))return $===Y;if($.length!==Y.length)return!1;for(let J=$.length;J--;)if($[J]!==Y[J])return!1;return!0}static _validateEventType($){return z._validateConstants(z.EVENT_TYPES,$)}static _validateChatStatus($){return z._validateConstants(z.CHAT_STATUSES,$)}static _validateConstants($,Y){for(let J in $)if($[J]===Y)return!0;return!1}static getDomainFromJid($){const Y=H.default.Strophe.getBareJidFromJid($);return Y.split('@')[1]}static _isMarkerMessage($){return $.message.received&&$.message.received.$attributes&&$.message.received.$attributes.xmlns===z.NAMESPACES.CHAT_MARKERS||$.message.read&&$.message.read.$attributes&&$.message.read.$attributes.xmlns===z.NAMESPACES.CHAT_MARKERS||$.message.acknowledged&&$.message.acknowledged.$attributes&&$.message.acknowledged.$attributes.xmlns===z.NAMESPACES.CHAT_MARKERS}static getNodeFromJid($){return H.default.Strophe.getNodeFromJid($)}static pickFile($={}){return N.pickFile($)}_isMethodReady($=!0,Y=!1){if(!0===$&&!0!==this._initialised)throw new Error(`XMPP client has not yet been fully initialised.`);if(!0===Y&&!1===this.connected)throw new Error(`An active connection is required to perform this action.`)}}z.doc=null,z.MARKER_TYPES={RECEIVED:'received',READ:'read',ACKNOWLEDGED:'acknowledged'},z.EVENT_TYPES={INITIALISED:'initialised',STATUS:'status',NEW_MESSAGE:'newmessage',ERROR:'error',MESSAGE_UPDATED:'messageupdated',PRESENCE_UPDATE:'presenceupdate',NEW_PARTICIPANT:'newparticipant',PARTICIPANT_UPDATED:'participantupdated',RECEIPT_RECEIVED:'receiptreceived',AUTO_RECONNECTED:'autoreconnected',DBS_DESTROYED:'dbsdestroyed',AUTO_DBS_DESTROYED:'autodbsdestroyed',ACK_RECEIVED:'ackreceived',UPLOAD_STARTED:'uploadstarted',UPLOAD_SUCCESS:'uploadsuccess',UPLOAD_FAILED:'uploadfailed'},z.CHAT_STATUSES={AWAY:'away',CHAT:'chat',DND:'dnd',XA:'xa'},z.NAMESPACES={MUC:'http://jabber.org/protocol/muc',MUC_SUB:'urn:xmpp:mucsub:0',MUC_OWNER:'http://jabber.org/protocol/muc#owner',X_DATA:'jabber:x:data',DISCO_INFO:'http://jabber.org/protocol/disco#info',DISCO_ITEMS:'http://jabber.org/protocol/disco#items',JABBER_CLIENT:'jabber:client',MAM:'urn:xmpp:mam:0',MAM_TMP:'urn:xmpp:mam:tmp',RESULT_SET_MANAGEMENT:'http://jabber.org/protocol/rsm',CHAT_MARKERS:'urn:xmpp:chat-markers:0',CT_METADATA:'ct:metadata:0',HINTS:'urn:xmpp:hints',CT_CLIENT_TIMESTAMP:'ct:client-timestamp:0',CT_SERVER_TIMESTAMP:'urn:commontime:infinity:timestamps',HTTP_UPLOAD:'urn:xmpp:http:upload',PING:'urn:xmpp:ping',CLIENT_STATE_INDICATION:'urn:xmpp:csi:0',ADDRESS:'http://jabber.org/protocol/address',VCARD_UPDATE:'vcard-temp:x:update',TIME:'urn:xmpp:time',INFINITY_BOT:'urn:commontime:infinity:api',PRIVATE_XML_STORAGE:'jabber:iq:private',CT_PRIVATE_XML_STORAGE:'ct:private-xml-data',CT_PUSH:'urn:commontime:infinity:push',PUSH:'urn:xmpp:push:0',DIRECTORY:'urn:commontime:infinity:directory',CARBONS:'urn:xmpp:carbons:2',INFINITY_MAM:'urn:commontime:infinity:mam',INFINITY_ACK:'urn:commontime:infinity:ack'},z.MUC_NODES={PRESENCE:'urn:xmpp:mucsub:nodes:presence',MESSAGES:'urn:xmpp:mucsub:nodes:messages',AFFILIATIONS:'urn:xmpp:mucsub:nodes:affiliations',CONFIG:'urn:xmpp:mucsub:nodes:config',SUBJECT:'urn:xmpp:mucsub:nodes:subject',SYSTEM:'urn:xmpp:mucsub:nodes:system'},z.MARKER_PRIORITIES={received:3,read:2,acknowledged:1},z.OBJECT_TYPES={MESSAGE:'message',CONTACT:'contact',ROOM:'room',PARTICIPANT:'participant',CACHE_ITEM:'cache_item',OBJECT_URL:'object_url'},z.CLIENT_STATES={ACTIVE:'active',INACTIVE:'inactive'},z.ERROR_CODES={DESTROYING_DBS:'destroying_dbs'},h.CtXmppClient=z,window.CtXmppClient=z},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(X,K,Q,Z){return new(Q||(Q=Promise))(function(ee,te){function ne(oe){try{se(Z.next(oe))}catch(ie){te(ie)}}function ae(oe){try{se(Z['throw'](oe))}catch(ie){te(ie)}}function se(oe){oe.done?ee(oe.value):new Q(function(ie){ie(oe.value)}).then(ne,ae)}se((Z=Z.apply(X,K||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(0),N=E(2),M=E(6),I=E(11),D=E(82),L=E(8),B=E(4),H=E(49),z=E(64),$=E(11),Y=E(7),J=E(81),G=E(9);class W extends A.BaseLayer{constructor(X,K,Q){super(X,K),this._postLoginTimeout=null,this.name=X,this.config=K;const Z=Q&&Q.store||new J.Store(X,this.logger,this.config),ee=Q&&Q.comms||new z.Comms(X,this.config.xmpp,Z,this.logger);ee.onDatabasesAutoDestroyed(()=>R(this,void 0,void 0,function*(){console.log('New user detected: clearing all data.'),yield this.store.clearAllData(),this.emit(M.PagerEvents.DatabasesAutoDestroyed)})),ee.onAutoReconnected((te)=>R(this,void 0,void 0,function*(){this._resumed=te.resumed,this.enableSuppressMode('pagerLayer#autoreconnect',!0);const ne=!this._resumed||null!==localStorage.getItem(`${this.name}_needs_mam`);ne&&this.showWaitingMessage('Updating...'),yield this._postLogin(ne),ne&&this.dismissWaitingMessage(),this.emit(M.PagerEvents.LoginResult,new H.ResumableCommsEventArgs(te.resumed,!0)),yield this.cancelSuppressMode('pagerLayer#autoreconnect'),this.emit(M.PagerEvents._Request_CheckForPendingPages)})),ee.onError((te)=>R(this,void 0,void 0,function*(){'string'==typeof te&&te.toLowerCase().includes('kicked')&&(this.emit(M.PagerEvents._Request_Component_Clear_Data),this.emit(M.PagerEvents.LogoutRequestConfirmed),this.emit(M.PagerEvents._Request_RaiseAlert,N.DefaultAlerts.AlertAcknowledge('Disconnected','You have been disconnected by an Administrator.')))})),this.bootstrap(ee,Z),this.config.testMode&&(window.sendTestMessages=D.sendBatchMessages,window.respondToTestMessages=D.respondToAllPendingMessages),window.cti&&(window.cti.store.schema.pagerVersion=window.CtPagerLayer.VERSION)}mute(){this.emit(M.PagerEvents.Mute)}login(X,K){const Q=(Z)=>super[Z];return R(this,void 0,void 0,function*(){const Z='Disconnected during login, please try again.';this.enableSuppressMode('pagerLayer#login',!0);let ee=!1;try{ee=yield Q('login').call(this,X,K)}catch(te){const ne='object'==typeof te&&te.msg?te.msg:Z;return void this._handleLoginFailure(ne)}yield new Promise((te,ne)=>{function ae(){ne({msg:Z}),document.removeEventListener('_pl_disconnected',ae)}document.addEventListener('_pl_disconnected',ae),this.showWaitingMessage('Logging in...');const se=!ee||null!==localStorage.getItem(`${this.name}_needs_mam`);se&&this.logger.log(G.LoggerTypes.Connectivity,'\uD83D\uDC75\uD83C\uDFFB MAM query needed!'),this._postLogin(se).then(()=>{return new Promise((oe,ie)=>{this.purgeOldPages(!0).then(()=>{oe()}).catch(ie)})}).then(()=>{return new Promise((oe,ie)=>{this.getCurrentUser().then((de)=>{this.config.xmpp.user.displayName=de.firstName&&de.lastName?`${de.firstName} ${de.lastName}`.trim():de.jid.split('@')[0],this.emit(M.PagerEvents.CurrentUserVCardUpdate),oe()}).catch(ie)})}).then(()=>{this.dismissWaitingMessage(),this.cancelSuppressMode('pagerLayer#login').then(()=>{this.emit(M.PagerEvents._Request_CheckForPendingPages),te()})}).catch(ne)}).catch((te)=>{const ne='object'==typeof te&&te.msg?te.msg:Z;this._handleLoginFailure(ne)})})}_postLogin(X){return R(this,void 0,void 0,function*(){return new Promise((K,Q)=>R(this,void 0,void 0,function*(){clearTimeout(this._postLoginTimeout);const Z=(ne)=>{return this.dismissWaitingMessage(),clearTimeout(this._postLoginTimeout),this.logger.error('Failure in post-login:',ne),void Q(ne)},ee=yield this.comms.getCurrentUser(),te=ee.group.includes('Console Users');if(this.config.isBroadcaster&&!te||!this.config.isBroadcaster&&te){const ne=this.config.isBroadcaster?'You are not authorised to use the console application.':'Console users are not permitted to login to the responder application.';return Z({msg:ne})}const ne=this.config.xmpp.loginTimeout||1e4;if(this._postLoginTimeout=setTimeout(()=>{clearTimeout(this._postLoginTimeout),Q(new Error('Login took longer than expected, please try again.'))},ne),X){this.logger.log(G.LoggerTypes.Connectivity,'\uD83D\uDC75\uD83C\uDFFB\u2705 SETTING NEEDS MAM FLAG...'),localStorage.setItem(`${this.name}_needs_mam`,'true');try{const ae=yield this.comms.getMessagesFromMam(this.getCurrentUserJid());ae&&0<ae.length&&(yield this._processMamHistory(ae)),this.logger.log(G.LoggerTypes.Connectivity,'\uD83D\uDC75\uD83C\uDFFB\u274C REMOVING NEEDS MAM FLAG...'),localStorage.removeItem(`${this.name}_needs_mam`)}catch(ae){return Z(ae)}}clearTimeout(this._postLoginTimeout),this.config.isBroadcaster&&this.comms.preventPresence(),yield this.comms.setPresence(),K()}))})}_processMamHistory(X){return R(this,void 0,void 0,function*(){const K=[],Q=[];X.map((Z)=>{Z.isFromMam=!0;const ee=B.getMessageType(Z.data);if(ee===I.PagerMessageTypes.NewPage){let te=JSON.parse(Z.data[ee]);te.messageId=Z._id,te.ts=Z.ts,0<Z.attachments.length&&(te=L.addAttachmentsToPage(Z,te)),K.push(te)}else ee===I.PagerMessageTypes.PageResponse&&Q.push(JSON.parse(Z.data[ee]))}),yield Promise.all(Q.map((Z)=>R(this,void 0,void 0,function*(){let ee=K.find((te)=>te._id===Z.pageId);if(ee||(ee=yield this.store.getPageById(Z.pageId),ee&&K.push(ee)),ee){const te=ee.individuals.find((ae)=>ae.jid===Z.from).responses,ne=te.find((ae)=>ae.type===Z.response.type);ne||te.push(Z.response)}return Promise.resolve()}))),yield Promise.all(K.sort((Z,ee)=>Z.openedDate-ee.openedDate).map((Z)=>R(this,void 0,void 0,function*(){if(Z.messageSplit=L.parseMessageContent(Z.message),yield this.store.addOrUpdatePage(Z),!this.config.isBroadcaster){const te=Z.individuals.find((ae)=>ae.jid===this.getCurrentUserJid()),ne=te.responses.find((ae)=>ae.type===Y.ContactResponseType.Response);if(!ne){const ae=te.responses.find((se)=>se.type===Y.ContactResponseType.Received);if(ae||this.sendReadReceipt(Z),this.config.xmpp.maxMessageAlertAge){const se=new Date().getTime(),oe=Z.openedDate;se-oe<=this.config.xmpp.maxMessageAlertAge&&(yield this.store.addToPendingPages(Z),this.emit(M.PagerEvents.NewPageReceived,Z))}else yield this.store.addToPendingPages(Z),this.emit(M.PagerEvents.NewPageReceived,Z)}else this.emit(M.PagerEvents.PageUpdate,Z)}else this.emit(M.PagerEvents.PageUpdate,Z);return Promise.resolve()})))})}_handleLoginFailure(X){return R(this,void 0,void 0,function*(){this.logger.error('\uD83D\uDE31 Handle login failure called:',X),this.dismissWaitingMessage(),yield this.cancelSuppressMode('*'),X&&this.emit(M.PagerEvents._Request_RaiseAlert,N.DefaultAlerts.AlertErrorWithOkayButton('Error logging in',X,1,{})),this.emit(M.PagerEvents._Request_Component_Clear_Data),this.emit(M.PagerEvents.LogoutRequestConfirmed),yield this.comms.logout(!0),yield this.clearAllData()})}purgeOldPages(X=!0){return R(this,void 0,void 0,function*(){yield this.store.purgeOldPages(X),yield this.comms.purgeOldMessages()})}createNewPage(){return R(this,void 0,void 0,function*(){try{this._raiseNewPageModal.createNewPage()}catch(X){this.logger.error(X)}})}updateUserDirectory(){return R(this,void 0,void 0,function*(){return this.comms.updateUserDirectory()})}syncTimeWithServer(){return R(this,void 0,void 0,function*(){return yield this.comms.syncTimeWithServer()})}getAllContactsInGroup(X){return R(this,void 0,void 0,function*(){return yield this.comms.getUsersInGroups(X)})}getAllContacts(X=!1,K=Y.FilterType.Exclude,Q=[]){return R(this,void 0,void 0,function*(){let Z=yield this.comms.getAllContacts();if(Z=Z.filter((ee)=>null!==ee),X){const ee=0<Q.length?Q:this.config.filteredGroups;if(ee){const te=Z.filter((ne)=>{const ae=ee.filter((se)=>ne.groups.includes(se));return K===Y.FilterType.Exclude?0===ae.length?ne:null:0<ae.length?ne:null});return te}return Z}return Z})}getCurrentUser(){return R(this,void 0,void 0,function*(){return yield this.comms.getCurrentUser()})}setSelectedContacts(X){return R(this,void 0,void 0,function*(){yield this.store.setSelectedContacts(X)})}getSelectedContacts(){return R(this,void 0,void 0,function*(){return yield this.store.getSelectedContacts()})}getPages(X,K){return this.store.getPages(this.getCurrentUserJid(),this.config.isBroadcaster,X,K)}setSelectedPage(X){return R(this,void 0,void 0,function*(){return yield this.store.setSelectedPage(X)})}getSelectedPage(){return R(this,void 0,void 0,function*(){return yield this.store.getSelectedPage()})}getPendingPages(){return R(this,void 0,void 0,function*(){return yield this.store.getPendingPages(this.getCurrentUserJid())})}removePendingPage(X){return R(this,void 0,void 0,function*(){return yield this.store.removePendingPage(X)})}deletePage(X){return R(this,void 0,void 0,function*(){return yield this.store.deletePage(X)})}updatePage(X){return R(this,void 0,void 0,function*(){return yield this.store.updatePage(X)})}addContactResponseToPage(X,K,Q){return R(this,void 0,void 0,function*(){return Q||(Q=this.getCurrentUserJid()),yield this.store.addContactResponseToPage(X,K,Q)})}downloadAttachmentsByMessageId(X){return R(this,void 0,void 0,function*(){return this.comms.downloadAttachments(X)})}photoAttachmentsEnabled(){return this.config.options&&!1===this.config.options.enablePhotoAttachments?!1:!0}audioAttachmentsEnabled(){return this.config.options&&!1===this.config.options.enableAudioAttachments?!1:!0}sendReadReceipt(X){const K={ts:new Date().getTime(),type:Y.ContactResponseType.Received};this.emit(M.PagerEvents.PageResponse,new M.SendPageResponseEventArgs(X._id,K,X.sender,X.isTestPage))}generateCommonComponents(X){return R(this,void 0,void 0,function*(){this._raiseNewPageModal=document.querySelector('ct-pg-raise-new-page'),this.config.isBroadcaster&&!this._raiseNewPageModal&&(this._raiseNewPageModal=document.createElement('ct-pg-raise-new-page'),this._raiseNewPageModal.owner=this.name,X.appendChild(this._raiseNewPageModal)),this._readOnlyPageModal=document.querySelector('ct-pg-read-only-page'),this.config.isBroadcaster&&!this._readOnlyPageModal&&(this._readOnlyPageModal=document.createElement('ct-pg-read-only-page'),this._readOnlyPageModal.owner=this.name,X.appendChild(this._readOnlyPageModal)),this._newPageModal=document.querySelector('ct-pg-new-page-modal'),this.config.isBroadcaster||this._newPageModal||(this._newPageModal=document.createElement('ct-pg-new-page-modal'),this._newPageModal.owner=this.name,X.appendChild(this._newPageModal)),this._clientReadOnlyModal=document.querySelector('ct-pg-read-only-client'),this.config.isBroadcaster||this._clientReadOnlyModal||(this._clientReadOnlyModal=document.createElement('ct-pg-read-only-client'),this._clientReadOnlyModal.owner=this.name,X.appendChild(this._clientReadOnlyModal))})}getHandlers(){return $.get(this)}}W.VERSION='0.2.5',h.PagerLayer=W,window.CtPagerLayer=W},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const M=E(15),I=E(96);h.isNumber=function(D){return!isNaN(parseFloat(D))&&isFinite(D)},h.generateGuid=function(){let D=Date.now();return window.performance&&'function'==typeof window.performance.now&&(D+=performance.now()),'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(L){const B=0|(D+16*Math.random())%16;return D=Math.floor(D/16),('x'===L?B:8|3&B).toString(16)})},h.getEncryptionKey=function(D){return new Promise((L,B)=>{const H=M.getSource('securesettings');if(!1!==H)H.getOrCreateCryptographicKey(function($){const J=I.Buffer.from(function(G){let W=[];for(let X=0;X<G.length;X+=2)W.push(parseInt(G.substr(X,2),16));return W}($));L(J)},B,D,256);else{console.warn('Oh no! \uD83D\uDE31 Your databases are encrypted but the key couldn\'t be secured because this platform doesn\'t support secure settings.');const $=localStorage.getItem(`${D}_key`);if(null!==$){const Y=I.Buffer.from(JSON.parse($));L(Y)}else{let Y=[],J;if(window.crypto&&window.crypto.getRandomValues){var z=new Uint8Array(32);for(window.crypto.getRandomValues(z),J=0;32>J;J++)Y[J]=z[J]}else for(let W=0;32>W;W++)Y[W]=Math.floor(256*Math.random());localStorage.setItem(`${D}_key`,JSON.stringify(Y));const G=I.Buffer.from(Y);L(G)}}})}},function(l,h,E){'use strict';var R=this&&this.__decorate||function(Y,J,G,W){var X=arguments.length,K=3>X?J:null===W?W=Object.getOwnPropertyDescriptor(J,G):W,Q;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)K=Reflect.decorate(Y,J,G,W);else for(var Z=Y.length-1;0<=Z;Z--)(Q=Y[Z])&&(K=(3>X?Q(K):3<X?Q(J,G,K):Q(J,G))||K);return 3<X&&K&&Object.defineProperty(J,G,K),K},A=this&&this.__awaiter||function(Y,J,G,W){return new(G||(G=Promise))(function(X,K){function Q(te){try{ee(W.next(te))}catch(ne){K(ne)}}function Z(te){try{ee(W['throw'](te))}catch(ne){K(ne)}}function ee(te){te.done?X(te.value):new G(function(ne){ne(te.value)}).then(Q,Z)}ee((W=W.apply(Y,J||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(7),I=E(4),D=E(3),L=E(1),B=E(8),H=E(2);var z;(function(Y){Y[Y.Individuals='individuals']='Individuals',Y[Y.Groups='groups']='Groups'})(z||(z={}));class $ extends N.CTLayerComponent{constructor(){super(...arguments),this.tabSelected=z.Individuals,this.loadingContacts=!1}static get is(){return'ct-pg-contact-selection'}initialize(){return A(this,void 0,void 0,function*(){})}setupListeners(){}attributeChangedCallback(Y,J,G){const W=(X)=>super[X];return A(this,void 0,void 0,function*(){if(W('attributeChangedCallback').call(this,Y,J,G),'showing'===Y){this.loadingContacts=!0;try{yield this.layer.updateUserDirectory()}catch(K){console.error(K)}this.loadingContacts=!1,this.tabSelected=z.Individuals,this.contacts=yield this.layer.getAllContacts(!0),this.contacts.map((K)=>{const Q=this.selectedContacts.find((Z)=>Z.name===K.id);return Q?K.selected=!0:(K.selected=!1,K.groups.map((Z)=>{const ee=this.selectedContacts.find((te)=>te.isGroup&&te.name===Z);ee&&(K.selected=!0)})),K.groups.map((Z)=>{const ee=this.groups[Z];ee?ee.contactCount+=1:this.groups[Z]={id:Z,selectedCount:0,contactCount:1,selected:!1}}),K}),Object.keys(this.groups).map((K)=>this.groups[K].selected=!1);const X=this.selectedContacts.filter((K)=>K.isGroup).sort((K,Q)=>{return K.name<Q.name?-1:K.name>Q.name?1:0});X.map((K)=>{this.groups[K.name].selected=!0}),this.contacts.sort((K,Q)=>{return K.id<Q.id?-1:K.id>Q.id?1:0})}})}close(){this.showing=!1,this.resetContactSelections(),this.closeFunction&&this.closeFunction()}selectTab(Y){this.tabSelected=Y}toggleContactSelection(Y,J=!1){if(!J){const G=this.contacts.find((W)=>W.id===Y);G.selected=!G.selected,!1===G.selected&&G.groups.map((W)=>this.groups[W].selected=!1)}else{const G=this.groups[Y];G.selected=!G.selected,this.contacts.map((W)=>{const X=W.groups.includes(G.id);X&&(W.selected=G.selected)})}this.forceRedraw()}resetContactSelections(){this.contacts=this.contacts.map((Y)=>Object.assign({},Y,{selected:!1})),Object.keys(this.groups).map((Y)=>this.groups[Y].selected=!1)}confirmSelectedContacts(){return A(this,void 0,void 0,function*(){this.selectedContacts=I.deepCloneArray(B.convertContacts(this.groups,this.contacts)),yield this.layer.setSelectedContacts(this.selectedContacts),this.close()})}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{width:100%;height:100%;display:flex;background-color:rgba(0,0,0,0.6);opacity:0;visibility:hidden;position:fixed;z-index:2;top:0}:host .container{display:flex;flex-direction:column;margin:auto;width:50vw;height:90vh;min-width:500px;transform:translateY(100%);will-change:transform;transition:transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);visibility:hidden}:host .container .overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);color:#FFF;display:flex;align-items:center;justify-content:center;font-size:18px;opacity:0;pointer-events:none;transition:opacity ease-in-out 300ms}:host .container .overlay span{display:block;margin-left:10px}:host .container .overlay.open{opacity:1;pointer-events:auto}:host .container .title{display:flex;justify-content:flex-end;flex:0 0 var(--header-height, 60px);padding:10px 0 10px 20px}:host .container .title h2{position:absolute;left:50%;top:0;transform:translateX(-50%)}:host .container .tabs{display:flex;flex:0 0 var(--header-height, 60px)}:host .container .tabs .tab{flex-basis:50%;display:flex;cursor:pointer}:host .container .tabs .tab h4{margin:auto}:host .container .contacts{overflow:auto;-webkit-overflow-scrolling:touch}:host .container .contacts div.inner{display:flex;flex-direction:column;width:100%}:host .container .contacts div.inner div.row{width:100%;padding:15px 30px;margin:auto;cursor:pointer;display:flex;justify-content:space-between}:host .container .buttonsContainer{display:flex;flex:0 0 10vh;margin-top:auto;width:100%;justify-content:flex-end}:host .container .buttonsContainer div{width:50%;margin:auto}@media screen and (max-width: 640px){:host .container{width:100%;height:100%;min-width:100%;max-height:100%}}:host([showing]){visibility:visible;transition:opacity 0.25s ease-in;opacity:1}:host([showing]) div.container{visibility:visible;transform:translateY(0)}:host .container{background-color:var(--default-bg-color);color:var(--default-font-color)}:host .container .title{background-color:var(--primary-color, #15233B);color:var(--primary-font-color, #fff)}:host .container .tabs .tab{background-color:var(--primary-color, #15233B);color:var(--primary-font-color, #fff)}:host .container .tabs .tab.selected{background-color:var(--default-bg-color);color:var(--default-font-color)}:host .container .contacts div.inner div.row{border-bottom:1px solid var(--default-border-color)}:host .container .buttonsContainer{background-color:var(--default-bg-color-dark)}
        `}generateComponentMarkup(){return window.__CTRender('div',{className:'container'},window.__CTRender('div',{className:`overlay ${this.loadingContacts?'open':''}`},window.__CTRender(L.CTIcon,{icon:H.Icons.COMMON.LoadingSpinner,width:'16px',height:'16px',spin:!0}),' ',window.__CTRender('span',null,'Updating contacts...')),window.__CTRender('div',{className:'title'},window.__CTRender('h2',null,'To:'),window.__CTRender(L.CTButton,{type:'transparent',icon:M.Icons.FONTAWESOME.Cross,iconColor:'#fff',onClick:()=>this.close()})),window.__CTRender('div',{className:'tabs'},window.__CTRender('div',{className:`tab ${this.tabSelected===z.Individuals?'selected':''}`,onClick:()=>this.selectTab(z.Individuals)},window.__CTRender('h4',null,'Individuals')),window.__CTRender('div',{className:`tab ${this.tabSelected===z.Groups?'selected':''}`,onClick:()=>this.selectTab(z.Groups)},window.__CTRender('h4',null,'Groups'))),window.__CTRender('div',{className:'contacts'},this._renderContactsList()),window.__CTRender('div',{className:'buttonsContainer'},window.__CTRender('div',null,window.__CTRender(L.CTButton,{type:'primary',onClick:()=>this.confirmSelectedContacts()},'Done'))))}_renderContactsList(){return D.renderIfElse(this.tabSelected===z.Individuals,window.__CTRender('div',{className:'inner'},this.contacts.map((Y)=>this._renderContactRow(Y))),window.__CTRender('div',{className:'inner'},' ',Object.keys(this.groups).map((Y)=>this._renderContactRow(this.groups[Y],!0))))}_renderContactRow(Y,J=!1){return window.__CTRender('div',{className:`row ${Y.selected?'selected':''}`,onClick:()=>this.toggleContactSelection(Y.id,J)},J?Y.id:B.getNameFromContact(Y),D.renderIf(Y.selected,window.__CTRender(L.CTIcon,{width:'18',height:'18',icon:M.Icons.FONTAWESOME.CheckCircleFilled})))}}R([N.prop({type:Boolean,attribute:!0,default:!1})],$.prototype,'showing',void 0),R([N.prop({type:Array,attribute:!1,default:[]})],$.prototype,'contacts',void 0),R([N.prop({type:Array,attribute:!1,default:[]})],$.prototype,'groups',void 0),R([N.prop({type:Array,attribute:!1})],$.prototype,'selectedContacts',void 0),R([N.prop({type:String,attribute:!1})],$.prototype,'tabSelected',void 0),R([N.prop({type:Boolean,attribute:!1})],$.prototype,'loadingContacts',void 0),h.CTPGContactSelection=$,$.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,J=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,G;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(G=B[W])&&(J=(3>Y?G(J):3<Y?G(H,z,J):G(H,z))||J);return 3<Y&&J&&Object.defineProperty(H,z,J),J},A=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,J){function G(K){try{X($.next(K))}catch(Q){J(Q)}}function W(K){try{X($['throw'](K))}catch(Q){J(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(G,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(28),I=E(1),D=E(16);class L extends N.CTLayerComponent{constructor(){super(...arguments),this.btnClick=()=>A(this,void 0,void 0,function*(){const B=yield D.CtXmppClient.pickFile({mimeTypes:this.fileTypes});let H=!0;B&&(B.forEach((z)=>{this._isAcceptableFile(z)||(H=!1)}),H?this.callback(B):this.layer.error('Invalid File Type',`Please add a file type that matches one of: ${this.extensions.join(',')}`))})}static get is(){return'ct-pg-file-picker'}initialize(){return A(this,void 0,void 0,function*(){this.extensions=this.fileTypes.reduce((B,H)=>{const z=H.split('/');return 0<z.length&&B.push(z[1].toLowerCase()),B},[])})}setupListeners(){}_isAcceptableFile(B){const H=B.lastIndexOf('.')+1,z=B.substring(H).toLowerCase();return this.extensions.includes(z)}get generateComponentStyles(){return``}generateComponentMarkup(){return window.__CTRender('div',null,window.__CTRender(I.CTButton,{icon:M.Icons.FONTAWESOME.PlusSign,iconColor:'#fff',onClick:this.btnClick}))}}R([N.prop({type:Array,attribute:!0,default:['image/jpg','image/jpeg','image/png','image/gif']})],L.prototype,'fileTypes',void 0),R([N.prop({type:Function,attribute:!1})],L.prototype,'callback',void 0),h.CTPGFilePicker=L,L.register()},function(l,h,E){(function(R,A){(function(N,M){l.exports=M()})(this,function(){'use strict';function N(Ue){var He=typeof Ue;return null!==Ue&&('object'==He||'function'==He)}function M(Ue){return'function'==typeof Ue}function B(){return'undefined'==typeof ve?$():function(){ve(Y)}}function $(){var Ue=setTimeout;return function(){return Ue(Y,1)}}function Y(){for(var Ue=0;Ue<Ee;Ue+=2){var He=we[Ue],ze=we[Ue+1];He(ze),we[Ue]=void 0,we[Ue+1]=void 0}Ee=0}function G(Ue,He){var ze=this,$e=new this.constructor(X);void 0===$e[Le]&&ge($e);var Ye=ze._state;if(Ye){var Ve=arguments[Ye-1];Pe(function(){return ue(Ye,$e,Ve,ze._result)})}else de(ze,$e,Ue,He);return $e}function W(Ue){var He=this;if(Ue&&'object'==typeof Ue&&Ue.constructor===He)return Ue;var ze=new He(X);return ae(ze,Ue),ze}function X(){}function K(){return new TypeError('You cannot resolve a promise with itself')}function Q(){return new TypeError('A promises callback cannot return that same promise.')}function Z(Ue,He,ze,$e){try{Ue.call(He,ze,$e)}catch(Ye){return Ye}}function ee(Ue,He,ze){Pe(function($e){var Ye=!1,Ve=Z(ze,He,function(Je){Ye||(Ye=!0,He===Je?oe($e,Je):ae($e,Je))},function(Je){Ye||(Ye=!0,ie($e,Je))},'Settle: '+($e._label||' unknown promise'));!Ye&&Ve&&(Ye=!0,ie($e,Ve))},Ue)}function te(Ue,He){He._state===ke?oe(Ue,He._result):He._state===qe?ie(Ue,He._result):de(He,void 0,function(ze){return ae(Ue,ze)},function(ze){return ie(Ue,ze)})}function ne(Ue,He,ze){He.constructor===Ue.constructor&&ze===G&&He.constructor.resolve===W?te(Ue,He):void 0===ze?oe(Ue,He):M(ze)?ee(Ue,He,ze):oe(Ue,He)}function ae(Ue,He){if(Ue===He)ie(Ue,K());else if(N(He)){var ze;try{ze=He.then}catch($e){return void ie(Ue,$e)}ne(Ue,He,ze)}else oe(Ue,He)}function se(Ue){Ue._onerror&&Ue._onerror(Ue._result),le(Ue)}function oe(Ue,He){Ue._state!==Oe||(Ue._result=He,Ue._state=ke,0!==Ue._subscribers.length&&Pe(le,Ue))}function ie(Ue,He){Ue._state!==Oe||(Ue._state=qe,Ue._result=He,Pe(se,Ue))}function de(Ue,He,ze,$e){var Ye=Ue._subscribers,Ve=Ye.length;Ue._onerror=null,Ye[Ve]=He,Ye[Ve+ke]=ze,Ye[Ve+qe]=$e,0===Ve&&Ue._state&&Pe(le,Ue)}function le(Ue){var He=Ue._subscribers,ze=Ue._state;if(0!==He.length){for(var $e=void 0,Ye=void 0,Ve=Ue._result,Je=0;Je<He.length;Je+=3)$e=He[Je],Ye=He[Je+ze],$e?ue(ze,$e,Ye,Ve):Ye(Ve);Ue._subscribers.length=0}}function ue(Ue,He,ze,$e){var Ye=M(ze),Ge=!0,Ve,Je;if(Ye){try{Ve=ze($e)}catch(We){Ge=!1,Je=We}if(He===Ve)return void ie(He,Q())}else Ve=$e;He._state!==Oe||(Ye&&Ge?ae(He,Ve):!1==Ge?ie(He,Je):Ue===ke?oe(He,Ve):Ue===qe&&ie(He,Ve))}function ce(Ue,He){try{He(function($e){ae(Ue,$e)},function($e){ie(Ue,$e)})}catch(ze){ie(Ue,ze)}}function pe(){return Be++}function ge(Ue){Ue[Le]=Be++,Ue._state=void 0,Ue._result=void 0,Ue._subscribers=[]}function me(){return new Error('Array Methods must be provided an Array')}function ye(){throw new TypeError('You must pass a resolver function as the first argument to the promise constructor')}function Te(){throw new TypeError('Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.')}var be=Array.isArray?Array.isArray:function(Ue){return'[object Array]'===Object.prototype.toString.call(Ue)};var Se=be,Ee=0,ve=void 0,Re=void 0,Pe=function(He,ze){we[Ee]=He,we[Ee+1]=ze,Ee+=2,2==Ee&&(Re?Re(Y):De())},Ae='undefined'==typeof window?void 0:window,Ne=Ae||{},Me=Ne.MutationObserver||Ne.WebKitMutationObserver,xe='undefined'==typeof self&&'undefined'!=typeof R&&'[object process]'==={}.toString.call(R),Ie='undefined'!=typeof Uint8ClampedArray&&'undefined'!=typeof importScripts&&'undefined'!=typeof MessageChannel,we=Array(1e3),De=void 0;De=xe?function(){return function(){return R.nextTick(Y)}}():Me?function(){var Ue=0,He=new Me(Y),ze=document.createTextNode('');return He.observe(ze,{characterData:!0}),function(){ze.data=Ue=++Ue%2}}():Ie?function(){var Ue=new MessageChannel;return Ue.port1.onmessage=Y,function(){return Ue.port2.postMessage(0)}}():void 0!==Ae||0?$():function(){try{var Ue=Function('return this')().require('vertx');return ve=Ue.runOnLoop||Ue.runOnContext,B()}catch(He){return $()}}();var Le=Math.random().toString(36).substring(2),Oe=void 0,ke=1,qe=2,Be=0,je=function(){function Ue(He,ze){this._instanceConstructor=He,this.promise=new He(X),this.promise[Le]||ge(this.promise),Se(ze)?(this.length=ze.length,this._remaining=ze.length,this._result=Array(this.length),0===this.length?oe(this.promise,this._result):(this.length=this.length||0,this._enumerate(ze),0===this._remaining&&oe(this.promise,this._result))):ie(this.promise,me())}return Ue.prototype._enumerate=function(ze){for(var $e=0;this._state===Oe&&$e<ze.length;$e++)this._eachEntry(ze[$e],$e)},Ue.prototype._eachEntry=function(ze,$e){var Ye=this._instanceConstructor,Ve=Ye.resolve;if(Ve===W){var Je=void 0,Ge=void 0,We=!1;try{Je=ze.then}catch(Ke){We=!0,Ge=Ke}if(Je===G&&ze._state!==Oe)this._settledAt(ze._state,$e,ze._result);else if('function'!=typeof Je)this._remaining--,this._result[$e]=ze;else if(Ye===Fe){var Xe=new Ye(X);We?ie(Xe,Ge):ne(Xe,ze,Je),this._willSettleAt(Xe,$e)}else this._willSettleAt(new Ye(function(Ke){return Ke(ze)}),$e)}else this._willSettleAt(Ve(ze),$e)},Ue.prototype._settledAt=function(ze,$e,Ye){var Ve=this.promise;Ve._state===Oe&&(this._remaining--,ze===qe?ie(Ve,Ye):this._result[$e]=Ye),0===this._remaining&&oe(Ve,this._result)},Ue.prototype._willSettleAt=function(ze,$e){var Ye=this;de(ze,void 0,function(Ve){return Ye._settledAt(ke,$e,Ve)},function(Ve){return Ye._settledAt(qe,$e,Ve)})},Ue}(),Fe=function(){function Ue(He){this[Le]=pe(),this._result=this._state=void 0,this._subscribers=[],X!==He&&('function'!=typeof He&&ye(),this instanceof Ue?ce(this,He):Te())}return Ue.prototype.catch=function(ze){return this.then(null,ze)},Ue.prototype.finally=function(ze){var $e=this,Ye=$e.constructor;return M(ze)?$e.then(function(Ve){return Ye.resolve(ze()).then(function(){return Ve})},function(Ve){return Ye.resolve(ze()).then(function(){throw Ve})}):$e.then(ze,ze)},Ue}();return Fe.prototype.then=G,Fe.all=function(Ue){return new je(this,Ue).promise},Fe.race=function(Ue){var He=this;return Se(Ue)?new He(function(ze,$e){for(var Ye=Ue.length,Ve=0;Ve<Ye;Ve++)He.resolve(Ue[Ve]).then(ze,$e)}):new He(function(ze,$e){return $e(new TypeError('You must pass an array to race.'))})},Fe.resolve=W,Fe.reject=function(Ue){var He=this,ze=new He(X);return ie(ze,Ue),ze},Fe._setScheduler=function(Ue){Re=Ue},Fe._setAsap=function(Ue){Pe=Ue},Fe._asap=Pe,Fe.polyfill=function(){var Ue;if('undefined'!=typeof A)Ue=A;else if('undefined'!=typeof self)Ue=self;else try{Ue=Function('return this')()}catch($e){throw new Error('polyfill failed because global object is unavailable in this environment')}var He=Ue.Promise;if(He){var ze=null;try{ze=Object.prototype.toString.call(He.resolve())}catch($e){}if('[object Promise]'===ze&&!He.cast)return}Ue.Promise=Fe},Fe.Promise=Fe,Fe})}).call(h,E(99),E(30))},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R=E(37),A=E.n(R),N=E(38);h['default']=E.i(N.a)(A.a)},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(13),A=E(55),N=E(4);window.__CTRender=window.skate.h;const M=[A.OverridingStylesMixin,A.ComponentStylesMixin,A.RenderMixin],I=M.reduce((L,B)=>B(L),R.Component);class D extends I{renderHtml(L){(void 0===L||null===L)&&(L='');const B=-1!==L.indexOf('<')&&-1!==L.indexOf('>');if(!B)return L;const H=`html_${N.generateRandomSixString()}_${N.generateRandomSixString()}`;return this.onRenderComplete(()=>{const z=this.shadowRoot.querySelector(`#${H}`);z&&(z.innerHTML=L)},!0),R.h('span',{id:H,class:'user-html',style:{display:'inline-block'}})}onRenderComplete(L,B=!1){this.shadowRoot&&this.addEventListener('render-complete',function H(){L(),B&&this.removeEventListener('render-complete',H)})}renderedCallback(){super.renderedCallback(),this.dispatchEvent(new CustomEvent('render-complete'))}static register(){if(null===this.is)return void console.error('Could not register component, please ensure that it has a static is property');const L=customElements.get(this.is);L||customElements.define(this.is,this)}}D.is=null,h.CTBaseComponent=D},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});class R{static addInstance(A,N){R.ensureRegistrationsObject(),window.__CTLayers[A]={instance:N,isReady:!1}}static getInstance(A){R.ensureRegistrationsObject();const N=window.__CTLayers[A];return!N?null:N.instance}static onReady(A,N){R.ensureRegistrationsObject();const M=window.__CTLayers[A],I=!!M&&M.isReady;I?setTimeout(()=>{N()},0):document.addEventListener(`base-layer-ready:${A}`,()=>{setTimeout(()=>{N()},0)})}static fireReady(A){R.ensureRegistrationsObject();const N=window.__CTLayers[A];!N||(N.isReady=!0),document.dispatchEvent(new CustomEvent(`base-layer-ready:${A}`))}static ensureRegistrationsObject(){window.__CTLayers||(window.__CTLayers={})}}h.LayerRegistration=R,window.CtLayerRegistration=R},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(12);class A extends R.BaseEventArgs{constructor(N,M){super(),this.success=N,M&&(this.errorMessage=M)}}h.CommsEventArgs=A},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R;(function(A){function N(){return'alert_'+new Date().getTime().toString()}A.generateId=N,A.AlertWaiting=function(H){return{id:N(),raisedOn:new Date().getTime(),priority:1,type:'info',title:'Please wait...',body:H,showLoadingAnimation:!0}},A.AlertErrorWithOkayButton=function(H='Error',z='An error occurred',$=1,Y={}){return{id:N(),raisedOn:new Date().getTime(),priority:$,type:'error',title:H,body:z,buttons:[{text:'Okay',action:Y.okay,type:'primary'}]}},A.AlertYesNoQuestion=function(H,z,$=0,Y={}){return{id:N(),raisedOn:new Date().getTime(),priority:$,type:'question',title:H,body:z,buttons:[{text:'No',action:Y.no,type:'primary'},{text:'Yes',action:Y.yes,type:'primary'}]}},A.AlertQuestion=function(H,z,$=0,Y){return{id:N(),raisedOn:new Date().getTime(),priority:$,type:'question',title:H,body:z,buttons:Y}},A.AlertAcknowledge=function(H,z,$=0,Y={},J){return{id:N(),raisedOn:new Date().getTime(),priority:$,type:'success',title:H,body:z,buttons:[{text:J||'Okay',action:Y.okay,type:'primary'}]}}})(R=h.DefaultAlerts||(h.DefaultAlerts={}))},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R;(function(A){A.COMMON={StatusOnline:{viewBox:'0 0 1024 1024',paths:['M470.923457,555.52087 L517.156966,555.52087 L678.97425,987.033627 L309.106173,987.033627 L470.923457,555.52087 Z M581.144144,581.041767 L537.561355,537.458979 C548.780687,526.239647 555.684891,510.828477 555.684891,493.87619 C555.684891,459.848327 528.068075,432.231511 494.040212,432.231511 C459.950704,432.231511 432.395532,459.848327 432.395532,493.87619 C432.395532,510.828477 439.238091,526.239647 450.457423,537.458979 L406.874635,581.041767 C384.559261,558.726393 370.750852,527.904054 370.750852,493.87619 C370.750852,425.75882 425.922841,370.586831 494.040212,370.586831 C562.095938,370.586831 617.329571,425.75882 617.329571,493.87619 C617.329571,527.904054 603.459518,558.726393 581.144144,581.041767 Z M494.040212,185.652792 L493.916922,185.652792 C664.179527,185.652792 802.14032,323.67523 802.14032,493.87619 C802.14032,579.007493 767.680944,656.063343 711.892509,711.851778 L668.309721,668.268989 C712.940469,623.638241 740.495641,561.993561 740.495641,493.937835 C740.495641,357.764738 630.213309,247.359117 494.040212,247.359117 C357.80547,247.359117 247.461493,357.764738 247.461493,493.937835 C247.461493,561.993561 274.95502,623.638241 319.647413,668.268989 L276.064625,711.851778 C220.337834,656.063343 185.816814,579.007493 185.816814,493.87619 C185.816814,323.67523 323.777607,185.652792 494.040212,185.652792 Z M494.040212,0.718753674 C766.386406,0.718753674 987.197648,221.529996 987.197648,493.87619 C987.197648,630.049288 931.964016,753.338647 842.702519,842.600143 L799.119731,799.017354 C877.22354,720.97519 925.552969,613.097001 925.552969,493.87619 C925.552969,255.557859 732.296898,62.3634333 494.040212,62.3634333 C255.72188,62.3634333 62.5274544,255.557859 62.5274544,493.87619 C62.5274544,613.097001 110.733594,720.97519 188.899048,799.017354 L145.316259,842.600143 C56.0547631,753.338647 0.882774838,630.049288 0.882774838,493.87619 C0.882774838,221.529996 221.632372,0.718753674 494.040212,0.718753674 Z']},StatusOffline:{viewBox:'0 0 1024 1024',paths:['M586.678306,210.286115 C562.139482,203.996961 536.419525,200.652792 509.916922,200.652792 L510.040212,200.652792 C339.777607,200.652792 201.816814,338.67523 201.816814,508.87619 C201.816814,535.342777 205.153389,561.028843 211.426433,585.537988 L264.560722,532.403699 C263.833299,524.67956 263.461493,516.852047 263.461493,508.937835 C263.461493,372.764738 373.80547,262.359117 510.040212,262.359117 C517.95418,262.359117 525.7807,262.732021 533.503206,263.461215 L586.678306,210.286115 Z M806.86787,425.990261 C814.213724,452.364232 818.14032,480.162284 818.14032,508.87619 C818.14032,594.007493 783.680944,671.063343 727.892509,726.851778 L684.309721,683.268989 C728.940469,638.638241 756.495641,576.993561 756.495641,508.937835 C756.495641,498.546495 755.853446,488.305204 754.606559,478.251572 L806.86787,425.990261 Z','M729.725748,67.238671 C663.573003,34.2656239 588.970927,15.7187537 510.040212,15.7187537 C237.632372,15.7187537 16.8827748,236.529996 16.8827748,508.87619 C16.8827748,587.810373 35.420918,662.415536 68.3909758,728.573445 L114.711707,682.252714 C91.4312107,629.204161 78.5274544,570.558265 78.5274544,508.87619 C78.5274544,270.557859 271.72188,77.3634333 510.040212,77.3634333 C571.684303,77.3634333 630.316005,90.2960769 683.367584,113.596835 L729.725747,67.2386739 L729.725748,67.238671 Z M948.986253,283.87188 C983.639793,351.333945 1003.19765,427.822772 1003.19765,508.87619 C1003.19765,645.049288 947.964016,768.338647 858.702519,857.600143 L815.119731,814.017354 C893.22354,735.97519 941.552969,628.097001 941.552969,508.87619 C941.552969,445.074231 927.701805,384.506419 902.844202,330.013931 L948.98625,283.871881 L948.986253,283.87188 Z','M568.387956,664.470175 L694.97425,1002.03363 L325.106173,1002.03363 L381.675174,851.182956 L568.387956,664.470175 Z M38.537334,1018.85532 L3.14468065,983.537334 L984.462666,0.144680652 L1019.85532,35.462666 L38.537334,1018.85532 Z']},LoadingSpinner:{viewBox:'0 0 1024 1024',paths:['M1005.714 512c0 272.571-221.143 493.714-493.714 493.714s-493.714-221.143-493.714-493.714c0-248 182.857-453.143 420.571-488.571v130.286c-166.857 33.714-292.571 181.714-292.571 358.286 0 201.714 164 365.714 365.714 365.714s365.714-164 365.714-365.714c0-176.571-125.714-324.571-292.571-358.286v-130.286c237.714 35.429 420.571 240.571 420.571 488.571z']},ChevronDown:{viewBox:'0 0 1024 1024',paths:['M614.286 420.571q0 7.429-5.714 13.143l-266.286 266.286q-5.714 5.714-13.143 5.714t-13.143-5.714l-266.286-266.286q-5.714-5.714-5.714-13.143t5.714-13.143l28.571-28.571q5.714-5.714 13.143-5.714t13.143 5.714l224.571 224.571 224.571-224.571q5.714-5.714 13.143-5.714t13.143 5.714l28.571 28.571q5.714 5.714 5.714 13.143z']},ChevonLeft:{viewBox:'0 0 1024 1024',paths:['M669.143 172l-303.429 303.429 303.429 303.429q10.857 10.857 10.857 25.714t-10.857 25.714l-94.857 94.857q-10.857 10.857-25.714 10.857t-25.714-10.857l-424-424q-10.857-10.857-10.857-25.714t10.857-25.714l424-424q10.857-10.857 25.714-10.857t25.714 10.857l94.857 94.857q10.857 10.857 10.857 25.714t-10.857 25.714z']},ChevronRight:{viewBox:'0 0 1024 1024',paths:['M632.571 501.143l-424 424q-10.857 10.857-25.714 10.857t-25.714-10.857l-94.857-94.857q-10.857-10.857-10.857-25.714t10.857-25.714l303.429-303.429-303.429-303.429q-10.857-10.857-10.857-25.714t10.857-25.714l94.857-94.857q10.857-10.857 25.714-10.857t25.714 10.857l424 424q10.857 10.857 10.857 25.714t-10.857 25.714z']},ChevronUp:{viewBox:'0 0 1024 1024',paths:['M614.286 676.571q0 7.429-5.714 13.143l-28.571 28.571q-5.714 5.714-13.143 5.714t-13.143-5.714l-224.571-224.571-224.571 224.571q-5.714 5.714-13.143 5.714t-13.143-5.714l-28.571-28.571q-5.714-5.714-5.714-13.143t5.714-13.143l266.286-266.286q5.714-5.714 13.143-5.714t13.143 5.714l266.286 266.286q5.714 5.714 5.714 13.143z']},ClearTextbox:{viewBox:'0 0 1024 1024',paths:['M1014.662 822.66c-0.004-0.004-0.008-0.008-0.012-0.010l-310.644-310.65 310.644-310.65c0.004-0.004 0.008-0.006 0.012-0.010 3.344-3.346 5.762-7.254 7.312-11.416 4.246-11.376 1.824-24.682-7.324-33.83l-146.746-146.746c-9.148-9.146-22.45-11.566-33.828-7.32-4.16 1.55-8.070 3.968-11.418 7.31 0 0.004-0.004 0.006-0.008 0.010l-310.648 310.652-310.648-310.65c-0.004-0.004-0.006-0.006-0.010-0.010-3.346-3.342-7.254-5.76-11.414-7.31-11.38-4.248-24.682-1.826-33.83 7.32l-146.748 146.748c-9.148 9.148-11.568 22.452-7.322 33.828 1.552 4.16 3.97 8.072 7.312 11.416 0.004 0.002 0.006 0.006 0.010 0.010l310.65 310.648-310.65 310.652c-0.002 0.004-0.006 0.006-0.008 0.010-3.342 3.346-5.76 7.254-7.314 11.414-4.248 11.376-1.826 24.682 7.322 33.83l146.748 146.746c9.15 9.148 22.452 11.568 33.83 7.322 4.16-1.552 8.070-3.97 11.416-7.312 0.002-0.004 0.006-0.006 0.010-0.010l310.648-310.65 310.648 310.65c0.004 0.002 0.008 0.006 0.012 0.008 3.348 3.344 7.254 5.762 11.414 7.314 11.378 4.246 24.684 1.826 33.828-7.322l146.746-146.748c9.148-9.148 11.57-22.454 7.324-33.83-1.552-4.16-3.97-8.068-7.314-11.414z']},ShowPassword:{viewBox:'0 0 1024 1024',paths:['M512 192c-223.318 0-416.882 130.042-512 320 95.118 189.958 288.682 320 512 320 223.312 0 416.876-130.042 512-320-95.116-189.958-288.688-320-512-320zM764.45 361.704c60.162 38.374 111.142 89.774 149.434 150.296-38.292 60.522-89.274 111.922-149.436 150.296-75.594 48.218-162.89 73.704-252.448 73.704-89.56 0-176.858-25.486-252.452-73.704-60.158-38.372-111.138-89.772-149.432-150.296 38.292-60.524 89.274-111.924 149.434-150.296 3.918-2.5 7.876-4.922 11.86-7.3-9.96 27.328-15.41 56.822-15.41 87.596 0 141.382 114.616 256 256 256 141.382 0 256-114.618 256-256 0-30.774-5.452-60.268-15.408-87.598 3.978 2.378 7.938 4.802 11.858 7.302v0zM512 416c0 53.020-42.98 96-96 96s-96-42.98-96-96 42.98-96 96-96 96 42.982 96 96z']},AlertQuestion:{viewBox:'0 0 1024 1024',paths:['M512 786.286v-109.714q0-8-5.143-13.143t-13.143-5.143h-109.714q-8 0-13.143 5.143t-5.143 13.143v109.714q0 8 5.143 13.143t13.143 5.143h109.714q8 0 13.143-5.143t5.143-13.143zM658.286 402.286q0-50.286-31.714-93.143t-79.143-66.286-97.143-23.429q-138.857 0-212 121.714-8.571 13.714 4.571 24l75.429 57.143q4 3.429 10.857 3.429 9.143 0 14.286-6.857 30.286-38.857 49.143-52.571 19.429-13.714 49.143-13.714 27.429 0 48.857 14.857t21.429 33.714q0 21.714-11.429 34.857t-38.857 25.714q-36 16-66 49.429t-30 71.714v20.571q0 8 5.143 13.143t13.143 5.143h109.714q8 0 13.143-5.143t5.143-13.143q0-10.857 12.286-28.286t31.143-28.286q18.286-10.286 28-16.286t26.286-20 25.429-27.429 16-34.571 7.143-46.286zM877.714 512q0 119.429-58.857 220.286t-159.714 159.714-220.286 58.857-220.286-58.857-159.714-159.714-58.857-220.286 58.857-220.286 159.714-159.714 220.286-58.857 220.286 58.857 159.714 159.714 58.857 220.286z']},AlertWarning:{viewBox:'0 0 1024 1024',paths:['M585.143 785.714v-108.571c0-10.286-8-18.857-18.286-18.857h-109.714c-10.286 0-18.286 8.571-18.286 18.857v108.571c0 10.286 8 18.857 18.286 18.857h109.714c10.286 0 18.286-8.571 18.286-18.857zM584 572l10.286-262.286c0-3.429-1.714-8-5.714-10.857-3.429-2.857-8.571-6.286-13.714-6.286h-125.714c-5.143 0-10.286 3.429-13.714 6.286-4 2.857-5.714 8.571-5.714 12l9.714 261.143c0 7.429 8.571 13.143 19.429 13.143h105.714c10.286 0 18.857-5.714 19.429-13.143zM576 38.286l438.857 804.571c12.571 22.286 12 49.714-1.143 72s-37.143 36-62.857 36h-877.714c-25.714 0-49.714-13.714-62.857-36s-13.714-49.714-1.143-72l438.857-804.571c12.571-23.429 37.143-38.286 64-38.286s51.429 14.857 64 38.286z']},Search:{viewBox:'0 0 1024 1024',paths:['M658.286 475.429c0-141.143-114.857-256-256-256s-256 114.857-256 256 114.857 256 256 256 256-114.857 256-256zM950.857 950.857c0 40-33.143 73.143-73.143 73.143-19.429 0-38.286-8-51.429-21.714l-196-195.429c-66.857 46.286-146.857 70.857-228 70.857-222.286 0-402.286-180-402.286-402.286s180-402.286 402.286-402.286 402.286 180 402.286 402.286c0 81.143-24.571 161.143-70.857 228l196 196c13.143 13.143 21.143 32 21.143 51.429z']},UserIconEmpty:{viewBox:'0 0 1024 1024',paths:['M686.286 448c80.571 23.429 191.429 102.857 191.429 362.857 0 117.714-87.429 213.143-194.857 213.143h-488c-107.429 0-194.857-95.429-194.857-213.143 0-260 110.857-339.429 191.429-362.857-28.571-45.143-45.143-98.286-45.143-155.429 0-161.143 131.429-292.571 292.571-292.571s292.571 131.429 292.571 292.571c0 57.143-16.571 110.286-45.143 155.429zM438.857 73.143c-121.143 0-219.429 98.286-219.429 219.429s98.286 219.429 219.429 219.429 219.429-98.286 219.429-219.429-98.286-219.429-219.429-219.429zM682.857 950.857c66.857 0 121.714-62.286 121.714-140 0-180-60.571-292.571-173.714-298.286-51.429 45.143-118.286 72.571-192 72.571s-140.571-27.429-192-72.571c-113.143 5.714-173.714 118.286-173.714 298.286 0 77.714 54.857 140 121.714 140h488z']},PlusSign:{viewBox:'0 0 1024 1024',paths:['M804.571 420.571v109.714q0 22.857-16 38.857t-38.857 16h-237.714v237.714q0 22.857-16 38.857t-38.857 16h-109.714q-22.857 0-38.857-16t-16-38.857v-237.714h-237.714q-22.857 0-38.857-16t-16-38.857v-109.714q0-22.857 16-38.857t38.857-16h237.714v-237.714q0-22.857 16-38.857t38.857-16h109.714q22.857 0 38.857 16t16 38.857v237.714h237.714q22.857 0 38.857 16t16 38.857z']}}})(R=h.Icons||(h.Icons={}))},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R;(function(A){A.ICOMOON={CheckBoxEmpty:{viewBox:'0 0 1024 1024',paths:['M896 0h-768c-70.4 0-128 57.6-128 128v768c0 70.4 57.6 128 128 128h768c70.4 0 128-57.6 128-128v-768c0-70.4-57.6-128-128-128zM896 896h-768v-768h768v768z']},CheckBoxChecked:{viewBox:'0 0 1024 1024',paths:['M896 0h-768c-70.4 0-128 57.6-128 128v768c0 70.4 57.6 128 128 128h768c70.4 0 128-57.6 128-128v-768c0-70.4-57.6-128-128-128zM448 794.51l-237.254-237.256 90.51-90.508 146.744 146.744 306.746-306.746 90.508 90.51-397.254 397.256z']},CheckCircleFilled:{viewBox:'0 0 1024 1024',paths:['M733.714 419.429q0-16-10.286-26.286l-52-51.429q-10.857-10.857-25.714-10.857t-25.714 10.857l-233.143 232.571-129.143-129.143q-10.857-10.857-25.714-10.857t-25.714 10.857l-52 51.429q-10.286 10.286-10.286 26.286 0 15.429 10.286 25.714l206.857 206.857q10.857 10.857 25.714 10.857 15.429 0 26.286-10.857l310.286-310.286q10.286-10.286 10.286-25.714zM877.714 512q0 119.429-58.857 220.286t-159.714 159.714-220.286 58.857-220.286-58.857-159.714-159.714-58.857-220.286 58.857-220.286 159.714-159.714 220.286-58.857 220.286 58.857 159.714 159.714 58.857 220.286z']},CrossCircleFilled:{viewBox:'0 0 1024 1024',paths:['M656.571 641.143q0-14.857-10.857-25.714l-103.429-103.429 103.429-103.429q10.857-10.857 10.857-25.714 0-15.429-10.857-26.286l-51.429-51.429q-10.857-10.857-26.286-10.857-14.857 0-25.714 10.857l-103.429 103.429-103.429-103.429q-10.857-10.857-25.714-10.857-15.429 0-26.286 10.857l-51.429 51.429q-10.857 10.857-10.857 26.286 0 14.857 10.857 25.714l103.429 103.429-103.429 103.429q-10.857 10.857-10.857 25.714 0 15.429 10.857 26.286l51.429 51.429q10.857 10.857 26.286 10.857 14.857 0 25.714-10.857l103.429-103.429 103.429 103.429q10.857 10.857 25.714 10.857 15.429 0 26.286-10.857l51.429-51.429q10.857-10.857 10.857-26.286zM877.714 512q0 119.429-58.857 220.286t-159.714 159.714-220.286 58.857-220.286-58.857-159.714-159.714-58.857-220.286 58.857-220.286 159.714-159.714 220.286-58.857 220.286 58.857 159.714 159.714 58.857 220.286z']},ExclamationCircleFilled:{viewBox:'0 0 1024 1024',paths:['M512 0c-282.77 0-512 229.23-512 512s229.23 512 512 512 512-229.23 512-512-229.23-512-512-512zM576 832h-128v-128h128v128zM576 576h-128v-384h128v384z']},QuestionCircleFilled:{viewBox:'0 0 1024 1024',paths:['M512 0c-282.77 0-512 229.23-512 512s229.23 512 512 512 512-229.23 512-512-229.23-512-512-512zM512 832c-35.346 0-64-28.654-64-64s28.654-64 64-64 64 28.654 64 64-28.654 64-64 64zM617.538 504.158c-39.112 24.57-57.538 38.114-57.538 56.092v32c0 26.51-21.49 48-48 48s-48-21.49-48-48v-32c0-33.618 12.964-63.854 38.532-89.87 18.864-19.194 41.778-33.59 63.936-47.512 45.564-28.624 65.532-43.978 65.532-70.868 0-29.252-16.88-48.788-31.042-60.026-22.734-18.040-54.328-27.974-88.958-27.974-52.534 0-99.792 35.082-114.924 85.314-7.648 25.382-34.422 39.758-59.806 32.114-25.382-7.648-39.76-34.422-32.114-59.806 13.112-43.52 40.398-82.63 76.832-110.124 37.71-28.456 82.668-43.498 130.012-43.498 56.208 0 108.994 17.322 148.63 48.776 43.444 34.474 67.37 82.496 67.37 135.224 0 82.76-63.846 122.872-110.462 152.158z']},Mute:{viewBox:'0 0 16 16',paths:['M0 5h3l5-5v16l-5-5h-3v-6zM14.326 8l1.674 1.674v1.326h-1.326l-1.674-1.674-1.674 1.674h-1.326v-1.326l1.674-1.674-1.674-1.674v-1.326h1.326l1.674 1.674 1.674-1.674h1.326v1.326l-1.674 1.674z']}},A.FONTAWESOME={BellFilled:{viewBox:'0 0 1024 1024',paths:['M521.143 969.143c0-5.143-4-9.143-9.143-9.143-45.143 0-82.286-37.143-82.286-82.286 0-5.143-4-9.143-9.143-9.143s-9.143 4-9.143 9.143c0 55.429 45.143 100.571 100.571 100.571 5.143 0 9.143-4 9.143-9.143zM987.429 804.571c0 40-33.143 73.143-73.143 73.143h-256c0 80.571-65.714 146.286-146.286 146.286s-146.286-65.714-146.286-146.286h-256c-40 0-73.143-33.143-73.143-73.143 84.571-71.429 182.857-199.429 182.857-475.429 0-109.714 90.857-229.714 242.286-252-2.857-6.857-4.571-14.286-4.571-22.286 0-30.286 24.571-54.857 54.857-54.857s54.857 24.571 54.857 54.857c0 8-1.714 15.429-4.571 22.286 151.429 22.286 242.286 142.286 242.286 252 0 276 98.286 404 182.857 475.429z']},CircleNotch:{viewBox:'0 0 1024 1024',paths:['M1005.714 512c0 272.571-221.143 493.714-493.714 493.714s-493.714-221.143-493.714-493.714c0-248 182.857-453.143 420.571-488.571v130.286c-166.857 33.714-292.571 181.714-292.571 358.286 0 201.714 164 365.714 365.714 365.714s365.714-164 365.714-365.714c0-176.571-125.714-324.571-292.571-358.286v-130.286c237.714 35.429 420.571 240.571 420.571 488.571z']},CheckBoxEmpty:{viewBox:'0 0 1024 1024',paths:['M640 146.286h-475.429q-37.714 0-64.571 26.857t-26.857 64.571v475.429q0 37.714 26.857 64.571t64.571 26.857h475.429q37.714 0 64.571-26.857t26.857-64.571v-475.429q0-37.714-26.857-64.571t-64.571-26.857zM804.571 237.714v475.429q0 68-48.286 116.286t-116.286 48.286h-475.429q-68 0-116.286-48.286t-48.286-116.286v-475.429q0-68 48.286-116.286t116.286-48.286h475.429q68 0 116.286 48.286t48.286 116.286z']},CheckBoxChecked:{viewBox:'0 0 1024 1024',paths:['M391.429 742.286l350.857-350.857q10.857-10.857 10.857-25.714t-10.857-25.714l-58.286-58.286q-10.857-10.857-25.714-10.857t-25.714 10.857l-266.857 266.857-120.571-120.571q-10.857-10.857-25.714-10.857t-25.714 10.857l-58.286 58.286q-10.857 10.857-10.857 25.714t10.857 25.714l204.571 204.571q10.857 10.857 25.714 10.857t25.714-10.857zM877.714 237.714v548.571q0 68-48.286 116.286t-116.286 48.286h-548.571q-68 0-116.286-48.286t-48.286-116.286v-548.571q0-68 48.286-116.286t116.286-48.286h548.571q68 0 116.286 48.286t48.286 116.286z']},CheckCircleFilled:{viewBox:'0 0 1024 1024',paths:['M733.714 419.429q0-16-10.286-26.286l-52-51.429q-10.857-10.857-25.714-10.857t-25.714 10.857l-233.143 232.571-129.143-129.143q-10.857-10.857-25.714-10.857t-25.714 10.857l-52 51.429q-10.286 10.286-10.286 26.286 0 15.429 10.286 25.714l206.857 206.857q10.857 10.857 25.714 10.857 15.429 0 26.286-10.857l310.286-310.286q10.286-10.286 10.286-25.714zM877.714 512q0 119.429-58.857 220.286t-159.714 159.714-220.286 58.857-220.286-58.857-159.714-159.714-58.857-220.286 58.857-220.286 159.714-159.714 220.286-58.857 220.286 58.857 159.714 159.714 58.857 220.286z']},ChevonLeft:{viewBox:'0 0 1024 1024',paths:['M669.143 172l-303.429 303.429 303.429 303.429q10.857 10.857 10.857 25.714t-10.857 25.714l-94.857 94.857q-10.857 10.857-25.714 10.857t-25.714-10.857l-424-424q-10.857-10.857-10.857-25.714t10.857-25.714l424-424q10.857-10.857 25.714-10.857t25.714 10.857l94.857 94.857q10.857 10.857 10.857 25.714t-10.857 25.714z']},Cross:{viewBox:'0 0 1024 1024',paths:['M741.714 755.429q0 22.857-16 38.857l-77.714 77.714q-16 16-38.857 16t-38.857-16l-168-168-168 168q-16 16-38.857 16t-38.857-16l-77.714-77.714q-16-16-16-38.857t16-38.857l168-168-168-168q-16-16-16-38.857t16-38.857l77.714-77.714q16-16 38.857-16t38.857 16l168 168 168-168q16-16 38.857-16t38.857 16l77.714 77.714q16 16 16 38.857t-16 38.857l-168 168 168 168q16 16 16 38.857z']},CrossCircleFilled:{viewBox:'0 0 1024 1024',paths:['M656.571 641.143q0-14.857-10.857-25.714l-103.429-103.429 103.429-103.429q10.857-10.857 10.857-25.714 0-15.429-10.857-26.286l-51.429-51.429q-10.857-10.857-26.286-10.857-14.857 0-25.714 10.857l-103.429 103.429-103.429-103.429q-10.857-10.857-25.714-10.857-15.429 0-26.286 10.857l-51.429 51.429q-10.857 10.857-10.857 26.286 0 14.857 10.857 25.714l103.429 103.429-103.429 103.429q-10.857 10.857-10.857 25.714 0 15.429 10.857 26.286l51.429 51.429q10.857 10.857 26.286 10.857 14.857 0 25.714-10.857l103.429-103.429 103.429 103.429q10.857 10.857 25.714 10.857 15.429 0 26.286-10.857l51.429-51.429q10.857-10.857 10.857-26.286zM877.714 512q0 119.429-58.857 220.286t-159.714 159.714-220.286 58.857-220.286-58.857-159.714-159.714-58.857-220.286 58.857-220.286 159.714-159.714 220.286-58.857 220.286 58.857 159.714 159.714 58.857 220.286z']},Ellipsis:{viewBox:'0 0 1024 1024',paths:['M219.429 420.571v109.714c0 30.286-24.571 54.857-54.857 54.857h-109.714c-30.286 0-54.857-24.571-54.857-54.857v-109.714c0-30.286 24.571-54.857 54.857-54.857h109.714c30.286 0 54.857 24.571 54.857 54.857zM512 420.571v109.714c0 30.286-24.571 54.857-54.857 54.857h-109.714c-30.286 0-54.857-24.571-54.857-54.857v-109.714c0-30.286 24.571-54.857 54.857-54.857h109.714c30.286 0 54.857 24.571 54.857 54.857zM804.571 420.571v109.714c0 30.286-24.571 54.857-54.857 54.857h-109.714c-30.286 0-54.857-24.571-54.857-54.857v-109.714c0-30.286 24.571-54.857 54.857-54.857h109.714c30.286 0 54.857 24.571 54.857 54.857z']},ExclamationCircleFilled:{viewBox:'0 0 1024 1024',paths:['M438.857 73.143q119.429 0 220.286 58.857t159.714 159.714 58.857 220.286-58.857 220.286-159.714 159.714-220.286 58.857-220.286-58.857-159.714-159.714-58.857-220.286 58.857-220.286 159.714-159.714 220.286-58.857zM512 785.714v-108.571q0-8-5.143-13.429t-12.571-5.429h-109.714q-7.429 0-13.143 5.714t-5.714 13.143v108.571q0 7.429 5.714 13.143t13.143 5.714h109.714q7.429 0 12.571-5.429t5.143-13.429zM510.857 589.143l10.286-354.857q0-6.857-5.714-10.286-5.714-4.571-13.714-4.571h-125.714q-8 0-13.714 4.571-5.714 3.429-5.714 10.286l9.714 354.857q0 5.714 5.714 10t13.714 4.286h105.714q8 0 13.429-4.286t6-10z']},InfoCircleFilled:{viewBox:'0 0 1024 1024',paths:['M585.143 786.286v-91.429c0-10.286-8-18.286-18.286-18.286h-54.857v-292.571c0-10.286-8-18.286-18.286-18.286h-182.857c-10.286 0-18.286 8-18.286 18.286v91.429c0 10.286 8 18.286 18.286 18.286h54.857v182.857h-54.857c-10.286 0-18.286 8-18.286 18.286v91.429c0 10.286 8 18.286 18.286 18.286h256c10.286 0 18.286-8 18.286-18.286zM512 274.286v-91.429c0-10.286-8-18.286-18.286-18.286h-109.714c-10.286 0-18.286 8-18.286 18.286v91.429c0 10.286 8 18.286 18.286 18.286h109.714c10.286 0 18.286-8 18.286-18.286zM877.714 512c0 242.286-196.571 438.857-438.857 438.857s-438.857-196.571-438.857-438.857 196.571-438.857 438.857-438.857 438.857 196.571 438.857 438.857z']},Paperclip:{viewBox:'0 0 1024 1024',paths:['M802.286 791.429q0 66.857-45.143 112t-112 45.143q-77.143 0-134.286-57.143l-444-443.429q-64.571-65.714-64.571-154.857 0-90.857 62.857-154.286t153.714-63.429q90.286 0 156 64.571l345.714 346.286q5.714 5.714 5.714 12.571 0 9.143-17.429 26.571t-26.571 17.429q-7.429 0-13.143-5.714l-346.286-346.857q-45.143-44-103.429-44-60.571 0-102.286 42.857t-41.714 103.429q0 60 43.429 103.429l443.429 444q36 36 82.857 36 36.571 0 60.571-24t24-60.571q0-46.857-36-82.857l-332-332q-14.857-13.714-34.286-13.714-16.571 0-27.429 10.857t-10.857 27.429q0 18.286 14.286 33.714l234.286 234.286q5.714 5.714 5.714 12.571 0 9.143-17.714 26.857t-26.857 17.714q-6.857 0-12.571-5.714l-234.286-234.286q-36-34.857-36-85.143 0-46.857 32.571-79.429t79.429-32.571q50.286 0 85.143 36l332 332q57.143 56 57.143 134.286z']},PlusSign:{viewBox:'0 0 1024 1024',paths:['M804.571 420.571v109.714q0 22.857-16 38.857t-38.857 16h-237.714v237.714q0 22.857-16 38.857t-38.857 16h-109.714q-22.857 0-38.857-16t-16-38.857v-237.714h-237.714q-22.857 0-38.857-16t-16-38.857v-109.714q0-22.857 16-38.857t38.857-16h237.714v-237.714q0-22.857 16-38.857t38.857-16h109.714q22.857 0 38.857 16t16 38.857v237.714h237.714q22.857 0 38.857 16t16 38.857z']},QuestionCircleFilled:{viewBox:'0 0 1024 1024',paths:['M512 786.286v-109.714q0-8-5.143-13.143t-13.143-5.143h-109.714q-8 0-13.143 5.143t-5.143 13.143v109.714q0 8 5.143 13.143t13.143 5.143h109.714q8 0 13.143-5.143t5.143-13.143zM658.286 402.286q0-50.286-31.714-93.143t-79.143-66.286-97.143-23.429q-138.857 0-212 121.714-8.571 13.714 4.571 24l75.429 57.143q4 3.429 10.857 3.429 9.143 0 14.286-6.857 30.286-38.857 49.143-52.571 19.429-13.714 49.143-13.714 27.429 0 48.857 14.857t21.429 33.714q0 21.714-11.429 34.857t-38.857 25.714q-36 16-66 49.429t-30 71.714v20.571q0 8 5.143 13.143t13.143 5.143h109.714q8 0 13.143-5.143t5.143-13.143q0-10.857 12.286-28.286t31.143-28.286q18.286-10.286 28-16.286t26.286-20 25.429-27.429 16-34.571 7.143-46.286zM877.714 512q0 119.429-58.857 220.286t-159.714 159.714-220.286 58.857-220.286-58.857-159.714-159.714-58.857-220.286 58.857-220.286 159.714-159.714 220.286-58.857 220.286 58.857 159.714 159.714 58.857 220.286z']},TrashCan:{viewBox:'0 0 1024 1024',paths:['M292.571 420.571v329.143q0 8-5.143 13.143t-13.143 5.143h-36.571q-8 0-13.143-5.143t-5.143-13.143v-329.143q0-8 5.143-13.143t13.143-5.143h36.571q8 0 13.143 5.143t5.143 13.143zM438.857 420.571v329.143q0 8-5.143 13.143t-13.143 5.143h-36.571q-8 0-13.143-5.143t-5.143-13.143v-329.143q0-8 5.143-13.143t13.143-5.143h36.571q8 0 13.143 5.143t5.143 13.143zM585.143 420.571v329.143q0 8-5.143 13.143t-13.143 5.143h-36.571q-8 0-13.143-5.143t-5.143-13.143v-329.143q0-8 5.143-13.143t13.143-5.143h36.571q8 0 13.143 5.143t5.143 13.143zM658.286 834.286v-541.714h-512v541.714q0 12.571 4 23.143t8.286 15.429 6 4.857h475.429q1.714 0 6-4.857t8.286-15.429 4-23.143zM274.286 219.429h256l-27.429-66.857q-4-5.143-9.714-6.286h-181.143q-5.714 1.143-9.714 6.286zM804.571 237.714v36.571q0 8-5.143 13.143t-13.143 5.143h-54.857v541.714q0 47.429-26.857 82t-64.571 34.571h-475.429q-37.714 0-64.571-33.429t-26.857-80.857v-544h-54.857q-8 0-13.143-5.143t-5.143-13.143v-36.571q0-8 5.143-13.143t13.143-5.143h176.571l40-95.429q8.571-21.143 30.857-36t45.143-14.857h182.857q22.857 0 45.143 14.857t30.857 36l40 95.429h176.571q8 0 13.143 5.143t5.143 13.143z']},WarningTriangle:{viewBox:'0 0 1024 1024',paths:['M585.143 785.714v-108.571c0-10.286-8-18.857-18.286-18.857h-109.714c-10.286 0-18.286 8.571-18.286 18.857v108.571c0 10.286 8 18.857 18.286 18.857h109.714c10.286 0 18.286-8.571 18.286-18.857zM584 572l10.286-262.286c0-3.429-1.714-8-5.714-10.857-3.429-2.857-8.571-6.286-13.714-6.286h-125.714c-5.143 0-10.286 3.429-13.714 6.286-4 2.857-5.714 8.571-5.714 12l9.714 261.143c0 7.429 8.571 13.143 19.429 13.143h105.714c10.286 0 18.857-5.714 19.429-13.143zM576 38.286l438.857 804.571c12.571 22.286 12 49.714-1.143 72s-37.143 36-62.857 36h-877.714c-25.714 0-49.714-13.714-62.857-36s-13.714-49.714-1.143-72l438.857-804.571c12.571-23.429 37.143-38.286 64-38.286s51.429 14.857 64 38.286z']},Wifi:{viewBox:'0 0 1024 1024',paths:['M585.143 870.286c-14.857 0-94.857-80-94.857-95.429 0-28 73.143-43.429 94.857-43.429s94.857 15.429 94.857 43.429c0 15.429-80 95.429-94.857 95.429zM739.429 715.429c-8 0-70.286-57.143-154.286-57.143-84.571 0-145.714 57.143-154.286 57.143-13.714 0-96.571-82.286-96.571-96 0-5.143 2.286-9.714 5.714-13.143 61.143-60.571 160.571-94.286 245.143-94.286s184 33.714 245.143 94.286c3.429 3.429 5.714 8 5.714 13.143 0 13.714-82.857 96-96.571 96zM895.429 560c-4.571 0-9.714-2.286-13.143-4.571-94.286-73.143-173.714-116.571-297.143-116.571-172.571 0-304 121.143-310.286 121.143-13.143 0-95.429-82.286-95.429-96 0-4.571 2.286-9.143 5.714-12.571 102.286-102.286 256.571-158.857 400-158.857s297.714 56.571 400 158.857c3.429 3.429 5.714 8 5.714 12.571 0 13.714-82.286 96-95.429 96zM1050.286 405.143c-4.571 0-9.143-2.286-12.571-5.143-132-116-274.286-180.571-452.571-180.571s-320.571 64.571-452.571 180.571c-3.429 2.857-8 5.143-12.571 5.143-13.143 0-96-82.286-96-96 0-5.143 2.286-9.714 5.714-13.143 144.571-143.429 353.143-222.857 555.429-222.857s410.857 79.429 555.429 222.857c3.429 3.429 5.714 8 5.714 13.143 0 13.714-82.857 96-96 96z']}}})(R=h.Icons||(h.Icons={}))},function(l,h,E){'use strict';var R=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,J=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,G;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(G=B[W])&&(J=(3>Y?G(J):3<Y?G(H,z,J):G(H,z))||J);return 3<Y&&J&&Object.defineProperty(H,z,J),J},A=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,J){function G(K){try{X($.next(K))}catch(Q){J(Q)}}function W(K){try{X($['throw'](K))}catch(Q){J(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(G,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(2),I=E(3),D=E(1);class L extends N.CTLayerComponent{constructor(){super(...arguments),this._rippleTimeout=null}static get is(){return'ct-button'}initialize(){return A(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}@keyframes ripple{100%{transform:scale(2);opacity:0}}:host{display:block;position:relative}:host button{position:relative;background:transparent;color:#000;padding:0.55em 1em;border:1px solid transparent;border-radius:0;font-size:inherit;font-weight:inherit;outline:none;cursor:pointer;overflow:hidden;width:100%;height:100%}:host button .button-content{pointer-events:none;display:inline-flex;justify-content:center;align-items:center}:host button .button-content .icon{display:block}:host button .button-content .label{display:block}:host button .button-content .icon+.label{margin:0 0 0 5px}:host button .ripple{background-color:white;border-radius:50%;opacity:0.4;transform:scale(0.01);position:absolute;pointer-events:none}:host button .ripple.animate{animation:ripple 0.6s ease-out}:host button.primary{background-color:var(--button-primary-bg, #15233B);border:var(--button-primary-border, #15233B);color:var(--button-primary-text, #fff)}:host button.primary .ripple{background-color:var(--button-primary-ripple, #fff)}:host button.secondary{background-color:var(--button-secondary-bg, rgba(0,0,0,0));border:var(--button-secondary-border, none);color:var(--button-secondary-text, #fff)}:host button.secondary .ripple{background-color:var(--button-secondary-ripple, #000)}:host button.tertiary{background-color:var(--button-tertiary-bg, #ddd);border:var(--button-tertiary-border, 1px solid #ddd);color:var(--button-tertiary-text, #000)}:host button.tertiary .ripple{background-color:var(--button-tertiary-ripple, #fff)}:host button.invert-primary{background:var(--button-invert-primary-bg, #fff);border:var(--button-invert-primary-border, 1px solid #fff);color:var(--button-invert-primary-text, #2c394e)}:host button.invert-primary .ripple{background-color:var(--button-invert-primary-ripple, #2c394e)}:host button.invert-secondary{background:var(--button-invert-secondary-bg, rgba(0,0,0,0));border:var(--button-invert-secondary-border, 1px solid #fff);color:var(--button-invert-secondary-text, #fff)}:host button.invert-secondary .ripple{background-color:var(--button-invert-secondary-ripple, #fff)}:host button.selected{background-color:var(--button-selected-bg, #000);border:var(--button-selected-border, #000);color:var(--button-selected-text, #fff)}:host button.selected .ripple{background-color:var(--button-selected-ripple, #fff)}:host button.cancel{background-color:var(--button-cancel-bg, rgba(0,0,0,0));border:var(--button-cancel-border, 1px solid #fff);color:var(--button-cancel-text, #000)}:host button.cancel .ripple{background-color:var(--button-cancel-ripple, #000)}:host button.warning{background-color:var(--button-warning-bg, #fdb851);border:var(--button-warning-border, #fdb851);color:var(--button-warning-text, #fff)}:host button.warning .ripple{background-color:var(--button-warning-ripple, #fff)}:host button.dangerous{background-color:var(--button-dangerous-bg, #f24647);border:var(--button-dangerous-border, #f24647);color:var(--button-dangerous-text, #fff)}:host button.dangerous .ripple{background-color:var(--button-dangerous-ripple, #fff)}:host button.headerBack{background-color:#231f20;border:none;color:white}:host button.headerBack .ripple{background-color:white}:host button.transparent{background-color:transparent;border:none}:host button.large{padding:1.25em 1em}:host button[disabled]{opacity:0.5;cursor:not-allowed}
        `}generateComponentMarkup(){const B=[this.type];this.selected&&B.push('selected'),this.large&&B.push('large'),this.isWaiting&&B.push('waiting'),this.isTransparent&&B.push('transparent');const H=M.Icons.COMMON.LoadingSpinner,z=I.buildStyles(!this.textColor?{}:{color:this.textColor});return window.__CTRender('button',{class:B.join(' '),style:z,disabled:this.isWaiting||this.disabled,onClick:($)=>this.handleButtonClick($)},window.__CTRender('div',{class:'button-content'},I.renderIf(!this.isWaiting&&!!this.icon,window.__CTRender(D.CTIcon,{icon:this.icon,color:this.iconColor,width:this.iconWidth,height:this.iconHeight,class:'icon'})),I.renderIfElse(this.isWaiting,window.__CTRender(D.CTIcon,{icon:H,color:this.iconColor,width:this.iconHeight,height:this.iconHeight,spin:!0,class:'icon'}),window.__CTRender('div',{class:'label'},window.__CTRender('slot',null)))))}handleButtonClick(B){if(!this.disabled&&(this._ripple(B.offsetX,B.offsetY,B.target),'function'==typeof this.onClick)){const H=Object.create(B,{target:{value:this}});this.onClick(H)}}_ripple(B,H,z){const $=z.querySelector('.ripple');$&&$.remove();const Y=z.clientWidth,J=z.clientHeight,G=Math.max(Y,J);clearTimeout(this._rippleTimeout),this._rippleTimeout=setTimeout(()=>{const K=document.createElement('span');K.classList.add('ripple'),K.style.width=`${G}px`,K.style.height=`${G}px`,K.style.left=`${B-G/2}px`,K.style.top=`${H-G/2}px`,z.insertBefore(K,z.firstChild),K.addEventListener('animationend',()=>{K.remove()}),K.classList.add('animate')},0)}}R([N.prop({type:String,attribute:!0,default:'primary'})],L.prototype,'type',void 0),R([N.prop({type:N.Stroolean,attribute:!0,default:!1})],L.prototype,'selected',void 0),R([N.prop({type:N.Stroolean,attribute:!0,default:!1})],L.prototype,'disabled',void 0),R([N.prop({type:N.Stroolean,attribute:!0,default:!1})],L.prototype,'large',void 0),R([N.prop({type:String,attribute:!0})],L.prototype,'textColor',void 0),R([N.prop({type:String,attribute:!0,default:'auto'})],L.prototype,'iconColor',void 0),R([N.prop({type:String,attribute:!0,default:'18px'})],L.prototype,'iconWidth',void 0),R([N.prop({type:String,attribute:!0,default:'18px'})],L.prototype,'iconHeight',void 0),R([N.prop({type:Function,attribute:!0})],L.prototype,'onClick',void 0),R([N.prop({type:N.Stroolean,attribute:!0,default:!1})],L.prototype,'isTransparent',void 0),R([N.prop({type:Object,attribute:!1,default:null})],L.prototype,'icon',void 0),R([N.prop({type:N.Stroolean,attribute:!1,default:!1})],L.prototype,'isWaiting',void 0),h.CTButton=L,L.register()},function(l){var E=function(){return this}();try{E=E||Function('return this')()||(1,eval)('this')}catch(R){'object'==typeof window&&(E=window)}l.exports=E},function(l,h,E){'use strict';var R=this&&this.__decorate||function(J,G,W,X){var K=arguments.length,Q=3>K?G:null===X?X=Object.getOwnPropertyDescriptor(G,W):X,Z;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)Q=Reflect.decorate(J,G,W,X);else for(var ee=J.length-1;0<=ee;ee--)(Z=J[ee])&&(Q=(3>K?Z(Q):3<K?Z(G,W,Q):Z(G,W))||Q);return 3<K&&Q&&Object.defineProperty(G,W,Q),Q},A=this&&this.__awaiter||function(J,G,W,X){return new(W||(W=Promise))(function(K,Q){function Z(ne){try{te(X.next(ne))}catch(ae){Q(ae)}}function ee(ne){try{te(X['throw'](ne))}catch(ae){Q(ae)}}function te(ne){ne.done?K(ne.value):new W(function(ae){ae(ne.value)}).then(Z,ee)}te((X=X.apply(J,G||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(7),I=E(6),D=E(4),L=E(3),B=E(8),H=E(1),z=E(94),$=E(2);class Y extends N.CTLayerComponent{constructor(){super(...arguments),this.atTop=!0,this.listPagination=20,this.paginationStart=1,this.paginationDebounce=0}static get is(){return'ct-pg-list'}initialize(){return A(this,void 0,void 0,function*(){this.clearData(),this.contacts={},this.onRenderComplete(()=>A(this,void 0,void 0,function*(){const J=yield this.layer.getAllContacts();J.forEach((G)=>{this.contacts[G.jid]=G}),this.getPages()}),!0)})}setupListeners(){this.addListener(I.PagerEvents.PageUpdate,()=>{this.getPages()}),this.addListener(I.PagerEvents._Request_Component_Clear_Data,()=>{this.clearData()}),this.addListener(I.PagerEvents.NewPageReceived,()=>{this.getPages(),this.forceRedraw()})}clearData(){this.pages=D.deepCloneArray([]),this.paginationStart=1,this.paginationDebounce=0}getPages(){this.pages=[...this.layer.getPages(this.listPagination*this.paginationStart)]}rowClick(J){return A(this,void 0,void 0,function*(){yield this.layer.setSelectedPage(J),this.emitEvent(I.PagerEvents._Request_ReadPageDetail,new I.ReadPageDetailEventArgs(J))})}deletePage(J){return A(this,void 0,void 0,function*(){const G=$.DefaultAlerts.AlertYesNoQuestion('Delete?','Are you sure you wish to delete this page?',1,{yes:()=>A(this,void 0,void 0,function*(){yield this.layer.deletePage(J),this.emitEvent(I.PagerEvents.PageUpdate)})});this.emitEvent(I.PagerEvents._Request_RaiseAlert,G)})}onScroll(J){const G=J.currentTarget,W=G.scrollHeight,X=G.scrollTop,K=G.clientHeight,Q=K/10;if(W-X<K+Q){const Z=new Date().getTime();return void((Z-this.paginationDebounce||!1)&&(this.paginationDebounce=Z,++this.paginationStart,this.getPages()))}return X<Q?(this.paginationStart=1,void this.getPages()):void 0}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:flex;flex-direction:column;width:100%;height:100%}:host div.container{height:100%;display:flex;flex-direction:column}:host div.container div.header{display:none}:host div.container div.header h3{color:white;margin:auto auto}@media screen and (max-width: 640px){:host div.container div.header{display:flex;flex:0 0 40px}}:host div.container p{text-align:center}:host div.container div.scrollable{overflow-y:scroll;-webkit-overflow-scrolling:touch;flex:1 1}@media screen and (max-width: 640px){:host div.container div.scrollable .innerHeader{display:none}}:host div.container div.scrollable div.row{position:relative;height:auto}:host div.container div.scrollable div.row div.background{position:absolute;right:0;top:0;z-index:0;height:100%;width:30vw;display:flex;background-color:#f2f2f2}:host div.container div.scrollable div.row div.background ct-button{margin:auto;height:100%;width:100%}:host div.container div.scrollable div.row div.foreground{display:flex;justify-content:space-between;padding:15px 0;cursor:pointer;position:relative;z-index:100}:host div.container div.scrollable div.row div.foreground.header{padding:5px 0;font-size:12px}:host div.container div.scrollable div.row div.foreground div{padding:0 10px;display:flex;justify-content:flex-start;overflow:hidden;white-space:nowrap}:host div.container div.scrollable div.row div.foreground span{overflow:hidden;text-overflow:ellipsis;margin:auto 0}:host div.container div.scrollable div.row div.foreground div.type{flex-basis:10%;order:1;flex:1 1 250px}:host div.container div.scrollable div.row div.foreground div.type span.color{margin:auto 5px auto 0;height:8px;width:8px;border-radius:50%}:host div.container div.scrollable div.row div.foreground div.from{flex-basis:10%;order:2}:host div.container div.scrollable div.row div.foreground div.to{flex-basis:20%;order:3}:host div.container div.scrollable div.row div.foreground div.subject{flex-basis:20%;order:4}:host div.container div.scrollable div.row div.foreground div.message{flex-basis:25%;order:5}:host div.container div.scrollable div.row div.foreground div.attachment{flex-basis:10%;order:6;flex:1 1 100px}:host div.container div.scrollable div.row div.foreground div.attachment ct-pg-icon{margin:auto}:host div.container div.scrollable div.row div.foreground div.raised{flex-basis:5%;order:6;flex:1 1 150px}@media screen and (max-width: 640px){:host div.container div.scrollable div.row div.foreground{flex-wrap:wrap}:host div.container div.scrollable div.row div.foreground div.type{order:1;flex-basis:50%}:host div.container div.scrollable div.row div.foreground div.attachment{order:2;flex:0 1 auto}:host div.container div.scrollable div.row div.foreground div.raised{order:3;flex:0 1 auto}:host div.container div.scrollable div.row div.foreground div.from{order:4;flex-basis:100%}:host div.container div.scrollable div.row div.foreground div.to{order:5;flex-basis:100%;display:none}:host div.container div.scrollable div.row div.foreground div.subject{order:6;flex-basis:100%}:host div.container div.scrollable div.row div.foreground div.message{order:7;flex-basis:100%}:host div.container div.scrollable div.row div.foreground div.from span,:host div.container div.scrollable div.row div.foreground div.subject span,:host div.container div.scrollable div.row div.foreground div.message span{padding-left:14px}}:host .container{background-color:var(--default-bg-color, #fff);color:var(--default-font-color, #333536)}:host .container .header{background-color:var(--secondary-color, #2c394e)}:host .container .scrollable{background-color:var(--default-bg-color, #fff)}:host .container .scrollable .row{border-bottom:1px solid var(--default-border-color, #d9d9d9)}:host .container .scrollable .row div.foreground{background-color:var(--default-bg-color, #fff)}:host .container .scrollable .row div.foreground.header{background-color:var(--default-border-color, #d9d9d9);color:var(--default-font-color-light, #9d9d9d)}:host .container .scrollable .row div.foreground div{color:var(--default-font-color, #333536)}@media screen and (max-width: 640px){:host .container .scrollable .row div.foreground div.from,:host .container .scrollable .row div.foreground div.message{color:var(--default-font-color-light, #9d9d9d)}}
        `}generateComponentMarkup(){return window.__CTRender('div',{className:'container'},L.renderIf(0<this.pages.length,window.__CTRender('div',{className:'header'},window.__CTRender('h3',null,'Recent Messages'))),window.__CTRender('div',{class:'scrollable',onscroll:(J)=>this.onScroll(J)},L.renderIf(0<this.pages.length,window.__CTRender('div',{className:'row innerHeader'},window.__CTRender('div',{className:'foreground header'},window.__CTRender('div',{className:'type'},window.__CTRender('span',null,'Type')),window.__CTRender('div',{className:'from'},window.__CTRender('span',null,'From')),window.__CTRender('div',{className:'to'},window.__CTRender('span',null,'To')),window.__CTRender('div',{className:'subject'},window.__CTRender('span',null,'Subject')),window.__CTRender('div',{className:'message'},window.__CTRender('span',null,'Message')),window.__CTRender('div',{className:'attachment'},window.__CTRender('span',null,'Attachment')),window.__CTRender('div',{className:'raised'},window.__CTRender('span',null,'Raised'))))),this._renderPageList(),this._renderLoading()))}_renderPageList(){return 0===this.pages.length?[window.__CTRender('p',null,'There are no pages to display.')]:this.pages.map((J)=>window.__CTRender('div',{className:'row'},window.__CTRender('div',{style:L.buildStyles({transform:'translateX(0vw)'}),className:'foreground',onClick:()=>this.rowClick(J),ontouchmove:this.enableTouchFeatures?(G)=>z.slideToReveal(G,30):null,ontouchend:this.enableTouchFeatures?(G)=>z.slideToRevealEnd(G,30):null},window.__CTRender('div',{className:'type'},window.__CTRender('span',{className:'color',style:L.buildStyles({backgroundColor:J.pageType.colorCode})}),window.__CTRender('span',null,J.pageType.name)),window.__CTRender('div',{className:'from'},window.__CTRender('span',null,B.getNameFromContact(this.contacts[J.sender]))),window.__CTRender('div',{className:'to'},window.__CTRender('span',null,J.individuals.map((G)=>B.getNameFromContact(G)).join(', '))),window.__CTRender('div',{className:'subject'},window.__CTRender('span',null,J.subject)),window.__CTRender('div',{className:'message'},window.__CTRender('span',null,J.message)),window.__CTRender('div',{className:'attachment'},L.renderIf(J.attachments,window.__CTRender(H.CTIcon,{width:'20',height:'20',icon:M.Icons.FONTAWESOME.Paperclip}))),window.__CTRender('div',{className:'raised'},window.__CTRender('span',null,D.formatDateForTimeOrDate(new Date(J.openedDate),!1,this.layer.config.xmpp.showSecondsOnTimestamps)))),window.__CTRender('div',{className:'background'},window.__CTRender(H.CTButton,{icon:M.Icons.FONTAWESOME.TrashCan,iconColor:'red',type:'cancel',iconWidth:'30',iconHeight:'30',onClick:()=>this.deletePage(J)}))))}_renderLoading(){return this.renderLoading?window.__CTRender('div',{className:'row'},window.__CTRender('p',null,'Loading...')):null}}R([N.prop({type:Array,attribute:!1,default:[]})],Y.prototype,'pages',void 0),R([N.prop({type:N.Stroolean,attribute:!0,default:!1})],Y.prototype,'enableTouchFeatures',void 0),R([N.prop({type:Boolean,attribute:!1,default:!1})],Y.prototype,'renderLoading',void 0),h.CTPGList=Y,Y.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function($,Y,J,G){var W=arguments.length,X=3>W?Y:null===G?G=Object.getOwnPropertyDescriptor(Y,J):G,K;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)X=Reflect.decorate($,Y,J,G);else for(var Q=$.length-1;0<=Q;Q--)(K=$[Q])&&(X=(3>W?K(X):3<W?K(Y,J,X):K(Y,J))||X);return 3<W&&X&&Object.defineProperty(Y,J,X),X},A=this&&this.__awaiter||function($,Y,J,G){return new(J||(J=Promise))(function(W,X){function K(ee){try{Z(G.next(ee))}catch(te){X(te)}}function Q(ee){try{Z(G['throw'](ee))}catch(te){X(te)}}function Z(ee){ee.done?W(ee.value):new J(function(te){te(ee.value)}).then(K,Q)}Z((G=G.apply($,Y||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(2),I=E(7),D=E(6),L=E(4),B=E(3),H=E(1);class z extends N.CTLayerComponent{constructor(){super(...arguments),this.buttonsDisabled=!1,this.hide=!1,this.viewImage=($)=>{const Y=$.target;L.displayImage(Y.src).catch(()=>this.emitEvent(D.PagerEvents._Request_RaiseAlert,M.DefaultAlerts.AlertErrorWithOkayButton('Error','Could not open image file.',1,{})))},this.mute=()=>{this.layer.mute(),this.muted=!0}}static get is(){return'ct-pg-new-page-modal'}initialize(){return A(this,void 0,void 0,function*(){this.connectivityStatus=this.layer.getConnectionStatus()})}setupListeners(){this.addListener(D.PagerEvents.NewPageReceived,()=>A(this,void 0,void 0,function*(){this.muted=!1,yield this.checkForPendingPages()})),this.addListener(D.PagerEvents.PageUpdate,()=>A(this,void 0,void 0,function*(){yield this.checkForPendingPages()})),this.addListener(D.PagerEvents._Request_CheckForPendingPages,()=>A(this,void 0,void 0,function*(){yield this.checkForPendingPages()})),this.addListener(D.PagerEvents.ConnectionStatusChange,($)=>{this.connectivityStatus=$.status,$.status===M.ConnectionStatus.Connected?(this.buttonsDisabled=!1,this.hide=!1,this.muted=!1):this.buttonsDisabled=!0,$.status===M.ConnectionStatus.Disconnected&&'Replaced by new connection'===$.disconnectStatus.getReason()&&(this.replyMenuShowing=!1,this.hide=!0,this.layer.clearAllData(),this.checkForPendingPages())},{dontSuppress:!0})}checkForPendingPages(){return A(this,void 0,void 0,function*(){const $=yield this.layer.getPendingPages();if(!this.replyMenuShowing){if(0<$.length){this.page=Object.assign({},$[0]);const Y=new Date().getTime(),J=this.page.openedDate;if(Y-J>this.layer.config.xmpp.maxMessageAlertAge)return yield this.layer.removePendingPage(this.page._id),void(yield this.checkForPendingPages());this.page.attachments&&!this.page.attachmentsLoaded&&(yield this.layer.downloadAttachmentsByMessageId(this.page.messageId))}else this.page=null;this.showing=!this.hide&&this.page,this.responseSendPending=!1,this.showing&&setTimeout(()=>{this.emitEvent(D.PagerEvents.RequestMakeAudioNotification,this.page),this.layer.purgeOldPages(!0)},0)}})}respondToPage($){return A(this,void 0,void 0,function*(){this.responseSendPending=!0,this.replyMenuShowing=!1;const Y={ts:new Date().getTime(),content:$,type:I.ContactResponseType.Response};if(yield this.layer.addContactResponseToPage(this.page,Y),this.emitEvent(D.PagerEvents.PageResponse,new D.SendPageResponseEventArgs(this.page._id,Y,this.page.sender)),0<this.page.audio.length){const J=this.shadowRoot.querySelector('audio');J&&(J.pause(),J.parentElement.removeChild(J))}})}toggleReplyMenu(){this.replyMenuShowing=!this.replyMenuShowing}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{background-color:var(--primary-color, #000);height:100%;width:100%;display:flex;flex-direction:column;transform:translateY(100%);will-change:transform;transition:transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);visibility:hidden;position:fixed;top:0;z-index:1;overflow:hidden}:host .container{height:100%;width:100%;display:flex;flex-direction:column}:host .container .title{display:flex;width:100%;flex:0 0 var(--header-height, 60px);padding:0 20px;justify-content:space-between;align-items:center}:host .container .content{flex:1 1;display:flex;flex-direction:column;margin:5px;min-height:0}:host .container .content .panel{flex:1 1;display:flex;flex-direction:column;overflow:auto}:host .container .content .panel .data{display:flex;flex-direction:row;margin:0 0 1px 0;padding:10px 20px;flex:0 0 var(--header-height, 60px)}:host .container .content .panel .data ct-icon.bell-filled{margin-left:10px}:host .container .content .panel .data ct-online-indicator{margin:auto 0}:host .container .content .panel .data.subject{display:flex;flex:0 1 auto;overflow:hidden}:host .container .content .panel .data.subject span{margin:auto 0}:host .container .content .panel .data.severity .name{margin:auto 0;font-size:18px}:host .container .content .panel .data.severity .time{margin:auto 0 auto auto;font-weight:300;font-size:18px}:host .container .content .panel .data.severity .mute{margin:3px 0 3px auto;font-weight:300}@media screen and (max-width: 640px){:host .container .content .panel .data.severity .name{font-size:16px}:host .container .content .panel .data.severity .time{font-size:12px}}:host .container .content .panel .message{padding:10px 20px;overflow:auto;-webkit-overflow-scrolling:touch;flex:1 1}:host .container .content .panel .message span{display:block;margin-bottom:15px}:host .container .content .panel .message ct-icon{margin:auto}:host .container .content .panel .message ct-audio,:host .container .content .panel .message ct-img{width:100%;margin:10px 0}:host .container .content .panel .message p{font-size:18px;line-height:28px}:host .container .content .panel .replyContainer{margin:auto 0 20px;padding:20px 20px 0}:host .container .replyMenuContainer{background-color:rgba(0,0,0,0.6);position:absolute;top:0;width:inherit;height:inherit;opacity:0;visibility:hidden}:host .container .replyMenuContainer.showing{visibility:visible;transition:opacity 0.25s ease-in;opacity:1}:host .container .replyMenuContainer .panel{position:absolute;bottom:0;width:100vw;display:flex;flex-direction:column;padding:25px 20px}:host .container .replyMenuContainer .panel ct-button{margin-top:15px}:host .container .replyMenuContainer .panel ct-button:first-child{margin-top:0}:host([showing]){visibility:visible;transform:translateY(0)}:host .container{background-color:var(--default-bg-color);color:var(--default-font-color)}:host .container .content{background-color:var(--default-bg-color)}:host .container .replyMenuContainer .panel{background-color:var(--default-bg-color)}
        `}generateComponentMarkup(){return this.page?window.__CTRender('div',{className:'container'},window.__CTRender('div',{className:'content'},window.__CTRender('div',{className:'panel'},this._renderHeader(),this._renderSubject(),window.__CTRender('div',{className:'message'},this._renderPageMessage(),this._renderAttachments()),window.__CTRender('div',{className:'replyContainer'},this._renderReplyButton()))),this._buildReplyMenu()):null}_renderHeader(){return this.connectivityStatus===M.ConnectionStatus.Connected?window.__CTRender('div',{className:'data severity',style:B.buildStyles({backgroundColor:this.page.pageType.colorCode,color:B.decideTextColorFromBgColor(this.page.pageType.colorCode)})},window.__CTRender('div',{className:'name'},this.page.pageType.name),window.__CTRender('div',{className:'time'},L.formatDate(this.page.openedDate,'HH:mm')),window.__CTRender(H.CTIcon,{width:'18',class:'bell-filled',height:'18',icon:I.Icons.FONTAWESOME.BellFilled})):window.__CTRender('div',{className:'data severity',style:B.buildStyles({backgroundColor:'#9b9b9b',color:B.decideTextColorFromBgColor('#9b9b9b')})},window.__CTRender(H.CTOnlineIndicator,null),B.renderIf(!this.muted,window.__CTRender(H.CTButton,{className:'mute',type:'invert-secondary',onClick:()=>this.mute()},window.__CTRender(H.CTIcon,{width:'16',height:'16',color:'#FFF',icon:I.Icons.ICOMOON.Mute}))))}_renderSubject(){return this.page.subject?window.__CTRender('div',{className:'data subject',style:B.buildStyles({backgroundColor:this.page.pageType.colorCode,color:B.decideTextColorFromBgColor(this.page.pageType.colorCode)})},window.__CTRender('span',null,this.page.subject)):null}_renderPageMessage(){if(this.page.messageSplit&&this.page.messageSplit.length){const $=[];return this.page.messageSplit.forEach((Y)=>{$.push(window.__CTRender('p',null,Y))}),window.__CTRender('div',null,$)}return window.__CTRender('span',null,this.page.message)}_renderAttachments(){if(!this.page.attachments)return null;let $=window.__CTRender('div',null,window.__CTRender(H.CTIcon,{width:20,height:20,icon:I.Icons.FONTAWESOME.CircleNotch,spin:!0}));return this.page.attachmentsLoaded&&($=window.__CTRender('div',null,B.renderIf(0<this.page.audio.length,window.__CTRender(H.CTAudio,{src:this.page.audio[0]})),B.renderIf(0<this.page.image.length,window.__CTRender(H.CTImg,{onclick:this.viewImage,src:this.page.image[0]})))),$}_renderReplyButton(){if(this.page.replyTemplate&&1===this.page.replyTemplate.buttons.length){const $=this.page.replyTemplate.buttons[0];return window.__CTRender(H.CTButton,{disabled:this.buttonsDisabled,type:'primary',onClick:()=>this.respondToPage($.value),isWaiting:this.responseSendPending,large:!0},$.label)}return this.page.replyTemplate&&1<this.page.replyTemplate.buttons.length?window.__CTRender(H.CTButton,{disabled:this.buttonsDisabled,type:'primary',onClick:()=>this.toggleReplyMenu(),isWaiting:this.responseSendPending,large:!0},'Reply'):window.__CTRender(H.CTButton,{disabled:this.buttonsDisabled,type:'primary',onClick:()=>this.respondToPage('Acknowledge'),isWaiting:this.responseSendPending,large:!0},'Acknowledge')}_buildReplyMenu(){const $=[];return this.page.replyTemplate&&this.page.replyTemplate.buttons?(this.page.replyTemplate.buttons.map((Y)=>{$.push(window.__CTRender(H.CTButton,{disabled:this.buttonsDisabled,type:'primary',onClick:()=>this.respondToPage(Y.value),large:!0},Y.label))}),$.push(window.__CTRender(H.CTButton,{type:'cancel',onClick:()=>this.toggleReplyMenu(),large:!0},'Cancel')),window.__CTRender('div',{className:`replyMenuContainer ${this.replyMenuShowing?'showing':''}`},window.__CTRender('div',{className:'panel'},$))):null}}R([N.prop({type:Boolean,attribute:!0,default:!1})],z.prototype,'showing',void 0),R([N.prop({type:Object,attribute:!1,default:null})],z.prototype,'page',void 0),R([N.prop({type:Boolean,attribute:!1,default:!1})],z.prototype,'replyMenuShowing',void 0),R([N.prop({type:String,attribute:!1})],z.prototype,'connectivityStatus',void 0),R([N.prop({type:Boolean,attribute:!1,default:!1})],z.prototype,'responseSendPending',void 0),R([N.prop({type:Boolean,attribute:!1,default:!1})],z.prototype,'muted',void 0),h.CTPGNewPageModal=z,z.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(W,X,K,Q){var Z=arguments.length,ee=3>Z?X:null===Q?Q=Object.getOwnPropertyDescriptor(X,K):Q,te;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)ee=Reflect.decorate(W,X,K,Q);else for(var ne=W.length-1;0<=ne;ne--)(te=W[ne])&&(ee=(3>Z?te(ee):3<Z?te(X,K,ee):te(X,K))||ee);return 3<Z&&ee&&Object.defineProperty(X,K,ee),ee},A=this&&this.__awaiter||function(W,X,K,Q){return new(K||(K=Promise))(function(Z,ee){function te(se){try{ae(Q.next(se))}catch(oe){ee(oe)}}function ne(se){try{ae(Q['throw'](se))}catch(oe){ee(oe)}}function ae(se){se.done?Z(se.value):new K(function(oe){oe(se.value)}).then(te,ne)}ae((Q=Q.apply(W,X||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(2),I=E(7),D=E(6),L=E(19),B=E(4),H=E(20),z=E(1),$=E(3),Y=E(8);var J;(function(W){W[W.Audio='audio']='Audio',W[W.Image='image']='Image'})(J||(J={}));class G extends N.CTLayerComponent{constructor(){super(...arguments),this.closeContacts=()=>A(this,void 0,void 0,function*(){this.selectedContacts=B.deepCloneArray((yield this.layer.getSelectedContacts())),this.newPage.to=this.selectedContacts,this.contactSelectionShowing=!1,this.validate()}),this.addAttachments=(W,X)=>{if(X){this.newPage[W]=[];for(const K of X)this.newPage[W].push(K);this.forceRedraw()}},this.deleteAttachment=(W)=>{this.newPage[W]=[],this.forceRedraw()},this.sendPage=()=>{const W=new Date().getTime();this.layer.syncTimeWithServer().then(()=>{const X=this.layer.getSyncedTimestamp(W),K=Y.createNewPage(this.newPage,this.layer.getCurrentUserJid(),this.layer.config.pageTypes[this.newPage.type],this.layer.config.replyTemplates[this.newPage.replyTemplate],X);this.isWaiting=!0,this.emitEvent(D.PagerEvents._Request_SendNewPage,new D.SendNewPageEventArgs(K))}).catch(()=>{this.emitEvent(D.PagerEvents._Request_RaiseAlert,M.DefaultAlerts.AlertErrorWithOkayButton('Send Error','Could not sync timestamp with server.',1,{}))})}}static get is(){return'ct-pg-raise-new-page'}initialize(){return A(this,void 0,void 0,function*(){this.types=this.layer.config.pageTypes.map((W,X)=>{return{key:X,value:W.name}}),this.replyTemplates=this.layer.config.replyTemplates.map((W,X)=>{return{key:X,value:W.name}}),this.connectivityStatus=this.layer.getConnectionStatus()})}setupListeners(){this.addListener(D.PagerEvents.ConnectionStatusChange,(W)=>{this.connectivityStatus=W.status,this.validate()}),this.addListener(D.PagerEvents._Request_CloseSendNewPageModal,()=>{this.close()}),this.addListener(D.PagerEvents.SendingPageError,()=>this.isWaiting=!1)}createNewPage(){this.newPage=Object.assign({},{to:[],type:0,replyTemplate:0,subject:'',message:'',image:[],audio:[]}),this.isValidated=!1,this.showing=!0}close(){this.isWaiting=!1,this.showing=!1,this.selectedContacts=[],this.layer.setSelectedContacts(this.selectedContacts)}showContactSelection(){this.contactSelectionShowing=!0}removeContact(W){this.selectedContacts=B.deepCloneArray(this.selectedContacts.filter((X)=>X.name!==W)),this.newPage.to=this.selectedContacts,this.validate()}selectionAction(W,X){this.newPage[W]=parseInt(X)}validate(){let W=!0;this.newPage?(255<this.newPage.subject.length&&(W=!1),(!this.newPage.message||4e3<this.newPage.message.length)&&(W=!1),0===this.newPage.to.length&&(W=!1),this.connectivityStatus!==M.ConnectionStatus.Connected&&(W=!1)):W=!1,this.isValidated=W}textFieldInput(W){switch(W.key){case'subject':this.newPage.subject=W.value;break;case'message':this.newPage.message=W.value;}this.validate()}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{width:100%;height:100%;display:flex;background-color:rgba(0,0,0,0.6);opacity:0;visibility:hidden;position:fixed;z-index:1}:host .container{display:flex;flex-direction:column;margin:auto;width:95vw;height:95vh;min-width:500px;transform:translateY(100%);will-change:transform;transition:transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);visibility:hidden}:host .container .title{display:flex;justify-content:space-between;align-items:center;flex:0 0 var(--header-height, 60px);padding:10px 0 10px 20px}:host .container .title h2{position:absolute;left:50%;top:0;transform:translateX(-50%)}@media screen and (max-width: 640px){:host .container .title h2{display:none}}:host .container .content{overflow:auto;-webkit-overflow-scrolling:touch}:host .container .content div.columns{display:flex;flex-direction:row;flex-wrap:wrap;overflow:auto;margin-bottom:10vh}:host .container .content div.columns h4{font-weight:400;margin:8px 0 0}:host .container .content div.columns .to{display:flex;flex:1 1 100%;justify-content:flex-start;width:100%;padding:20px;min-height:87px}:host .container .content div.columns .to h4{margin:auto 20px auto 0}:host .container .content div.columns .to div.contactContainer{display:flex;flex-grow:1;margin-right:20px;flex-wrap:wrap}:host .container .content div.columns .to div.contactContainer span.contactPill{display:flex;justify-content:space-between;font-size:12px;height:30px;padding:0 15px;border-radius:20px;margin:0 5px 5px 0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;cursor:pointer}:host .container .content div.columns .to div.contactContainer span.contactPill span,:host .container .content div.columns .to div.contactContainer span.contactPill ct-icon{margin:auto 10px auto 0;height:15px}:host .container .content div.columns .to div.contactContainer span.contactPill ct-icon{margin:auto 0}:host .container .content div.columns .to ct-button{margin:auto 0 auto auto}:host .container .content div.columns .types{display:flex;flex-wrap:wrap;flex:1 1 100%}:host .container .content div.columns .types div{flex:1 1 100%;padding:10px 20px;display:flex;overflow:auto}:host .container .content div.columns .types div h4{margin:auto;flex-basis:30%}:host .container .content div.columns .types div ct-selection-list{margin:auto 0 auto 2%}:host .container .content div.columns .subject{display:flex;flex-basis:100%;flex-direction:column;padding:0 20px}:host .container .content div.columns .subject ct-textbox{margin-bottom:5px}:host .container .content div.columns .pageContent{display:flex;flex-basis:100%;flex-direction:column;padding:0 20px;overflow:auto}:host .container .content div.columns .pageContent ct-textbox{margin-bottom:5px}:host .container .content div.columns .attachments{display:flex;flex:1 1 100%;min-height:150px;justify-content:flex-start;align-items:flex-start}@media screen and (max-width: 640px){:host .container .content div.columns .attachments{flex-wrap:wrap}}:host .container .content div.columns .attachments div{flex:0 0 50%;padding:10px 20px;display:flex;overflow:auto;flex-direction:column}@media screen and (max-width: 640px){:host .container .content div.columns .attachments div{flex-basis:100%}}:host .container .content div.columns .attachments div h4{flex:1 1 100%}:host .container .content div.columns .attachments div ct-pg-file-picker{margin:20px 0 10px;flex:0 1 15%;width:15%}:host .container .content div.columns .attachments div ct-button{margin:0 0 10px;flex:0 1 15%;width:15%}:host .container .content div.columns .attachments div img{flex:0 0 auto}:host .container .buttonsContainer{display:flex;height:10vh;width:100%;justify-content:flex-end;position:fixed;bottom:0}:host .container .buttonsContainer div{margin:auto 20px}:host .container .buttonsContainer div ct-button{flex:1 1 40%}@media screen and (max-width: 640px){:host .container{width:100%;height:100%;min-width:100%;max-height:100%}}:host([showing]){visibility:visible;transition:opacity 0.25s ease-in;opacity:1}:host([showing]) div.container{visibility:visible;transform:translateY(0)}:host .container{background-color:var(--default-bg-color);color:var(--default-font-color)}:host .container .title{background-color:var(--primary-color, #15233B);color:var(--primary-font-color, #fff)}:host .container .content{background-color:var(--default-bg-color)}:host .container .content div.columns .to,:host .container .content div.columns .types,:host .container .content div.columns .subject,:host .container .content div.columns .pageContent{border-bottom:1px solid var(--default-border-color)}:host .container .content div.columns .to div.contactContainer span.contactPill{background-color:var(--primary-color);color:var(--primary-font-color)}:host .container .content div.columns .to div.contactContainer span.contactPill:hover{background-color:#223961}:host .container .content div.columns .attachments:first-child{border-right:1px solid var(--default-border-color)}:host .container .buttonsContainer{background-color:var(--default-bg-color-dark)}
        `}generateComponentMarkup(){return this.newPage?window.__CTRender('div',{className:`container`},window.__CTRender('div',{className:'title'},this._renderTitle()),window.__CTRender('div',{class:'content'},this._renderBody()),window.__CTRender('div',{className:'buttonsContainer'},window.__CTRender('div',null,window.__CTRender(z.CTButton,{type:'primary',disabled:!this.isValidated,isWaiting:this.isWaiting,onClick:this.sendPage},'Send Message'))),window.__CTRender(L.CTPGContactSelection,{showing:this.contactSelectionShowing,closeFunction:this.closeContacts,selectedContacts:this.newPage.to})):null}_renderTitle(){return[window.__CTRender(z.CTOnlineIndicator,null),window.__CTRender('h2',null,'New Message'),window.__CTRender(z.CTButton,{type:'transparent',icon:I.Icons.FONTAWESOME.Cross,iconColor:'#fff',onClick:()=>this.close()})]}_renderBody(){return window.__CTRender('div',{className:'columns'},window.__CTRender('div',{className:'to'},window.__CTRender('h4',null,'To:'),window.__CTRender('div',{className:'contactContainer'},this.newPage.to.map((W)=>window.__CTRender('span',{className:'contactPill',onClick:()=>this.removeContact(W.name)},window.__CTRender('span',null,W.displayName),window.__CTRender(z.CTIcon,{width:'13',height:'13',icon:I.Icons.FONTAWESOME.Cross})))),window.__CTRender(z.CTButton,{type:'primary',icon:I.Icons.FONTAWESOME.Ellipsis,iconColor:'#fff',onClick:()=>this.showContactSelection()})),window.__CTRender('div',{className:'types'},window.__CTRender('div',null,window.__CTRender('h4',null,'Type:'),window.__CTRender(z.CTSelectionList,{options:this.types,selected:this.newPage.type,forceDropdown:!0,onSelect:(W)=>this.selectionAction('type',W)})),window.__CTRender('div',null,window.__CTRender('h4',null,'Reply Template:'),window.__CTRender(z.CTSelectionList,{options:this.replyTemplates,selected:this.newPage.replyTemplate,forceDropdown:!0,onSelect:(W)=>this.selectionAction('replyTemplate',W)}))),window.__CTRender('div',{className:'subject'},window.__CTRender('h4',null,'Subject:'),window.__CTRender(z.CTTextbox,{fullBorder:!0,type:'text',name:'subject',defaultValue:this.newPage.subject,showClearOptions:!1,callback:(W)=>this.textFieldInput(W),max:255})),window.__CTRender('div',{className:'pageContent'},window.__CTRender('h4',null,'Message:'),window.__CTRender(z.CTTextbox,{fullBorder:!0,type:'textarea',name:'message',defaultValue:this.newPage.message,showClearOptions:!1,callback:(W)=>this.textFieldInput(W),max:4e3})),window.__CTRender('div',{className:'attachments'},this.layer.audioAttachmentsEnabled()?window.__CTRender('div',null,window.__CTRender('h4',null,'Audio Message:'),window.__CTRender(H.CTPGFilePicker,{fileTypes:['audio/mpeg','audio/mp3'],callback:(W)=>this.addAttachments(J.Audio,W)}),$.renderIf(0<this.newPage.audio.length,window.__CTRender(z.CTButton,{type:'primary',icon:I.Icons.FONTAWESOME.TrashCan,iconColor:'#fff',onClick:()=>this.deleteAttachment(J.Audio)})),this._renderAudioAttachments()):null,this.layer.photoAttachmentsEnabled()?window.__CTRender('div',null,window.__CTRender('h4',null,'Image Attachment:'),window.__CTRender(H.CTPGFilePicker,{callback:(W)=>this.addAttachments(J.Image,W)}),$.renderIf(0<this.newPage.image.length,window.__CTRender(z.CTButton,{type:'primary',icon:I.Icons.FONTAWESOME.TrashCan,iconColor:'#fff',onClick:()=>this.deleteAttachment(J.Image)})),this._renderImageAttachments()):null))}_renderAudioAttachments(){return this.newPage.audio.map((W)=>window.__CTRender('audio',{controls:!0},window.__CTRender('source',{src:W,type:'audio/mpeg'})))}_renderImageAttachments(){return this.newPage.image.map((W)=>window.__CTRender('img',{src:W,width:150}))}}R([N.prop({type:Boolean,attribute:!0,default:!1})],G.prototype,'showing',void 0),R([N.prop({type:Boolean,attribute:!0,default:!1})],G.prototype,'isValidated',void 0),R([N.prop({type:Boolean,attribute:!0,default:!1})],G.prototype,'isWaiting',void 0),R([N.prop({type:Boolean,attribute:!1,default:!1})],G.prototype,'contactSelectionShowing',void 0),R([N.prop({type:Array,attribute:!1,default:[]})],G.prototype,'selectedContacts',void 0),R([N.prop({type:String,attribute:!1})],G.prototype,'connectivityStatus',void 0),h.CTPGRaiseNewPage=G,G.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function($,Y,J,G){var W=arguments.length,X=3>W?Y:null===G?G=Object.getOwnPropertyDescriptor(Y,J):G,K;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)X=Reflect.decorate($,Y,J,G);else for(var Q=$.length-1;0<=Q;Q--)(K=$[Q])&&(X=(3>W?K(X):3<W?K(Y,J,X):K(Y,J))||X);return 3<W&&X&&Object.defineProperty(Y,J,X),X},A=this&&this.__awaiter||function($,Y,J,G){return new(J||(J=Promise))(function(W,X){function K(ee){try{Z(G.next(ee))}catch(te){X(te)}}function Q(ee){try{Z(G['throw'](ee))}catch(te){X(te)}}function Z(ee){ee.done?W(ee.value):new J(function(te){te(ee.value)}).then(K,Q)}Z((G=G.apply($,Y||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(2),I=E(7),D=E(6),L=E(4),B=E(3),H=E(1);class z extends N.CTLayerComponent{constructor(){super(...arguments),this.close=()=>{if(this.showing=!1,0<this.page.audio.length){const $=this.shadowRoot.querySelector('ct-audio');$.pause()}this.page=null},this.viewImage=($)=>{const Y=$.target;L.displayImage(Y.src).catch(()=>this.emitEvent(D.PagerEvents._Request_RaiseAlert,M.DefaultAlerts.AlertErrorWithOkayButton('Error','Could not open image file.',1,{})))},this._attachmentLoadedCount=0}static get is(){return'ct-pg-read-only-client'}initialize(){return A(this,void 0,void 0,function*(){this._attachmentLoaded=this._attachmentLoaded.bind(this)})}setupListeners(){this.addListener(D.PagerEvents._Request_OpenClientReadModal,($)=>A(this,void 0,void 0,function*(){this.page=Object.assign({},$),this.response=this.page.individuals.find((Y)=>Y.id===this.layer.getCurrentUserJid()).responses.find((Y)=>Y.type===I.ContactResponseType.Response),this.showing=!0,this.page.attachments&&!this.page.attachmentsLoaded&&(this.attachmentsLoading=!0,yield this.layer.downloadAttachmentsByMessageId(this.page.messageId))})),this.addListener(D.PagerEvents.PageUpdate,($)=>{this.page&&$&&($._id!==this.page._id||(this.page=$,this.forceRedraw()))})}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{background-color:var(--primary-color, #000);height:100%;width:100%;display:flex;flex-direction:column;transform:translateX(100%);will-change:transform;transition:transform 0.15s linear;visibility:hidden;position:fixed;top:0;z-index:1;overflow:hidden}:host .container{height:100%;width:100%;display:flex;flex-direction:column}:host .container .content{flex:1 1;display:flex;flex-direction:column;background-color:white;min-height:0}:host .container .content .panel{flex:1 1;display:flex;flex-direction:column;overflow:auto}:host .container .content .panel .data{display:flex;flex-direction:row;font-size:18px;padding:10px 20px;flex:0 0 var(--header-height, 60px)}:host .container .content .panel .data.title{background-color:#231f20;color:white;flex:0 0 var(--header-height, 60px);justify-content:flex-start;padding:10px 20px 10px 0}:host .container .content .panel .data.title .name{margin:auto 0}:host .container .content .panel .data.title .colorCircle{width:20px;height:20px;border-radius:50%;margin:auto auto auto 10px}:host .container .content .panel .data.title .time{margin:auto 0 auto auto}@media screen and (max-width: 640px){:host .container .content .panel .data.title .name{font-size:16px}:host .container .content .panel .data.title .time{font-size:12px}}:host .container .content .panel .data.subject{display:flex;flex:0 1 auto;overflow-x:hidden}:host .container .content .panel .data.subject span{margin:auto 0}:host .container .content .panel .data ct-icon{margin-right:10px}:host .container .content .panel .data.severity .time{margin:0 0 0 auto;font-weight:300}:host .container .content .panel .message{padding:10px 20px;overflow:auto;-webkit-overflow-scrolling:touch;flex:1 1}:host .container .content .panel .message span{display:block;margin-bottom:15px}:host .container .content .panel .message ct-audio,:host .container .content .panel .message ct-img{width:100%;margin:10px 0}:host .container .content .panel .message p{font-size:18px;line-height:28px}:host .container .content .panel .replyContainer{margin:auto 0 40px;padding:0 20px}:host .container .content .panel .replyContainer h4{text-align:center;font-weight:400;color:#646566;margin-bottom:10px}:host .container .content .panel .replyContainer .replyPill{display:flex;justify-content:center;background-color:#646566;color:white;padding:5px 20px;border-radius:20px;font-weight:300;max-width:70%;margin:0 auto;text-align:center}:host([showing]){visibility:visible;transform:translateX(0)}:host .container{background-color:var(--default-bg-color);color:var(--default-font-color)}:host .container .content .panel{background-color:var(--default-bg-color)}:host .container .content .panel .data.subject{background-color:var(--default-bg-color);border-bottom:1px solid var(--default-border-color)}:host .container .content .panel .message{background-color:var(--default-bg-color)}:host .container .content .panel .replyContainer{background-color:var(--default-bg-color)}:host .container .content .panel .replyContainer h4{color:var(--default-font-color-light)}
        `}generateComponentMarkup(){return this.page?window.__CTRender('div',{className:'container'},window.__CTRender('div',{className:'content'},window.__CTRender('div',{className:'panel'},window.__CTRender('div',{className:'data title'},window.__CTRender(H.CTButton,{type:'transparent',icon:I.Icons.FONTAWESOME.ChevonLeft,iconColor:'#fff',onClick:this.close}),window.__CTRender('div',{className:'name'},this.page.pageType.name),window.__CTRender('div',{className:'colorCircle',style:B.buildStyles({backgroundColor:this.page.pageType.colorCode})}),window.__CTRender('div',{className:'time'},L.formatDateForTimeOrDate(this.page.openedDate,!1,this.layer.config.xmpp.showSecondsOnTimestamps))),this.page.subject?window.__CTRender('div',{className:'data subject'},window.__CTRender('span',null,this.page.subject)):null,window.__CTRender('div',{className:'message'},this._renderPageMessage(),this._renderAttachments()),this._generateResponseDisplay()))):null}_renderPageMessage(){if(this.page.messageSplit&&this.page.messageSplit.length){const $=[];return this.page.messageSplit.forEach((Y)=>{$.push(window.__CTRender('p',null,Y))}),window.__CTRender('div',null,$)}return window.__CTRender('span',null,this.page.message)}_attachmentLoaded(){++this._attachmentLoadedCount>=this.page.audio.length+this.page.image.length&&(this.attachmentsLoading=!1)}_renderAttachments(){return window.__CTRender('div',null,B.renderIf(this.attachmentsLoading,window.__CTRender(H.CTIcon,{width:20,height:20,icon:I.Icons.FONTAWESOME.CircleNotch,spin:!0})),B.renderIf(0<this.page.audio.length&&this.page.attachmentsLoaded,window.__CTRender(H.CTAudio,{src:this.page.audio[0],onLoad:this._attachmentLoaded})),B.renderIf(0<this.page.image.length&&this.page.attachmentsLoaded,window.__CTRender(H.CTImg,{onclick:this.viewImage,src:this.page.image[0],onLoad:this._attachmentLoaded})))}_generateResponseDisplay(){return this.response?window.__CTRender('div',{className:'replyContainer'},window.__CTRender('h4',null,'You replied at ',L.formatDateForTimeOrDate(this.response.ts,!1,this.layer.config.xmpp.showSecondsOnTimestamps)),window.__CTRender('div',{className:'replyPill'},window.__CTRender('span',null,this.response.content))):null}}R([N.prop({type:Boolean,attribute:!0,default:!1})],z.prototype,'showing',void 0),R([N.prop({type:Object,attribute:!1,default:null})],z.prototype,'page',void 0),R([N.prop({type:Boolean,attribute:!1,default:!1})],z.prototype,'attachmentsLoading',void 0),h.CTPGReadOnlyClient=z,z.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(Y,J,G,W){var X=arguments.length,K=3>X?J:null===W?W=Object.getOwnPropertyDescriptor(J,G):W,Q;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)K=Reflect.decorate(Y,J,G,W);else for(var Z=Y.length-1;0<=Z;Z--)(Q=Y[Z])&&(K=(3>X?Q(K):3<X?Q(J,G,K):Q(J,G))||K);return 3<X&&K&&Object.defineProperty(J,G,K),K},A=this&&this.__awaiter||function(Y,J,G,W){return new(G||(G=Promise))(function(X,K){function Q(te){try{ee(W.next(te))}catch(ne){K(ne)}}function Z(te){try{ee(W['throw'](te))}catch(ne){K(ne)}}function ee(te){te.done?X(te.value):new G(function(ne){ne(te.value)}).then(Q,Z)}ee((W=W.apply(Y,J||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(7),I=E(6),D=E(4),L=E(3),B=E(8),H=E(1);var z;(function(Y){Y[Y.Replies='replies']='Replies',Y[Y.MessageContent='message-content']='MessageContent'})(z||(z={}));class $ extends N.CTLayerComponent{constructor(){super(...arguments),this.viewOption=z.Replies}static get is(){return'ct-pg-read-only-page'}initialize(){return A(this,void 0,void 0,function*(){})}setupListeners(){this.addListener(I.PagerEvents._Request_OpenBroadcasterReadModal,(Y)=>{this.page=Object.assign({},Y),!1===this.page.attachmentsLoaded&&this.layer.downloadAttachmentsByMessageId(this.page.messageId),this.viewOption=z.Replies,this.showing=!0}),this.addListener(I.PagerEvents.PageUpdate,(Y)=>A(this,void 0,void 0,function*(){this.page&&Y&&(Y._id!==this.page._id||(this.page=Y,this.forceRedraw()))}))}close(){this.showing=!1}viewOptionBtnClick(Y){this.viewOption=Y}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{width:100%;height:100%;display:flex;background-color:rgba(0,0,0,0.6);opacity:0;visibility:hidden;position:fixed;z-index:1}:host .container{display:flex;flex-direction:column;margin:auto;width:95vw;height:95vh;min-width:500px;will-change:transform;transition:transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);visibility:hidden}:host .container .title{display:flex;justify-content:space-between;align-items:center;flex:0 0 var(--header-height, 60px);padding:10px 0 10px 20px}@media screen and (max-width: 640px){:host .container .title{justify-content:flex-end}:host .container .title ct-online-indicator{display:none}:host .container .title .tabs{width:80%}}:host .container .title .tabs{position:absolute;display:flex;align-items:flex-end;top:0;left:50%;height:59px;transform:translateX(-50%)}:host .container .title h2{position:absolute;left:50%;top:0;transform:translateX(-50%)}:host .container .content{overflow:auto;display:flex;flex-direction:column;padding:20px}:host .container .content div.row{display:flex;justify-content:flex-start;padding:15px 0;min-height:62px;overflow:auto}:host .container .content div.row.header{min-height:30px;padding:5px 0;font-size:12px}:host .container .content div.row div{margin:auto 0}:host .container .content div.row .user{flex-basis:40%}:host .container .content div.row .received{flex-basis:20%}:host .container .content div.row .reply{flex-basis:35%}:host .container .content div.row .label{flex-basis:15%}@media screen and (max-width: 640px){:host .container .content div.row .label{flex-basis:50%}}:host .container .content div.row .value{flex-basis:70%}@media screen and (max-width: 640px){:host .container .content div.row .value{flex-basis:50%}}:host .container .content div.row .responsePill{display:flex;justify-content:space-between;padding:5px 20px;border-radius:20px;font-weight:300}@media screen and (max-width: 640px){:host .container{width:100%;height:100%;min-width:100%;max-height:100%}}:host([showing]){visibility:visible;transition:opacity 0.25s ease-in;opacity:1}:host([showing]) div.container{visibility:visible}:host .container{background-color:var(--default-bg-color);color:var(--default-font-color)}:host .container .title{background-color:var(--primary-color, #15233B);color:var(--primary-font-color, #fff)}:host .container .content{background-color:var(--default-bg-color)}:host .container .content div.row{border-bottom:1px solid var(--default-border-color)}:host .container .content div.row.header,:host .container .content div.row .label{color:var(--default-font-color-light)}:host .container .content div.row .responsePill{background-color:#646566;color:white}
        `}generateComponentMarkup(){return 0===Object.keys(this.page).length?null:window.__CTRender('div',{className:`container`},window.__CTRender('div',{className:'title'},this._renderTitle()),window.__CTRender('div',{class:'content'},this._renderBody()))}_renderTitle(){return[window.__CTRender(H.CTOnlineIndicator,null),window.__CTRender('div',{className:'tabs'},window.__CTRender(H.CTButton,{type:'primary',selected:this.viewOption===z.Replies,onClick:()=>this.viewOptionBtnClick(z.Replies)},'Replies'),window.__CTRender(H.CTButton,{type:'primary',selected:this.viewOption===z.MessageContent,onClick:()=>this.viewOptionBtnClick(z.MessageContent)},'Message Content')),window.__CTRender(H.CTButton,{type:'transparent',icon:M.Icons.FONTAWESOME.Cross,iconColor:'#fff',onClick:()=>this.close()})]}_renderBody(){return L.renderIfElse(this.viewOption===z.Replies,window.__CTRender('div',null,this._renderReplies()),window.__CTRender('div',null,this._renderReadOnlyMessage()))}_renderReplies(){const Y=[];return Y.push(window.__CTRender('div',{className:'row header'},window.__CTRender('div',{className:'user'},window.__CTRender('span',null,'User')),window.__CTRender('div',{className:'received'},window.__CTRender('span',null,'Received')),window.__CTRender('div',{className:'reply'},window.__CTRender('span',null,'Reply')))),this.page.individuals.map((J)=>{const G=B.getResponse(J,M.ContactResponseType.Received),W=B.getResponse(J,M.ContactResponseType.Response);Y.push(window.__CTRender('div',{className:'row'},window.__CTRender('div',{className:'user'},window.__CTRender('span',null,B.getNameFromContact(J))),window.__CTRender('div',{className:'received'},window.__CTRender('span',null,null===G?'':D.formatDateForTimeOrDate(new Date(G.ts),!1,this.layer.config.xmpp.showSecondsOnTimestamps))),window.__CTRender('div',{className:'reply'},W?window.__CTRender('div',{className:'responsePill'},window.__CTRender('span',null,W.content),window.__CTRender('span',null,D.formatDateForTimeOrDate(new Date(W.ts),!1,this.layer.config.xmpp.showSecondsOnTimestamps))):null)))}),Y}_renderReadOnlyMessage(){const Y=[window.__CTRender('div',{className:'row'},window.__CTRender('div',{className:'label'},'Sent:'),window.__CTRender('div',{className:'value'},D.formatDateForTimeOrDate(new Date(this.page.openedDate),!1,this.layer.config.xmpp.showSecondsOnTimestamps))),window.__CTRender('div',{className:'row'},window.__CTRender('div',{className:'label'},'Type:'),window.__CTRender('div',{className:'value'},this.page.pageType.name)),window.__CTRender('div',{className:'row'},window.__CTRender('div',{className:'label'},'Reply Template:'),window.__CTRender('div',{className:'value'},this.page.replyTemplate?this.page.replyTemplate.name:'Not Found')),window.__CTRender('div',{className:'row'},window.__CTRender('div',{className:'label'},'Subject:'),window.__CTRender('div',{className:'value'},this.page.subject)),window.__CTRender('div',{className:'row'},window.__CTRender('div',{className:'label'},'Message:'),window.__CTRender('div',{className:'value'},this._renderPageContent()))];return this.layer.audioAttachmentsEnabled()&&Y.push(window.__CTRender('div',{className:'row'},window.__CTRender('div',{className:'label'},'Audio:'),window.__CTRender('div',{className:'value'},this._renderAudioAttachments()))),this.layer.photoAttachmentsEnabled()&&Y.push(window.__CTRender('div',{className:'row'},window.__CTRender('div',{className:'label'},'Image:'),window.__CTRender('div',{className:'value'},this._renderImageAttachments()))),Y}_renderPageContent(){const Y=B.parseMessageContent(this.page.message);if(Y.length){const J=[];return Y.forEach((G)=>{J.push(window.__CTRender('p',null,G))}),window.__CTRender('div',null,J)}return window.__CTRender('span',null,this.page.message)}_renderAudioAttachments(){return 0===this.page.audio.length?[window.__CTRender('span',null,'No audio attached')]:!0===this.page.attachmentsLoaded?this.page.audio.map((Y)=>window.__CTRender('audio',{controls:!0},window.__CTRender('source',{src:Y,type:'audio/mpeg'}))):[window.__CTRender('div',null,'Loading...')]}_renderImageAttachments(){return 0===this.page.image.length?[window.__CTRender('span',null,'No image attached')]:!0===this.page.attachmentsLoaded?this.page.image.map((Y)=>window.__CTRender('img',{src:Y,width:150})):[window.__CTRender('div',null,'Loading...')]}}R([N.prop({type:Boolean,attribute:!0,default:!1})],$.prototype,'showing',void 0),R([N.prop({type:Object,attribute:!1})],$.prototype,'page',void 0),R([N.prop({type:String,attribute:!1})],$.prototype,'viewOption',void 0),h.CTPGReadOnlyPage=$,$.register()},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0}),h['default']=function(){function A(Q){return btoa(unescape(encodeURIComponent(Q)))}function M(){(function(Q){function Z(Le){return parseInt(Le)===Le}function ee(Le){if(!Z(Le.length))return!1;for(var Oe=0;Oe<Le.length;Oe++)if(!Z(Le[Oe])||0>Le[Oe]||255<Le[Oe])return!1;return!0}function te(Le,Oe){if(Le.buffer&&ArrayBuffer.isView(Le)&&'Uint8Array'===Le.name)return Oe&&(Le.slice?Le=Le.slice():Le=Array.prototype.slice.call(Le)),Le;if(Array.isArray(Le)){if(!ee(Le))throw new Error('Array contains invalid value: '+Le);return new Uint8Array(Le)}if(Z(Le.length)&&ee(Le))return new Uint8Array(Le);throw new Error('unsupported array-like object')}function ne(Le){return new Uint8Array(Le)}function ae(Le,Oe,ke,qe,Be){(null!=qe||null!=Be)&&(Le.slice?Le=Le.slice(qe,Be):Le=Array.prototype.slice.call(Le,qe,Be)),Oe.set(Le,ke)}function se(Le){for(var Oe=[],ke=0;ke<Le.length;ke+=4)Oe.push(Le[ke]<<24|Le[ke+1]<<16|Le[ke+2]<<8|Le[ke+3]);return Oe}var de=function(){return{toBytes:function(ke){var qe=[],Be=0;for(ke=encodeURI(ke);Be<ke.length;){var je=ke.charCodeAt(Be++);37===je?(qe.push(parseInt(ke.substr(Be,2),16)),Be+=2):qe.push(je)}return te(qe)},fromBytes:function(ke){for(var qe=[],Be=0,je;Be<ke.length;)je=ke[Be],128>je?(qe.push(String.fromCharCode(je)),Be++):191<je&&224>je?(qe.push(String.fromCharCode((31&je)<<6|63&ke[Be+1])),Be+=2):(qe.push(String.fromCharCode((15&je)<<12|(63&ke[Be+1])<<6|63&ke[Be+2])),Be+=3);return qe.join('')}}}(),le=function(){var ke='0123456789abcdef';return{toBytes:function(qe){for(var Be=[],je=0;je<qe.length;je+=2)Be.push(parseInt(qe.substr(je,2),16));return Be},fromBytes:function(qe){for(var Be=[],je=0,Fe;je<qe.length;je++)Fe=qe[je],Be.push(ke[(240&Fe)>>4]+ke[15&Fe]);return Be.join('')}}}(),ue={16:10,24:12,32:14},ce=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],pe=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],ge=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],me=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],_e=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],fe=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],he=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],ye=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],Te=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],Ce=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239000,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],be=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998000,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],Se=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],Ee=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],ve=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239000,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],Re=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998000,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925],Pe=function(Le){if(!(this instanceof Pe))throw Error('AES must be instanitated with `new`');Object.defineProperty(this,'key',{value:te(Le,!0)}),this._prepare()};Pe.prototype._prepare=function(){var Le=ue[this.key.length];if(null==Le)throw new Error('invalid key size (must be 16, 24 or 32 bytes)');this._Ke=[],this._Kd=[];for(var Oe=0;Oe<=Le;Oe++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);for(var ke=4*(Le+1),qe=this.key.length/4,Be=se(this.key),Oe=0,je;Oe<qe;Oe++)je=Oe>>2,this._Ke[je][Oe%4]=Be[Oe],this._Kd[Le-je][Oe%4]=Be[Oe];for(var Fe=0,Ue=qe,He;Ue<ke;){if(He=Be[qe-1],Be[0]^=pe[255&He>>16]<<24^pe[255&He>>8]<<16^pe[255&He]<<8^pe[255&He>>24]^ce[Fe]<<24,Fe+=1,8!=qe)for(var Oe=1;Oe<qe;Oe++)Be[Oe]^=Be[Oe-1];else{for(var Oe=1;Oe<qe/2;Oe++)Be[Oe]^=Be[Oe-1];He=Be[qe/2-1],Be[qe/2]^=pe[255&He]^pe[255&He>>8]<<8^pe[255&He>>16]<<16^pe[255&He>>24]<<24;for(var Oe=qe/2+1;Oe<qe;Oe++)Be[Oe]^=Be[Oe-1]}for(var Oe=0,ze,$e;Oe<qe&&Ue<ke;)ze=Ue>>2,$e=Ue%4,this._Ke[ze][$e]=Be[Oe],this._Kd[Le-ze][$e]=Be[Oe++],Ue++}for(var ze=1;ze<Le;ze++)for(var $e=0;4>$e;$e++)He=this._Kd[ze][$e],this._Kd[ze][$e]=Se[255&He>>24]^Ee[255&He>>16]^ve[255&He>>8]^Re[255&He]},Pe.prototype.encrypt=function(Le){if(16!=Le.length)throw new Error('invalid plaintext size (must be 16 bytes)');for(var Oe=this._Ke.length-1,ke=[0,0,0,0],qe=se(Le),Be=0;4>Be;Be++)qe[Be]^=this._Ke[0][Be];for(var je=1;je<Oe;je++){for(var Be=0;4>Be;Be++)ke[Be]=me[255&qe[Be]>>24]^_e[255&qe[(Be+1)%4]>>16]^fe[255&qe[(Be+2)%4]>>8]^he[255&qe[(Be+3)%4]]^this._Ke[je][Be];qe=ke.slice()}for(var Fe=ne(16),Be=0,Ue;4>Be;Be++)Ue=this._Ke[Oe][Be],Fe[4*Be]=255&(pe[255&qe[Be]>>24]^Ue>>24),Fe[4*Be+1]=255&(pe[255&qe[(Be+1)%4]>>16]^Ue>>16),Fe[4*Be+2]=255&(pe[255&qe[(Be+2)%4]>>8]^Ue>>8),Fe[4*Be+3]=255&(pe[255&qe[(Be+3)%4]]^Ue);return Fe},Pe.prototype.decrypt=function(Le){if(16!=Le.length)throw new Error('invalid ciphertext size (must be 16 bytes)');for(var Oe=this._Kd.length-1,ke=[0,0,0,0],qe=se(Le),Be=0;4>Be;Be++)qe[Be]^=this._Kd[0][Be];for(var je=1;je<Oe;je++){for(var Be=0;4>Be;Be++)ke[Be]=ye[255&qe[Be]>>24]^Te[255&qe[(Be+3)%4]>>16]^Ce[255&qe[(Be+2)%4]>>8]^be[255&qe[(Be+1)%4]]^this._Kd[je][Be];qe=ke.slice()}for(var Fe=ne(16),Be=0,Ue;4>Be;Be++)Ue=this._Kd[Oe][Be],Fe[4*Be]=255&(ge[255&qe[Be]>>24]^Ue>>24),Fe[4*Be+1]=255&(ge[255&qe[(Be+3)%4]>>16]^Ue>>16),Fe[4*Be+2]=255&(ge[255&qe[(Be+2)%4]>>8]^Ue>>8),Fe[4*Be+3]=255&(ge[255&qe[(Be+1)%4]]^Ue);return Fe};var Ae=function(Le){if(!(this instanceof Ae))throw Error('AES must be instanitated with `new`');this.description='Electronic Code Block',this.name='ecb',this._aes=new Pe(Le)};Ae.prototype.encrypt=function(Le){if(Le=te(Le),0!=Le.length%16)throw new Error('invalid plaintext size (must be multiple of 16 bytes)');for(var Oe=ne(Le.length),ke=ne(16),qe=0;qe<Le.length;qe+=16)ae(Le,ke,0,qe,qe+16),ke=this._aes.encrypt(ke),ae(ke,Oe,qe);return Oe},Ae.prototype.decrypt=function(Le){if(Le=te(Le),0!=Le.length%16)throw new Error('invalid ciphertext size (must be multiple of 16 bytes)');for(var Oe=ne(Le.length),ke=ne(16),qe=0;qe<Le.length;qe+=16)ae(Le,ke,0,qe,qe+16),ke=this._aes.decrypt(ke),ae(ke,Oe,qe);return Oe};var Ne=function(Le,Oe){if(!(this instanceof Ne))throw Error('AES must be instanitated with `new`');if(this.description='Cipher Block Chaining',this.name='cbc',!Oe)Oe=ne(16);else if(16!=Oe.length)throw new Error('invalid initialation vector size (must be 16 bytes)');this._lastCipherblock=te(Oe,!0),this._aes=new Pe(Le)};Ne.prototype.encrypt=function(Le){if(Le=te(Le),0!=Le.length%16)throw new Error('invalid plaintext size (must be multiple of 16 bytes)');for(var Oe=ne(Le.length),ke=ne(16),qe=0;qe<Le.length;qe+=16){ae(Le,ke,0,qe,qe+16);for(var Be=0;16>Be;Be++)ke[Be]^=this._lastCipherblock[Be];this._lastCipherblock=this._aes.encrypt(ke),ae(this._lastCipherblock,Oe,qe)}return Oe},Ne.prototype.decrypt=function(Le){if(Le=te(Le),0!=Le.length%16)throw new Error('invalid ciphertext size (must be multiple of 16 bytes)');for(var Oe=ne(Le.length),ke=ne(16),qe=0;qe<Le.length;qe+=16){ae(Le,ke,0,qe,qe+16),ke=this._aes.decrypt(ke);for(var Be=0;16>Be;Be++)Oe[qe+Be]=ke[Be]^this._lastCipherblock[Be];ae(Le,this._lastCipherblock,0,qe,qe+16)}return Oe};var Me=function(Le,Oe,ke){if(!(this instanceof Me))throw Error('AES must be instanitated with `new`');if(this.description='Cipher Feedback',this.name='cfb',!Oe)Oe=ne(16);else if(16!=Oe.length)throw new Error('invalid initialation vector size (must be 16 size)');ke||(ke=1),this.segmentSize=ke,this._shiftRegister=te(Oe,!0),this._aes=new Pe(Le)};Me.prototype.encrypt=function(Le){if(0!=Le.length%this.segmentSize)throw new Error('invalid plaintext size (must be segmentSize bytes)');for(var Oe=te(Le,!0),qe=0,ke;qe<Oe.length;qe+=this.segmentSize){ke=this._aes.encrypt(this._shiftRegister);for(var Be=0;Be<this.segmentSize;Be++)Oe[qe+Be]^=ke[Be];ae(this._shiftRegister,this._shiftRegister,0,this.segmentSize),ae(Oe,this._shiftRegister,16-this.segmentSize,qe,qe+this.segmentSize)}return Oe},Me.prototype.decrypt=function(Le){if(0!=Le.length%this.segmentSize)throw new Error('invalid ciphertext size (must be segmentSize bytes)');for(var Oe=te(Le,!0),qe=0,ke;qe<Oe.length;qe+=this.segmentSize){ke=this._aes.encrypt(this._shiftRegister);for(var Be=0;Be<this.segmentSize;Be++)Oe[qe+Be]^=ke[Be];ae(this._shiftRegister,this._shiftRegister,0,this.segmentSize),ae(Le,this._shiftRegister,16-this.segmentSize,qe,qe+this.segmentSize)}return Oe};var xe=function(Le,Oe){if(!(this instanceof xe))throw Error('AES must be instanitated with `new`');if(this.description='Output Feedback',this.name='ofb',!Oe)Oe=ne(16);else if(16!=Oe.length)throw new Error('invalid initialation vector size (must be 16 bytes)');this._lastPrecipher=te(Oe,!0),this._lastPrecipherIndex=16,this._aes=new Pe(Le)};xe.prototype.encrypt=function(Le){for(var Oe=te(Le,!0),ke=0;ke<Oe.length;ke++)16===this._lastPrecipherIndex&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),Oe[ke]^=this._lastPrecipher[this._lastPrecipherIndex++];return Oe},xe.prototype.decrypt=xe.prototype.encrypt;var Ie=function(Le){if(!(this instanceof Ie))throw Error('Counter must be instanitated with `new`');0===Le||Le||(Le=1),'number'==typeof Le?(this._counter=ne(16),this.setValue(Le)):this.setBytes(Le)};Ie.prototype.setValue=function(Le){if('number'!=typeof Le||parseInt(Le)!=Le)throw new Error('invalid counter value (must be an integer)');if(Le>Number.MAX_SAFE_INTEGER)throw new Error('integer value out of safe range');for(var Oe=15;0<=Oe;--Oe)this._counter[Oe]=Le%256,Le=parseInt(Le/256)},Ie.prototype.setBytes=function(Le){if(Le=te(Le,!0),16!=Le.length)throw new Error('invalid counter bytes size (must be 16 bytes)');this._counter=Le},Ie.prototype.increment=function(){for(var Le=15;0<=Le;Le--)if(255===this._counter[Le])this._counter[Le]=0;else{this._counter[Le]++;break}};var we=function(Le,Oe){if(!(this instanceof we))throw Error('AES must be instanitated with `new`');this.description='Counter',this.name='ctr',Oe instanceof Ie||(Oe=new Ie(Oe)),this._counter=Oe,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new Pe(Le)};we.prototype.encrypt=function(Le){for(var Oe=te(Le,!0),ke=0;ke<Oe.length;ke++)16===this._remainingCounterIndex&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),Oe[ke]^=this._remainingCounter[this._remainingCounterIndex++];return Oe},we.prototype.decrypt=we.prototype.encrypt;var De={AES:Pe,Counter:Ie,ModeOfOperation:{ecb:Ae,cbc:Ne,cfb:Me,ofb:xe,ctr:we},utils:{hex:le,utf8:de},padding:{pkcs7:{pad:function(Le){Le=te(Le,!0);var Oe=16-Le.length%16,ke=ne(Le.length+Oe);ae(Le,ke);for(var qe=Le.length;qe<ke.length;qe++)ke[qe]=Oe;return ke},strip:function(Le){if(Le=te(Le,!0),16>Le.length)throw new Error('PKCS#7 invalid length');var Oe=Le[Le.length-1];if(16<Oe)throw new Error('PKCS#7 padding byte out of range');for(var ke=Le.length-Oe,qe=0;qe<Oe;qe++)if(Le[ke+qe]!==Oe)throw new Error('PKCS#7 invalid padding byte');var Be=ne(ke);return ae(Le,Be,0,0,ke),Be}}},_arrayTest:{coerceArray:te,createArray:ne,copyArray:ae}};'undefined'!=typeof exports||('function'==typeof define&&E(100)?define(De):(Q.aesjs&&(De._aesjs=Q.aesjs),Q.aesjs=De))})(this)}let D=!1,L=null,B='lunr_index',H='idxBlock',z='docBlock';const $=function(){function Q(ee){if(null===ee||'object'!=typeof ee)return ee;var te=ee.constructor();for(var ne in ee)ee.hasOwnProperty(ne)&&(te[ne]=ee[ne]);return te}var Z=function(ee){var te=new Z.Index;return te.pipeline.add(Z.trimmer,Z.stopWordFilter,Z.stemmer),ee&&ee.call(te,te),te};return Z.version='0.9.5',lunr=Z,Z.utils={},Z.utils.warn=function(ee){return function(te){ee.console&&console.warn&&console.warn(te)}}(this),Z.utils.toString=function(ee){return void 0===ee||null===ee?'':ee.toString()},Z.EventEmitter=function(){this.events={}},Z.EventEmitter.prototype.addListener=function(){var ee=Array.prototype.slice.call(arguments),te=ee.pop();if('function'!=typeof te)throw new TypeError('last argument must be a function');ee.forEach(function(ae){this.hasHandler(ae)||(this.events[ae]=[]),this.events[ae].push(te)},this)},Z.EventEmitter.prototype.removeListener=function(ee,te){if(this.hasHandler(ee)){var ne=this.events[ee].indexOf(te);-1===ne||(this.events[ee].splice(ne,1),0==this.events[ee].length&&delete this.events[ee])}},Z.EventEmitter.prototype.emit=function(ee){if(this.hasHandler(ee)){var te=Array.prototype.slice.call(arguments,1);this.events[ee].forEach(function(ne){ne.apply(void 0,te)},this)}},Z.EventEmitter.prototype.hasHandler=function(ee){return ee in this.events},Z.tokenizer=function(ee){if(!arguments.length||null===ee||void 0===ee)return[];if(Array.isArray(ee)){var te=ee.filter(function(ae){return null===ae||void 0===ae?!1:!0});te=te.map(function(ae){return Z.utils.toString(ae).toLowerCase()});var ne=[];return te.forEach(function(ae){var se=ae.split(Z.tokenizer.seperator);ne=ne.concat(se)},this),ne}return ee.toString().trim().toLowerCase().split(Z.tokenizer.seperator)},Z.tokenizer.defaultSeperator=/[\s\-]+/,Z.tokenizer.seperator=Z.tokenizer.defaultSeperator,Z.tokenizer.setSeperator=function(ee){null!==ee&&void 0!==ee&&'object'==typeof ee&&(Z.tokenizer.seperator=ee)},Z.tokenizer.resetSeperator=function(){Z.tokenizer.seperator=Z.tokenizer.defaultSeperator},Z.tokenizer.getSeperator=function(){return Z.tokenizer.seperator},Z.Pipeline=function(){this._queue=[]},Z.Pipeline.registeredFunctions={},Z.Pipeline.registerFunction=function(ee,te){te in Z.Pipeline.registeredFunctions&&Z.utils.warn('Overwriting existing registered function: '+te),ee.label=te,Z.Pipeline.registeredFunctions[te]=ee},Z.Pipeline.getRegisteredFunction=function(ee){return!0==ee in Z.Pipeline.registeredFunctions?Z.Pipeline.registeredFunctions[ee]:null},Z.Pipeline.warnIfFunctionNotRegistered=function(ee){var te=ee.label&&ee.label in this.registeredFunctions;te||Z.utils.warn('Function is not registered with pipeline. This may cause problems when serialising the index.\n',ee)},Z.Pipeline.load=function(ee){var te=new Z.Pipeline;return ee.forEach(function(ne){var ae=Z.Pipeline.getRegisteredFunction(ne);if(ae)te.add(ae);else throw new Error('Cannot load un-registered function: '+ne)}),te},Z.Pipeline.prototype.add=function(){var ee=Array.prototype.slice.call(arguments);ee.forEach(function(te){Z.Pipeline.warnIfFunctionNotRegistered(te),this._queue.push(te)},this)},Z.Pipeline.prototype.after=function(ee,te){Z.Pipeline.warnIfFunctionNotRegistered(te);var ne=this._queue.indexOf(ee);if(-1===ne)throw new Error('Cannot find existingFn');this._queue.splice(ne+1,0,te)},Z.Pipeline.prototype.before=function(ee,te){Z.Pipeline.warnIfFunctionNotRegistered(te);var ne=this._queue.indexOf(ee);if(-1===ne)throw new Error('Cannot find existingFn');this._queue.splice(ne,0,te)},Z.Pipeline.prototype.remove=function(ee){var te=this._queue.indexOf(ee);-1===te||this._queue.splice(te,1)},Z.Pipeline.prototype.run=function(ee){for(var te=[],ne=ee.length,ae=this._queue.length,se=0,oe;se<ne;se++){oe=ee[se];for(var ie=0;ie<ae&&(oe=this._queue[ie](oe,se,ee),void 0!==oe&&null!==oe);ie++);void 0!==oe&&null!==oe&&te.push(oe)}return te},Z.Pipeline.prototype.reset=function(){this._queue=[]},Z.Pipeline.prototype.get=function(){return this._queue},Z.Pipeline.prototype.toJSON=function(){return this._queue.map(function(ee){return Z.Pipeline.warnIfFunctionNotRegistered(ee),ee.label})},Z.Index=function(){this._fields=[],this._ref='id',this.pipeline=new Z.Pipeline,this.documentStore=new Z.DocumentStore,this.index={},this.eventEmitter=new Z.EventEmitter,this._idfCache={},this.on('add','remove','update',function(){this._idfCache={}}.bind(this))},Z.Index.prototype.on=function(){var ee=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,ee)},Z.Index.prototype.off=function(ee,te){return this.eventEmitter.removeListener(ee,te)},Z.Index.load=function(ee){ee.version!==Z.version&&Z.utils.warn('version mismatch: current '+Z.version+' importing '+ee.version);var te=new this;for(var ne in te._fields=ee.fields,te._ref=ee.ref,te.documentStore=Z.DocumentStore.load(ee.documentStore),te.pipeline=Z.Pipeline.load(ee.pipeline),te.index={},ee.index)te.index[ne]=Z.InvertedIndex.load(ee.index[ne]);return te},Z.Index.prototype.addField=function(ee){return this._fields.push(ee),this.index[ee]=new Z.InvertedIndex,this},Z.Index.prototype.setRef=function(ee){return this._ref=ee,this},Z.Index.prototype.saveDocument=function(ee){return this.documentStore=new Z.DocumentStore(ee),this},Z.Index.prototype.addDoc=function(ee,te){if(ee){var te=void 0===te||te,ne=ee[this._ref];this.documentStore.addDoc(ne,ee),this._fields.forEach(function(ae){var se=this.pipeline.run(Z.tokenizer(ee[ae]));this.documentStore.addFieldLength(ne,ae,se.length);var oe={};for(var ie in se.forEach(function(le){le in oe?oe[le]+=1:oe[le]=1},this),oe){var de=oe[ie];de=Math.sqrt(de),this.index[ae].addToken(ie,{ref:ne,tf:de})}},this),te&&this.eventEmitter.emit('add',ee,this)}},Z.Index.prototype.removeDocByRef=function(ee){if(ee&&!1!==this.documentStore.isDocStored()&&this.documentStore.hasDoc(ee)){var ne=this.documentStore.getDoc(ee);this.removeDoc(ne,!1)}},Z.Index.prototype.removeDoc=function(ee,te){if(ee){var te=void 0===te||te,ne=ee[this._ref];this.documentStore.hasDoc(ne)&&(this.documentStore.removeDoc(ne),this._fields.forEach(function(ae){var se=this.pipeline.run(Z.tokenizer(ee[ae]));se.forEach(function(oe){this.index[ae].removeToken(oe,ne)},this)},this),te&&this.eventEmitter.emit('remove',ee,this))}},Z.Index.prototype.updateDoc=function(ee,te){var te=void 0===te||te;this.removeDocByRef(ee[this._ref],!1),this.addDoc(ee,!1),te&&this.eventEmitter.emit('update',ee,this)},Z.Index.prototype.idf=function(ee,te){var ne='@'+te+'/'+ee;if(Object.prototype.hasOwnProperty.call(this._idfCache,ne))return this._idfCache[ne];var ae=this.index[te].getDocFreq(ee),se=1+Math.log(this.documentStore.length/(ae+1));return this._idfCache[ne]=se,se},Z.Index.prototype.getFields=function(){return this._fields.slice()},Z.Index.prototype.search=function(ee,te){if(!ee)return[];ee='string'==typeof ee?{any:ee}:JSON.parse(JSON.stringify(ee));var ne=null;null!=te&&(ne=JSON.stringify(te));for(var ae=new Z.Configuration(ne,this.getFields()).get(),se={},oe=Object.keys(ee),ie=0,de;ie<oe.length;ie++)de=oe[ie],se[de]=this.pipeline.run(Z.tokenizer(ee[de]));var le={};for(var ue in ae){var ce=se[ue]||se.any;if(ce){var pe=this.fieldSearch(ce,ue,ae),ge=ae[ue].boost;for(var me in pe)pe[me]*=ge;for(var me in pe)me in le?le[me]+=pe[me]:le[me]=pe[me]}}var _e=[],fe;for(var me in le)fe={ref:me,score:le[me]},this.documentStore.hasDoc(me)&&(fe.doc=this.documentStore.getDoc(me)),_e.push(fe);return _e.sort(function(he,ye){return ye.score-he.score}),_e},Z.Index.prototype.fieldSearch=function(ee,te,ne){var ae=ne[te].bool,se=ne[te].expand,oe=ne[te].boost,ie=null,de={};if(0!==oe)return ee.forEach(function(le){var ue=[le];!0==se&&(ue=this.index[te].expandToken(le));var ce={};ue.forEach(function(pe){var ge=this.index[te].getDocs(pe),me=this.idf(pe,te);if(ie&&'AND'==ae){var _e={};for(var fe in ie)fe in ge&&(_e[fe]=ge[fe]);ge=_e}for(var fe in pe==le&&this.fieldSearchStats(de,pe,ge),ge){var he=this.index[te].getTermFrequency(pe,fe),ye=this.documentStore.getFieldLength(fe,te),Te=1;0!=ye&&(Te=1/Math.sqrt(ye));var Ce=1;pe!=le&&(Ce=0.15*(1-(pe.length-le.length)/pe.length));var be=he*me*Te*Ce;fe in ce?ce[fe]+=be:ce[fe]=be}},this),ie=this.mergeScores(ie,ce,ae)},this),ie=this.coordNorm(ie,de,ee.length),ie},Z.Index.prototype.mergeScores=function(ee,te,ne){if(!ee)return te;if('AND'==ne){var ae={};for(var se in te)se in ee&&(ae[se]=ee[se]+te[se]);return ae}for(var se in te)se in ee?ee[se]+=te[se]:ee[se]=te[se];return ee},Z.Index.prototype.fieldSearchStats=function(ee,te,ne){for(var ae in ne)ae in ee?ee[ae].push(te):ee[ae]=[te]},Z.Index.prototype.coordNorm=function(ee,te,ne){for(var ae in ee)if(ae in te){var se=te[ae].length;ee[ae]=ee[ae]*se/ne}return ee},Z.Index.prototype.toJSON=function(){var ee={};return this._fields.forEach(function(te){ee[te]=this.index[te].toJSON()},this),{version:Z.version,fields:this._fields,ref:this._ref,documentStore:this.documentStore.toJSON(),index:ee,pipeline:this.pipeline.toJSON()}},Z.Index.prototype.use=function(ee){var te=Array.prototype.slice.call(arguments,1);te.unshift(this),ee.apply(this,te)},Z.DocumentStore=function(ee){this._save=null===ee||void 0===ee||ee,this.docs={},this.docInfo={},this.length=0},Z.DocumentStore.load=function(ee){var te=new this;return te.length=ee.length,te.docs=ee.docs,te.docInfo=ee.docInfo,te._save=ee.save,te},Z.DocumentStore.prototype.isDocStored=function(){return this._save},Z.DocumentStore.prototype.addDoc=function(ee,te){this.hasDoc(ee)||this.length++,this.docs[ee]=!0===this._save?Q(te):null},Z.DocumentStore.prototype.getDoc=function(ee){return!1===this.hasDoc(ee)?null:this.docs[ee]},Z.DocumentStore.prototype.hasDoc=function(ee){return ee in this.docs},Z.DocumentStore.prototype.removeDoc=function(ee){this.hasDoc(ee)&&(delete this.docs[ee],delete this.docInfo[ee],this.length--)},Z.DocumentStore.prototype.addFieldLength=function(ee,te,ne){null===ee||void 0===ee||!1==this.hasDoc(ee)||(!this.docInfo[ee]&&(this.docInfo[ee]={}),this.docInfo[ee][te]=ne)},Z.DocumentStore.prototype.updateFieldLength=function(ee,te,ne){null===ee||void 0===ee||!1==this.hasDoc(ee)||this.addFieldLength(ee,te,ne)},Z.DocumentStore.prototype.getFieldLength=function(ee,te){return null===ee||void 0===ee?0:ee in this.docs?te in this.docInfo[ee]?this.docInfo[ee][te]:0:0},Z.DocumentStore.prototype.toJSON=function(){return{docs:this.docs,docInfo:this.docInfo,length:this.length,save:this._save}},Z.stemmer=function(){var ee={ational:'ate',tional:'tion',enci:'ence',anci:'ance',izer:'ize',bli:'ble',alli:'al',entli:'ent',eli:'e',ousli:'ous',ization:'ize',ation:'ate',ator:'ate',alism:'al',iveness:'ive',fulness:'ful',ousness:'ous',aliti:'al',iviti:'ive',biliti:'ble',logi:'log'},te={icate:'ic',ative:'',alize:'al',iciti:'ic',ical:'ic',ful:'',ness:''},ae='[aeiouy]',se='[^aeiou]'+'[^aeiouy]*',oe=ae+'[aeiou]*',ce=new RegExp('^('+se+')?'+oe+se),pe=new RegExp('^('+se+')?'+oe+se+oe+se),ge=new RegExp('^('+se+')?'+oe+se+'('+oe+')?$'),me=new RegExp('^('+se+')?'+ae),_e=/^(.+?)(ss|i)es$/,fe=/^(.+?)([^s])s$/,he=/^(.+?)eed$/,ye=/^(.+?)(ed|ing)$/,Te=/.$/,Ce=/(at|bl|iz)$/,be=new RegExp('([^aeiouylsz])\\1$'),Se=new RegExp('^'+se+ae+'[^aeiouwxy]$'),Ee=/^(.+?[^aeiou])y$/,ve=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,Re=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,Pe=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,Ae=/^(.+?)(s|t)(ion)$/,Ne=/^(.+?)e$/,Me=/ll$/,xe=new RegExp('^'+se+ae+'[^aeiouwxy]$');return function(De){var Le,Oe,ke,qe,Be,je,Fe;if(3>De.length)return De;if(ke=De.substr(0,1),'y'==ke&&(De=ke.toUpperCase()+De.substr(1)),qe=_e,Be=fe,qe.test(De)?De=De.replace(qe,'$1$2'):Be.test(De)&&(De=De.replace(Be,'$1$2')),qe=he,Be=ye,qe.test(De)){var Ue=qe.exec(De);qe=ce,qe.test(Ue[1])&&(qe=Te,De=De.replace(qe,''))}else if(Be.test(De)){var Ue=Be.exec(De);Le=Ue[1],Be=me,Be.test(Le)&&(De=Le,Be=Ce,je=be,Fe=Se,Be.test(De)?De+='e':je.test(De)?(qe=Te,De=De.replace(qe,'')):Fe.test(De)&&(De+='e'))}if(qe=Ee,qe.test(De)){var Ue=qe.exec(De);Le=Ue[1],De=Le+'i'}if(qe=ve,qe.test(De)){var Ue=qe.exec(De);Le=Ue[1],Oe=Ue[2],qe=ce,qe.test(Le)&&(De=Le+ee[Oe])}if(qe=Re,qe.test(De)){var Ue=qe.exec(De);Le=Ue[1],Oe=Ue[2],qe=ce,qe.test(Le)&&(De=Le+te[Oe])}if(qe=Pe,Be=Ae,qe.test(De)){var Ue=qe.exec(De);Le=Ue[1],qe=pe,qe.test(Le)&&(De=Le)}else if(Be.test(De)){var Ue=Be.exec(De);Le=Ue[1]+Ue[2],Be=pe,Be.test(Le)&&(De=Le)}if(qe=Ne,qe.test(De)){var Ue=qe.exec(De);Le=Ue[1],qe=pe,Be=ge,je=xe,(qe.test(Le)||Be.test(Le)&&!je.test(Le))&&(De=Le)}return qe=Me,Be=pe,qe.test(De)&&Be.test(De)&&(qe=Te,De=De.replace(qe,'')),'y'==ke&&(De=ke.toLowerCase()+De.substr(1)),De}}(),Z.Pipeline.registerFunction(Z.stemmer,'stemmer'),Z.stopWordFilter=function(ee){if(ee&&!0!==Z.stopWordFilter.stopWords[ee])return ee},Z.clearStopWords=function(){Z.stopWordFilter.stopWords={}},Z.addStopWords=function(ee){null==ee||!1===Array.isArray(ee)||ee.forEach(function(te){Z.stopWordFilter.stopWords[te]=!0},this)},Z.resetStopWords=function(){Z.stopWordFilter.stopWords=Z.defaultStopWords},Z.defaultStopWords={"":!0,a:!0,able:!0,about:!0,across:!0,after:!0,all:!0,almost:!0,also:!0,am:!0,among:!0,an:!0,and:!0,any:!0,are:!0,as:!0,at:!0,be:!0,because:!0,been:!0,but:!0,by:!0,can:!0,cannot:!0,could:!0,dear:!0,did:!0,do:!0,does:!0,either:!0,else:!0,ever:!0,every:!0,for:!0,from:!0,get:!0,got:!0,had:!0,has:!0,have:!0,he:!0,her:!0,hers:!0,him:!0,his:!0,how:!0,however:!0,i:!0,if:!0,in:!0,into:!0,is:!0,it:!0,its:!0,just:!0,least:!0,let:!0,like:!0,likely:!0,may:!0,me:!0,might:!0,most:!0,must:!0,my:!0,neither:!0,no:!0,nor:!0,not:!0,of:!0,off:!0,often:!0,on:!0,only:!0,or:!0,other:!0,our:!0,own:!0,rather:!0,said:!0,say:!0,says:!0,she:!0,should:!0,since:!0,so:!0,some:!0,than:!0,that:!0,the:!0,their:!0,them:!0,then:!0,there:!0,these:!0,they:!0,this:!0,tis:!0,to:!0,too:!0,twas:!0,us:!0,wants:!0,was:!0,we:!0,were:!0,what:!0,when:!0,where:!0,which:!0,while:!0,who:!0,whom:!0,why:!0,will:!0,with:!0,would:!0,yet:!0,you:!0,your:!0},Z.stopWordFilter.stopWords=Z.defaultStopWords,Z.Pipeline.registerFunction(Z.stopWordFilter,'stopWordFilter'),Z.trimmer=function(ee){if(null===ee||void 0===ee)throw new Error('token should not be undefined');return ee.replace(/^\W+/,'').replace(/\W+$/,'')},Z.Pipeline.registerFunction(Z.trimmer,'trimmer'),Z.InvertedIndex=function(){this.root={docs:{},df:0}},Z.InvertedIndex.load=function(ee){var te=new this;return te.root=ee.root,te},Z.InvertedIndex.prototype.addToken=function(ee,te,ne){for(var ne=ne||this.root,ae=0,se;ae<=ee.length-1;)se=ee[ae],se in ne||(ne[se]={docs:{},df:0}),ae+=1,ne=ne[se];var oe=te.ref;ne.docs[oe]?ne.docs[oe]={tf:te.tf}:(ne.docs[oe]={tf:te.tf},ne.df+=1)},Z.InvertedIndex.prototype.hasToken=function(ee){if(!ee)return!1;for(var te=this.root,ne=0;ne<ee.length;ne++){if(!te[ee[ne]])return!1;te=te[ee[ne]]}return!0},Z.InvertedIndex.prototype.getNode=function(ee){if(!ee)return null;for(var te=this.root,ne=0;ne<ee.length;ne++){if(!te[ee[ne]])return null;te=te[ee[ne]]}return te},Z.InvertedIndex.prototype.getDocs=function(ee){var te=this.getNode(ee);return null==te?{}:te.docs},Z.InvertedIndex.prototype.getTermFrequency=function(ee,te){var ne=this.getNode(ee);return null==ne?0:te in ne.docs?ne.docs[te].tf:0},Z.InvertedIndex.prototype.getDocFreq=function(ee){var te=this.getNode(ee);return null==te?0:te.df},Z.InvertedIndex.prototype.removeToken=function(ee,te){if(ee){var ne=this.getNode(ee);null==ne||te in ne.docs&&(delete ne.docs[te],ne.df-=1)}},Z.InvertedIndex.prototype.expandToken=function(ee,te,ne){if(null==ee||''==ee)return[];var te=te||[];if(void 0==ne&&(ne=this.getNode(ee),null==ne))return te;for(var ae in 0<ne.df&&te.push(ee),ne)'docs'!=ae&&('df'==ae||this.expandToken(ee+ae,te,ne[ae]));return te},Z.InvertedIndex.prototype.toJSON=function(){return{root:this.root}},Z.Configuration=function(ee,te){var ee=ee||'';if(void 0==te||null==te)throw new Error('fields should not be null');this.config={};var ne;try{ne=JSON.parse(ee),this.buildUserConfig(ne,te)}catch(ae){Z.utils.warn('user configuration parse failed, will use default configuration'),this.buildDefaultConfig(te)}},Z.Configuration.prototype.buildDefaultConfig=function(ee){this.reset(),ee.forEach(function(te){this.config[te]={boost:1,bool:'OR',expand:!1}},this)},Z.Configuration.prototype.buildUserConfig=function(ee,te){var ne='OR',ae=!1;if(this.reset(),'bool'in ee&&(ne=ee.bool||ne),'expand'in ee&&(ae=ee.expand||ae),'fields'in ee){for(var se in ee.fields)if(-1<te.indexOf(se)){var oe=ee.fields[se],ie=ae;void 0!=oe.expand&&(ie=oe.expand),this.config[se]={boost:oe.boost||0===oe.boost?oe.boost:1,bool:oe.bool||ne,expand:ie}}else Z.utils.warn('field name in user configuration not found in index instance fields');}else this.addAllFields2UserConfig(ne,ae,te)},Z.Configuration.prototype.addAllFields2UserConfig=function(ee,te,ne){ne.forEach(function(ae){this.config[ae]={boost:1,bool:ee,expand:te}},this)},Z.Configuration.prototype.get=function(){return this.config},Z.Configuration.prototype.reset=function(){this.config={}},lunr.SortedSet=function(){this.length=0,this.elements=[]},lunr.SortedSet.load=function(ee){var te=new this;return te.elements=ee,te.length=ee.length,te},lunr.SortedSet.prototype.add=function(){var ee,te;for(ee=0;ee<arguments.length;ee++)te=arguments[ee],~this.indexOf(te)||this.elements.splice(this.locationFor(te),0,te);this.length=this.elements.length},lunr.SortedSet.prototype.toArray=function(){return this.elements.slice()},lunr.SortedSet.prototype.map=function(ee,te){return this.elements.map(ee,te)},lunr.SortedSet.prototype.forEach=function(ee,te){return this.elements.forEach(ee,te)},lunr.SortedSet.prototype.indexOf=function(ee){for(var te=0,ne=this.elements.length,ae=ne-te,se=te+Math.floor(ae/2),oe=this.elements[se];1<ae;){if(oe===ee)return se;oe<ee&&(te=se),oe>ee&&(ne=se),ae=ne-te,se=te+Math.floor(ae/2),oe=this.elements[se]}return oe===ee?se:-1},lunr.SortedSet.prototype.locationFor=function(ee){for(var te=0,ne=this.elements.length,ae=ne-te,se=te+Math.floor(ae/2),oe=this.elements[se];1<ae;)oe<ee&&(te=se),oe>ee&&(ne=se),ae=ne-te,se=te+Math.floor(ae/2),oe=this.elements[se];return oe>ee?se:oe<ee?se+1:void 0},lunr.SortedSet.prototype.intersect=function(ee){for(var te=new lunr.SortedSet,ne=0,ae=0,se=this.length,oe=ee.length,ie=this.elements,de=ee.elements;!(ne>se-1||ae>oe-1);){if(ie[ne]===de[ae]){te.add(ie[ne]),ne++,ae++;continue}if(ie[ne]<de[ae]){ne++;continue}if(ie[ne]>de[ae]){ae++;continue}}return te},lunr.SortedSet.prototype.clone=function(){var ee=new lunr.SortedSet;return ee.elements=this.toArray(),ee.length=ee.elements.length,ee},lunr.SortedSet.prototype.union=function(ee){var te,ne,ae;this.length>=ee.length?(te=this,ne=ee):(te=ee,ne=this),ae=te.clone();for(var se=0,oe=ne.toArray();se<oe.length;se++)ae.add(oe[se]);return ae},lunr.SortedSet.prototype.toJSON=function(){return this.toArray()},Z}();let W=!0;const X=new Map;let K='pureJs';self.onmessage=function(Q){function Z(ue){return new Promise((ce,pe)=>{ie(JSON.stringify(ue)).then((ge)=>{if(this.subtle)this.subtle.encrypt({name:'AES-CBC',iv:this._iv},this._key,ge).then((me)=>{ce(me)}).catch(pe);else{const me=new aesjs.ModeOfOperation.ctr(this._key),_e=me.encrypt(ge);ce(_e)}}).catch(pe)})}function ee(ue){return new Promise((ce,pe)=>{if(this.subtle)this.subtle.decrypt({name:'AES-CBC',iv:this._iv},this._key,ue).then((ge)=>{const me=new Uint8Array(ge);de(me).then((_e)=>{ce(JSON.parse(_e))}).catch(pe)}).catch(pe);else{const ge=new aesjs.ModeOfOperation.ctr(this._key),me=ge.decrypt(ue);de(me).then((_e)=>{ce(JSON.parse(_e))}).catch(pe)}})}function te(ue,ce){return new Promise((pe,ge)=>{X.set(ue,{resolve:pe,reject:ge}),self.postMessage({action:'store-record',key:ue,record:ce})})}function ne(ue){return new Promise((ce,pe)=>{X.set(ue,{resolve:ce,reject:pe}),self.postMessage({action:'retrieve-record',key:ue})})}function ae(ue=1e3){return W&&console.time('encrypt'),new Promise((ce,pe)=>{function ge(){if(0===Te.length)W&&console.timeEnd('encrypt'),W&&console.time('index'),ye.documentStore.docs={},W&&console.time('index2'),me();else{const be=Te.splice(0,ue),Se={};be.forEach((Ee)=>{const ve=he.documentStore.docs[Ee];Se[Ee]=ve}),W&&console.time('block'),Z(Se).then((Ee)=>{te(z+_e++,Ee).then(()=>{W&&console.timeEnd('block'),ge()}).catch(pe)}).catch(pe)}}function me(){if(0===Ce.length)ye.index={},Z(ye).then((be)=>{W&&console.timeEnd('index2'),te(B,be).then(ce).catch(pe)});else{const be=Ce.shift();W&&console.time('chunk'),Z({prop:be,data:ye.index[be]}).then((Se)=>{te(H+fe++,Se).then(()=>{W&&console.timeEnd('chunk'),me()})})}}let _e=0,fe=0;const he=L.toJSON(),ye=JSON.parse(JSON.stringify(he)),Te=Object.keys(ye.documentStore.docs),Ce=Object.keys(ye.index);ge()})}function se(){return new Promise((ue,ce)=>{function pe(){ne(z+_e).then((he)=>{return he?void ee(he).then((ye)=>{me.documentStore.docs=Object.assign(me.documentStore.docs,ye),_e++,pe()}).catch(ce):ge()}).catch(ce)}function ge(){ne(H+fe).then((he)=>{return he?void ee(he).then((ye)=>{me.index[ye.prop]=ye.data,fe++,ge()}).catch(ce):ue(me)}).catch(ce)}let me=null,_e=0,fe=0;ne(B).then((he)=>{return he?void ee(he).then((ye)=>{me=ye,pe()}).catch(ce):ue(me)}).catch(ce)})}function oe(){return new Promise((ue)=>{ne(K).then((pe)=>{if(pe===void 0){const ge=self.crypto.subtle===void 0;te(K,ge).then(()=>{ue(ge)})}else ue(pe)})})}function ie(ue){return new Promise((ce)=>{const ge=new TextEncoder;ce(ge.encode(ue))})}function de(ue){return new Promise((ce)=>{const ge=new TextDecoder;ce(ge.decode(ue))})}function le(ue){return new Promise((ce)=>{this.subtle?this.subtle.importKey('raw',ue,{name:'AES-CBC'},!1,['encrypt','decrypt']).then((ge)=>{ce(ge)}):ce(ue)})}switch(Q.data.action){case'initialise':const ue=()=>{D=!0,self.postMessage({_id:Q.data._id,action:'initialisation-complete',success:!0,msg:'Successfully initialised the user index.'})},ce=(Ee)=>{self.postMessage({_id:Q.data._id,action:'initialisation-complete',success:!1,msg:Ee})};if(!Q.data.instanceId)return void ce('Error initialising user index database.');W=!0===Q.data.debug,this._blockSize=Q.data.blockSize||this._blockSize,oe().then((Ee)=>{Ee?(M(),this.subtle=null):this.subtle=self.crypto.subtle,le(Q.data.key).then((ve)=>{this._key=ve,this._iv=Q.data.iv,se().then((Re)=>{Re&&(L=$.Index.load(Re)),ue()}).catch(()=>{ce('Failed reading database for previously stored index.')})}).catch(()=>{ce('Failed importing key for previously stored index.')})}).catch(()=>{ce('Failed detecting crypto type for previously stored index')});break;case'fetch':if(!1==D)return void self.postMessage({_id:Q.data._id,success:!1,action:'index-complete',msg:'Initialisation must be completed before the \'fetch\' action can take place.'});const pe=Date.now();fetch(Q.data.endpoint,{method:'GET',headers:{Authorization:'Basic '+A(`${Q.data.jid}:${Q.data.pass}`)}}).then((Ee)=>{return Ee.json()}).then((Ee)=>{const ve={added:Ee.added||[],updated:Ee.updated||[],removed:Ee.removed||[]};void 0!==Ee.full&&(L=null,ve.added=Ee.full);const Re=Date.now()-pe,Pe=[`Downloaded '${ve.added.length}' additions, '${ve.updated.length}' updates and '${ve.removed.length}' deletions in ${Re}ms`];null===L&&(L=$(function(){this.setRef('jid'),this.addField('jid'),this.addField('firstName'),this.addField('lastName'),this.addField('jobTitle'),this.addField('telephone'),this.addField('group'),this.saveDocument(!0)}),Pe.push(`Created a fresh index`)),0<ve.added.length&&(ve.added.forEach((Ae)=>L.addDoc(Ae)),Pe.push(`Added '${ve.added.length}' users to index`)),0<ve.updated.length&&(ve.updated.forEach((Ae)=>L.updateDoc(Ae)),Pe.push(`Updated '${ve.updated.length}' users in index`)),0<ve.removed.length&&(ve.removed.forEach((Ae)=>L.removeDoc(Ae)),Pe.push(`Removed '${ve.removed.length}' users from index`)),ae(2e3).then(()=>{self.postMessage({_id:Q.data._id,success:!0,action:'index-complete',hash:Ee.hash||null,msg:`${Pe.join(', ')} | Completed in ${Date.now()-pe}ms.`})}).catch(()=>{self.postMessage({_id:Q.data._id,success:!1,action:'index-complete',msg:'Couldn\'t persist updated index.'})})}).catch((Ee)=>{const ve=`Unable to download user directory from location '${Q.data.endpoint}'`;console.error(ve,Ee),self.postMessage({_id:Q.data._id,success:!1,action:'index-complete',msg:ve})});break;case'search':if($.clearStopWords(),!1==D)return void self.postMessage({_id:Q.data._id,success:!1,action:'search-complete',msg:'Initialisation must be completed before the \'search\' action can take place.'});if(null===L)return void self.postMessage({_id:Q.data._id,success:!1,action:'search-complete',msg:'There is no index to be searched, have you updated the index yet?'});const ge=Date.now();let me=null;if(Array.isArray(Q.data.fields)&&0<Q.data.fields.length){const Ee={fields:{},bool:'OR',expand:!0};Q.data.fields.forEach((ve)=>{Ee.fields[ve]={}}),me=L.search(Q.data.query,Ee)}else me=L.search(Q.data.query,{expand:!0});const _e=me.map((Ee)=>{return Ee.doc});self.postMessage({_id:Q.data._id,success:!0,action:'search-complete',msg:`Found ${_e.length} users in ${Date.now()-ge}ms.`,results:_e});break;case'jid-search':if(!1==D)return void self.postMessage({_id:Q.data._id,success:!1,action:'jid-search-complete',msg:'Initialisation must be completed before the \'jid-search\' action can take place.'});if(null===L)return void self.postMessage({_id:Q.data._id,success:!1,action:'jid-search-complete',msg:'There is no index to be searched, have you updated the index yet?'});const fe=Date.now(),he=L.search(Q.data.jid,{expand:!0})[0],ye=void 0===he?null:he.doc;self.postMessage({_id:Q.data._id,success:!0,action:'jid-search-complete',msg:null===ye?`No user with JID '${Q.data.jid}' could be found.`:`Found user with JID '${Q.data.jid}' in ${Date.now()-fe}ms.`,result:ye});break;case'get-all-users':if(!1==D)return void self.postMessage({_id:Q.data._id,success:!1,action:'get-all-users-complete',msg:'Initialisation must be completed before the \'get-all-users\' action can take place.'});if(null===L)return void self.postMessage({_id:Q.data._id,success:!1,action:'get-all-users-complete',msg:'There is no index available, have you updated the index yet?'});const Te=Date.now(),Ce=[];for(let Ee in L.documentStore.docs)Ce.push(L.documentStore.docs[Ee]);self.postMessage({_id:Q.data._id,success:!0,action:'get-all-users-complete',msg:`Fetched '${Ce.length}' users in ${Date.now()-Te}ms.`,results:Ce});break;case'get-users-in-groups':if(!1==D)return void self.postMessage({_id:Q.data._id,success:!1,action:'get-users-in-group-complete',msg:'Initialisation must be completed before the \'get-all-users\' action can take place.'});if(null===L)return void self.postMessage({_id:Q.data._id,success:!1,action:'get-users-in-groups-complete',msg:'There is no index available, have you updated the index yet?'});const be=[];for(let Ee in L.documentStore.docs){const ve=L.documentStore.docs[Ee];if(!ve.group)continue;const Re=ve.group.split(Q.data.sep);Q.data.groupNames.filter((Pe)=>Re.includes(Pe)).length&&be.push(ve)}self.postMessage({_id:Q.data._id,success:!0,action:'get-users-in-group-complete',results:be});break;case'store-record-response':case'retrieve-record-response':const Se=X.get(Q.data.key);Se&&(Q.data.success?Se.resolve(Q.data.record):Se.reject(Q.data.msg),X.delete(Q.data.key));break;default:self.postMessage({_id:Q.data._id,success:!0,msg:`Invalid action '${Q.data.action}' was specified.`});}}}},function(l,h,E){var R,A,N,M,I,D,L,B,H,z,H,$,H,Y,H,J,H,G;(function(W,X){A={id:'strophe-base64',exports:{},loaded:!1},R=function(){return X()}.call(A.exports,E,A.exports,A),A.loaded=!0,!(R===void 0&&(R=A.exports))})(this,function(){var W='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';return{encode:function(K){var Q='',ie=0,Z,ee,te,ne,ae,se,oe;do Z=K.charCodeAt(ie++),ee=K.charCodeAt(ie++),te=K.charCodeAt(ie++),ne=Z>>2,ae=(3&Z)<<4|ee>>4,se=(15&ee)<<2|te>>6,oe=63&te,isNaN(ee)?(ae=(3&Z)<<4,se=oe=64):isNaN(te)&&(oe=64),Q=Q+W.charAt(ne)+W.charAt(ae)+W.charAt(se)+W.charAt(oe);while(ie<K.length);return Q},decode:function(K){var Q='',ie=0,Z,ee,te,ne,ae,se,oe;K=K.replace(/[^A-Za-z0-9\+\/\=]/g,'');do ne=W.indexOf(K.charAt(ie++)),ae=W.indexOf(K.charAt(ie++)),se=W.indexOf(K.charAt(ie++)),oe=W.indexOf(K.charAt(ie++)),Z=ne<<2|ae>>4,ee=(15&ae)<<4|se>>2,te=(3&se)<<6|oe,Q+=String.fromCharCode(Z),64!=se&&(Q+=String.fromCharCode(ee)),64!=oe&&(Q+=String.fromCharCode(te));while(ie<K.length);return Q}}}),function(W,X){M={id:'strophe-sha1',exports:{},loaded:!1},N=function(){return X()}.call(M.exports,E,M.exports,M),M.loaded=!0,!(N===void 0&&(N=M.exports))}(this,function(){function W(se,oe){se[oe>>5]|=128<<24-oe%32,se[(oe+64>>9<<4)+15]=oe;var ie=Array(80),de=1732584193,le=-271733879,ue=-1732584194,ce=271733878,pe=-1009589776,ge,me,_e,fe,he,ye,Te,Ce;for(ge=0;ge<se.length;ge+=16){for(fe=de,he=le,ye=ue,Te=ce,Ce=pe,me=0;80>me;me++)ie[me]=16>me?se[ge+me]:ee(ie[me-3]^ie[me-8]^ie[me-14]^ie[me-16],1),_e=Z(Z(ee(de,5),X(me,le,ue,ce)),Z(Z(pe,ie[me]),K(me))),pe=ce,ce=ue,ue=ee(le,30),le=de,de=_e;de=Z(de,fe),le=Z(le,he),ue=Z(ue,ye),ce=Z(ce,Te),pe=Z(pe,Ce)}return[de,le,ue,ce,pe]}function X(se,oe,ie,de){return 20>se?oe&ie|~oe&de:40>se?oe^ie^de:60>se?oe&ie|oe&de|ie&de:oe^ie^de}function K(se){return 20>se?1518500249:40>se?1859775393:60>se?-1894007588:-899497514}function Q(se,oe){var ie=te(se);16<ie.length&&(ie=W(ie,8*se.length));for(var de=Array(16),le=Array(16),ue=0;16>ue;ue++)de[ue]=909522486^ie[ue],le[ue]=1549556828^ie[ue];var ce=W(de.concat(te(oe)),512+8*oe.length);return W(le.concat(ce),672)}function Z(se,oe){var ie=(65535&se)+(65535&oe);return(se>>16)+(oe>>16)+(ie>>16)<<16|65535&ie}function ee(se,oe){return se<<oe|se>>>32-oe}function te(se){for(var oe=[],de=0;de<8*se.length;de+=8)oe[de>>5]|=(se.charCodeAt(de/8)&255)<<24-de%32;return oe}function ne(se){for(var oe='',de=0;de<32*se.length;de+=8)oe+=String.fromCharCode(se[de>>5]>>>24-de%32&255);return oe}function ae(se){for(var ie='',ue=0,de,le;ue<4*se.length;ue+=3)for(de=(255&se[ue>>2]>>8*(3-ue%4))<<16|(255&se[ue+1>>2]>>8*(3-(ue+1)%4))<<8|255&se[ue+2>>2]>>8*(3-(ue+2)%4),le=0;4>le;le++)ie+=8*ue+6*le>32*se.length?'=':'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'.charAt(63&de>>6*(3-le));return ie}return{b64_hmac_sha1:function(se,oe){return ae(Q(se,oe))},b64_sha1:function(se){return ae(W(te(se),8*se.length))},binb2str:ne,core_hmac_sha1:Q,str_hmac_sha1:function(se,oe){return ne(Q(se,oe))},str_sha1:function(se){return ne(W(te(se),8*se.length))}}}),function(W,X){D={id:'strophe-md5',exports:{},loaded:!1},I=function(){return X()}.call(D.exports,E,D.exports,D),D.loaded=!0,!(I===void 0&&(I=D.exports))}(this,function(){var X=function(le,ue){var ce=(65535&le)+(65535&ue);return(le>>16)+(ue>>16)+(ce>>16)<<16|65535&ce},K=function(le,ue){return le<<ue|le>>>32-ue},Q=function(le){for(var ue=[],ce=0;ce<8*le.length;ce+=8)ue[ce>>5]|=(255&le.charCodeAt(ce/8))<<ce%32;return ue},Z=function(le){for(var ue='',ce=0;ce<32*le.length;ce+=8)ue+=String.fromCharCode(255&le[ce>>5]>>>ce%32);return ue},ee=function(le){for(var ue='0123456789abcdef',ce='',pe=0;pe<4*le.length;pe++)ce+=ue.charAt(15&le[pe>>2]>>8*(pe%4)+4)+ue.charAt(15&le[pe>>2]>>8*(pe%4));return ce},te=function(le,ue,ce,pe,ge,me){return X(K(X(X(ue,le),X(pe,me)),ge),ce)},ne=function(le,ue,ce,pe,ge,me,_e){return te(ue&ce|~ue&pe,le,ue,ge,me,_e)},ae=function(le,ue,ce,pe,ge,me,_e){return te(ue&pe|ce&~pe,le,ue,ge,me,_e)},se=function(le,ue,ce,pe,ge,me,_e){return te(ue^ce^pe,le,ue,ge,me,_e)},oe=function(le,ue,ce,pe,ge,me,_e){return te(ce^(ue|~pe),le,ue,ge,me,_e)},ie=function(le,ue){le[ue>>5]|=128<<ue%32,le[(ue+64>>>9<<4)+14]=ue;for(var ce=1732584193,pe=-271733879,ge=-1732584194,me=271733878,Te=0,_e,fe,he,ye;Te<le.length;Te+=16)_e=ce,fe=pe,he=ge,ye=me,ce=ne(ce,pe,ge,me,le[Te+0],7,-680876936),me=ne(me,ce,pe,ge,le[Te+1],12,-389564586),ge=ne(ge,me,ce,pe,le[Te+2],17,606105819),pe=ne(pe,ge,me,ce,le[Te+3],22,-1044525330),ce=ne(ce,pe,ge,me,le[Te+4],7,-176418897),me=ne(me,ce,pe,ge,le[Te+5],12,1200080426),ge=ne(ge,me,ce,pe,le[Te+6],17,-1473231341),pe=ne(pe,ge,me,ce,le[Te+7],22,-45705983),ce=ne(ce,pe,ge,me,le[Te+8],7,1770035416),me=ne(me,ce,pe,ge,le[Te+9],12,-1958414417),ge=ne(ge,me,ce,pe,le[Te+10],17,-42063),pe=ne(pe,ge,me,ce,le[Te+11],22,-1990404162),ce=ne(ce,pe,ge,me,le[Te+12],7,1804603682),me=ne(me,ce,pe,ge,le[Te+13],12,-40341101),ge=ne(ge,me,ce,pe,le[Te+14],17,-1502002290),pe=ne(pe,ge,me,ce,le[Te+15],22,1236535329),ce=ae(ce,pe,ge,me,le[Te+1],5,-165796510),me=ae(me,ce,pe,ge,le[Te+6],9,-1069501632),ge=ae(ge,me,ce,pe,le[Te+11],14,643717713),pe=ae(pe,ge,me,ce,le[Te+0],20,-373897302),ce=ae(ce,pe,ge,me,le[Te+5],5,-701558691),me=ae(me,ce,pe,ge,le[Te+10],9,38016083),ge=ae(ge,me,ce,pe,le[Te+15],14,-660478335),pe=ae(pe,ge,me,ce,le[Te+4],20,-405537848),ce=ae(ce,pe,ge,me,le[Te+9],5,568446438),me=ae(me,ce,pe,ge,le[Te+14],9,-1019803690),ge=ae(ge,me,ce,pe,le[Te+3],14,-187363961),pe=ae(pe,ge,me,ce,le[Te+8],20,1163531501),ce=ae(ce,pe,ge,me,le[Te+13],5,-1444681467),me=ae(me,ce,pe,ge,le[Te+2],9,-51403784),ge=ae(ge,me,ce,pe,le[Te+7],14,1735328473),pe=ae(pe,ge,me,ce,le[Te+12],20,-1926607734),ce=se(ce,pe,ge,me,le[Te+5],4,-378558),me=se(me,ce,pe,ge,le[Te+8],11,-2022574463),ge=se(ge,me,ce,pe,le[Te+11],16,1839030562),pe=se(pe,ge,me,ce,le[Te+14],23,-35309556),ce=se(ce,pe,ge,me,le[Te+1],4,-1530992060),me=se(me,ce,pe,ge,le[Te+4],11,1272893353),ge=se(ge,me,ce,pe,le[Te+7],16,-155497632),pe=se(pe,ge,me,ce,le[Te+10],23,-1094730640),ce=se(ce,pe,ge,me,le[Te+13],4,681279174),me=se(me,ce,pe,ge,le[Te+0],11,-358537222),ge=se(ge,me,ce,pe,le[Te+3],16,-722521979),pe=se(pe,ge,me,ce,le[Te+6],23,76029189),ce=se(ce,pe,ge,me,le[Te+9],4,-640364487),me=se(me,ce,pe,ge,le[Te+12],11,-421815835),ge=se(ge,me,ce,pe,le[Te+15],16,530742520),pe=se(pe,ge,me,ce,le[Te+2],23,-995338651),ce=oe(ce,pe,ge,me,le[Te+0],6,-198630844),me=oe(me,ce,pe,ge,le[Te+7],10,1126891415),ge=oe(ge,me,ce,pe,le[Te+14],15,-1416354905),pe=oe(pe,ge,me,ce,le[Te+5],21,-57434055),ce=oe(ce,pe,ge,me,le[Te+12],6,1700485571),me=oe(me,ce,pe,ge,le[Te+3],10,-1894986606),ge=oe(ge,me,ce,pe,le[Te+10],15,-1051523),pe=oe(pe,ge,me,ce,le[Te+1],21,-2054922799),ce=oe(ce,pe,ge,me,le[Te+8],6,1873313359),me=oe(me,ce,pe,ge,le[Te+15],10,-30611744),ge=oe(ge,me,ce,pe,le[Te+6],15,-1560198380),pe=oe(pe,ge,me,ce,le[Te+13],21,1309151649),ce=oe(ce,pe,ge,me,le[Te+4],6,-145523070),me=oe(me,ce,pe,ge,le[Te+11],10,-1120210379),ge=oe(ge,me,ce,pe,le[Te+2],15,718787259),pe=oe(pe,ge,me,ce,le[Te+9],21,-343485551),ce=X(ce,_e),pe=X(pe,fe),ge=X(ge,he),me=X(me,ye);return[ce,pe,ge,me]};return{hexdigest:function(le){return ee(ie(Q(le),8*le.length))},hash:function(le){return Z(ie(Q(le),8*le.length))}}}),function(W,X){B={id:'strophe-utils',exports:{},loaded:!1},L=function(){return X()}.call(B.exports,E,B.exports,B),B.loaded=!0,!(L===void 0&&(L=B.exports))}(this,function(){return{utf16to8:function(X){var Z='',ee=X.length,K,Q;for(K=0;K<ee;K++)Q=X.charCodeAt(K),0<=Q&&127>=Q?Z+=X.charAt(K):2047<Q?(Z+=String.fromCharCode(224|15&Q>>12),Z+=String.fromCharCode(128|63&Q>>6),Z+=String.fromCharCode(128|63&Q>>0)):(Z+=String.fromCharCode(192|31&Q>>6),Z+=String.fromCharCode(128|63&Q>>0));return Z},addCookies:function(X){var K,Q,Z,ee,te,ne,ae;for(K in X||{})te='',ne='',ae='',Q=X[K],Z='object'==typeof Q,ee=escape(unescape(Z?Q.value:Q)),Z&&(te=Q.expires?';expires='+Q.expires:'',ne=Q.domain?';domain='+Q.domain:'',ae=Q.path?';path='+Q.path:''),document.cookie=K+'='+ee+te+ne+ae}}}),function(W,X){H=[],!(z=function(){return X()}.apply(h,H))}(this,function(){Function.prototype.bind||(Function.prototype.bind=function(W){var X=this,K=Array.prototype.slice,Q=Array.prototype.concat,Z=K.call(arguments,1);return function(){return X.apply(W?W:this,Q.call(Z,K.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(W){return'[object Array]'===Object.prototype.toString.call(W)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(W){var X=this.length,K=+arguments[1]||0;for(K=0>K?Math.ceil(K):Math.floor(K),0>K&&(K+=X);K<X;K++)if(K in this&&this[K]===W)return K;return-1})}),Array.prototype.forEach||(Array.prototype.forEach=function(W,X){var K,Q;if(null===this)throw new TypeError(' this is null or not defined');var Z=Object(this),ee=Z.length>>>0;if('function'!=typeof W)throw new TypeError(W+' is not a function');for(1<arguments.length&&(K=X),Q=0;Q<ee;){var te;Q in Z&&(te=Z[Q],W.call(K,te,Q,Z)),Q++}}),function(W,X){H=[N,R,I,L,z],!($=function(){return X.apply(this,arguments)}.apply(h,H))}(this,function(W,X,K,Q){function Z(se,oe){return new ae.Builder(se,oe)}function te(se){return new ae.Builder('iq',se)}function ne(se){return new ae.Builder('presence',se)}var ae;return ae={VERSION:'1.2.12',NS:{HTTPBIND:'http://jabber.org/protocol/httpbind',BOSH:'urn:xmpp:xbosh',CLIENT:'jabber:client',AUTH:'jabber:iq:auth',ROSTER:'jabber:iq:roster',PROFILE:'jabber:iq:profile',DISCO_INFO:'http://jabber.org/protocol/disco#info',DISCO_ITEMS:'http://jabber.org/protocol/disco#items',MUC:'http://jabber.org/protocol/muc',SASL:'urn:ietf:params:xml:ns:xmpp-sasl',STREAM:'http://etherx.jabber.org/streams',FRAMING:'urn:ietf:params:xml:ns:xmpp-framing',BIND:'urn:ietf:params:xml:ns:xmpp-bind',SESSION:'urn:ietf:params:xml:ns:xmpp-session',VERSION:'jabber:iq:version',STANZAS:'urn:ietf:params:xml:ns:xmpp-stanzas',XHTML_IM:'http://jabber.org/protocol/xhtml-im',XHTML:'http://www.w3.org/1999/xhtml'},XHTML:{tags:['a','blockquote','br','cite','em','img','li','ol','p','span','strong','ul','body'],attributes:{a:['href'],blockquote:['style'],br:[],cite:['style'],em:[],img:['src','alt','style','height','width'],li:['style'],ol:['style'],p:['style'],span:['style'],strong:[],ul:['style'],body:[]},css:['background-color','color','font-family','font-size','font-style','font-weight','margin-left','margin-right','text-align','text-decoration'],validTag:function(se){for(var oe=0;oe<ae.XHTML.tags.length;oe++)if(se==ae.XHTML.tags[oe])return!0;return!1},validAttribute:function(se,oe){if('undefined'!=typeof ae.XHTML.attributes[se]&&0<ae.XHTML.attributes[se].length)for(var ie=0;ie<ae.XHTML.attributes[se].length;ie++)if(oe==ae.XHTML.attributes[se][ie])return!0;return!1},validCSS:function(se){for(var oe=0;oe<ae.XHTML.css.length;oe++)if(se==ae.XHTML.css[oe])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,addNamespace:function(se,oe){ae.NS[se]=oe},forEachChild:function(se,oe,ie){var de,le;for(de=0;de<se.childNodes.length;de++)le=se.childNodes[de],le.nodeType==ae.ElementType.NORMAL&&(!oe||this.isTagEqual(le,oe))&&ie(le)},isTagEqual:function(se,oe){return se.tagName==oe},_xmlGenerator:null,_makeGenerator:function(){var se;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&10>document.documentMode?(se=this._getIEXmlDom(),se.appendChild(se.createElement('strophe'))):se=document.implementation.createDocument('jabber:client','strophe',null),se},xmlGenerator:function(){return ae._xmlGenerator||(ae._xmlGenerator=ae._makeGenerator()),ae._xmlGenerator},_getIEXmlDom:function(){for(var se=null,oe=['Msxml2.DOMDocument.6.0','Msxml2.DOMDocument.5.0','Msxml2.DOMDocument.4.0','MSXML2.DOMDocument.3.0','MSXML2.DOMDocument','MSXML.DOMDocument','Microsoft.XMLDOM'],ie=0;ie<oe.length&&null==se;ie++)try{se=new ActiveXObject(oe[ie])}catch(de){se=null}return se},xmlElement:function(se){if(!se)return null;var oe=ae.xmlGenerator().createElement(se),ie,de,le;for(ie=1;ie<arguments.length;ie++){var ue=arguments[ie];if(ue)if('string'==typeof ue||'number'==typeof ue)oe.appendChild(ae.xmlTextNode(ue));else if('object'==typeof ue&&'function'==typeof ue.sort)for(de=0;de<ue.length;de++){var ce=ue[de];'object'==typeof ce&&'function'==typeof ce.sort&&void 0!==ce[1]&&null!==ce[1]&&oe.setAttribute(ce[0],ce[1])}else if('object'==typeof ue)for(le in ue)ue.hasOwnProperty(le)&&void 0!==ue[le]&&null!==ue[le]&&oe.setAttribute(le,ue[le])}return oe},xmlescape:function(se){return se=se.replace(/\&/g,'&amp;'),se=se.replace(/</g,'&lt;'),se=se.replace(/>/g,'&gt;'),se=se.replace(/'/g,'&apos;'),se=se.replace(/"/g,'&quot;'),se},xmlunescape:function(se){return se=se.replace(/\&amp;/g,'&'),se=se.replace(/&lt;/g,'<'),se=se.replace(/&gt;/g,'>'),se=se.replace(/&apos;/g,'\''),se=se.replace(/&quot;/g,'"'),se},xmlTextNode:function(se){return ae.xmlGenerator().createTextNode(se)},xmlHtmlNode:function(se){var oe;if(window.DOMParser){var ie=new DOMParser;oe=ie.parseFromString(se,'text/xml')}else oe=new ActiveXObject('Microsoft.XMLDOM'),oe.async='false',oe.loadXML(se);return oe},getText:function(se){if(!se)return null;var oe='';0===se.childNodes.length&&se.nodeType==ae.ElementType.TEXT&&(oe+=se.nodeValue);for(var ie=0;ie<se.childNodes.length;ie++)se.childNodes[ie].nodeType==ae.ElementType.TEXT&&(oe+=se.childNodes[ie].nodeValue);return ae.xmlescape(oe)},copyElement:function(se){var oe,ie;if(se.nodeType==ae.ElementType.NORMAL){for(ie=ae.xmlElement(se.tagName),oe=0;oe<se.attributes.length;oe++)ie.setAttribute(se.attributes[oe].nodeName,se.attributes[oe].value);for(oe=0;oe<se.childNodes.length;oe++)ie.appendChild(ae.copyElement(se.childNodes[oe]))}else se.nodeType==ae.ElementType.TEXT&&(ie=ae.xmlGenerator().createTextNode(se.nodeValue));return ie},createHtml:function(se){var oe,ie,de,le,ue,ce,pe,ge,me,_e,fe;if(se.nodeType==ae.ElementType.NORMAL){if(le=se.nodeName.toLowerCase(),ae.XHTML.validTag(le))try{for(ie=ae.xmlElement(le),oe=0;oe<ae.XHTML.attributes[le].length;oe++)if(ue=ae.XHTML.attributes[le][oe],ce=se.getAttribute(ue),'undefined'!=typeof ce&&null!==ce&&''!==ce&&!1!==ce&&0!==ce)if('style'==ue&&'object'==typeof ce&&'undefined'!=typeof ce.cssText&&(ce=ce.cssText),'style'==ue){for(pe=[],ge=ce.split(';'),de=0;de<ge.length;de++)me=ge[de].split(':'),_e=me[0].replace(/^\s*/,'').replace(/\s*$/,'').toLowerCase(),ae.XHTML.validCSS(_e)&&(fe=me[1].replace(/^\s*/,'').replace(/\s*$/,''),pe.push(_e+': '+fe));0<pe.length&&(ce=pe.join('; '),ie.setAttribute(ue,ce))}else ie.setAttribute(ue,ce);for(oe=0;oe<se.childNodes.length;oe++)ie.appendChild(ae.createHtml(se.childNodes[oe]))}catch(he){ie=ae.xmlTextNode('')}else for(ie=ae.xmlGenerator().createDocumentFragment(),oe=0;oe<se.childNodes.length;oe++)ie.appendChild(ae.createHtml(se.childNodes[oe]));}else if(se.nodeType==ae.ElementType.FRAGMENT)for(ie=ae.xmlGenerator().createDocumentFragment(),oe=0;oe<se.childNodes.length;oe++)ie.appendChild(ae.createHtml(se.childNodes[oe]));else se.nodeType==ae.ElementType.TEXT&&(ie=ae.xmlTextNode(se.nodeValue));return ie},escapeNode:function(se){return'string'==typeof se?se.replace(/^\s+|\s+$/g,'').replace(/\\/g,'\\5c').replace(/ /g,'\\20').replace(/\"/g,'\\22').replace(/\&/g,'\\26').replace(/\'/g,'\\27').replace(/\//g,'\\2f').replace(/:/g,'\\3a').replace(/</g,'\\3c').replace(/>/g,'\\3e').replace(/@/g,'\\40'):se},unescapeNode:function(se){return'string'==typeof se?se.replace(/\\20/g,' ').replace(/\\22/g,'"').replace(/\\26/g,'&').replace(/\\27/g,'\'').replace(/\\2f/g,'/').replace(/\\3a/g,':').replace(/\\3c/g,'<').replace(/\\3e/g,'>').replace(/\\40/g,'@').replace(/\\5c/g,'\\'):se},getNodeFromJid:function(se){return 0>se.indexOf('@')?null:se.split('@')[0]},getDomainFromJid:function(se){var oe=ae.getBareJidFromJid(se);if(0>oe.indexOf('@'))return oe;var ie=oe.split('@');return ie.splice(0,1),ie.join('@')},getResourceFromJid:function(se){var oe=se.split('/');return 2>oe.length?null:(oe.splice(0,1),oe.join('/'))},getBareJidFromJid:function(se){return se?se.split('/')[0]:null},_handleError:function(se){'undefined'!=typeof se.stack&&ae.fatal(se.stack),se.sourceURL?ae.fatal('error: '+this.handler+' '+se.sourceURL+':'+se.line+' - '+se.name+': '+se.message):se.fileName?ae.fatal('error: '+this.handler+' '+se.fileName+':'+se.lineNumber+' - '+se.name+': '+se.message):ae.fatal('error: '+se.message)},log:function(){},debug:function(se){this.log(this.LogLevel.DEBUG,se)},info:function(se){this.log(this.LogLevel.INFO,se)},warn:function(se){this.log(this.LogLevel.WARN,se)},error:function(se){this.log(this.LogLevel.ERROR,se)},fatal:function(se){this.log(this.LogLevel.FATAL,se)},serialize:function(se){var oe;if(!se)return null;'function'==typeof se.tree&&(se=se.tree());var ie=se.nodeName,de,le;for(se.getAttribute('_realname')&&(ie=se.getAttribute('_realname')),oe='<'+ie,de=0;de<se.attributes.length;de++)'_realname'!=se.attributes[de].nodeName&&(oe+=' '+se.attributes[de].nodeName+'=\''+ae.xmlescape(se.attributes[de].value)+'\'');if(0<se.childNodes.length){for(oe+='>',de=0;de<se.childNodes.length;de++)switch(le=se.childNodes[de],le.nodeType){case ae.ElementType.NORMAL:oe+=ae.serialize(le);break;case ae.ElementType.TEXT:oe+=ae.xmlescape(le.nodeValue);break;case ae.ElementType.CDATA:oe+='<![CDATA['+le.nodeValue+']]>';}oe+='</'+ie+'>'}else oe+='/>';return oe},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(se,oe){ae._connectionPlugins[se]=oe}},ae.Builder=function(se,oe){('presence'==se||'message'==se||'iq'==se)&&(oe&&!oe.xmlns?oe.xmlns=ae.NS.CLIENT:!oe&&(oe={xmlns:ae.NS.CLIENT})),this.nodeTree=ae.xmlElement(se,oe),this.node=this.nodeTree},ae.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return ae.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(se){for(var oe in se)se.hasOwnProperty(oe)&&(void 0===se[oe]?this.node.removeAttribute(oe):this.node.setAttribute(oe,se[oe]));return this},c:function(se,oe,ie){var de=ae.xmlElement(se,oe,ie);return this.node.appendChild(de),'string'!=typeof ie&&'number'!=typeof ie&&(this.node=de),this},cnode:function(se){var ie=ae.xmlGenerator(),oe;try{oe=void 0!==ie.importNode}catch(le){oe=!1}var de=oe?ie.importNode(se,!0):ae.copyElement(se);return this.node.appendChild(de),this.node=de,this},t:function(se){var oe=ae.xmlTextNode(se);return this.node.appendChild(oe),this},h:function(se){var oe=document.createElement('body');oe.innerHTML=se;for(var ie=ae.createHtml(oe);0<ie.childNodes.length;)this.node.appendChild(ie.childNodes[0]);return this}},ae.Handler=function(se,oe,ie,de,le,ue,ce){this.handler=se,this.ns=oe,this.name=ie,this.type=de,this.id=le,this.options=ce||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(ae.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.from=this.options.matchBareFromJid?ue?ae.getBareJidFromJid(ue):null:ue,this.user=!0},ae.Handler.prototype={getNamespace:function(se){var oe=se.getAttribute('xmlns');return oe&&this.options.ignoreNamespaceFragment&&(oe=oe.split('#')[0]),oe},namespaceMatch:function(se){var oe=!1;if(!this.ns)return!0;var ie=this;return ae.forEachChild(se,null,function(de){ie.getNamespace(de)===ie.ns&&(oe=!0)}),oe=oe||this.getNamespace(se)===this.ns,oe},isMatch:function(se){var oe=se.getAttribute('from');this.options.matchBareFromJid&&(oe=ae.getBareJidFromJid(oe));var ie=se.getAttribute('type');return!this.namespaceMatch(se)||this.name&&!ae.isTagEqual(se,this.name)||this.type&&(Array.isArray(this.type)?-1==this.type.indexOf(ie):ie!=this.type)||this.id&&se.getAttribute('id')!=this.id||this.from&&oe!=this.from?!1:!0},run:function(se){var oe=null;try{oe=this.handler(se)}catch(ie){throw ae._handleError(ie),ie}return oe},toString:function(){return'{Handler: '+this.handler+'('+this.name+','+this.id+','+this.ns+')}'}},ae.TimedHandler=function(se,oe){this.period=se,this.handler=oe,this.lastCalled=new Date().getTime(),this.user=!0},ae.TimedHandler.prototype={run:function(){return this.lastCalled=new Date().getTime(),this.handler()},reset:function(){this.lastCalled=new Date().getTime()},toString:function(){return'{TimedHandler: '+this.handler+'('+this.period+')}'}},ae.Connection=function(se,oe){this.service=se,this.options=oe||{};var ie=this.options.protocol||'';for(var de in this._proto=0===se.indexOf('ws:')||0===se.indexOf('wss:')||0===ie.indexOf('ws')?new ae.Websocket(this):new ae.Bosh(this),this.jid='',this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),Q.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),ae._connectionPlugins)if(ae._connectionPlugins.hasOwnProperty(de)){var le=ae._connectionPlugins[de],ue=function(){};ue.prototype=le,this[de]=new ue,this[de].init(this)}},ae.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this.override=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(se){var oe='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(ie){var de=0|16*Math.random(),le='x'==ie?de:8|3&de;return le.toString(16)});return'string'==typeof se||'number'==typeof se?oe+':'+se:oe+''},addProtocolErrorHandler:function(se,oe,ie){this.protocolErrorHandlers[se][oe]=ie},connect:function(se,oe,ie,de,le,ue,ce){this.jid=se,this.authzid=ae.getBareJidFromJid(this.jid),this.authcid=ce||ae.getNodeFromJid(this.jid),this.pass=oe,this.servtype='xmpp',this.connect_callback=ie,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=ae.getDomainFromJid(this.jid),this._changeConnectStatus(ae.Status.CONNECTING,null),this._proto._connect(de,le,ue)},attach:function(se,oe,ie,de,le,ue,ce){if(this._proto instanceof ae.Bosh)this._proto._attach(se,oe,ie,de,le,ue,ce);else throw{name:'StropheSessionError',message:'The "attach" method can only be used with a BOSH connection.'}},restore:function(se,oe,ie,de,le){if(this._sessionCachingSupported())this._proto._restore(se,oe,ie,de,le);else throw{name:'StropheSessionError',message:'The "restore" method can only be used with a BOSH connection.'}},_sessionCachingSupported:function(){if(this._proto instanceof ae.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem('_strophe_','_strophe_'),window.sessionStorage.removeItem('_strophe_')}catch(se){return!1}return!0}return!1},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},nextValidRid:function(){},send:function(se){if(null!==se){if('function'==typeof se.sort)for(var oe=0;oe<se.length;oe++)this._queueData(se[oe]);else'function'==typeof se.tree?this._queueData(se.tree()):this._queueData(se);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(se,oe,ie,de){var le=null,ue=this;'function'==typeof se.tree&&(se=se.tree());var ce=se.getAttribute('id');if(ce||(ce=this.getUniqueId('sendPresence'),se.setAttribute('id',ce)),'function'==typeof oe||'function'==typeof ie){var pe=this.addHandler(function(ge){le&&ue.deleteTimedHandler(le);var me=ge.getAttribute('type');'error'==me?ie&&ie(ge):oe&&oe(ge)},null,'presence',null,ce);de&&(le=this.addTimedHandler(de,function(){return ue.deleteHandler(pe),ie&&ie(null),!1}))}return this.send(se),ce},sendIQ:function(se,oe,ie,de){var le=null,ue=this;'function'==typeof se.tree&&(se=se.tree());var ce=se.getAttribute('id');if(ce||(ce=this.getUniqueId('sendIQ'),se.setAttribute('id',ce)),'function'==typeof oe||'function'==typeof ie){var pe=this.addHandler(function(ge){le&&ue.deleteTimedHandler(le);var me=ge.getAttribute('type');if('result'==me)oe&&oe(ge);else if('error'==me)ie&&ie(ge);else throw{name:'StropheError',message:'Got bad IQ type of '+me}},null,'iq',['error','result'],ce);de&&(le=this.addTimedHandler(de,function(){return ue.deleteHandler(pe),ie&&ie(null),!1}))}return this.send(se),ce},_queueData:function(se){if(null===se||!se.tagName||!se.childNodes)throw{name:'StropheError',message:'Cannot queue non-DOMElement.'};this._data.push(se)},_sendRestart:function(){this._data.push('restart'),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(se,oe){var ie=new ae.TimedHandler(se,oe);return this.addTimeds.push(ie),ie},deleteTimedHandler:function(se){this.removeTimeds.push(se)},addHandler:function(se,oe,ie,de,le,ue,ce){var pe=new ae.Handler(se,oe,ie,de,le,ue,ce);return this.addHandlers.push(pe),pe},deleteHandler:function(se){this.removeHandlers.push(se);var oe=this.addHandlers.indexOf(se);0<=oe&&this.addHandlers.splice(oe,1)},registerSASLMechanisms:function(se){this.mechanisms={},se=se||[ae.SASLAnonymous,ae.SASLExternal,ae.SASLMD5,ae.SASLOAuthBearer,ae.SASLPlain,ae.SASLSHA1],se.forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(se){this.mechanisms[se.prototype.name]=se},disconnect:function(se,oe){if(ae.info('Disconnect was called because: '+se),this.connected){this._changeConnectStatus(ae.Status.DISCONNECTING,se);var ie=!1;this.disconnecting=!0,this.authenticated&&(ie=ne({xmlns:ae.NS.CLIENT,type:'unavailable'})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(ie,oe)}else ae.info('Disconnect was called before Strophe connected to the server'),this._proto._abortAllRequests(),this._doDisconnect(se)},_changeConnectStatus:function(se,oe){for(var ie in ae._connectionPlugins)if(ae._connectionPlugins.hasOwnProperty(ie)){var de=this[ie];if(de.statusChanged)try{de.statusChanged(se,oe)}catch(le){ae.error(''+ie+' plugin caused an exception changing status: '+le)}}if(this.connect_callback)try{this.connect_callback(se,oe)}catch(le){ae._handleError(le),ae.error('User connection callback caused an exception: '+le)}},_doDisconnect:function(se){'number'==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),ae.info('_doDisconnect was called'),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(ae.Status.DISCONNECTED,se),this.connected=!1},_dataRecv:function(se,oe){ae.info('_dataRecv called');var ie=this._proto._reqToData(se);if(null!==ie){this.xmlInput!==ae.Connection.prototype.xmlInput&&(ie.nodeName===this._proto.strip&&ie.childNodes.length?this.xmlInput(ie.childNodes[0]):this.xmlInput(ie)),this.rawInput!==ae.Connection.prototype.rawInput&&(oe?this.rawInput(oe):this.rawInput(ae.serialize(ie)));for(var de,le;0<this.removeHandlers.length;)le=this.removeHandlers.pop(),de=this.handlers.indexOf(le),0<=de&&this.handlers.splice(de,1);for(;0<this.addHandlers.length;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var ue=ie.getAttribute('type'),ce,pe;if(null!==ue&&'terminate'==ue)return this.disconnecting?void 0:(ce=ie.getAttribute('condition'),pe=ie.getElementsByTagName('conflict'),null===ce?this._changeConnectStatus(ae.Status.CONNFAIL,'unknown'):('remote-stream-error'==ce&&0<pe.length&&(ce='conflict'),this._changeConnectStatus(ae.Status.CONNFAIL,ce)),void this._doDisconnect(ce));var ge=this;ae.forEachChild(ie,null,function(me){var _e,fe;for(fe=ge.handlers,ge.handlers=[],_e=0;_e<fe.length;_e++){var he=fe[_e];try{he.isMatch(me)&&(ge.authenticated||!he.user)?he.run(me)&&ge.handlers.push(he):ge.handlers.push(he)}catch(ye){ae.warn('Removing Strophe handlers due to uncaught exception: '+ye.message)}}})}},mechanisms:{},_connect_cb:function(se,oe,ie){ae.info('_connect_cb was called'),this.connected=!0;var de;try{de=this._proto._reqToData(se)}catch(_e){if('badformat'!=_e)throw _e;this._changeConnectStatus(ae.Status.CONNFAIL,'bad-format'),this._doDisconnect('bad-format')}if(de){this.xmlInput!==ae.Connection.prototype.xmlInput&&(de.nodeName===this._proto.strip&&de.childNodes.length?this.xmlInput(de.childNodes[0]):this.xmlInput(de)),this.rawInput!==ae.Connection.prototype.rawInput&&(ie?this.rawInput(ie):this.rawInput(ae.serialize(de)));var le=this._proto._connect_cb(de);if(le!==ae.Status.CONNFAIL){var ue;if(ue=de.getElementsByTagNameNS?0<de.getElementsByTagNameNS(ae.NS.STREAM,'features').length:0<de.getElementsByTagName('stream:features').length||0<de.getElementsByTagName('features').length,!ue)return void this._proto._no_auth_received(oe);var ce=[],me=de.getElementsByTagName('mechanism'),pe,ge;if(0<me.length)for(pe=0;pe<me.length;pe++)ge=ae.getText(me[pe]),this.mechanisms[ge]&&ce.push(this.mechanisms[ge]);return 0===ce.length&&0===de.getElementsByTagName('auth').length?void this._proto._no_auth_received(oe):void(!1!==this.do_authentication&&this.authenticate(ce))}}},sortMechanismsByPriority:function(se){var oe,ie,de,le;for(oe=0;oe<se.length-1;++oe){for(de=oe,ie=oe+1;ie<se.length;++ie)se[ie].prototype.priority>se[de].prototype.priority&&(de=ie);de!=oe&&(le=se[oe],se[oe]=se[de],se[de]=le)}return se},_attemptSASLAuth:function(se){se=this.sortMechanismsByPriority(se||[]);var oe=0,ie=!1;for(oe=0;oe<se.length;++oe)if(se[oe].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,'success',null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,'failure',null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,'challenge',null,null),this._sasl_mechanism=new se[oe],this._sasl_mechanism.onStart(this);var de=Z('auth',{xmlns:ae.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var le=this._sasl_mechanism.onChallenge(this,null);de.t(X.encode(le))}this.send(de.tree()),ie=!0;break}return ie},_attemptLegacyAuth:function(){null===ae.getNodeFromJid(this.jid)?(this._changeConnectStatus(ae.Status.CONNFAIL,'x-strophe-bad-non-anon-jid'),this.disconnect('x-strophe-bad-non-anon-jid')):(this._changeConnectStatus(ae.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,'_auth_1'),this.send(te({type:'get',to:this.domain,id:'_auth_1'}).c('query',{xmlns:ae.NS.AUTH}).c('username',{}).t(ae.getNodeFromJid(this.jid)).tree()))},authenticate:function(se){this._attemptSASLAuth(se)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(se){var oe=X.decode(ae.getText(se)),ie=this._sasl_mechanism.onChallenge(this,oe),de=Z('response',{xmlns:ae.NS.SASL});return''!==ie&&de.t(X.encode(ie)),this.send(de.tree()),!0},_auth1_cb:function(){var oe=te({type:'set',id:'_auth_2'}).c('query',{xmlns:ae.NS.AUTH}).c('username',{}).t(ae.getNodeFromJid(this.jid)).up().c('password').t(this.pass);return ae.getResourceFromJid(this.jid)||(this.jid=ae.getBareJidFromJid(this.jid)+'/strophe'),oe.up().c('resource',{}).t(ae.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,'_auth_2'),this.send(oe.tree()),!1},_sasl_success_cb:function(se){if(this._sasl_data['server-signature']){var ie=X.decode(ae.getText(se)),de=/([a-z]+)=([^,]+)(,|$)/,le=ie.match(de),oe;if('v'==le[1]&&(oe=le[2]),oe!=this._sasl_data['server-signature'])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}ae.info('SASL authentication succeeded.'),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var ue=[],ce=function(pe,ge){for(;pe.length;)this.deleteHandler(pe.pop());return this._sasl_auth1_cb.bind(this)(ge),!1};return ue.push(this._addSysHandler(function(pe){ce.bind(this)(ue,pe)}.bind(this),null,'stream:features',null,null)),ue.push(this._addSysHandler(function(pe){ce.bind(this)(ue,pe)}.bind(this),ae.NS.STREAM,'features',null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(se){this.features=se;var oe,ie;for(oe=0;oe<se.childNodes.length;oe++)ie=se.childNodes[oe],'bind'==ie.nodeName&&(this.do_bind=!0),'session'==ie.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(ae.Status.AUTHFAIL,null),!1;var de=this,le=function(){de._addSysHandler(de._sasl_bind_cb.bind(de),null,null,null,'_bind_auth_2'),de.override&&(de.send(te({type:'set',id:'_override_1'}).c('override',{xmlns:'urn:commontime:infinity:bind',"resource-conflict":'closeold'}).tree()),de.override=!1);var ue=ae.getResourceFromJid(de.jid);ue?de.send(te({type:'set',id:'_bind_auth_2'}).c('bind',{xmlns:ae.NS.BIND}).c('resource',{}).t(ue).tree()):de.send(te({type:'set',id:'_bind_auth_2'}).c('bind',{xmlns:ae.NS.BIND}).tree())};return void 0!==this.streamManagement&&void 0!==this.streamManagement.prevId?(this._addSysHandler(function(){return de.authenticated=!0,de._changeConnectStatus(ae.Status.CONNECTED,'resumed'),!1},'urn:xmpp:sm:3','resumed'),this._addSysHandler(function(){return le(),!1},'urn:xmpp:sm:3','failed'),this.send(Z('resume',{xmlns:'urn:xmpp:sm:3',previd:this.streamManagement.prevId,h:this.streamManagement.getIncomingCounter()||0}))):le(),!1},_sasl_bind_cb:function(se){if('error'==se.getAttribute('type')){ae.info('SASL binding failed.');var oe=se.getElementsByTagName('conflict'),ie;return 0<oe.length&&(ie='conflict',this._doDisconnect(ie)),this._changeConnectStatus(ae.Status.AUTHFAIL,ie),!1}var de=se.getElementsByTagName('bind'),le;return 0<de.length?void(le=de[0].getElementsByTagName('jid'),0<le.length&&(this.jid=ae.getText(le[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,'_session_auth_2'),this.send(te({type:'set',id:'_session_auth_2'}).c('session',{xmlns:ae.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(ae.Status.CONNECTED,null)))):(ae.info('SASL binding failed.'),this._changeConnectStatus(ae.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(se){if('result'==se.getAttribute('type'))this.authenticated=!0,this._changeConnectStatus(ae.Status.CONNECTED,null);else if('error'==se.getAttribute('type'))return ae.info('Session creation failed.'),this._changeConnectStatus(ae.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(se){this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure();const oe=se.getElementsByTagName('text')[0];let ie=null;return void 0!==oe&&(ie=oe.innerHTML||null),this._changeConnectStatus(ae.Status.AUTHFAIL,ie),this.disconnect(ie),!1},_auth2_cb:function(se){return'result'==se.getAttribute('type')?(this.authenticated=!0,this._changeConnectStatus(ae.Status.CONNECTED,null)):'error'==se.getAttribute('type')&&(this._changeConnectStatus(ae.Status.AUTHFAIL,null),this.disconnect('authentication failed')),!1},_addSysTimedHandler:function(se,oe){var ie=new ae.TimedHandler(se,oe);return ie.user=!1,this.addTimeds.push(ie),ie},_addSysHandler:function(se,oe,ie,de,le){var ue=new ae.Handler(se,oe,ie,de,le);return ue.user=!1,this.addHandlers.push(ue),ue},_onDisconnectTimeout:function(){return ae.info('_onDisconnectTimeout was called'),this._changeConnectStatus(ae.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var se,oe,ie,de;0<this.addTimeds.length;)this.timedHandlers.push(this.addTimeds.pop());for(;0<this.removeTimeds.length;)oe=this.removeTimeds.pop(),se=this.timedHandlers.indexOf(oe),0<=se&&this.timedHandlers.splice(se,1);var le=new Date().getTime();for(de=[],se=0;se<this.timedHandlers.length;se++)oe=this.timedHandlers[se],(this.authenticated||!oe.user)&&(ie=oe.lastCalled+oe.period,0>=ie-le?oe.run()&&de.push(oe):de.push(oe));this.timedHandlers=de,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),1e3))}},ae.SASLMechanism=function(se,oe,ie){this.name=se,this.isClientFirst=oe,this.priority=ie},ae.SASLMechanism.prototype={test:function(){return!0},onStart:function(se){this._connection=se},onChallenge:function(){throw new Error('You should implement challenge handling!')},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},ae.SASLAnonymous=function(){},ae.SASLAnonymous.prototype=new ae.SASLMechanism('ANONYMOUS',!1,20),ae.SASLAnonymous.prototype.test=function(se){return null===se.authcid},ae.SASLPlain=function(){},ae.SASLPlain.prototype=new ae.SASLMechanism('PLAIN',!0,30),ae.SASLPlain.prototype.test=function(se){return null!==se.authcid},ae.SASLPlain.prototype.onChallenge=function(se){var oe=se.authzid;return oe+='\0',oe+=se.authcid,oe+='\0',oe+=se.pass,Q.utf16to8(oe)},ae.SASLSHA1=function(){},ae.SASLSHA1.prototype=new ae.SASLMechanism('SCRAM-SHA-1',!0,50),ae.SASLSHA1.prototype.test=function(se){return null!==se.authcid},ae.SASLSHA1.prototype.onChallenge=function(se,oe,ie){var de=ie||K.hexdigest(1234567890*Math.random()),le='n='+Q.utf16to8(se.authcid);return le+=',r=',le+=de,se._sasl_data.cnonce=de,se._sasl_data['client-first-message-bare']=le,le='n,,'+le,this.onChallenge=function(ue,ce){for(var ve='c=biws,',Re=ue._sasl_data['client-first-message-bare']+','+ce+',',Pe=ue._sasl_data.cnonce,Ae=/([a-z]+)=([^,]+)(,|$)/,pe,ge,me,_e,fe,he,ye,Te,Ce,be,Se,Ee,Ne;ce.match(Ae);)switch(Ne=ce.match(Ae),ce=ce.replace(Ne[0],''),Ne[1]){case'r':pe=Ne[2];break;case's':ge=Ne[2];break;case'i':me=Ne[2];}if(pe.substr(0,Pe.length)!==Pe)return ue._sasl_data={},ue._sasl_failure_cb();for(ve+='r='+pe,Re+=ve,ge=X.decode(ge),ge+='\0\0\0\x01',Ce=Q.utf16to8(ue.pass),_e=he=W.core_hmac_sha1(Ce,ge),ye=1;ye<me;ye++){for(fe=W.core_hmac_sha1(Ce,W.binb2str(he)),Te=0;5>Te;Te++)_e[Te]^=fe[Te];he=fe}for(_e=W.binb2str(_e),be=W.core_hmac_sha1(_e,'Client Key'),Se=W.str_hmac_sha1(_e,'Server Key'),Ee=W.core_hmac_sha1(W.str_sha1(W.binb2str(be)),Re),ue._sasl_data['server-signature']=W.b64_hmac_sha1(Se,Re),Te=0;5>Te;Te++)be[Te]^=Ee[Te];return ve+=',p='+X.encode(W.binb2str(be)),ve}.bind(this),le},ae.SASLMD5=function(){},ae.SASLMD5.prototype=new ae.SASLMechanism('DIGEST-MD5',!1,40),ae.SASLMD5.prototype.test=function(se){return null!==se.authcid},ae.SASLMD5.prototype._quote=function(se){return'"'+se.replace(/\\/g,'\\\\').replace(/"/g,'\\"')+'"'},ae.SASLMD5.prototype.onChallenge=function(se,oe,ie){for(var de=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,le=ie||K.hexdigest(''+1234567890*Math.random()),ue='',ce=null,pe='',me;oe.match(de);)switch(me=oe.match(de),oe=oe.replace(me[0],''),me[2]=me[2].replace(/^"(.+)"$/,'$1'),me[1]){case'realm':ue=me[2];break;case'nonce':pe=me[2];break;case'qop':me[2];break;case'host':ce=me[2];}var _e=se.servtype+'/'+se.domain;null!==ce&&(_e=_e+'/'+ce);var fe=Q.utf16to8(se.authcid+':'+ue+':'+this._connection.pass),he=K.hash(fe)+':'+pe+':'+le,ye='AUTHENTICATE:'+_e,Te='';return Te+='charset=utf-8,',Te+='username='+this._quote(Q.utf16to8(se.authcid))+',',Te+='realm='+this._quote(ue)+',',Te+='nonce='+this._quote(pe)+',',Te+='nc=00000001,',Te+='cnonce='+this._quote(le)+',',Te+='digest-uri='+this._quote(_e)+',',Te+='response='+K.hexdigest(K.hexdigest(he)+':'+pe+':00000001:'+le+':auth:'+K.hexdigest(ye))+',',Te+='qop=auth',this.onChallenge=function(){return''},Te},ae.SASLOAuthBearer=function(){},ae.SASLOAuthBearer.prototype=new ae.SASLMechanism('OAUTHBEARER',!0,60),ae.SASLOAuthBearer.prototype.test=function(se){return null!==se.authcid},ae.SASLOAuthBearer.prototype.onChallenge=function(se){var oe='n,a=';return oe+=se.authzid,oe+=',',oe+='\x01',oe+='auth=Bearer ',oe+=se.pass,oe+='\x01',oe+='\x01',Q.utf16to8(oe)},ae.SASLExternal=function(){},ae.SASLExternal.prototype=new ae.SASLMechanism('EXTERNAL',!0,10),ae.SASLExternal.prototype.onChallenge=function(se){return se.authcid===se.authzid?'':se.authzid},{Strophe:ae,$build:Z,$msg:function(se){return new ae.Builder('message',se)},$iq:te,$pres:ne,SHA1:W,Base64:X,MD5:K}}),function(W,X){H=[$],!(Y=function(K){return X(K.Strophe,K.$build)}.apply(h,H))}(this,function(W,X){return W.Request=function(K,Q,Z,ee){this.id=++W._requestId,this.xmlData=K,this.data=W.serialize(K),this.origFunc=Q,this.func=Q,this.rid=Z,this.date=NaN,this.sends=ee||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var te=new Date;return(te-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var te=new Date;return(te-this.dead)/1e3},this.xhr=this._newXHR()},W.Request.prototype={getResponse:function(){var K=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(K=this.xhr.responseXML.documentElement,'parsererror'==K.tagName)throw W.error('invalid response received'),W.error('responseText: '+this.xhr.responseText),W.error('responseXML: '+W.serialize(this.xhr.responseXML)),'parsererror';}else if(this.xhr.responseText)throw W.error('invalid response received'),W.error('responseText: '+this.xhr.responseText),'badformat';return K},_newXHR:function(){var K=null;return window.XMLHttpRequest?(K=new XMLHttpRequest,K.overrideMimeType&&K.overrideMimeType('text/xml; charset=utf-8')):window.ActiveXObject&&(K=new ActiveXObject('Microsoft.XMLHTTP')),K.onreadystatechange=this.func.bind(null,this),K}},W.Bosh=function(K){this._conn=K,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this._requests=[]},W.Bosh.prototype={strip:null,_buildBody:function(){var K=X('body',{rid:this.rid++,xmlns:W.NS.HTTPBIND});return null!==this.sid&&K.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),K},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem('strophe-bosh-session'),this._conn.nextValidRid(this.rid)},_connect:function(K,Q,Z){this.wait=K||this.wait,this.hold=Q||this.hold,this.errors=0;var ee=this._buildBody().attrs({to:this._conn.domain,"xml:lang":'en',wait:this.wait,hold:this.hold,content:'text/xml; charset=utf-8',ver:'1.6',"xmpp:version":'1.0',"xmlns:xmpp":W.NS.BOSH});Z&&ee.attrs({route:Z});var te=this._conn._connect_cb;this._requests.push(new W.Request(ee.tree(),this._onRequestStateChange.bind(this,te.bind(this._conn)),ee.tree().getAttribute('rid'))),this._throttledRequestHandler()},_attach:function(K,Q,Z,ee,te,ne,ae){this._conn.jid=K,this.sid=Q,this.rid=Z,this._conn.connect_callback=ee,this._conn.domain=W.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=te||this.wait,this.hold=ne||this.hold,this.window=ae||this.window,this._conn._changeConnectStatus(W.Status.ATTACHED,null)},_restore:function(K,Q,Z,ee,te){var ne=JSON.parse(window.sessionStorage.getItem('strophe-bosh-session'));if('undefined'!=typeof ne&&null!==ne&&ne.rid&&ne.sid&&ne.jid&&('undefined'==typeof K||null===K||W.getBareJidFromJid(ne.jid)==W.getBareJidFromJid(K)||null===W.getNodeFromJid(K)&&W.getDomainFromJid(ne.jid)==K))this._conn.restored=!0,this._attach(ne.jid,ne.sid,ne.rid,Q,Z,ee,te);else throw{name:'StropheSessionError',message:'_restore: no restoreable session.'}},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem('strophe-bosh-session',JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem('strophe-bosh-session')},_connect_cb:function(K){var Q=K.getAttribute('type'),Z,ee;if(null!==Q&&'terminate'==Q)return Z=K.getAttribute('condition'),W.error('BOSH-Connection failed: '+Z),ee=K.getElementsByTagName('conflict'),null===Z?this._conn._changeConnectStatus(W.Status.CONNFAIL,'unknown'):('remote-stream-error'==Z&&0<ee.length&&(Z='conflict'),this._conn._changeConnectStatus(W.Status.CONNFAIL,Z)),this._conn._doDisconnect(Z),W.Status.CONNFAIL;this.sid||(this.sid=K.getAttribute('sid'));var te=K.getAttribute('requests');te&&(this.window=parseInt(te,10));var ne=K.getAttribute('hold');ne&&(this.hold=parseInt(ne,10));var ae=K.getAttribute('wait');ae&&(this.wait=parseInt(ae,10));var se=K.getAttribute('inactivity');se&&(this.inactivity=parseInt(se,10))},_disconnect:function(K){this._sendTerminate(K)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem('strophe-bosh-session'),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(K){var Q=this._getRequestStatus(K),Z;Z=this._conn.protocolErrorHandlers.HTTP[Q],Z&&Z.call(this,Q)},_hitError:function(K){this.errors++,W.warn('request errored, status: '+K+', number of errors: '+this.errors),4<this.errors&&this._conn._onDisconnectTimeout()},_no_auth_received:function(K){K=K?K.bind(this._conn):this._conn._connect_cb.bind(this._conn);var Q=this._buildBody();this._requests.push(new W.Request(Q.tree(),this._onRequestStateChange.bind(this,K.bind(this._conn)),Q.tree().getAttribute('rid'))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var Q;0<this._requests.length;)Q=this._requests.pop(),Q.abort=!0,Q.xhr.abort(),Q.xhr.onreadystatechange=function(){}},_onIdle:function(){var K=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===K.length&&!this._conn.disconnecting&&(W.info('no requests during idle cycle, sending blank request'),K.push(null)),!this._conn.paused){if(2>this._requests.length&&0<K.length){for(var Q=this._buildBody(),Z=0;Z<K.length;Z++)null!==K[Z]&&('restart'===K[Z]?Q.attrs({to:this._conn.domain,"xml:lang":'en',"xmpp:restart":'true',"xmlns:xmpp":W.NS.BOSH}):Q.cnode(K[Z]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new W.Request(Q.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Q.tree().getAttribute('rid'))),this._throttledRequestHandler()}if(0<this._requests.length){var ee=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(W.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),ee>Math.floor(W.TIMEOUT*this.wait)&&(W.warn('Request '+this._requests[0].id+' timed out, over '+Math.floor(W.TIMEOUT*this.wait)+' seconds since last activity'),this._throttledRequestHandler())}}},_getRequestStatus:function(K,Q){var Z;if(4==K.xhr.readyState)try{Z=K.xhr.status}catch(ee){W.error('Caught an error while retrieving a request\\\'s status, reqStatus: '+Z)}return'undefined'==typeof Z&&(Z='number'==typeof Q?Q:0),Z},_onRequestStateChange:function(K,Q){if(W.debug('request id '+Q.id+'.'+Q.sends+' state changed to '+Q.xhr.readyState),Q.abort)return void(Q.abort=!1);if(4===Q.xhr.readyState){var Z=this._getRequestStatus(Q);if(this.disconnecting&&400<=Z)return this._hitError(Z),void this._callProtocolErrorHandlers(Q);if((0<Z&&500>Z||5<Q.sends)&&(this._removeRequest(Q),W.debug('request id '+Q.id+' should now be removed')),200==Z){var ee=this._requests[0]==Q,te=this._requests[1]==Q;(te||ee&&0<this._requests.length&&this._requests[0].age()>Math.floor(W.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(+Q.rid+1),W.debug('request id '+Q.id+'.'+Q.sends+' got 200'),K(Q),this.errors=0}else 0===Z||400<=Z&&600>Z||12000<=Z?(W.error('request id '+Q.id+'.'+Q.sends+' error '+Z+' happened'),this._hitError(Z),this._callProtocolErrorHandlers(Q),400<=Z&&500>Z&&(this._conn._changeConnectStatus(W.Status.DISCONNECTING,null),this._conn._doDisconnect())):W.error('request id '+Q.id+'.'+Q.sends+' error '+Z+' happened');(!(0<Z&&500>Z)||5<Q.sends)&&this._throttledRequestHandler()}},_processRequest:function(K){var Q=this,Z=this._requests[K],ee=this._getRequestStatus(Z,-1);if(Z.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var te=Z.age(),ne=!isNaN(te)&&te>Math.floor(W.TIMEOUT*this.wait),ae=null!==Z.dead&&Z.timeDead()>Math.floor(W.SECONDARY_TIMEOUT*this.wait),se=4==Z.xhr.readyState&&(1>ee||500<=ee);if((ne||ae||se)&&(ae&&W.error('Request '+this._requests[K].id+' timed out (secondary), restarting'),Z.abort=!0,Z.xhr.abort(),Z.xhr.onreadystatechange=function(){},this._requests[K]=new W.Request(Z.xmlData,Z.origFunc,Z.rid,Z.sends),Z=this._requests[K]),0===Z.xhr.readyState){W.debug('request id '+Z.id+'.'+Z.sends+' posting');try{var oe=this._conn.options.contentType||'text/xml; charset=utf-8';Z.xhr.open('POST',this._conn.service,!this._conn.options.sync),'undefined'!=typeof Z.xhr.setRequestHeader&&Z.xhr.setRequestHeader('Content-Type',oe),this._conn.options.withCredentials&&(Z.xhr.withCredentials=!0)}catch(le){return W.error('XHR open failed.'),this._conn.connected||this._conn._changeConnectStatus(W.Status.CONNFAIL,'bad-service'),void this._conn.disconnect()}var ie=function(){if(Z.date=new Date,Q._conn.options.customHeaders){var le=Q._conn.options.customHeaders;for(var ue in le)le.hasOwnProperty(ue)&&Z.xhr.setRequestHeader(ue,le[ue])}Z.xhr.send(Z.data)};if(1<Z.sends){var de=1e3*Math.min(Math.floor(W.TIMEOUT*this.wait),Math.pow(Z.sends,3));setTimeout(function(){ie()},de)}else ie();Z.sends++,this._conn.xmlOutput!==W.Connection.prototype.xmlOutput&&(Z.xmlData.nodeName===this.strip&&Z.xmlData.childNodes.length?this._conn.xmlOutput(Z.xmlData.childNodes[0]):this._conn.xmlOutput(Z.xmlData)),this._conn.rawOutput!==W.Connection.prototype.rawOutput&&this._conn.rawOutput(Z.data)}else W.debug('_processRequest: '+(0===K?'first':'second')+' request has readyState of '+Z.xhr.readyState)},_removeRequest:function(K){W.debug('removing request');var Q;for(Q=this._requests.length-1;0<=Q;Q--)K==this._requests[Q]&&this._requests.splice(Q,1);K.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(K){var Q=this._requests[K];null===Q.dead&&(Q.dead=new Date),this._processRequest(K)},_reqToData:function(K){try{return K.getResponse()}catch(Q){if('parsererror'!=Q)throw Q;this._conn.disconnect('strophe-parsererror')}},_sendTerminate:function(K){W.info('_sendTerminate was called');var Q=this._buildBody().attrs({type:'terminate'});K&&Q.cnode(K.tree());var Z=new W.Request(Q.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Q.tree().getAttribute('rid'));this._requests.push(Z),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?W.debug('_throttledRequestHandler called with '+this._requests.length+' requests'):W.debug('_throttledRequestHandler called with undefined requests'),this._requests&&0!==this._requests.length&&(0<this._requests.length&&this._processRequest(0),1<this._requests.length&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},W}),function(W,X){H=[$],!(J=function(K){return X(K.Strophe,K.$build)}.apply(h,H))}(this,function(W,X){return W.Websocket=function(K){this._conn=K,this.strip='wrapper';var Q=K.service;if(0!==Q.indexOf('ws:')&&0!==Q.indexOf('wss:')){var Z='';Z+='ws'===K.options.protocol&&'https:'!==window.location.protocol?'ws':'wss',Z+='://'+window.location.host,Z+=0===Q.indexOf('/')?Q:window.location.pathname+Q,K.service=Z}},W.Websocket.prototype={_buildStream:function(){return X('open',{xmlns:W.NS.FRAMING,to:this._conn.domain,version:'1.0'})},_check_streamerror:function(K,Q){var Z;if(Z=K.getElementsByTagNameNS?K.getElementsByTagNameNS(W.NS.STREAM,'error'):K.getElementsByTagName('stream:error'),0===Z.length)return!1;for(var ee=Z[0],te='',ae=0,se;ae<ee.childNodes.length&&(se=ee.childNodes[ae],se.getAttribute('xmlns')==='urn:ietf:params:xml:ns:xmpp-streams');ae++)te='text'===se.nodeName?se.textContent:se.nodeName;var oe='WebSocket stream error: ';return oe+=te?te:'unknown',W.error(oe),this._conn._changeConnectStatus(Q,te),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,'xmpp'),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(K){var Q=this._check_streamerror(K,W.Status.CONNFAIL);if(Q)return W.Status.CONNFAIL},_handleStreamStart:function(K){var Q=!1,Z=K.getAttribute('xmlns');'string'==typeof Z?Z!==W.NS.FRAMING&&(Q='Wrong xmlns in <open />: '+Z):Q='Missing xmlns in <open />';var ee=K.getAttribute('version');return'string'==typeof ee?'1.0'!==ee&&(Q='Wrong version in <open />: '+ee):Q='Missing version in <open />',!Q||(this._conn._changeConnectStatus(W.Status.CONNFAIL,Q),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(K){if(0===K.data.indexOf('<open ')||0===K.data.indexOf('<?xml')){var Q=K.data.replace(/^(<\?.*?\?>\s*)*/,'');if(''===Q)return;var Z=new DOMParser().parseFromString(Q,'text/xml').documentElement;this._conn.xmlInput(Z),this._conn.rawInput(K.data),this._handleStreamStart(Z)&&this._connect_cb(Z)}else if(0===K.data.indexOf('<close ')){this._conn.rawInput(K.data),this._conn.xmlInput(K);var ee=K.getAttribute('see-other-uri');ee?(this._conn._changeConnectStatus(W.Status.REDIRECT,'Received see-other-uri, resetting connection'),this._conn.reset(),this._conn.service=ee,this._connect()):(this._conn._changeConnectStatus(W.Status.CONNFAIL,'Received closing stream'),this._conn._doDisconnect())}else{var te=this._streamWrap(K.data),ne=new DOMParser().parseFromString(te,'text/xml').documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(ne,null,K.data)}},_disconnect:function(K,Q){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED&&(K&&this._conn.send(K),!0!==Q)){var Z=X('close',{xmlns:W.NS.FRAMING});this._conn.xmlOutput(Z);var ee=W.serialize(Z);this._conn.rawOutput(ee);try{this.socket.send(ee)}catch(te){W.info('Couldn\'t send <close /> tag.')}}this._conn._doDisconnect()},_doDisconnect:function(){W.info('WebSockets _doDisconnect was called'),this._closeSocket()},_streamWrap:function(K){return'<wrapper>'+K+'</wrapper>'},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(K){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(K){this._conn.connected&&!this._conn.disconnecting?(W.error('Websocket closed unexpectedly'),this._conn._doDisconnect()):K&&1006===K.code&&!this._conn.connected&&this.socket?(W.error('Websocket closed unexcectedly'),this._conn._changeConnectStatus(W.Status.CONNFAIL,'The WebSocket connection could not be established or was disconnected.'),this._conn._doDisconnect()):W.info('Websocket closed')},_no_auth_received:function(K){W.error('Server did not send any auth methods'),this._conn._changeConnectStatus(W.Status.CONNFAIL,'Server did not send any auth methods'),K&&(K=K.bind(this._conn),K()),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(K){W.error('Websocket error '+K),this._conn._changeConnectStatus(W.Status.CONNFAIL,'The WebSocket connection could not be established or was disconnected.'),this._disconnect()},_onIdle:function(){if(null!==this.socket){var K=this._conn._data;if(0<K.length&&!this._conn.paused){for(var Q=0;Q<K.length;Q++)if(null!==K[Q]){var Z,ee;Z='restart'===K[Q]?this._buildStream().tree():K[Q],ee=W.serialize(Z),this._conn.xmlOutput(Z),this._conn.rawOutput(ee),this.socket.send(ee)}this._conn._data=[]}}},_onMessage:function(K){var ee='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />',Q,Z;if(K.data===ee)return this._conn.rawInput(ee),this._conn.xmlInput(K),void(this._conn.disconnecting||this._conn._doDisconnect());if(0!==K.data.search('<open '))Z=this._streamWrap(K.data),Q=new DOMParser().parseFromString(Z,'text/xml').documentElement;else if(Q=new DOMParser().parseFromString(K.data,'text/xml').documentElement,!this._handleStreamStart(Q))return;return this._check_streamerror(Q,W.Status.ERROR)?void 0:this._conn.disconnecting&&'presence'===Q.firstChild.nodeName&&'unavailable'===Q.firstChild.getAttribute('type')?(this._conn.xmlInput(Q),void this._conn.rawInput(W.serialize(Q))):void this._conn._dataRecv(Q,K.data)},_onOpen:function(){W.info('Websocket open');var K=this._buildStream();this._conn.xmlOutput(K.tree());var Q=W.serialize(K);this._conn.rawOutput(Q),this.socket.send(Q)},_reqToData:function(K){return K},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},W}),function(){H=[$,Y,J],G=function(X){return X}.apply(h,H),!(G!==void 0&&(l.exports=G))}(this)},function(l,h){'use strict';h.a=function(A){const N=A.Strophe;return N.isTagEqual=function(M,I){return(M.tagName||M.node.tagName)===I},N.addConnectionPlugin('streamManagement',{logging:!0,returnWholeStanza:!1,autoSendCountOnEveryIncomingStanza:!1,requestResponseInterval:0,allowResume:!0,_c:null,_NS:'urn:xmpp:sm:3',_isStreamManagementEnabled:!1,_serverProcesssedStanzasCounter:null,_clientProcessedStanzasCounter:null,_clientSentStanzasCounter:null,_originalXMLOutput:null,_requestHandler:null,_incomingHandler:null,_requestResponseIntervalCount:0,_unacknowledgedStanzas:[],_acknowledgedStanzaListeners:[],_counters:{incoming:0,outgoing:0,server:0},addAcknowledgedStanzaListener:function(M){this._acknowledgedStanzaListeners.push(M)},enable:function(M){const I={xmlns:this._NS,resume:this.allowResume};if(M)try{I.max=''+M/1e3}catch(D){console.error(`Couldn't convert '${M}' to milliseconds:`,D)}this._c.send(A.$build('enable',I)),this._c.flush(),this._c.pause()},requestAcknowledgement:function(){this._requestResponseIntervalCount=0,this._c.send(A.$build('r',{xmlns:this._NS}))},getOutgoingCounter:function(){return this._counters.outgoing},getServerProcessedCounter:function(){return this._counters.server},getIncomingCounter:function(){return this._counters.incoming},init:function(M){this._c=M,N.addNamespace('SM',this._NS);const I=localStorage.getItem(this._c.options.instance_id+'_counters');if(null!==I){let D=null;try{D=JSON.parse(I)}catch(L){}null!==D&&(this._counters=D)}this._originalXMLOutput=this._c.xmlOutput,this._c.xmlOutput=this.xmlOutput.bind(this)},statusChanged:function(M,I){(M===N.Status.CONNECTED||M===N.Status.DISCONNECTED)&&(this._requestResponseIntervalCount=0,this._isStreamManagementEnabled=!1,M===N.Status.CONNECTED&&'resumed'!==I&&this._resetCounters(),M===N.Status.CONNECTED&&'resumed'===I&&(this._isStreamManagementEnabled=!0),this._unacknowledgedStanzas=[],this._requestHandler&&this._c.deleteHandler(this._requestHandler),this._incomingHandler&&this._c.deleteHandler(this._incomingHandler),this._requestHandler=this._c.addHandler(this._handleServerRequestHandler.bind(this),this._NS,'r'),this._incomingHandler=this._c.addHandler(this._incomingStanzaHandler.bind(this),null,null))},xmlOutput:function(M){function I(B){return N.isTagEqual(B,'iq')||N.isTagEqual(B,'presence')||N.isTagEqual(B,'message')}if(I(M))this._increaseSentStanzasCounter(M);else if(void 0!==M.children)for(var L=0,D;L<M.children.length;L++)D=M.children[L],I()&&this._increaseSentStanzasCounter(D);return this._originalXMLOutput.call(this._c,M)},_incomingStanzaHandler:function(M){if(N.isTagEqual(M,'enabled')&&M.getAttribute('xmlns')===this._NS&&(this._isStreamManagementEnabled=!0,this._c.resume()),(N.isTagEqual(M,'iq')||N.isTagEqual(M,'presence')||N.isTagEqual(M,'message'))&&(this._increaseReceivedStanzasCounter(),this.autoSendCountOnEveryIncomingStanza&&this._answerProcessedStanzas(),N.isTagEqual(M,'message')&&'error'===M.getAttribute('type')&&--this._counters.outgoing),N.isTagEqual(M,'a')){var I=parseInt(M.getAttribute('h'));this._handleAcknowledgedStanzas(I,this._counters.server),this._counters.server=I,this._persistCounters(),0<this.requestResponseInterval&&(this._requestResponseIntervalCount=0)}return!0},_handleAcknowledgedStanzas:function(M,I){var D=M-I;0>D&&this._throwError('New reported stanza count lower than previous. New: '+M+' - Previous: '+I),D>this._unacknowledgedStanzas.length&&this._throwError('Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledge Count: '+D+' - Unacknowledge Stanza Count: '+this._unacknowledgedStanzas.length+' - New: '+M+' - Previous: '+I);for(var L=0,B;L<D;L++){B=this._unacknowledgedStanzas.shift();for(var H=0;H<this._acknowledgedStanzaListeners.length;H++)this._acknowledgedStanzaListeners[H](B)}this.logging&&0<this._unacknowledgedStanzas.length&&console.warn('Unacknowledged stanzas',this._unacknowledgedStanzas)},_handleServerRequestHandler:function(){return this._answerProcessedStanzas(),!0},_answerProcessedStanzas:function(M){(this._isStreamManagementEnabled||!0===M)&&this._c.send(A.$build('a',{xmlns:this._NS,h:this._counters.incoming}))},_increaseSentStanzasCounter:function(M){this._isStreamManagementEnabled&&(this._unacknowledgedStanzas.push(this.returnWholeStanza?M:M.getAttribute('id')),this._counters.outgoing++,this._persistCounters(),0<this.requestResponseInterval&&(this._requestResponseIntervalCount++,this._requestResponseIntervalCount===this.requestResponseInterval&&this.requestAcknowledgement()))},_increaseReceivedStanzasCounter:function(){this._isStreamManagementEnabled&&(this._counters.incoming++,this._persistCounters())},_persistCounters:function(){localStorage.setItem(this._c.options.instance_id+'_counters',JSON.stringify(this._counters))},_resetCounters:function(){this._counters={incoming:0,outgoing:0,server:0},this._persistCounters()},_throwError:function(M){console.error(M)}}),A}},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(36),A=E(18);h.UsersDirectory=class{constructor(M,I=!1){this._instanceId=null,this._worker=null,this._debug=!1,this._db=null,this._dbName=null,this.initialised=!1,this._workerResponseListeners={},this._instanceId=M,this._debug=I,this._dbName=`${M}_user_index`}_onWorkerResponse(M){if(M.data&&this._debug&&console.log(`Worker: ${M.data.msg}`),M.data._id){const I=this._workerResponseListeners[M.data._id];if(!I)return;const D=I(M.data);!0!==D&&delete this._workerResponseListeners[M.data._id]}else switch(M.data.action){case'store-record':const I=this._db.transaction([this._dbName],'readwrite');I.oncomplete=()=>{this._postMessageToWorker({action:'store-record-response',success:!0,key:M.data.key})},I.onerror=(L)=>{console.error(`Failed to put '${M.data.key}'.`),this._postMessageToWorker({key:M.data.key,action:'store-record-response',success:!1,msg:L.toString()})},I.objectStore(this._dbName).put(M.data.record,M.data.key);break;case'retrieve-record':const D=this._db.transaction([this._dbName]).objectStore(this._dbName).get(M.data.key);D.onsuccess=()=>{this._postMessageToWorker({action:'retrieve-record-response',success:!0,key:M.data.key,record:D.result})},D.onerror=(L)=>{console.error(`Failed to get ${M.data.key}:`,L),this._postMessageToWorker({key:M.data.key,action:'retrieve-record-response',success:!1,msg:L.toString(),record:null})};}}_postMessageToWorker(M,I){if(null===this._worker)throw new Error('Worker has not been initialised!');const D=A.generateGuid();I&&(this._workerResponseListeners[D]=I),this._worker.postMessage(Object.assign({},M,{_id:D}))}initialise(M,I){return new Promise((D,L)=>{const B=indexedDB.open(this._dbName);B.onupgradeneeded=(H)=>{H.target.result.createObjectStore(this._dbName)},B.onerror=(H)=>{console.error('Couldn\'t open IndexedDB database.',H)},B.onsuccess=(H)=>{this._db=H.target.result,this._worker=new Worker(window.URL.createObjectURL(new Blob([`const start = ${R.default.toString()}; start.call(self);`],{type:'text/javascript'}))),this._worker.onmessage=this._onWorkerResponse.bind(this),this._postMessageToWorker({action:'initialise',instanceId:this._instanceId,key:M,iv:I,debug:this._debug},(z)=>{return!0===z.success?(this.initialised=!0,D(z.msg)):(console.error(z.msg),this.initialised=!1,this.destroy(!0).then(()=>{L(z.msg)})),!1})}})}update(M,I,D){if(!0!==this.initialised)throw new Error('User index must be initialised first.');return new Promise((L,B)=>{this._postMessageToWorker({action:'fetch',endpoint:D,jid:M,pass:I},(H)=>{return!0===H.success?L(H):(console.error(H.msg),B(H.msg)),!1})})}search(M,I){if(!0!==this.initialised)throw new Error('User index must be initialised first.');return new Promise((D,L)=>{this._postMessageToWorker({action:'search',query:M,fields:I||[]},(B)=>{return!0===B.success?D(B.results):(console.error(B.msg),L(B.msg)),!1})})}getUserByJid(M){if(!0!==this.initialised)throw new Error('User index must be initialised first.');return new Promise((I,D)=>{this._postMessageToWorker({action:'jid-search',jid:M},(L)=>{return!0===L.success?I(L.result):(console.error(L.msg),D(L.msg)),!1})})}getAllUsers(M=!1){if(!0!==this.initialised)throw new Error('User index must be initialised first.');return new Promise((I,D)=>{this._postMessageToWorker({action:'get-all-users'},(L)=>{return!0===L.success?M?I(L.results.filter((B)=>!B.deleted)):I(L.results):(console.error(L.msg),D(L.msg)),!1})})}getUsersInGroups(M,I){if(!0!==this.initialised)throw new Error('User index must be initialised first.');return new Promise((D,L)=>{this._postMessageToWorker({action:'get-users-in-groups',groupNames:M,sep:I},(B)=>{return!0===B.success?D(B.results):(console.error(B.msg),L(B.msg)),!1})})}destroy(M=!1){if(!0!==this.initialised&&!1===M)throw new Error('User index must be initialised first.');return new Promise((I,D)=>{this._db.close();const L=indexedDB.deleteDatabase(this._dbName);L.onerror=()=>{D('Error deleting user directory database.')},L.onsuccess=()=>{this._db=null,this.initialised=!1,I()},L.onblocked=()=>{D('Couldn\'t delete user directory database due to the operation being blocked.')}})}static _resolvePath(M){return M?0===M.indexOf('http')||0===M.indexOf('//')?M:0===M.indexOf('/')?window.location.origin+M:`${window.location.origin}/${M}`:null}}},function(l,h,E){'use strict';function R(se){return-1!==se.indexOf('.')&&(se=se.split('.').pop().toLowerCase()),ae.hasOwnProperty(se)?ae[se].mimeType:null}function A(se){return-1!==se.indexOf('.')&&(se=se.split('.').pop().toLowerCase()),ae.hasOwnProperty(se)?ae[se].mediaType:null}function N(se){const oe=Object.keys(ae).filter((ie)=>ae[ie].mimeType===se)[0];return oe?ae[oe].mediaType:null}function M(se){return se.replace(/\\/g,'/').split('/').pop()}function I(){return new W.Promise((se,oe)=>{if(X.isElectron())try{const ie=Q.require('electron').remote.app,de=Q.require('path'),le=de.sep,ue=ie.getPath('userData'),ce=ue+le+te+le,pe=Q.require('fs');pe.existsSync(ce)||pe.mkdirSync(ce),se(ce)}catch(ie){oe(ie)}else{const ie=X.getPlatformName(),de=K.getSource('file');if(!1!==de){let le='';if('ios'===ie)le+=de.documentsDirectory;else if('android'===ie)le+=de.dataDirectory;else return oe('Unsupported platform, expected Android or iOS.');Z.resolveLocalFileSystemURL(le,function(ue){ue.getDirectory(te,{create:!0,exclusive:!1},function(ce){se(ce.nativeURL)},oe)},oe)}else oe('No file plugin available.')}})}function z(se){return new W.Promise((oe)=>{const de=new XMLHttpRequest;de.open('GET',se,!0),de.responseType='blob',de.onload=()=>{200===de.status&&oe(de.response)},de.send()})}Object.defineProperty(h,'__esModule',{value:!0});const W=E(21),X=E(14),K=E(15),Q=window,Z=window;let ee=null;const te='attachments',ne={IMAGE:'image',AUDIO:'audio',VIDEO:'video'},ae={a:{mimeType:'application/octet-stream',mediaType:null},ai:{mimeType:'application/postscript',mediaType:null},aif:{mimeType:'audio/x-aiff',mediaType:ne.AUDIO},aifc:{mimeType:'audio/x-aiff',mediaType:ne.AUDIO},aiff:{mimeType:'audio/x-aiff',mediaType:ne.AUDIO},au:{mimeType:'audio/basic',mediaType:ne.AUDIO},avi:{mimeType:'video/x-msvideo',mediaType:null},bat:{mimeType:'text/plain',mediaType:null},bin:{mimeType:'application/octet-stream',mediaType:null},bmp:{mimeType:'image/x-ms-bmp',mediaType:ne.IMAGE},c:{mimeType:'text/plain',mediaType:null},cdf:{mimeType:'application/x-cdf',mediaType:null},csh:{mimeType:'application/x-csh',mediaType:null},css:{mimeType:'text/css',mediaType:null},dll:{mimeType:'application/octet-stream',mediaType:null},doc:{mimeType:'application/msword',mediaType:null},docm:{mimeType:'application/vnd.ms-word.document.macroEnabled.12',mediaType:null},docx:{mimeType:'application/vnd.openxmlformats-officedocument.wordprocessingml.document',mediaType:null},dot:{mimeType:'application/msword',mediaType:null},dotx:{mimeType:'application/vnd.openxmlformats-officedocument.wordprocessingml.template',mediaType:null},dvi:{mimeType:'application/x-dvi',mediaType:null},eml:{mimeType:'message/rfc822',mediaType:null},eps:{mimeType:'application/postscript',mediaType:null},etx:{mimeType:'text/x-setext',mediaType:null},exe:{mimeType:'application/octet-stream',mediaType:null},gif:{mimeType:'image/gif',mediaType:ne.IMAGE},gtar:{mimeType:'application/x-gtar',mediaType:null},h:{mimeType:'text/plain',mediaType:null},hdf:{mimeType:'application/x-hdf',mediaType:null},htm:{mimeType:'text/html',mediaType:null},html:{mimeType:'text/html',mediaType:null},jpe:{mimeType:'image/jpe',mediaType:ne.IMAGE},jpeg:{mimeType:'image/jpeg',mediaType:ne.IMAGE},jpg:{mimeType:'image/jpeg',mediaType:ne.IMAGE,preferred:!0},js:{mimeType:'application/javascript',mediaType:null},json:{mimeType:'application/json',mediaType:null},ksh:{mimeType:'text/plain',mediaType:null},latex:{mimeType:'application/x-latex',mediaType:null},m1v:{mimeType:'video/mpeg',mediaType:ne.VIDEO},m4a:{mimeType:'audio/mpeg',mediaType:ne.AUDIO,preferred:!0},man:{mimeType:'application/x-troff-man',mediaType:null},me:{mimeType:'application/x-troff-me',mediaType:null},mht:{mimeType:'message/rfc822',mediaType:null},mhtml:{mimeType:'message/rfc822',mediaType:null},mif:{mimeType:'application/x-mif',mediaType:null},mov:{mimeType:'video/quicktime',mediaType:ne.VIDEO},movie:{mimeType:'video/x-sgi-movie',mediaType:ne.VIDEO},mp2:{mimeType:'audio/mpeg',mediaType:ne.AUDIO},mp3:{mimeType:'audio/mp3',mediaType:ne.AUDIO},mp4:{mimeType:'video/mp4',mediaType:ne.VIDEO},mpa:{mimeType:'video/mpeg',mediaType:ne.VIDEO},mpe:{mimeType:'video/mpeg',mediaType:ne.VIDEO},mpeg:{mimeType:'video/mpeg',mediaType:ne.VIDEO},mpg:{mimeType:'video/mpeg',mediaType:ne.VIDEO,preferred:!0},ms:{mimeType:'application/x-troff-ms',mediaType:null},nc:{mimeType:'application/x-netcdf',mediaType:null},nws:{mimeType:'message/rfc822',mediaType:null},o:{mimeType:'application/octet-stream',mediaType:null},obj:{mimeType:'application/octet-stream',mediaType:null},oda:{mimeType:'application/oda',mediaType:null},otf:{mimeType:'application/x-font-opentype',mediaType:null},pbm:{mimeType:'image/x-portable-bitmap',mediaType:ne.IMAGE},pdf:{mimeType:'application/pdf',mediaType:null},pfx:{mimeType:'application/x-pkcs12',mediaType:null},pgm:{mimeType:'image/x-portable-graymap',mediaType:ne.IMAGE},png:{mimeType:'image/png',mediaType:ne.IMAGE},pnm:{mimeType:'image/x-portable-anymap',mediaType:ne.IMAGE},po:{mimeType:'text/x-gettext-translation',mediaType:null},pot:{mimeType:'application/vnd.ms-powerpoint',mediaType:null},ppa:{mimeType:'application/vnd.ms-powerpoint',mediaType:null},ppm:{mimeType:'image/x-portable-pixmap',mediaType:ne.IMAGE},pps:{mimeType:'application/vnd.ms-powerpoint',mediaType:null},ppt:{mimeType:'application/vnd.ms-powerpoint',mediaType:null},pptm:{mimeType:'application/vnd.ms-powerpoint.presentation.macroEnabled.12',mediaType:null},pptx:{mimeType:'application/vnd.openxmlformats-officedocument.presentationml.presentation',mediaType:null},ps:{mimeType:'application/postscript',mediaType:null},pwz:{mimeType:'application/vnd.ms-powerpoint',mediaType:null},py:{mimeType:'text/x-python',mediaType:null},pyc:{mimeType:'application/x-python-code',mediaType:null},pyo:{mimeType:'application/x-python-code',mediaType:null},qt:{mimeType:'video/quicktime',mediaType:ne.VIDEO},ra:{mimeType:'audio/x-pn-realaudio',mediaType:ne.AUDIO},ram:{mimeType:'application/x-pn-realaudio',mediaType:ne.AUDIO},ras:{mimeType:'image/x-cmu-raster',mediaType:ne.IMAGE},rdf:{mimeType:'application/xml',mediaType:null},rgb:{mimeType:'image/x-rgb',mediaType:ne.IMAGE},roff:{mimeType:'application/x-troff',mediaType:null},rtx:{mimeType:'text/richtext',mediaType:null},sgm:{mimeType:'text/x-sgml',mediaType:null},sgml:{mimeType:'text/x-sgml',mediaType:null},sh:{mimeType:'application/x-sh',mediaType:null},shar:{mimeType:'application/x-shar',mediaType:null},snd:{mimeType:'audio/basic',mediaType:ne.AUDIO},so:{mimeType:'application/octet-stream',mediaType:null},src:{mimeType:'application/x-wais-source',mediaType:null},svg:{mimeType:'image/svg+xml',mediaType:ne.IMAGE},swf:{mimeType:'application/x-shockwave-flash',mediaType:null},t:{mimeType:'application/x-troff',mediaType:null},tar:{mimeType:'application/x-tar',mediaType:null},tcl:{mimeType:'application/x-tcl',mediaType:null},tex:{mimeType:'application/x-tex',mediaType:null},texi:{mimeType:'application/x-texinfo',mediaType:null},texinfo:{mimeType:'application/x-texinfo',mediaType:null},tif:{mimeType:'image/tiff',mediaType:ne.IMAGE},tiff:{mimeType:'image/tiff',mediaType:ne.IMAGE},tr:{mimeType:'application/x-troff',mediaType:null},tsv:{mimeType:'text/tab-separated-values',mediaType:null},ttf:{mimeType:'application/x-font-truetype',mediaType:null},txt:{mimeType:'text/plain',mediaType:null,preferred:!0},ustar:{mimeType:'application/x-ustar',mediaType:null},vcf:{mimeType:'text/x-vcard',mediaType:null},wav:{mimeType:'audio/x-wav',mediaType:ne.AUDIO},woff:{mimeType:'application/font-woff',mediaType:null,preferred:!0},woff2:{mimeType:'application/font-woff',mediaType:null},wsdl:{mimeType:'application/xml',mediaType:null},xbm:{mimeType:'image/x-xbitmap',mediaType:ne.IMAGE},xlb:{mimeType:'application/vnd.ms-excel',mediaType:null},xls:{mimeType:'application/vnd.ms-excel',mediaType:null},xlsm:{mimeType:'application/vnd.ms-excel.sheet.macroEnabled.12',mediaType:null},xlsx:{mimeType:'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',mediaType:null},xml:{mimeType:'text/xml',mediaType:null},xpdl:{mimeType:'application/xml',mediaType:null},xpm:{mimeType:'image/x-xpixmap',mediaType:ne.IMAGE},xsl:{mimeType:'application/xml',mediaType:null},xwd:{mimeType:'image/x-xwindowdump',mediaType:ne.IMAGE},zip:{mimeType:'application/zip',mediaType:null}};h.getMimeTypeFromExtension=R,h.getMediaTypeFromExtension=A,h.getMediaTypeFromMimeType=N,h.getFileNameFromPath=M,h.upload=function(se,oe,ie,de){return new W.Promise((le,ue)=>{if(null==ee&&(ee=X.isElectron()?K.getSource('@commontimeltd/com.commontime.filetransfer'):K.getSource('FileTransfer')),!1!==ee){const ce={httpMethod:'PUT',fileName:M(se),fileKey:'file',headers:de,mimeType:R(se),chunkedMode:!1},pe=new ee;pe.upload(se,oe,(ge)=>{le({source:se,target:oe,response:ge.response})},ue,ce)}else console.warn('Falling back to using XHR for file uploads.'),z(se).then((ce)=>{const pe=new XMLHttpRequest;if(pe.addEventListener('load',(ge)=>{le({source:ie,target:oe,response:ge})}),pe.addEventListener('error',ue),pe.open('PUT',oe,!0),de)for(let ge in de)pe.setRequestHeader(ge,de[ge]);pe.send(ce)})})},h.download=function(se,oe=null){return new W.Promise((ie,de)=>{null===ee&&(ee=X.isElectron()?K.getSource('@commontimeltd/com.commontime.filetransfer'):K.getSource('FileTransfer')),!1===ee?ie({source:se,target:se}):I().then((le)=>{const ue=new ee,ce=le+Date.now()+'_'+M(se),pe=(me)=>{X.isElectron()?ie({source:me.filePath,target:se}):X.isDevice()?ie({source:me.nativeURL,target:se}):(console.warn('Attachments are not currently supported on this platform.'),de())},ge=(me)=>{console.error(`Unable to download file '${ce}' from '${se}':`,me),de(me)};X.isDevice()?ue.download(se,ce,pe,ge,!1,{headers:oe}):ue.download(se,ce,pe,ge,{headers:oe})}).catch(de)})},h.getFileInfo=function(se){return new W.Promise((oe,ie)=>{if(X.isElectron())try{const de=Q.require('fs-plus');de.stat(se,(le,ue)=>{le?ie(le):oe({name:M(se),path:se,size:ue.size,type:R(se),mediaType:A(se)})})}catch(de){ie('Couldn\'t require \'fs-plus\' module.')}else if(X.isDevice()){const de=0===se.indexOf('file://')?se:`file://${se}`;Z.resolveLocalFileSystemURL(de,function(le){le.file(function(ue){const ce=ue.type?ue.type:R(se);oe({name:ue.name,path:de,size:ue.size,type:ce,mediaType:A(se)})})},ie)}else z(se).then((de)=>{oe({name:se.split('/').pop(),path:se,size:de.size,type:de.type,mediaType:N(de.type)})})})},h.deleteFile=function(se){return new W.Promise((oe,ie)=>{if(X.isElectron())try{const de=Q.require('fs-plus'),le=de.existsSync(se);le?(de.unlinkSync(se),oe()):ie(`File '${se}' doesn't exist and cannot be deleted.`)}catch(de){ie(`Something went wrong while trying to delete the file '${se}': ${de}`)}else X.isDevice()?Z.resolveLocalFileSystemURL(se,(de)=>{de.isDirectory?ie(`File path '${se}' is a directory and cannot be deleted.`):de.remove(oe,ie)},(de)=>{ie(de)}):oe()})},h.urlToBlob=z,h.blobToObjectUrl=function(se){return new W.Promise((oe)=>{oe(URL.createObjectURL(se))})},h.deleteAttachments=function(){return new W.Promise((se,oe)=>{if(X.isElectron()){const ie=Q.require('path'),de=Q.require('fs'),le=Q.require('electron').remote.app.getPath('userData'),ue=ie.sep,ce=le+ue+te+ue;if(!de.existsSync(ce))return se();de.readdir(ce,(pe,ge)=>{if(pe)return oe(pe);for(const me of ge)de.lstatSync(ie.join(ce,me)).isFile()&&de.unlinkSync(ie.join(ce,me));se()})}else if(X.isDevice()){const ie=X.getPlatformName(),de=K.getSource('file');if(!1!==de){let le=null;'ios'===ie?le=de.documentsDirectory:'android'===ie&&(le=de.dataDirectory),null===le?oe('Unsupported platform, expected Android or iOS.'):Z.resolveLocalFileSystemURL(le,(ue)=>{ue.getDirectory(te,{create:!1,exclusive:!1},function(ce){ce.removeRecursively(se,oe)},function(ce){1===ce.code?se():(console.error(`Couldn't get '${te}' to delete:`,ce),oe(ce))})},function(ue){oe(ue)})}else oe('No file plugin available.')}else se()})},h.pickFile=function(se){return new W.Promise((oe,ie)=>{let de=[],le=['*'],ue='All Files';if(void 0===se.mediaType?void 0!==se.mimeTypes&&(de=se.mimeTypes,le=Object.keys(ae).filter((ce)=>0<=de.indexOf(ae[ce].mimeType))):(le=Object.keys(ae).filter((ce)=>ae[ce].mediaType===se.mediaType),de=le.map((ce)=>{return ae[ce].mimeType}),ue=se.mediaType),X.isElectron()){const ce=Q.require('electron').remote.dialog;ce.showOpenDialog({properties:['openFile','multiSelections'],filters:[{name:ue,extensions:le}]},(pe)=>{const ge=Q.require('path'),me=Q.require('fs'),_e=Q.require('electron').remote.app.getPath('userData'),fe=ge.sep,he=_e+fe+te+fe;me.existsSync(he)||me.mkdirSync(he);const ye=[];pe.forEach((Te)=>{ye.push(new W.Promise((Ce,be)=>{const Se=ge.join(he,Date.now()+'_'+ge.basename(Te)),Ee=(Pe)=>{console.error(`A problem occurred when trying to copy the file '${Te}' to '${Se}'.`,Pe),be(Pe)},ve=me.createReadStream(Te);ve.on('error',Ee);const Re=me.createWriteStream(Se);Re.on('error',Ee),Re.on('close',()=>{Ce(Se)}),ve.pipe(Re)}))}),W.Promise.all(ye).then(oe).catch(ie)})}else if(X.isDevice()){const ce=X.getPlatformName(),pe=K.getSource('file');if(!1!==pe){let ge=null;'ios'===ce?ge=pe.documentsDirectory:'android'===ce&&(ge=pe.dataDirectory),null===ge?ie('Unsupported platform, expected Android or iOS.'):Z.resolveLocalFileSystemURL(ge,(me)=>{me.getDirectory(te,{create:!0,exclusive:!1},()=>{const fe=K.getSource('fileimporter');null===fe?ie('File importer plugin not available.'):fe.importFile((he)=>{oe([he])},ie,void 0,de,te)},ie)},ie)}else ie('No file plugin available.')}else{const ce=document.createElement('input');ce.setAttribute('type','file'),ce.setAttribute('multiple','multiple'),ce.addEventListener('change',()=>{const pe=[];for(let ge=0;ge<ce.files.length;ge++)pe.push(URL.createObjectURL(ce.files[ge]));oe(pe)}),ce.click()}})},h.getFileSize=function(se){return new W.Promise((oe,ie)=>{if(se&&-1!==se.name.indexOf('.encrypted')){const de=K.getSource('fileEncryption');de?de.getFileSize((le)=>{try{oe(parseInt(le))}catch(ue){console.error('Couldn\'t convert file size to an integer.'),ie(ue)}},ie,se.path):oe(se.size)}else oe(se.size)})}},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});class R{constructor(A,N,M,I=!0){this._id=null,this._timeout=-1,this._startTime=-1,this._totalTimeRun=-1,this._complete=!1,this._duration=-1,this._callback=null,this._paused=!1,this._pauseable=!1,this._id=A,this._duration=M,this._callback=N,this._startTime=new Date().getTime(),this._timeout=setTimeout(this._callback,this._duration),this._pauseable=!1!==I}_timeDiff(A){return new Date().getTime()-A}cancel(){clearTimeout(this._timeout),this._paused=!1}pause(){clearTimeout(this._timeout),this._totalTimeRun=this._timeDiff(this._startTime),this._complete=this._totalTimeRun>=this._duration,this._complete||(this._paused=!0)}resume(){this._paused=!1,this._timeout=this._complete?-1:setTimeout(this._callback,this._duration-this._totalTimeRun)}end(){this._paused=!1,clearTimeout(this._timeout),this._callback()}restart(){this._paused=!1,this._startTime=new Date().getTime(),this._timeout=setTimeout(this._callback,this._duration)}get paused(){return this._paused}get pauseable(){return this._pauseable}get id(){return this._id}}h.default=R},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});class R{constructor(){this.nsResolve=function(A){return'vc'==A?'vcard-temp':null},this.json={}}static fromXml(A){const N=new R;try{N.initFromXML(A)}catch(M){return console.error('Bad vCard: '+M),void 0}return N}static fromJSON(A){const N=new R;return N.initFromJSON(A),N}_extractEmail(A){const N={};return'string'==typeof A.USERID&&(N.address=A.USERID),A.HOME&&(N.home=!0),A.WORK&&(N.work=!0),A.INTERNET&&(N.internet=!0),A.PREF&&(N.pref=!0),A.X400&&(N.x400=!0),N}_extractTelephone(A){const N={};return'string'==typeof A.NUMBER&&(N.number=A.NUMBER),A.HOME&&(N.home=!0),A.WORK&&(N.work=!0),A.VOICE&&(N.voice=!0),A.FAX&&(N.fax=!0),A.PAGER&&(N.pager=!0),A.MSG&&(N.msg=!0),A.CELL&&(N.cell=!0),A.VIDEO&&(N.video=!0),A.BBS&&(N.bbs=!0),A.MODEM&&(N.modem=!0),A.ISDN&&(N.isdn=!0),A.PCS&&(N.pcs=!0),A.PREF&&(N.pref=!0),N}_extractAddress(A){const N={};return'string'==typeof A.POBOX&&(N.poBox=A.POBOX),'string'==typeof A.EXTADD&&(N.extraAddress=A.EXTADD),'string'==typeof A.STREET&&(N.street=A.STREET),'string'==typeof A.LOCALITY&&(N.locality=A.LOCALITY),'string'==typeof A.REGION&&(N.locality=A.REGION),'string'==typeof A.PCODE&&(N.locality=A.PCODE),'string'==typeof A.CTRY&&(N.locality=A.CTRY),A.WORK&&(N.work=!0),A.HOME&&(N.home=!0),A.POSTAL&&(N.postal=!0),A.PARCEL&&(N.parcel=!0),A.DOM&&(N.dom=!0),A.INTL&&(N.intl=!0),A.PREF&&(N.pref=!0),N}initFromXML(A){const N={};'string'==typeof A.VERSION&&(N.version=A.VERSION),'string'==typeof A.FN&&(N.fullName=A.FN),'object'!=typeof A.N||Array.isArray(A.N)||(N.name={},'string'==typeof A.N.FAMILY&&(N.name.family=A.N.FAMILY),'string'==typeof A.N.GIVEN&&(N.name.given=A.N.GIVEN),'string'==typeof A.N.MIDDLE&&(N.name.middle=A.N.MIDDLE),'string'==typeof A.N.PREFIX&&(N.name.prefix=A.N.PREFIX),'string'==typeof A.N.SUFFIX&&(N.name.suffix=A.N.SUFFIX)),'string'==typeof A.NICKNAME&&(N.nickName=A.NICKNAME),'object'!=typeof A.PHOTO||Array.isArray(A.PHOTO)||(N.photo={},'string'==typeof A.PHOTO.TYPE&&(N.photo.type=A.PHOTO.TYPE),'string'==typeof A.PHOTO.BINVAL&&(N.photo.binval=A.PHOTO.BINVAL)),'string'==typeof A.BDAY&&(N.birthday=A.BDAY),'object'==typeof A.ADR&&(N.address=[],Array.isArray(A.ADR)?A.ADR.forEach((M)=>{N.address.push(this._extractAddress(M))}):N.address.push(this._extractAddress(A.ADR))),'object'==typeof A.TEL&&(N.telephone=[],Array.isArray(A.TEL)?A.TEL.forEach((M)=>{N.telephone.push(this._extractTelephone(M))}):N.telephone.push(this._extractTelephone(A.TEL))),'object'==typeof A.EMAIL&&(N.email=[],Array.isArray(A.EMAIL)?A.EMAIL.forEach((M)=>{N.email.push(this._extractEmail(M))}):N.email.push(this._extractEmail(A.EMAIL))),'string'==typeof A.JABBERID&&(N.jabberId=A.JABBERID),'string'==typeof A.MAILER&&(N.mailer=A.MAILER),'string'==typeof A.TZ&&(N.timeZone=A.TZ),'object'!=typeof A.GEO||Array.isArray(A.GEO)||(N.geolocation={},'string'==typeof A.GEO.LAT&&(N.geolocation.lat=A.GEO.LAT),'string'==typeof A.GEO.LON&&(N.geolocation.lng=A.N.GIVEN)),'string'==typeof A.TITLE&&(N.title=A.TITLE),'string'==typeof A.ROLE&&(N.role=A.ROLE),'object'!=typeof A.LOGO||Array.isArray(A.LOGO)||(N.logo={},'string'==typeof A.LOGO.TYPE&&(N.logo.type=A.PHOTO.TYPE),'string'==typeof A.PHOTO.BINVAL&&(N.logo.binval=A.PHOTO.BINVAL),'string'==typeof A.PHOTO.EXTVAL&&(N.logo.extval=A.PHOTO.EXTVAL)),'object'!=typeof A.AGENT||Array.isArray(A.AGENT)||(N.agent={},'string'==typeof A.AGENT.EXTVAL&&(N.agent.extval=A.AGENT.EXTVAL)),'object'!=typeof A.ORG||Array.isArray(A.ORG)||(N.organisation={},'string'==typeof A.ORG.ORGNAME&&(N.organisation.name=A.ORG.ORGNAME),'string'==typeof A.ORG.ORGUNIT&&(N.organisation.unit=A.ORG.ORGUNIT)),'object'==typeof A.CATEGORIES&&(N.categories=[],Array.isArray(A.CATEGORIES)?A.CATEGORIES.forEach((M)=>{N.categories.push({keyword:M.KEYWORD})}):N.telephone.push({keyword:A.CATEGORIES.KEYWORD})),'string'==typeof A.NOTE&&(N.note=A.NOTE),'string'==typeof A.PRODID&&(N.prodid=A.PRODID),'string'==typeof A.REV&&(N.rev=A.REV),'string'==typeof A['SORT-STRING']&&(N.sortString=A['SORT-STRING']),'object'!=typeof A.SOUND||Array.isArray(A.SOUND)||(N.sound={},'string'==typeof A.SOUND.PHONETIC&&(N.sound.phonetic=A.SOUND.PHONETIC),'string'==typeof A.SOUND.BINVAL&&(N.sound.binval=A.SOUND.BINVAL),'string'==typeof A.SOUND.EXTVAL&&(N.sound.extval=A.SOUND.EXTVAL)),'string'==typeof A.UID&&(N.uid=A.UID),'string'==typeof A.URL&&(N.url=A.URL),'string'==typeof A.DESC&&(N.description=A.DESC),'object'!=typeof A.CLASS||Array.isArray(A.CLASS)||(A.CLASS.PUBLIC&&(N.classification='public'),A.CLASS.PRIVATE&&(N.classification='private'),A.CLASS.CONFIDENTIAL&&(N.classification='confidential')),'object'!=typeof A.KEY||Array.isArray(A.KEY)||(N.key={},'string'==typeof A.KEY.CRED&&(N.key.credential=A.KEY.CRED),'string'==typeof A.KEY.TYPE&&(N.key.type=A.KEY.TYPE)),this.json=N}initFromJSON(A){this.json=A}toJSON(){return this.json}toXML(A){const N=new DOMParser().parseFromString('<vCard xmlns="vcard-temp"/>','text/xml'),M=N.firstElementChild;if(this.json.fullName&&this.addNode(M,'FN',this.json.fullName),this.json.name){const D=this.addNode(M,'N');this.json.name.family&&this.addNode(D,'FAMILY',this.json.name.family),this.json.name.given&&this.addNode(D,'GIVEN',this.json.name.given),this.json.name.middle&&this.addNode(D,'MIDDLE',this.json.name.middle),this.json.name.prefix&&this.addNode(D,'PREFIX',this.json.name.prefix),this.json.name.suffix&&this.addNode(D,'SUFFIX',this.json.name.suffix)}if(this.json.nickName&&this.addNode(M,'NICKNAME',this.json.nickName),this.json.photo){const D=this.addNode(M,'PHOTO');this.json.photo.type&&this.addNode(D,'TYPE',this.json.photo.type),this.json.photo.binval&&this.addNode(D,'BINVAL',this.json.photo.binval)}if(this.json.birthday&&this.addNode(M,'BDAY',this.json.birthday),this.json.address&&this.json.address.forEach((D)=>{const L=this.addNode(M,'ADR');D.home&&this.addNode(L,'HOME'),D.work&&this.addNode(L,'WORK'),D.postal&&this.addNode(L,'POSTAL'),D.parcel&&this.addNode(L,'PARCEL'),D.dom&&this.addNode(L,'DOM'),D.intl&&this.addNode(L,'INTL'),D.pref&&this.addNode(L,'PREF'),D.poBox&&this.addNode(L,'POBOX',D.poBox),D.extraAddress&&this.addNode(L,'EXTADD',D.extraAddress),D.street&&this.addNode(L,'STREET',D.street),D.locality&&this.addNode(L,'LOCALITY',D.locality),D.region&&this.addNode(L,'REGION',D.region),D.postcode&&this.addNode(L,'PCODE',D.postcode),D.country&&this.addNode(L,'CTRY',D.country)}),this.json.telephone&&this.json.telephone.forEach((D)=>{const L=this.addNode(M,'TEL');D.home&&this.addNode(L,'HOME'),D.work&&this.addNode(L,'WORK'),D.voice&&this.addNode(L,'VOICE'),D.fax&&this.addNode(L,'FAX'),D.pager&&this.addNode(L,'PAGER'),D.msg&&this.addNode(L,'MSG'),D.cell&&this.addNode(L,'CELL'),D.video&&this.addNode(L,'VIDEO'),D.bbs&&this.addNode(L,'BBS'),D.modem&&this.addNode(L,'MODEM'),D.isdn&&this.addNode(L,'ISDN'),D.pcs&&this.addNode(L,'PCS'),D.pref&&this.addNode(L,'PREF'),D.number&&this.addNode(L,'NUMBER',D.number)}),this.json.email&&this.json.email.forEach((D)=>{const L=this.addNode(M,'EMAIL');D.home&&this.addNode(L,'HOME'),D.work&&this.addNode(L,'WORK'),D.internet&&this.addNode(L,'INTERNET'),D.pref&&this.addNode(L,'PREF'),D.x400&&this.addNode(L,'X400'),D.address&&this.addNode(L,'USERID',D.address)}),this.json.jabberId&&this.addNode(M,'JABBERID',this.json.jabberId),this.json.mailer&&this.addNode(M,'MAILER',this.json.mailer),this.json.timeZone&&this.addNode(M,'TZ',this.json.timeZone),this.json.geolocation){const D=this.addNode(M,'GEO');this.json.geolocation.lat&&this.addNode(D,'LAT',this.json.geolocation.lat),this.json.geolocation.lng&&this.addNode(D,'LON',this.json.geolocation.lng)}if(this.json.title&&this.addNode(M,'TITLE',this.json.title),this.json.role&&this.addNode(M,'ROLE',this.json.role),this.json.logo){const D=this.addNode(M,'LOGO');this.json.logo.type&&this.addNode(D,'TYPE',this.json.logo.type),this.json.logo.binval&&this.addNode(D,'BINVAL',this.json.logo.binval),this.json.logo.extval&&this.addNode(D,'EXTVAL',this.json.logo.extval)}if(this.json.organisation){const D=this.addNode(M,'ORG');this.json.organisation.name&&this.addNode(D,'ORGNAME',this.json.organisation.name),this.json.organisation.unit&&this.addNode(D,'ORGUNIT',this.json.organisation.unit)}if(this.json.categories&&this.json.categories.forEach((D)=>{const L=this.addNode(M,'CATEGORIES');D.keyword&&this.addNode(L,'KEYWORD',D.keyword)}),this.json.note&&this.addNode(M,'NOTE',this.json.note),this.json.productId&&this.addNode(M,'PRODID',this.json.productId),this.json.lastRevised&&this.addNode(M,'REV',this.json.lastRevised),this.json.sortString&&this.addNode(M,'SORT-STRING',this.json.sortString),this.json.sound){const D=this.addNode(M,'SOUND');this.json.sound.phonetic&&this.addNode(D,'PHONETIC',this.json.sound.phonetic),this.json.sound.extval&&this.addNode(D,'EXTVAL',this.json.sound.extval),this.json.sound.binval&&this.addNode(D,'BINVAL',this.json.sound.binval)}if(this.json.uid&&this.addNode(M,'UID',this.json.uid),this.json.url&&this.addNode(M,'URL',this.json.url),this.json.description&&this.addNode(M,'DESC',this.json.description),this.json.classification){const D=this.addNode(M,'CLASS');'public'===this.json.classification&&this.addNode(D,'PUBLIC'),'private'===this.json.classification&&this.addNode(D,'PRIVATE'),'confidential'===this.json.classification&&this.addNode(D,'CONFIDENTIAL')}if(this.json.key){const D=this.addNode(M,'KEY');this.json.key.credential&&this.addNode(D,'CRED',this.json.key.credential),this.json.key.type&&this.addNode(D,'TYPE',this.json.key.type)}let I='';if(A)I=new XMLSerializer().serializeToString(N);else{const D=N.children[0];for(let L=0;L<D.childElementCount;L++){console.log(D.childNodes.item(L));const B=new XMLSerializer().serializeToString(D.childNodes.item(L));I+=B}}return I}addNode(A,N,M){const I=A.ownerDocument.createElement(N);return A.appendChild(I),void 0!==M&&(I.textContent=M),I}}h.VCardSimple=R},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(J,G){function W(Q){try{K(Y.next(Q))}catch(Z){G(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){G(Z)}}function K(Q){Q.done?J(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(16),N=E(24),M=E(9),I=E(2),D=E(5),L=E(4);class B{constructor(H,z){if(this.waitingAlertId=void 0,this.suppressMode=!1,this._messageHandlers=new Map,this._messageProcessorQueue=Promise.resolve(),this._suppressModeQueue=[],this._deferredStanzas=[],!z)throw new Error('You must supply a config object');this.name=H,this.config=z,this._eventListeners={},this.logger=new M.Logger(this.config.logging||[]),this._setUpHandlers(),N.LayerRegistration.addInstance(this.name,this)}static getInstance(H){return N.LayerRegistration.getInstance(H)}static onReady(H,z){N.LayerRegistration.onReady(H,z)}bootstrap(H,z){return this._buildCommonComponents(),this.showWaitingMessage('Initialising app'),Promise.resolve().then(()=>this._setStore(z)).then(()=>this._setLogger()).then(()=>this._setComms(H)).then(()=>this._setupPushNotifications()).then(()=>this._setupCommonEventListeners()).then(()=>N.LayerRegistration.fireReady(this.name)).then(()=>this.dismissWaitingMessage()).catch(($)=>{N.LayerRegistration.fireReady(this.name),setTimeout(()=>{this.error('Error during bootstrap',$)},100)})}on(H,z,$=!1,Y=!1){this._eventListeners[H]===void 0&&(this._eventListeners[H]=[]);this._eventListeners[H].push({oneTimeOnly:$,allowSuppress:Y,callback:(G)=>{z(G.detail)}})}emit(H,z){this._eventListeners[H]||(this._eventListeners[H]=[]),this.logger.log(M.LoggerTypes.Events,`%c RAISING EVENT:%c ${H} (${this._eventListeners[H].length} listeners)`,'color: #066; font-weight: bold;','color: #999; font-weight: normal;',{data:z});const $=[];for(let Y=0;Y<this._eventListeners[H].length;Y++){const J=this._eventListeners[H][Y];this.suppressMode&&J.allowSuppress||J.callback({detail:z}),!0===J.oneTimeOnly&&$.push(Y)}$.length&&(this._eventListeners[H]=this._eventListeners[H].filter((Y,J)=>!$.includes(J)))}login(H,z){return R(this,void 0,void 0,function*(){return yield this.comms.login(H,z)})}attemptReconnect(){this.comms.attemptReconnect()}logout(){return R(this,void 0,void 0,function*(){return yield this.comms.logout()})}getSyncedTimestamp(H){return this.comms.getSyncedTimestamp(H)}getConnectionStatus(){return this.comms.getConnectionStatus()}clearAllData(H=!1){return R(this,void 0,void 0,function*(){yield this.store.clearAllData(),yield this.comms.clearAllData(H)})}getCurrentUserJid(){return this.comms.username}getCurrentUserResource(){return this.comms.getCurrentUserResource()}getCurrentXmppDisplayName(){return this.config.xmpp.user.displayName||this.config.xmpp.user.id}error(H,z){return R(this,void 0,void 0,function*(){yield this.cancelSuppressMode('*'),this.dismissWaitingMessage();const $='string'==typeof z?z:z.message;this.emit(D.BaseEvents._Request_RaiseAlert,I.DefaultAlerts.AlertErrorWithOkayButton(H,$,1,{})),this.logger.error(z)})}getLabel(H,z){return this.config.labels&&this.config.labels[H]?L.tokenReplace(this.config.labels[H],z):null}getUniqueCommsId(){return this.comms.getUniqueId()}sendMessage(H,z,$,Y=[]){return R(this,void 0,void 0,function*(){try{const J=yield this._prepareMessage(H,$);if(null===J)return null;const G=yield this.comms.sendMessage(z,J,Y),W=G.data[H.toString()]&&JSON.parse(G.data[H.toString()]);return Object.assign({},G,{data:{[H.toString()]:W}})}catch(J){this.error('Error sending message',J)}})}sendRoomMessage(H,z){return R(this,void 0,void 0,function*(){try{const $=yield this._prepareMessage(H,z);if(null===$)return null;const Y=yield this.comms.sendRoomMessage($),J=Y.data[H.toString()]&&JSON.parse(Y.data[H.toString()]);return Object.assign({},Y,{data:{[H.toString()]:J}})}catch($){this.error('Error sending room message',$)}})}sendMulticastMessage(H,z,$=[],Y=[]){return R(this,void 0,void 0,function*(){try{const J=yield this._prepareMessage(H,z);if(null===J)return null;const G=yield this.comms.sendMulticastMessage($,J,this.config.isBroadcaster,Y),W=G.data[H.toString()]&&JSON.parse(G.data[H.toString()]);return Object.assign({},G,{data:{[H.toString()]:W}})}catch(J){'object'==typeof J?(this.logger.error(J),this.workOutIfAttachmentTooLarge(J)):this.error('Error sending multicast message',J)}})}workOutIfAttachmentTooLarge(H){const z='There was an error sending the message, please try again.';if(H.nodeName&&'iq'===H.nodeName&&H.childNodes&&H.childNodes[1]&&'error'===H.childNodes[1].nodeName){const $=H.childNodes[1];if($.childNodes&&$.childNodes[1]&&'text'===$.childNodes[1].nodeName){const Y=$.childNodes[1],J=Y.textContent.match(/\d+/)[0],G=J?parseInt(J):0;if(G){const W=Math.round(G/1024/1024),X=`The attachment is too large. Please select a file lower than ${W}MB in size.`;throw this.error('Attachment Too Large',X),new Error(X)}else{const W='The attachment is too large. Please choose a smaller attachment.';throw this.error('Attachment Too Large',W),new Error(W)}}}throw this.error('Error sending multicast message',z),new Error(z)}sendMessageToBot(H,z,$=!1){return R(this,void 0,void 0,function*(){try{yield this._sendBotCommand(H,z,null)}catch(Y){if($)throw Y;else this.error('Error sending bot message',Y)}})}sendBotCommand(H,z,$=!1){return R(this,void 0,void 0,function*(){try{return yield this.comms.sendBotCommand(H.toString(),z)}catch(Y){if($)throw Y;else this.error('Error sending bot command',Y)}})}downloadFile(H){return R(this,void 0,void 0,function*(){try{return yield this.comms.downloadFile(H)}catch(z){this.error('Error downloading file',z)}})}setSupportLoggingTypes(H=['_all_']){return R(this,void 0,void 0,function*(){return this.logger.setTypes(H),yield this.store.saveLoggerTypes(H)})}resetSupportLogging(){return R(this,void 0,void 0,function*(){return this.logger.setTypes([]),yield this.store.deleteLoggerTypes()})}showWaitingMessage(H){if(this.dismissWaitingMessage(),!this.waitingAlertId){const z=I.DefaultAlerts.AlertWaiting(H);this.waitingAlertId=z.id,this.alertModalManager.raiseAlert(z)}}dismissWaitingMessage(){this.waitingAlertId&&(this.alertModalManager.dismissAlertById(this.waitingAlertId),this.waitingAlertId=null)}enableSuppressMode(z=!1){}cancelSuppressMode(){return R(this,void 0,void 0,function*(){return Promise.resolve()})}addDeferredStanza(H){this._deferredStanzas||(this._deferredStanzas=[]),this.logger.log(M.LoggerTypes.Other,`%c ADDING DEFERRED STANZA %c${H.id} > ${H.eventType}`,'color: #696; font-weight: bold;','color: #999; font-weight: normal;',{payload:H.payload}),this._deferredStanzas.push(H)}removeDeferredStanza(H,z){this._deferredStanzas&&this._deferredStanzas.length&&(!this._deferredStanzas.some(($)=>$.id===H&&$.eventType===z)||(this.logger.log(M.LoggerTypes.Other,`%c REMOVING DEFERRED STANZA %c${H} > ${z}`,'color: #696; font-weight: bold;','color: #999; font-weight: normal;'),this._deferredStanzas=this._deferredStanzas.filter(($)=>{return $.id!==H||$.eventType!==z})))}_setComms(H){return new Promise((z)=>{const Y=this.config.xmpp.initTimeout||1e4,J=setTimeout(()=>{this.logger.log(M.LoggerTypes.XmppClient,`Comms was not initialised within ${Math.floor(Y/1e3)} seconds. Aborting.`)},Y);this.comms=H,this.comms.onLogin((G)=>{this.handleLogin(G)}),this.comms.onLogout((G)=>{this.handleLogout(G)}),this.comms.onNewMessage((G)=>{this.handleNewMessage(G)}),this.comms.onMessageUpdate((G)=>{this.handleMessageUpdate(G)}),this.comms.onChatMarkerUpdate((G)=>{this.handleChatMarkerUpdate(G)}),this.comms.onStatusUpdate((G,W,X)=>{this.handleConnectionChange(G,W,X)}),this.comms.onPresenceUpdate((G)=>{this.handlePresenceUpdate(G)}),this.comms.onRoomNewParticipant((G)=>{this.handleRoomParticipantUpdate(G)}),this.comms.onRoomParticipantUpdate((G)=>{this.handleRoomParticipantUpdate(G)}),this.comms.onStartFetchingMissedMessages(()=>{this.enableSuppressMode('baseLayer#mam',!0)}),this.comms.onFinishedFetchingMissedMessages(()=>{this.cancelSuppressMode('baseLayer#mam')}),this.comms.onInitialized(()=>{z(),clearTimeout(J),this.config.xmpp.user.id&&this.config.xmpp.user.password&&this.config.xmpp.user.domain&&(this.showWaitingMessage(`Logging in as ${this.config.xmpp.user.id}`),this._attemptAutoLogin(this.config.xmpp.user.id,this.config.xmpp.user.password,this.config.xmpp.user.domain))})})}_setStore(H){return new Promise((z)=>{this.store=H,this.store.init().then(()=>z())})}_setLogger(){return new Promise((H)=>R(this,void 0,void 0,function*(){const z=yield this.store.getLoggerTypes();z&&this.logger.setTypes(z),H()}))}_setupPushNotifications(){return new Promise((H)=>R(this,void 0,void 0,function*(){const z=window;this.config.enablePushNotifications&&z.cordova?z.cordova.plugins.notification?z.cti.store.notification&&z.cti.store.notification.token?(yield this.store.savePushNotificationToken(z.cti.store.notification.token),H()):z.cordova.plugins.notification.registerForPush(($)=>R(this,void 0,void 0,function*(){yield this.store.savePushNotificationToken($),H()}),($)=>{this.logger.error($),H()},{channelName:this.name}):H():H()}))}_setupCommonEventListeners(){return new Promise((H)=>R(this,void 0,void 0,function*(){const z=yield this.store.getTheme();this._setThemeOnHtml(z),this.on(D.BaseEvents._Request_ThemeChange,($)=>R(this,void 0,void 0,function*(){yield this.store.saveTheme($),this._setThemeOnHtml($)})),H()}))}_setThemeOnHtml(H){document.querySelector('html').setAttribute('theme',H),this.emit(D.BaseEvents._Request_RedrawAllUIs)}_setUpHandlers(){this._messageHandlers=new Map,this.getHandlers().forEach((H)=>{H.messageKey&&this._messageHandlers.set(H.messageKey,H),H.eventType&&H.eventType.length&&H.eventType.forEach((z)=>{this.on(z,($)=>R(this,void 0,void 0,function*(){try{yield H.callHandleEvent(z,$)}catch(Y){this.error('Error handling event',`Event type: ${z.toString()}. ${Y.message||Y}`)}}))})})}_prepareMessage(H,z){return R(this,void 0,void 0,function*(){const $=this._messageHandlers.get(H),Y=yield $.callCreateMessage(z);return null===Y||void 0===Y?null:{[$.messageKey]:JSON.stringify(Y)}})}_sendBotCommand(H,z,$){return R(this,void 0,void 0,function*(){const Y=H.toString(),J=yield this._prepareBotMessage(H,z,$);if(null!==J){const G=yield this.comms.sendBotCommand(Y,J);if(G&&!1===G.success){const W=yield this._shouldRetryBotMessage(H,z,G);!0===W&&(yield this._sendBotCommand(H,z,G))}}})}_prepareBotMessage(H,z,$){return R(this,void 0,void 0,function*(){const Y=this._messageHandlers.get(H),J=yield Y.callCreateBotMessage(z,$);return null===J||void 0===J?null:{[Y.messageKey]:JSON.stringify(J)}})}_shouldRetryBotMessage(H,z,$){return R(this,void 0,void 0,function*(){const Y=this._messageHandlers.get(H);return yield Y.callHandleFailedBotResponse(z,$)})}_buildCommonComponents(){return R(this,void 0,void 0,function*(){const H='div',z='___ct_base_layer_modal_container';let $=document.querySelector(`${H}#${z}`);$||($=document.createElement(H),$.id=z,$.setAttribute('style','position: absolute; top: 0; left: 0; width: 0; height: 0; z-index: 99999;'),document.body.appendChild($)),this.alertModalManager=document.querySelector('ct-alert-modal-manager'),this.alertModalManager||(this.alertModalManager=document.createElement('ct-alert-modal-manager'),this.alertModalManager.owner=this.name,$.appendChild(this.alertModalManager)),yield this.generateCommonComponents($)})}_attemptAutoLogin(H,z,$){return R(this,void 0,void 0,function*(){let Y=`${H}@${$}`;this.config.xmpp.user&&!0===this.config.xmpp.user.forceLowercaseJid&&(Y=Y.toLowerCase()),this.logger.log(M.LoggerTypes.Connectivity,`%c ATTEMPTING AUTOMATIC LOGIN AS > %c${Y}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;'),yield this.comms.login(Y,z)})}handleLogin(H){this.emit(D.BaseEvents.LoginResult,H)}handleLogout(H){this.emit(D.BaseEvents.LogoutResult,H)}handleNewMessage(H){if(!0===this.suppressMode&&!0!==H.isFromMam)return void this.addDeferredStanza({id:H._id,eventType:A.CtXmppClient.EVENT_TYPES.NEW_MESSAGE,payload:H});this.emit(D.BaseEvents.UserActivity,new D.UserActivityEventArgs(H.jid,H.ts));const z=L.getMessageType(H.data);if(!z)return;const $=H.data[z]&&JSON.parse(H.data[z]),Y=Object.assign({},H,{data:{[z]:$}}),J=this._messageHandlers.get(z);J&&(this._messageProcessorQueue=this._messageProcessorQueue.then(()=>R(this,void 0,void 0,function*(){try{return this.removeDeferredStanza(H._id,A.CtXmppClient.EVENT_TYPES.NEW_MESSAGE),this.logger.log(M.LoggerTypes.ProcessingReceived,`%c PROCESSING NEW MESSAGE:%c`,'color: #060; font-weight: bold;','color: #999; font-weight: normal;',{[z]:$}),yield J.callHandleMessage(Y)}catch(G){this.error('Error processing message',G)}})).catch((G)=>this.error('Error processing message',G)))}handleMessageUpdate(H){if(!0===this.suppressMode)return void this.addDeferredStanza({id:H._id,eventType:A.CtXmppClient.EVENT_TYPES.MESSAGE_UPDATED,payload:H});this.emit(D.BaseEvents.UserActivity,new D.UserActivityEventArgs(H.jid,H.ts));const z=L.getMessageType(H.data);if(!z)return;const $=H.data[z]&&JSON.parse(H.data[z]),Y=Object.assign({},H,{data:{[z]:$}}),J=this._messageHandlers.get(z);J&&(this._messageProcessorQueue=this._messageProcessorQueue.then(()=>R(this,void 0,void 0,function*(){try{return this.removeDeferredStanza(H._id,A.CtXmppClient.EVENT_TYPES.MESSAGE_UPDATED),this.logger.log(M.LoggerTypes.ProcessingUpdated,`%c PROCESSING MESSAGE UPDATE:%c`,'color: #060; font-weight: bold;','color: #999; font-weight: normal;',{[z]:$}),yield J.callHandleMessageUpdate(Y)}catch(G){this.error('Error processing message update',G)}})).catch((G)=>this.error('Error processing message update',G)))}handleChatMarkerUpdate(H){if(!0===this.suppressMode)return void this.addDeferredStanza({id:H.message_id,eventType:A.CtXmppClient.EVENT_TYPES.RECEIPT_RECEIVED,payload:H});const z=Object.assign({},H);let $=`${z.sender_resource}@${this.config.xmpp.user.domain}`;this.config.xmpp.user&&!0===this.config.xmpp.user.forceLowercaseJid&&($=$.toLowerCase()),z.sender_resource=$,this.emit(D.BaseEvents.UserActivity,new D.UserActivityEventArgs(z.sender_resource,z.message.updated_at||z.message.ts));const Y=L.getMessageType(z.message.data);if(!Y)return;const J=z.message.data[Y]&&JSON.parse(z.message.data[Y]),G=Object.assign({},z,{message:{data:{[Y]:J}}}),W=this._messageHandlers.get(Y);W&&(this._messageProcessorQueue=this._messageProcessorQueue.then(()=>R(this,void 0,void 0,function*(){try{this.removeDeferredStanza(H.message_id,A.CtXmppClient.EVENT_TYPES.RECEIPT_RECEIVED);const X=z.sender_resource.split('@').shift();return this.logger.log(M.LoggerTypes.ProcessingChatMarker,`%c PROCESSING CHAT MARKER: %c${X} > ${z.type}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;'),yield W.callHandleMessageReceipt(z)}catch(X){this.error('Error processing chat marker',X)}})).catch((X)=>this.error('Error processing chat marker',X)))}handleRoomParticipantUpdate(H){if(H.jid){this.emit(D.BaseEvents.UserActivity,new D.UserActivityEventArgs(H.jid,H.updated_at||H.ts));const z=H.metadata&&H.metadata.role?H.metadata.role:'';this.emit(D.BaseEvents.RoomParticipantUpdate,new D.RoomParticipantUpdateEventArgs(H.jid,H.room_name,z,I.RoomRole[H.room_role]))}}handleConnectionChange(H,z,$){this.comms.setConnectionStatus(H),B.onReady(this.name,()=>{this.emit(D.BaseEvents.ConnectionStatusChange,new D.ConnectionStatusEventArgs(H,z,$))})}handlePresenceUpdate(H){H.online&&this.emit(D.BaseEvents.UserActivity,new D.UserActivityEventArgs(H.id,this.getSyncedTimestamp()));const z=H.online?I.ConnectionStatus.Connected:I.ConnectionStatus.Disconnected;this.emit(D.BaseEvents.OtherUserConnectionStatusChange,new D.UserConnectionStatusEventArgs(H.id,z))}}h.BaseLayer=B},function(l,h,E){'use strict';var R=this&&this.__decorate||function(z,$,Y,J){var G=arguments.length,W=3>G?$:null===J?J=Object.getOwnPropertyDescriptor($,Y):J,X;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)W=Reflect.decorate(z,$,Y,J);else for(var K=z.length-1;0<=K;K--)(X=z[K])&&(W=(3>G?X(W):3<G?X($,Y,W):X($,Y))||W);return 3<G&&W&&Object.defineProperty($,Y,W),W},A=this&&this.__awaiter||function(z,$,Y,J){return new(Y||(Y=Promise))(function(G,W){function X(Z){try{Q(J.next(Z))}catch(ee){W(ee)}}function K(Z){try{Q(J['throw'](Z))}catch(ee){W(ee)}}function Q(Z){Z.done?G(Z.value):new Y(function(ee){ee(Z.value)}).then(X,K)}Q((J=J.apply(z,$||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(13),M=E(0),I=E(24),D=E(9),L=E(5),B=E(23);class H extends B.CTBaseComponent{constructor(){super(...arguments),this._connected=!1,this._debouncers={}}get layer(){return this._baseLayer?this._baseLayer:null}get componentStyles(){return this.generateComponentStyles}componentMarkup(){if(!this.layer){const z=this._findParentCTLayerComponent();if(z&&(this._baseLayer=z._baseLayer,this._initializeForBaseLayer()),!this._connected)return null;if(!this.layer)return z?console.error(`Component <${this.localName}> child of <${z.localName}> does not have an owner layer specified`):console.error(`Component <${this.localName}> does not have an owner layer specified`),N.h('em',{style:{display:'inline-block',fontSize:'12px',color:'#900',backgroundColor:'#FF0',padding:'3px 6px'}},`${this.localName}:`,N.h('br'),'OWNER NOT SPECIFIED')}return this.generateComponentMarkup()}connectedCallback(){super.connectedCallback()}attributeChangedCallback(z,$,Y){super.attributeChangedCallback(z,$,Y);'owner'===z?Y!==$&&''!==Y&&(this.owner=Y,this._attemptConnectToBaseLayer()):void 0}forceRedraw(){this._renderTrigger=new Date().getTime()}debounce(z,$,Y=100){clearTimeout(this._debouncers[z]),this._debouncers[z]=setTimeout(()=>{$(),delete this._debouncers[z]},Y)}emitEvent(z,$){this._baseLayer?this._baseLayer.emit(z,$):console.error(`Could not emit event from component <${this.localName}> - it does not have an owner layer specified`)}emitComponentEvent(z,$){this._baseLayer?(this._baseLayer.logger.log(D.LoggerTypes.Events,`%c RAISING COMPONENT EVENT:%c ${z}`,'color: #066; font-weight: bold;','color: #999; font-weight: normal;',{component:this,data:$}),this.dispatchEvent(new CustomEvent(z,{detail:$}))):console.error(`Could not emit event from component <${this.localName}> - it does not have an owner layer specified`)}addListener(z,$,Y){if(this._baseLayer){let J=!1,G=!0;Y&&!0===Y.onceOnly&&(J=!0),Y&&!0===Y.dontSuppress&&(G=!1),this._baseLayer.on(z,$,J,G)}else console.error(`Could not set event handler on component <${this.localName}> - it does not have an owner layer specified`)}addListeners(z,$,Y){z.forEach((J)=>{this.addListener(J,$,Y)})}launchModal(z){this._baseLayer.emit(L.BaseEvents._Request_RaiseAlert,z)}getLabel(z,$){return this.layer.getLabel(z,$)}_attemptConnectToBaseLayer(){this.owner&&I.LayerRegistration.onReady(this.owner,()=>{this._connectToLayer()})}_connectToLayer(){return A(this,void 0,void 0,function*(){this._connected||this.owner&&(this._baseLayer=I.LayerRegistration.getInstance(this.owner)||null,this._baseLayer&&(yield this._initializeForBaseLayer()))})}_initializeForBaseLayer(){return A(this,void 0,void 0,function*(){yield this.initialize.apply(this),this.setupListeners(),this._connected=!0,this.forceRedraw(),this.addListener(L.BaseEvents._Request_RedrawAllUIs,()=>A(this,void 0,void 0,function*(){yield this.initialize.apply(this),this.forceRedraw()}))})}_findParentCTLayerComponent(){let z=this,$=!1;do z=z.parentNode||z.host,z||($=!0),z&&z.owner&&($=!0);while(!$);return z||null}}H.is=null,R([M.prop({type:String,attribute:!0})],H.prototype,'owner',void 0),R([M.prop({type:Number,attribute:!1,default:0})],H.prototype,'_renderTrigger',void 0),h.CTLayerComponent=H},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(J,G){function W(Q){try{K(Y.next(Q))}catch(Z){G(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){G(Z)}}function K(Q){Q.done?J(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(22),N=E(16),M=E(2),I=E(5),D=E(9),L=E(4);h.BaseComms=class{constructor(H,z,$,Y){this._firstConnectionInitialized=!1,this._loggingIn=!1,this._loginTimeout=null,this._clientName=H;const J={debug:Y.getTypesAsEnumValues().includes(D.LoggerTypes.XmppClient),mucHost:z.mucHost,mam:{auto:z.mam&&!0===z.mam.autoFetch||!1,defaultTimeLimit:z.maxMessageAge||0,pageSize:500},autoLogin:!(z.autoLogin!==void 0)||z.autoLogin,autoReconnect:!(z.autoReconnect!==void 0)||z.autoReconnect,enablePing:!1!==z.enablePing,pingInterval:z.pingInterval||5e3,pingTimeout:z.pingTimeout||1e4,connectTimeout:z.connectTimeout||15000,multicastHost:z.multicastHost,uploadHost:z.uploadHost,autoMarkMessages:z.useChatMarkers,encryption:z.encryption||!1,fileEncryption:z.fileEncryption||!1,autoPurgeOldMessagesAge:z.maxMessageAge||0,authAttachments:!0===z.authAttachments,streamResumption:!1!==z.streamResumption,useEncodedJidAsResource:z.user&&!0===z.user.userPersistentResource||!1,adSpn:z.adSpn||null,adSecurityPackage:z.adSecurityPackage||null,push:z.push,enableMessageCarbons:z.enableMessageCarbons||!1,useConnectionEvents:z.useConnectionEvents,maxStreamResumptionTime:z.maxStreamResumptionTime||null,alwaysSendPresence:z.alwaysSendPresence||!1,updateUserDirectoryOnLogin:!1!==z.updateUserDirectoryOnLogin,updateRosterOnLogin:!1};z.adTokenPlaceholder&&(J.adTokenPlaceholder=z.adTokenPlaceholder),this.client=new N.CtXmppClient(this._clientName,z.endpoint,J),this.store=$,this.logger=Y,this.xmppConfig=z,this._localEventHandlers={},this._setupCommonHandlers()}onInitialized(H){this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.INITIALISED,()=>{H()})}onLogin(H){const z='comms-login';this._localEventHandlers[z]===void 0&&(this._localEventHandlers[z]=[]),this._localEventHandlers[z].push(H)}onLogout(H){const z='comms-logout';this._localEventHandlers[z]===void 0&&(this._localEventHandlers[z]=[]),this._localEventHandlers[z].push(H)}onNewMessage(H){this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.NEW_MESSAGE,(z)=>{H(Object.assign({},z))})}onMessageUpdate(H){this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.MESSAGE_UPDATED,(z)=>{H(Object.assign({},z))})}onChatMarkerUpdate(H){this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.RECEIPT_RECEIVED,(z)=>{H(Object.assign({},z))})}onStatusUpdate(H){this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.STATUS,(z)=>{let $=M.ConnectionStatus.Disconnected,Y=null;switch(z.id){case A.default.Strophe.Status.CONNFAIL:$=M.ConnectionStatus.Disconnected,Y=new M.DisconnectionStatus(z.wontReconnect,z.reason);break;case A.default.Strophe.Status.AUTHFAIL:$=M.ConnectionStatus.Disconnected,Y=new M.DisconnectionStatus(!1,z.reason);break;case A.default.Strophe.Status.ERROR:$=M.ConnectionStatus.Disconnected,Y=new M.DisconnectionStatus(z.wontReconnect,z.reason);break;case A.default.Strophe.Status.CONNECTING:$=M.ConnectionStatus.Connecting;break;case A.default.Strophe.Status.AUTHENTICATING:$=M.ConnectionStatus.Connecting;break;case A.default.Strophe.Status.CONNECTED:$=M.ConnectionStatus.Connected;break;case A.default.Strophe.Status.DISCONNECTING:$=M.ConnectionStatus.Disconnecting;break;case A.default.Strophe.Status.DISCONNECTED:$=M.ConnectionStatus.Disconnected,Y=new M.DisconnectionStatus(z.wontReconnect,z.reason);break;default:M.ConnectionStatus.Disconnected;}z.id===A.default.Strophe.Status.DISCONNECTED&&document.dispatchEvent(new CustomEvent('_pl_disconnected')),H($,z.reconnectTime,Y)})}onPresenceUpdate(H){this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.PRESENCE_UPDATE,(z)=>{H(z)})}onRoomNewParticipant(H){this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.NEW_PARTICIPANT,(z)=>{H(Object.assign({},z))})}onRoomParticipantUpdate(H){this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.PARTICIPANT_UPDATED,(z)=>{H(Object.assign({},z))})}onError(H){this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.ERROR,(z)=>{H(z)})}onStartFetchingMissedMessages(H){const z='missed-messages-start';this._localEventHandlers[z]===void 0&&(this._localEventHandlers[z]=[]),this._localEventHandlers[z].push(H)}onFinishedFetchingMissedMessages(H){const z='missed-messages-finished';this._localEventHandlers[z]===void 0&&(this._localEventHandlers[z]=[]),this._localEventHandlers[z].push(H)}onAutoReconnected(H){this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.AUTO_RECONNECTED,(z)=>{H(z)})}onDatabasesAutoDestroyed(H){this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.AUTO_DBS_DESTROYED,()=>{H()})}getSyncedTimestamp(H){const z=null===H||H===void 0?new Date().getTime():H;return this.client.getSyncedTimestamp(z)}getCurrentUserResource(){return this.client.resource}getConnectionStatus(){return this.status}setConnectionStatus(H){this.status=H}login(H,z,$=!0){return R(this,void 0,void 0,function*(){const Y=(J,G)=>{clearTimeout(this._loginTimeout),this._loggingIn=!1,this.logger.log(D.LoggerTypes.Connectivity,`%c LOGIN FAILED > %c${this.username}`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;'),this.username='',G&&this.triggerLoginEvent(!1,J.msg)};return!0===this._loggingIn?Promise.reject(new Error('Login currently in progress, please wait.')):new Promise((J,G)=>R(this,void 0,void 0,function*(){try{this._loggingIn=!0,clearTimeout(this._loginTimeout);const W=this.xmppConfig.loginTimeout||1e4;this._loginTimeout=setTimeout(()=>R(this,void 0,void 0,function*(){this.logger.log(D.LoggerTypes.Connectivity,'%c\uD83D\uDEAB LOGIN TIMED OUT','color: #600; font-weight: bold;');const K={msg:`Logging in took longer than ${Math.floor(W/1e3)} seconds. Please check your connectivity and try again.`};Y(K,$),this._loggingIn=!1,clearTimeout(this._loginTimeout),G(K)}),W),this.xmppConfig.user&&!0===this.xmppConfig.user.forceLowercaseJid&&(H=H.toLowerCase()),this.logger.log(D.LoggerTypes.Connectivity,`%c ATTEMPTING LOGIN > %c${H}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;'),this.username=H;let X=!1;try{X=yield this.client.login(H,z)}catch(K){return Y(K,$),void G(K)}this.checkTimeSync(!1),$&&this.triggerLoginEvent(!0),clearTimeout(this._loginTimeout),this._loggingIn=!1,J(X)}catch(W){Y(W,$),G(W)}}))})}logout(H=!1,z=!0){return R(this,void 0,void 0,function*(){try{this.logger.log(D.LoggerTypes.Connectivity,`%c LOGGING OUT > %c${this.username}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;'),this._firstConnectionInitialized=!1,yield this.client.logout(H),this.username='',z&&this.triggerLogoutEvent(!0)}catch($){this.logger.log(D.LoggerTypes.Connectivity,`%c LOGOUT FAILED > %c${this.username}`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;'),z&&this.triggerLogoutEvent(!1)}})}attemptReconnect(){this.client.reLoginNow()}joinRoom(){return R(this,void 0,void 0,function*(){(yield this.xmppConfig)&&this.xmppConfig.room?this._joinOrLeaveRoom(this.xmppConfig.room):null})}leaveRoom(){return R(this,void 0,void 0,function*(){(yield this.xmppConfig)&&this.xmppConfig.room?this._joinOrLeaveRoom(this.xmppConfig.room,!0):null})}setClientStateActive(H){return R(this,void 0,void 0,function*(){const z=H?N.CtXmppClient.CLIENT_STATES.ACTIVE:N.CtXmppClient.CLIENT_STATES.INACTIVE;this.client.setClientState(z)})}getUniqueId(){return this.client.getUniqueId()}sendMessage(H,z,$=[]){return R(this,void 0,void 0,function*(){if(this.status!==M.ConnectionStatus.Connected)throw new Error('Unable to send message: not currently connected');const Y=yield this.client.sendChatMessage(H,null,z,$);if(this.logger.shouldLog(D.LoggerTypes.MessageSent)){const J=L.getMessageType(Y.data),G=Y.data[J]&&JSON.parse(Y.data[J]);this.logger.log(D.LoggerTypes.MessageSent,`%c MESSAGE SENT: %c${H} >`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;',{[J]:G})}return Y})}sendRoomMessage(H){return R(this,void 0,void 0,function*(){if(!this.xmppConfig.room)throw new Error('No room configured in XmppConfig');if(this.status!==M.ConnectionStatus.Connected)throw new Error('Unable to send room message: not currently connected');const z=this.xmppConfig.room.name,$=yield this.client.sendGroupChatMessage(z,null,H);if(this.logger.shouldLog(D.LoggerTypes.MessageSent)){const Y=L.getMessageType($.data),J=$.data[Y]&&JSON.parse($.data[Y]);this.logger.log(D.LoggerTypes.MessageSent,`%c ROOM MESSAGE SENT: %c${z} >`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;',{[Y]:J})}return $})}sendMulticastMessage(H,z,$,Y=[]){return R(this,void 0,void 0,function*(){if(this.status!==M.ConnectionStatus.Connected)throw new Error('Unable to multicast message: not currently connected');const J=yield this.client.sendMulticastMessage(H,null,z,Y);if(this.logger.shouldLog(D.LoggerTypes.MessageSent)){const G=JSON.stringify(H),W=L.getMessageType(J.data),X=J.data[W]&&JSON.parse(J.data[W]);this.logger.log(D.LoggerTypes.MessageSent,`%c MUTILCAST MESSAGE SENT: %c${G} >`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;',{[W]:X})}return J})}sendBotCommand(H,z){return R(this,void 0,void 0,function*(){if(this.status!==M.ConnectionStatus.Connected)throw new Error(`Unable to send bot command "${H}": not currently connected`);if(!this.xmppConfig.bot)throw new Error('No bot configured in XmppConfig');const $=this.xmppConfig.bot.componentJid;if(!$)throw new Error('Unable to issue bot command; no bot component jid configured');if(void 0!==z&&null!==z){const Y=Object.assign({},z);H in Y&&(Y[H]=JSON.parse(Y[H])),this.logger.log(D.LoggerTypes.MessageSent,`%c BOT COMMAND SENT: %c${H} >`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;',{data:Y})}else this.logger.log(D.LoggerTypes.MessageSent,`%c BOT COMMAND SENT: %c${H}`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;');try{const Y=yield this.client.sendBotCommand($,H,z,this.xmppConfig.bot.timeout);return this.logger.log(D.LoggerTypes.MessageSent,`%c BOT RESPONSE: %c${H} > ${Y.success?'success':'fail'}`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;',{data:Y.data||null}),Y}catch(Y){const J='Server connections to local subdomains are forbidden'===Y?`Unable to connect to bot: ${$}`:Y.message||Y;throw new Error(J)}})}updateStatus(H,z,$=!1,Y){return R(this,void 0,void 0,function*(){const J=yield this.client.setChatStatus(H,z,$,Y);if(this.logger.shouldLog(D.LoggerTypes.Status)){const G=JSON.stringify(J);this.logger.log(D.LoggerTypes.Status,`%c STATUS UPDATED: %c${G}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;')}return J})}listParticipantsByRoom(H){return R(this,void 0,void 0,function*(){const z=yield this.client.listParticipantsByRoom(H);return Promise.all(z.map(($)=>R(this,void 0,void 0,function*(){return yield this._participantToUser($)})))})}getParticipantByRoomAndJid(H,z){return R(this,void 0,void 0,function*(){const $=yield this.client.getParticipantByRoomAndJid(H,z);return!$?null:yield this._participantToUser($)})}getAllContacts(){return R(this,void 0,void 0,function*(){const H=yield this.client.getAllUsers(!0),z=H.map(($)=>{const Y={telephone:[$.telephone],fullName:`${$.firstName} ${$.lastName}`,title:$.prefix,jabberId:$.jid};return{id:$.jid,subscription:'',online:null,groups:$.group.split('|'),avatarHash:$.avatar,firstName:$.firstName,lastName:$.lastName,vCard:Y}});return Promise.all(z.map(($)=>R(this,void 0,void 0,function*(){return yield this._xmppContactToUser($)})).filter(($)=>null!==$))})}getUsersInGroups(H){return R(this,void 0,void 0,function*(){const z=yield this.client.getUsersInGroups(H,'|'),$=z.map((Y)=>{const J={telephone:[Y.telephone],fullName:`${Y.firstName} ${Y.lastName}`,title:Y.prefix,jabberId:Y.jid};return{id:Y.jid,subscription:'',online:null,groups:Y.group.split('|'),avatarHash:Y.avatar,firstName:Y.firstName,lastName:Y.lastName,vCard:J}});return Promise.all($.map((Y)=>R(this,void 0,void 0,function*(){return yield this._xmppContactToUser(Y)})).filter((Y)=>null!==Y))})}getChatHistory(H){return R(this,void 0,void 0,function*(){return yield this.client.getChatHistory(H)})}queryMam(H,z,$,Y,J=!0){return R(this,void 0,void 0,function*(){return yield this.client.queryMam(H,z,$,Y,J)})}clearAllData(H=!1){return R(this,void 0,void 0,function*(){yield this.client.destroyDbs(!1,H)})}createPushNotificationRegistration(H){return R(this,void 0,void 0,function*(){const z=this._generatePushNotificationPayload(H.platform,H.channelUri,H.azureId);return yield this.client.sendIq('push.localhost','set',z)})}checkTimeSync(H=!0){const z=new Date().getTime(),$=this.getSyncedTimestamp(z),Y=Math.abs($-z),G=Y<1e4,W=G?'#666':'#F00',X=G?'#999':'#F00',K=H?console.log:G?()=>{}:console.log;if(K.call(console.log,`%c CLIENT TIME: %c${new Date(z).toTimeString()}`,'color: #666; font-weight: bold;','color: #999; font-weight: normal;'),K.call(console.log,`%c SERVER TIME: %c${new Date($).toTimeString()}`,'color: #666; font-weight: bold;','color: #999; font-weight: normal;'),Y){const Q=Math.floor(Y/3600000%24),Z=Math.floor(Y/60000%60),ee=Math.floor(Y/1e3%60),te=Math.floor(Y%1e3);let ne='';0<Q&&(ne+=`${Q}h `),0<Z&&(ne+=`${Z}m `),0<ee&&(ne+=`${ee}s `),0<te&&(ne+=`${te}ms `),z>$?K.call(console.log,`%c TIME SYNC: %cClient is %c${ne.trim()} ahead %cof server`,`color: ${W}; font-weight: bold;`,`color: ${X}; font-weight: normal;`,`color: ${X}; font-weight: bold;`,`color: ${X}; font-weight: normal;`):K.call(console.log,`%c TIME SYNC: %cClient is %c${ne.trim()} behind %cserver`,`color: ${W}; font-weight: bold;`,`color: ${X}; font-weight: normal;`,`color: ${X}; font-weight: bold;`,`color: ${X}; font-weight: normal;`)}else K.call(console.log,`%c TIME SYNC: %cClient and server times are identical`,'color: #666; font-weight: bold;','color: #999; font-weight: normal;')}updateVCardForUser(H){return R(this,void 0,void 0,function*(){return this.username&&this.username===H?null:void(yield this.client.updatevCardForContact(H))})}getOurVCard(){return R(this,void 0,void 0,function*(){try{return yield this.client.getOurvCard()}catch(H){return null}})}downloadFile(H){return R(this,void 0,void 0,function*(){const z=yield this.client.doDownload(H);return z.source||null})}initializeFirstConnection(){return R(this,void 0,void 0,function*(){})}buildCurrentUser(H){return R(this,void 0,void 0,function*(){const z=H.split('@').shift(),$={id:H,jid:H,username:z,firstName:'',lastName:'',connectionStatus:this.getConnectionStatus()},Y=yield this.getOurVCard();return yield this.embelishUser($,Y,M.UserAdditionalDetailsType.VCard)})}triggerLoginEvent(H,z){this._fireLocalEventHandlers('comms-login',new I.CommsEventArgs(H,z))}triggerLogoutEvent(H,z){this._fireLocalEventHandlers('comms-logout',new I.CommsEventArgs(H,z))}triggerFetchingMissedMessagesState(H){H?this._fireLocalEventHandlers('missed-messages-start'):this._fireLocalEventHandlers('missed-messages-finished')}_setupCommonHandlers(){this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.NEW_MESSAGE,(H)=>R(this,void 0,void 0,function*(){if(this.logger.shouldLog(D.LoggerTypes.MessageReceived)){const z=L.getMessageType(H.data),$=H.data[z]&&JSON.parse(H.data[z]);this.logger.log(D.LoggerTypes.MessageReceived,`%c MESSAGE RECEIVED:%c`,'color: #060; font-weight: bold;','color: #999; font-weight: normal;',{[z]:$})}})),this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.MESSAGE_UPDATED,(H)=>{if(this.logger.shouldLog(D.LoggerTypes.MessageUpdated)){const z=L.getMessageType(H.data),$=H.data[z]&&JSON.parse(H.data[z]);this.logger.log(D.LoggerTypes.MessageUpdated,`%c MESSAGE UPDATED:%c`,'color: #060; font-weight: bold;','color: #999; font-weight: normal;',{[z]:$})}}),this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.RECEIPT_RECEIVED,(H)=>{if(this.logger.shouldLog(D.LoggerTypes.MessageChatMarker)){const z=H.sender_resource.split('@').shift();this.logger.log(D.LoggerTypes.MessageChatMarker,`%c CHAT MARKER RECEIVED: %c${z} > ${H.type}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;')}}),this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.STATUS,(H)=>R(this,void 0,void 0,function*(){const z=M.ConnectionStatus[H.label];if(this.setConnectionStatus(z),z===M.ConnectionStatus.Connected&&(this.username=this.client.bareJid,!1===this._firstConnectionInitialized&&(yield this.initializeFirstConnection(),this._firstConnectionInitialized=!0)),this.logger.shouldLog(D.LoggerTypes.Connectivity)){const $=H.reconnectTime?` - reconnect attempt in ${H.reconnectTime/1e3} second(s)`:'';this.logger.log(D.LoggerTypes.Connectivity,`%c CONNECTIVITY CHANGE: %c${z}${$}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;')}})),this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.NEW_PARTICIPANT,(H)=>R(this,void 0,void 0,function*(){if(H.jid&&this.logger.shouldLog(D.LoggerTypes.Participation)){const z=yield this._participantToUser(H);this.logger.log(D.LoggerTypes.Participation,`%c NEW PARTICIPANT: %c${z.username} > ${z.connectionStatus}`,'color: #006; font-weight: bold;','color: #999; font-weight: normal;',{participant:H})}})),this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.PARTICIPANT_UPDATED,(H)=>R(this,void 0,void 0,function*(){if(H.jid&&this.logger.shouldLog(D.LoggerTypes.Participation)){const z=yield this._participantToUser(H);this.logger.log(D.LoggerTypes.Participation,`%c PARTICIPANT UPDATED: %c${z.username} > ${z.connectionStatus}`,'color: #006; font-weight: bold;','color: #999; font-weight: normal;',{participant:H})}})),this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.PRESENCE_UPDATE,(H)=>R(this,void 0,void 0,function*(){if(H.id&&this.logger.shouldLog(D.LoggerTypes.Presence)){const z=yield this._xmppContactToUser(H);z?this.logger.log(D.LoggerTypes.Presence,`%c PRESENCE UPDATED: %c${z.username} > ${z.connectionStatus}`,'color: #006; font-weight: bold;','color: #999; font-weight: normal;'):this.logger.error(D.LoggerTypes.Presence,`%c PRESENCE UPDATED FOR UNKNOWN CONTACT:`,'color: #006; font-weight: bold;',{contact:H})}})),this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.ERROR,(H)=>{this.logger.error(`%c ERROR:`,'color: #C00; font-weight: bold;','\r\n\t',H)}),this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.AUTO_RECONNECTED,({resumed:H})=>R(this,void 0,void 0,function*(){if(this.logger.shouldLog(D.LoggerTypes.Connectivity)){const z=!0===H?' - STREAM RESUMED':'';this.logger.log(D.LoggerTypes.Connectivity,`%c AUTO RECONNECTED AFTER DISCONNECT${z}`,'color: #669; font-weight: bold;')}})),this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.DBS_DESTROYED,()=>{this.logger.shouldLog(D.LoggerTypes.CleanUp)&&this.logger.log(D.LoggerTypes.CleanUp,`%c DATABASES DESTROYED`,'color: #669; font-weight: bold;')}),this.client.addEventListener(N.CtXmppClient.EVENT_TYPES.AUTO_DBS_DESTROYED,()=>{this.logger.shouldLog(D.LoggerTypes.CleanUp)&&this.logger.log(D.LoggerTypes.CleanUp,`%c DATABASES AUTO DESTROYED`,'color: #669; font-weight: bold;')})}_joinOrLeaveRoom(H,z=!1){return R(this,void 0,void 0,function*(){'participant'===H.type&&((yield z)?this.client.leaveRoom(H.name):this.client.joinRoom(H.name)),'subscriber'===H.type&&((yield z)?this.client.unsubscribeFromRoom(H.name):this.client.subscribeToRoom(H.name,H.nodes))})}_participantToUser(H){return R(this,void 0,void 0,function*(){const z={id:H._id,jid:H.jid,username:H.username,firstName:'',lastName:'',connectionStatus:H.online?M.ConnectionStatus.Connected:M.ConnectionStatus.Disconnected};return this.embelishUser(z,H,M.UserAdditionalDetailsType.Participant)})}_xmppContactToUser(H){return R(this,void 0,void 0,function*(){if(!H||!H.id)return null;const z={id:H.id,jid:H.id,username:H.id.substring(0,H.id.indexOf('@')),firstName:'',lastName:'',connectionStatus:H.online?M.ConnectionStatus.Connected:M.ConnectionStatus.Disconnected,groups:H.groups,subscription:H.subscription};return this.embelishUser(z,H,M.UserAdditionalDetailsType.Contact)})}_fireLocalEventHandlers(H,z){this._localEventHandlers[H]!==void 0&&this._localEventHandlers[H].forEach(($)=>$(z))}_generatePushNotificationPayload(H,z,$){return{push:{$attributes:{xmlns:'urn:commontime:infinity:push'},notification:{type:'android'===H?'gcm':'apns',installation_id:$,registration_id:z}}}}}},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(13);h.Stroolean=R.prop.create({coerce:(A)=>'string'==typeof A&&'true'===A.toLowerCase(),default:!1,deserialize:(A)=>'string'==typeof A&&'true'===A.toLowerCase(),serialize:(A)=>A?'true':'false'}),h.NullableNumber=R.prop.create({coerce:(A)=>'null'===A?null:parseInt(A),default:null,deserialize:(A)=>'null'===A?null:parseInt(A),serialize:(A)=>null===A||A===void 0?'null':A.toString()})},function(l,h,E){'use strict';function A(D){if('function'==typeof D){const L=D();return L instanceof Array?'array':'object'==typeof L?'object':typeof L}}var N=this&&this.__rest||function(D,L){var B={};for(var H in D)Object.prototype.hasOwnProperty.call(D,H)&&0>L.indexOf(H)&&(B[H]=D[H]);if(null!=D&&'function'==typeof Object.getOwnPropertySymbols)for(var z=0,H=Object.getOwnPropertySymbols(D);z<H.length;z++)0>L.indexOf(H[z])&&(B[H[z]]=D[H[z]]);return B};Object.defineProperty(h,'__esModule',{value:!0});const M=E(13),I=(D)=>D;h.prop=function(D){return function(L,B){const{type:H}=D,z=N(D,['type']),$=A(H),Y=M.prop[$]||I,J=L.constructor,G=J.props||{},W=Object.assign({},G,{[B]:Y(z)});Object.defineProperty(J,'props',{configurable:!0,get(){return W}})}}},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(12);class A extends R.BaseEventArgs{constructor(N,M,I){super(),this.status=N,this.reconnectTime=M,this.disconnectStatus=I}}h.ConnectionStatusEventArgs=A},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(25);class A extends R.CommsEventArgs{constructor(N,M,I){super(M,I),this.success=M,this.resumed=N,I&&(this.errorMessage=I)}}h.ResumableCommsEventArgs=A},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(12);class A extends R.BaseEventArgs{constructor(N,M,I,D){super(),this.jid=N,this.roomName=M,this.role=I,this.roomRole=D}}h.RoomParticipantUpdateEventArgs=A},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(12);class A extends R.BaseEventArgs{constructor(N,M){super(),this.jid=N,this.date=M}}h.UserActivityEventArgs=A},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(12);class A extends R.BaseEventArgs{constructor(N,M){super(),this.jid=N,this.connectionStatus=M}}h.UserConnectionStatusEventArgs=A},function(l,h){'use strict';var R=this&&this.__awaiter||function(N,M,I,D){return new(I||(I=Promise))(function(L,B){function H(Y){try{$(D.next(Y))}catch(J){B(J)}}function z(Y){try{$(D['throw'](Y))}catch(J){B(J)}}function $(Y){Y.done?L(Y.value):new I(function(J){J(Y.value)}).then(H,z)}$((D=D.apply(N,M||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});h.BaseHandler=class{constructor(N){this.messageKey=null,this.eventType=[],this.layer=N}createMessage(){throw new Error('Not implemented')}createBotMessage(){throw new Error('Not implemented')}handleFailedBotResponse(){return R(this,void 0,void 0,function*(){return!1})}handleMessage(){return R(this,void 0,void 0,function*(){})}handleMessageUpdate(){return R(this,void 0,void 0,function*(){})}handleMessageReceipt(){return R(this,void 0,void 0,function*(){})}handleEvent(){return R(this,void 0,void 0,function*(){})}callCreateMessage(N){return R(this,void 0,void 0,function*(){return this.createMessage(N)})}callCreateBotMessage(N){return R(this,void 0,void 0,function*(){return this.createMessage(N)})}callHandleFailedBotResponse(N,M){return R(this,void 0,void 0,function*(){return M&&!0!==M.success&&(yield this.handleFailedBotResponse(N,M))})}callHandleMessage(N){return R(this,void 0,void 0,function*(){yield this.handleMessage(N)})}callHandleMessageUpdate(N){return R(this,void 0,void 0,function*(){yield this.handleMessageUpdate(N)})}callHandleMessageReceipt(N){return R(this,void 0,void 0,function*(){yield this.handleMessageReceipt(N)})}callHandleEvent(N,M){return R(this,void 0,void 0,function*(){yield this.handleEvent(N,M)})}}},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const A=E(13);h.ComponentStylesMixin=function(N){class M extends N{constructor(...I){super(...I);const D=window.ShadyCSS;if(this.styleElements||(this.styleElements=[]),!!this.componentStyles)if(!D)this.styleElements=[A.h('style',this.componentStyles),...this.styleElements];else{if(!this.overridingStylesMixinApplied)return;const B=this.localName;if(!0!==M._seenTags[B]){M._seenTags[B]=!0;const H=document.createElement('template');H.innerHTML=`<style>${this.componentStyles}</style>`,D.prepareTemplate(H,B)}}}get componentStylesMixinApplied(){return!0}}return M._seenTags={},M}},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R=E(57);h.RenderMixin=R.RenderMixin;var A=E(54);h.ComponentStylesMixin=A.ComponentStylesMixin;var N=E(56);h.OverridingStylesMixin=N.OverridingStylesMixin},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const A=E(13);h.OverridingStylesMixin=function(N){class M extends N{constructor(...I){super(...I);const D=this.localName,L=window.ShadyCSS,H=window.__CtOverridingStyles||{},z=[...(H['*']||[]),...(H[D.toLowerCase()]||[])];if(!L)z&&(!this.styleElements&&(this.styleElements=[]),z.forEach(($)=>{const Y=/^(.*?)\.css$/.test($),J=Y?`@import url('${$}');`:$;this.styleElements=[...this.styleElements,A.h('style',J)]}));else if(!0!==M._seenTags[D]){function $(J){return new Promise((G)=>{const W=new XMLHttpRequest;W.onreadystatechange=()=>{W.readyState===XMLHttpRequest.DONE&&(200===W.status?G(W.responseText):G(`:host { content: 'Error: could not load stylesheet: ${J}' }`))},W.open('GET',J),W.send()})}M._seenTags[D]=!0;const Y=[];z&&z.forEach((J)=>{const G=/^(.*?)\.css$/.test(J),W=G?$(J):Promise.resolve(J);Y.push(W)}),Promise.all(Y).then((J)=>{const G=document.createElement('template');if(this.componentStyles&&!0===this.componentStylesMixinApplied&&(G.innerHTML+=this.componentStyles),0<J.length){const W=J.join('\n');G.innerHTML+=`<style>${W}</style>`}G.innerHTML.length&&L.prepareTemplate(G,D)})}}get overridingStylesMixinApplied(){return!0}}return M._seenTags={},M}},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0}),h.RenderMixin=function(A){function N(I){return I instanceof Array?I:[I]}return class extends A{renderCallback(){const I=N(this.styleElements||[]),D=N(this.componentMarkup?this.componentMarkup()||[]:[]);return[...I,...D]}}}},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R;(function(A){A[A.Broadcaster='broadcaster']='Broadcaster',A[A.Responder='responder']='Responder'})(R=h.AppMode||(h.AppMode={}))},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R;(function(A){A[A.Connecting='connecting']='Connecting',A[A.Connected='connected']='Connected',A[A.Disconnected='disconnected']='Disconnected',A[A.Disconnecting='disconnecting']='Disconnecting'})(R=h.ConnectionStatus||(h.ConnectionStatus={}))},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});h.DisconnectionStatus=class{constructor(A,N){this.wontReconnect=A,this.reason=N}getReason(){return this.reason}}},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R;(function(A){A[A.None='none']='None',A[A.Participant='participant']='Participant',A[A.Moderator='moderator']='Moderator'})(R=h.RoomRole||(h.RoomRole={}))},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R;(function(A){A[A.Contact='contact']='Contact',A[A.VCard='vcard']='VCard',A[A.Participant='participant']='Participant'})(R=h.UserAdditionalDetailsType||(h.UserAdditionalDetailsType={}))},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(I,D,L,B){return new(L||(L=Promise))(function(H,z){function $(G){try{J(B.next(G))}catch(W){z(W)}}function Y(G){try{J(B['throw'](G))}catch(W){z(W)}}function J(G){G.done?H(G.value):new L(function(W){W(G.value)}).then($,Y)}J((B=B.apply(I,D||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(18),N=E(9);h.BaseStore=class{constructor(I,D,L=!1,B=!0){this._saveToPersistentQueue=Promise.resolve(),this._isDestoryingDb=!1,this._lastResolve=null,this.name=I,this.logger=D,this._autoCompact=L,this._encryption=B}init(){return R(this,void 0,void 0,function*(){this._db||(yield this._createDb(this.name)),this._autoCompact||(yield this._db.compact()),this.state=yield this.getFromPersistent()})}savePushNotificationToken(I){return R(this,void 0,void 0,function*(){this.state.pushNotificationToken=I,yield this.saveToPersistent()})}getPushNotificationToken(){return R(this,void 0,void 0,function*(){return this.state.pushNotificationToken})}savePushNotificationAzureId(I){return R(this,void 0,void 0,function*(){this.state.pushNotificationTokenAzureId=I,yield this.saveToPersistent()})}getPushNotificationAzureId(){return R(this,void 0,void 0,function*(){return this.state.pushNotificationTokenAzureId})}clearAllData(){return R(this,void 0,void 0,function*(){return new Promise((I)=>{localStorage.removeItem(this.name),this._db&&!this._isDestoryingDb?(this._isDestoryingDb=!0,this._db.destroy().then(()=>{return this._createDb(this.name),this.init()}).then(()=>{this._isDestoryingDb=!1,I()})):I()})})}getLoggerTypes(){return R(this,void 0,void 0,function*(){return this.state.loggerTypes})}saveLoggerTypes(I){return R(this,void 0,void 0,function*(){return this.state.loggerTypes=I,yield this.saveToPersistent()})}deleteLoggerTypes(){return R(this,void 0,void 0,function*(){return delete this.state.loggerTypes,yield this.saveToPersistent()})}getStateSnapshot(){return this.state}getTheme(){return R(this,void 0,void 0,function*(){return this.state.theme||''})}saveTheme(I){return R(this,void 0,void 0,function*(){return this.state.theme=I,yield this.saveToPersistent()})}getFromPersistent(){return R(this,void 0,void 0,function*(){if(this._db)try{return yield this._db.get(this.name)}catch(I){const D=this.generateInitialState(),L=yield this._db.put(D);return D._rev=L.rev,D}else{localStorage.getItem(this.name)?JSON.parse(localStorage.getItem(this.name)):this.generateInitialState()}})}saveToPersistent(){return R(this,void 0,void 0,function*(){return this._saveDebouncer&&(clearTimeout(this._saveDebouncer),this._lastResolve(),this._lastResolve=null),new Promise((I)=>{this._lastResolve=I,this._saveDebouncer=setTimeout(()=>{this._db?this._saveToPersistentQueue=this._saveToPersistentQueue.then(()=>R(this,void 0,void 0,function*(){try{const D=yield this._db.put(this.state);this.state._rev=D.rev,this.logger.shouldLog(N.LoggerTypes.DataStorage)&&this.logger.log(N.LoggerTypes.DataStorage,'\uD83D\uDCBE %cSTATE UPDATED:','color: #606; font-weight: bold;',{state:Object.assign({},this.state)}),I()}catch(D){throw new Error(D)}})):(localStorage[this.name]=JSON.stringify(this.state),this.logger.shouldLog(N.LoggerTypes.DataStorage)&&this.logger.log(N.LoggerTypes.DataStorage,'\uD83D\uDCBE %cSTATE UPDATED:','color: #606; font-weight: bold;',{state:Object.assign({},this.state)}),I())},150)})})}_createDb(I){return R(this,void 0,void 0,function*(){if(!window.PouchDB)this.logger.log(N.LoggerTypes.DataStorage,'\uD83D\uDCBE %cCANNOT FIND POUCHDB, USING LOCAL STORAGE INSTEAD','color: #606; font-weight: bold;');else if(this.logger.log(N.LoggerTypes.DataStorage,` %cUSING POUCHDB: %c${I}`,'color: #606; font-weight: bold;','color: #999; font-weight: normal;'),this._db=new window.PouchDB(`${I}`,{revs_limit:1,auto_compaction:this._autoCompact}),!0===this._encryption){this.logger.log(N.LoggerTypes.DataStorage,` %cENCRYPTING POUCHDB...`,'color: #606; font-weight: bold;','color: #999; font-weight: normal;');const D=yield A.getEncryptionKey(I+'_pg_layer');this._db.crypto({key:D})}})}}},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(I,D,L,B){return new(L||(L=Promise))(function(H,z){function $(G){try{J(B.next(G))}catch(W){z(W)}}function Y(G){try{J(B['throw'](G))}catch(W){z(W)}}function J(G){G.done?H(G.value):new L(function(W){W(G.value)}).then($,Y)}J((B=B.apply(I,D||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(9),N=E(45);class M extends N.BaseComms{constructor(I,D,L,B){D.enableMessageCarbons=!0,super(I,D,L,B)}getMessagesFromMam(){return R(this,void 0,void 0,function*(){this.logger.log(A.LoggerTypes.Mam,`%c FETCHING MESSAGES FROM THE MAM`,'color: #669; font-weight: bold;'),this.triggerFetchingMissedMessagesState(!0);try{const D=yield this.queryMam(null,this.client.getLastArchiveId(),null,null,!1);return this.logger.log(A.LoggerTypes.Mam,`%c FOUND ${D.length} MESSAGE(S) IN THE MAM`,'color: #669; font-weight: bold;',[...D]),this.logger.log(A.LoggerTypes.Mam,`%c FINISHED FETCHING MESSAGES FROM THE MAM`,'color: #669; font-weight: bold;'),D}catch(D){throw this.logger.error(D),D}finally{this.triggerFetchingMissedMessagesState(!1)}})}syncTimeWithServer(){return R(this,void 0,void 0,function*(){return yield this.client.getServerTime()})}updateUserDirectory(){return R(this,void 0,void 0,function*(){try{yield this.client.updateUserDirectory()}catch(I){throw this.logger.error(I),I}})}setPresence(){return R(this,void 0,void 0,function*(){try{yield this.client.sendPresence()}catch(I){throw this.logger.error(I),I}})}preventPresence(){this.client.setClientState('inactive')}getCurrentUser(){return R(this,void 0,void 0,function*(){return yield this.client.getUserByJid(this.client.bareJid)})}initializeFirstConnection(){const I=(D)=>super[D];return R(this,void 0,void 0,function*(){I('initializeFirstConnection').call(this);var D='undefined'!=typeof navigator&&/Android/.test(navigator.userAgent);D&&this.client.addExcludeStanzaFilter((L)=>{const B=L.message&&L.message.data&&L.message.data.newpage;if(!B)return!1;const H=window;return H.plugins&&H.plugins.insomnia&&H.plugins.insomnia.switchOnScreenAndForeground(()=>{this.logger.log(A.LoggerTypes.MessageReceived,`Insomnia call complete`)},(z)=>{this.logger.log(A.LoggerTypes.MessageReceived,`Insomnia call failed ${z}`)},{showWhenLocked:!0,turnScreenOn:!0,dismissKeyGuard:!0,keepScreenOn:!0}),!1})})}embelishUser(I,D){return R(this,void 0,void 0,function*(){const L=yield this.client.getUserByJid(I.jid);return I.firstName=L.firstName,I.lastName=L.lastName,D.vCard&&(I.vCard=D.vCard),I})}downloadAttachments(I){return R(this,void 0,void 0,function*(){const D=yield this.client.getMessageById(I);return yield this.client.downloadAttachments(D,!0)})}purgeOldMessages(){return R(this,void 0,void 0,function*(){return yield this.client.purgeOldMessages()})}}h.Comms=M},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(5);class A extends R.BaseEventArgs{constructor(N){super(),this.messageId=N}}h.BasePageEventArgs=A},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(5);class A extends R.BaseEventArgs{constructor(N){super(),this.page=N}}h.ReadPageDetailEventArgs=A},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(5);class A extends R.BaseEventArgs{constructor(N){super(),this.page=N}}h.SendNewPageEventArgs=A},function(l,h,E){'use strict';Object.defineProperty(h,'__esModule',{value:!0});const R=E(5);class A extends R.BaseEventArgs{constructor(N,M,I,D=!1){super(),this.response=M,this.pageId=N,this.sender=I,this.isTestPage=D}}h.SendPageResponseEventArgs=A},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(D,L,B,H){return new(B||(B=Promise))(function(z,$){function Y(W){try{G(H.next(W))}catch(X){$(X)}}function J(W){try{G(H['throw'](W))}catch(X){$(X)}}function G(W){W.done?z(W.value):new B(function(X){X(W.value)}).then(Y,J)}G((H=H.apply(D,L||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(10),N=E(2),M=E(6);class I extends A.BaseHandler{constructor(){super(...arguments),this.messageKey=null,this.eventType=[M.PagerEvents._Request_Logout,M.PagerEvents.LoginResult]}createMessage(){return{}}handleMessage(){return R(this,void 0,void 0,function*(){})}handleMessageUpdate(){return R(this,void 0,void 0,function*(){})}handleMessageReceipt(){return R(this,void 0,void 0,function*(){})}handleEvent(D){return R(this,void 0,void 0,function*(){D===M.PagerEvents._Request_Logout&&this.layer.emit(M.PagerEvents._Request_RaiseAlert,N.DefaultAlerts.AlertYesNoQuestion('Logout','Do you wish to logout?',1,{yes:()=>R(this,void 0,void 0,function*(){yield this.layer.comms.logout(!0),yield this.layer.clearAllData(),this.layer.emit(M.PagerEvents._Request_Component_Clear_Data),this.layer.emit(M.PagerEvents.LogoutRequestConfirmed)})}))})}}h.ConnectivityHandler=I},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(L,B,H,z){return new(H||(H=Promise))(function($,Y){function J(X){try{W(z.next(X))}catch(K){Y(K)}}function G(X){try{W(z['throw'](X))}catch(K){Y(K)}}function W(X){X.done?$(X.value):new H(function(K){K(X.value)}).then(J,G)}W((z=z.apply(L,B||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(10),N=E(11),M=E(17),I=E(8);class D extends A.BaseHandler{constructor(){super(...arguments),this.messageKey=N.PagerMessageTypes.DiagnosticsRequest,this.eventType=[]}createMessage(L){return L}handleMessage(L){return R(this,void 0,void 0,function*(){const B=L.data[this.messageKey];!0===B.enableLogging?this.layer.setSupportLoggingTypes(['_all_']):this.layer.resetSupportLogging();const H={currentUser:this.layer.getCurrentUserJid(),config:this.layer.config,state:this.layer.store.getStateSnapshot(),pagerVersion:M.PagerLayer.VERSION,appVersion:''};window.cti&&(H.appVersion=window.cti.store.schema.version);const z=[I.createAddressFromJid(L.sender_id)];this.layer.sendMulticastMessage(N.PagerMessageTypes.DiagnosticsRequest,H,z)})}handleMessageUpdate(){return R(this,void 0,void 0,function*(){})}handleMessageReceipt(){return R(this,void 0,void 0,function*(){})}handleEvent(){return R(this,void 0,void 0,function*(){})}}h.DiagnosticsRequestHandler=D},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(M,I,D,L){return new(D||(D=Promise))(function(B,H){function z(J){try{Y(L.next(J))}catch(G){H(G)}}function $(J){try{Y(L['throw'](J))}catch(G){H(G)}}function Y(J){J.done?B(J.value):new D(function(G){G(J.value)}).then(z,$)}Y((L=L.apply(M,I||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(10);class N extends A.BaseHandler{constructor(){super(...arguments),this.messageKey='json',this.eventType=[]}createMessage(){return{}}handleMessage(M){return R(this,void 0,void 0,function*(){const I=M.data[this.messageKey];switch(I.data.type){case'register':yield this.layer.store.savePushNotificationAzureId(I.data.RegistrationId);break;case'remove':yield this.layer.store.savePushNotificationAzureId('');}})}handleMessageUpdate(){return R(this,void 0,void 0,function*(){})}handleMessageReceipt(){return R(this,void 0,void 0,function*(){})}handleEvent(){return R(this,void 0,void 0,function*(){})}}h.PushNotificationResponseHandler=N},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(I,D,L,B){return new(L||(L=Promise))(function(H,z){function $(G){try{J(B.next(G))}catch(W){z(W)}}function Y(G){try{J(B['throw'](G))}catch(W){z(W)}}function J(G){G.done?H(G.value):new L(function(W){W(G.value)}).then($,Y)}J((B=B.apply(I,D||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(10),N=E(6);class M extends A.BaseHandler{constructor(){super(...arguments),this.messageKey=null,this.eventType=[N.PagerEvents._Request_ReadPageDetail]}createMessage(){return{}}handleMessage(){return R(this,void 0,void 0,function*(){})}handleMessageUpdate(){return R(this,void 0,void 0,function*(){})}handleMessageReceipt(){return R(this,void 0,void 0,function*(){})}handleEvent(I,D){return R(this,void 0,void 0,function*(){if(I===N.PagerEvents._Request_ReadPageDetail){const L=D;this.layer.config.isBroadcaster?this.layer.emit(N.PagerEvents._Request_OpenBroadcasterReadModal,L.page):this.layer.emit(N.PagerEvents._Request_OpenClientReadModal,L.page)}})}}h.ReadPageDetailHandler=M},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(L,B,H,z){return new(H||(H=Promise))(function($,Y){function J(X){try{W(z.next(X))}catch(K){Y(K)}}function G(X){try{W(z['throw'](X))}catch(K){Y(K)}}function W(X){X.done?$(X.value):new H(function(K){K(X.value)}).then(J,G)}W((z=z.apply(L,B||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(10),N=E(11),M=E(6),I=E(8);class D extends A.BaseHandler{constructor(){super(...arguments),this.messageKey=N.PagerMessageTypes.NewPage,this.eventType=[]}createMessage(L){return Object.assign({},L.page)}handleMessage(L){return R(this,void 0,void 0,function*(){const B=L.data[this.messageKey];B.messageId=L._id,B.ts=L.ts;const H=yield this._getPageIfExists(B._id);H||(B.messageSplit=I.parseMessageContent(B.message),yield this.layer.store.addPage(B),!this.layer.config.isBroadcaster&&(yield this.layer.store.addToPendingPages(B),this.layer.sendReadReceipt(B)),this.layer.emit(M.PagerEvents.NewPageReceived,B))})}handleMessageUpdate(L){return R(this,void 0,void 0,function*(){const B=L.data[this.messageKey];let H=yield this._getPageIfExists(B._id);H&&(!1===H.attachmentsLoaded&&0<L.attachments.length&&(H=I.addAttachmentsToPage(L,H),yield this.layer.store.updatePage(H)),this.layer.emit(M.PagerEvents.PageUpdate,H))})}handleMessageReceipt(){return R(this,void 0,void 0,function*(){})}handleEvent(){return R(this,void 0,void 0,function*(){})}_getPageIfExists(L){return R(this,void 0,void 0,function*(){const B=yield this.layer.getPages(),H=B.find((z)=>z._id===L);return H||null})}}h.ReceiveNewPageHandler=D},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(z,$,Y,J){return new(Y||(Y=Promise))(function(G,W){function X(Z){try{Q(J.next(Z))}catch(ee){W(ee)}}function K(Z){try{Q(J['throw'](Z))}catch(ee){W(ee)}}function Q(Z){Z.done?G(Z.value):new Y(function(ee){ee(Z.value)}).then(X,K)}Q((J=J.apply(z,$||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(10),N=E(2),M=E(11),I=E(7),D=E(6),L=E(4),B=E(8);class H extends A.BaseHandler{constructor(){super(...arguments),this.messageKey=null,this.eventType=[D.PagerEvents._Request_SendNewPage]}createMessage(){return{}}handleMessage(){return R(this,void 0,void 0,function*(){})}handleMessageUpdate(){return R(this,void 0,void 0,function*(){})}handleMessageReceipt(){return R(this,void 0,void 0,function*(){})}handleEvent(z,$){return R(this,void 0,void 0,function*(){if(z===D.PagerEvents._Request_SendNewPage){const Y=$;try{Y.page._id=L.generateRandomSixString(),Y.page.individuals=[],Y.page.to.map((K)=>{Y.page.individuals=[...Y.page.individuals,...K.contacts]});const J=[...(yield this.layer.getAllContacts(!0,I.FilterType.Include)),...Y.page.individuals],G=B.convertContactsIntoAddressList(J),W=Y.page.image.concat(Y.page.audio),X=yield this.layer.store.getPageById(Y.page._id);if(!X)try{const K=yield this.layer.sendMulticastMessage(M.PagerMessageTypes.NewPage,{page:Y.page},G,W);Y.page.messageId=K._id,yield this.layer.store.addPage(Y.page),yield this.layer.purgeOldPages(!0),this.layer.emit(D.PagerEvents.PageUpdate,Y.page),setTimeout(()=>this.layer.emit(D.PagerEvents._Request_CloseSendNewPageModal),2e3)}catch(K){this.layer.emit(D.PagerEvents.SendingPageError,K)}}catch(J){this.layer.emit(D.PagerEvents._Request_RaiseAlert,N.DefaultAlerts.AlertErrorWithOkayButton('Send Error',J,1,{}))}}})}}h.SendNewPageHandler=H},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(J,G){function W(Q){try{K(Y.next(Q))}catch(Z){G(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){G(Z)}}function K(Q){Q.done?J(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(10),N=E(2),M=E(11),I=E(7),D=E(6),L=E(8);class B extends A.BaseHandler{constructor(){super(...arguments),this.testMessageResponseQueue=Promise.resolve(),this.messageKey=M.PagerMessageTypes.PageResponse,this.eventType=[D.PagerEvents.PageResponse]}createMessage(H){return H}handleMessage(H){return R(this,void 0,void 0,function*(){const z=H.data[this.messageKey];let $=yield this.layer.store.getPageById(z.pageId);if($){if($=yield this.layer.addContactResponseToPage($,z.response,z.from),z.from===this.layer.getCurrentUserJid()&&!this.layer.config.isBroadcaster&&z.response.type===I.ContactResponseType.Response){yield this.layer.store.removePendingPage(z.pageId),this.layer.emit(D.PagerEvents.RespondedToPage,z.pageId);const Y=yield this.layer.getPendingPages();0===Y.length&&this.layer.emit(D.PagerEvents.RespondedToAllPages)}this.layer.emit(D.PagerEvents.PageUpdate,$)}})}handleMessageUpdate(){return R(this,void 0,void 0,function*(){})}handleMessageReceipt(){return R(this,void 0,void 0,function*(){})}handleEvent(H,z){return R(this,void 0,void 0,function*(){if(H===D.PagerEvents.PageResponse&&!this.layer.config.isBroadcaster){const $=z;try{const Y={pageId:$.pageId,response:$.response,from:this.layer.getCurrentUserJid()};if(!$.isTestPage){const J=yield this.layer.getAllContactsInGroup(this.layer.config.filteredGroups),G=[...L.convertContactsIntoAddressList(J)];yield this._processAndSendPageResponse($,Y,G)}else{const J=[{type:'to',jid:$.sender}];yield this._processAndSendPageResponse($,Y,J),this.testMessageResponseQueue=this.testMessageResponseQueue.then(()=>R(this,void 0,void 0,function*(){setTimeout(()=>R(this,void 0,void 0,function*(){const G={pageId:Y.pageId,response:{type:I.ContactResponseType.Response,ts:new Date().getTime(),content:'Fake Response'},from:Y.from};return yield this._processAndSendPageResponse($,G,J)}),this.layer.config.testingResponseDelay||1e3)}))}}catch(Y){this.layer.emit(D.PagerEvents._Request_RaiseAlert,N.DefaultAlerts.AlertErrorWithOkayButton('Send Error',Y,1,{}))}}})}_processAndSendPageResponse(H,z,$){return R(this,void 0,void 0,function*(){const Y=yield this.layer.store.getPageById(H.pageId);Y?(yield this.layer.addContactResponseToPage(Y,z.response,z.from),yield this.layer.sendMulticastMessage(M.PagerMessageTypes.PageResponse,z,$),z.response.type===I.ContactResponseType.Response&&(yield this.layer.store.removePendingPage(H.pageId),this.layer.emit(D.PagerEvents.PageUpdate,null),this.layer.emit(D.PagerEvents.RespondedToPage,H.pageId))):this.layer.emit(D.PagerEvents.PageUpdate,null);const J=yield this.layer.getPendingPages();0===J.length&&this.layer.emit(D.PagerEvents.RespondedToAllPages)})}}h.SendPageResponseHandler=B},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(I,D,L,B){return new(L||(L=Promise))(function(H,z){function $(G){try{J(B.next(G))}catch(W){z(W)}}function Y(G){try{J(B['throw'](G))}catch(W){z(W)}}function J(G){G.done?H(G.value):new L(function(W){W(G.value)}).then($,Y)}J((B=B.apply(I,D||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(10),N=E(11);class M extends A.BaseHandler{constructor(){super(...arguments),this.messageKey=N.PagerMessageTypes.StartTest,this.eventType=[]}createMessage(){return{}}handleMessage(I){return R(this,void 0,void 0,function*(){const D=I.data[this.messageKey];this.layer.config.testingResponseDelay=D.responseDelay,this.layer.sendMessage(N.PagerMessageTypes.StartTest,I.sender_id,{ready:!0})})}handleMessageUpdate(){return R(this,void 0,void 0,function*(){})}handleMessageReceipt(){return R(this,void 0,void 0,function*(){})}handleEvent(){return R(this,void 0,void 0,function*(){})}}h.StartTestModeHandler=M},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R;(function(A){A[A.Received='received']='Received',A[A.Response='response']='Response'})(R=h.ContactResponseType||(h.ContactResponseType={}))},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R;(function(A){A[A.Android='android']='Android',A[A.Electron='electon']='Electron',A[A.iOS='ios']='iOS'})(R=h.DeviceType||(h.DeviceType={}))},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R;(function(A){A[A.Exclude='exclude']='Exclude',A[A.Include='get']='Include'})(R=h.FilterType||(h.FilterType={}))},function(l,h){'use strict';Object.defineProperty(h,'__esModule',{value:!0});var R;(function(A){A[A.NotReceivedNotification='not-received']='NotReceivedNotification',A[A.Received='received']='Received',A[A.Displayed='displayed']='Displayed',A[A.Unable='unable']='Unable',A[A.Attending='attending']='Attending',A[A.Acknowledged='acknowledged']='Acknowledged',A[A.AutoDismissed='auto-dismissed']='AutoDismissed'})(R=h.ResponseStatus||(h.ResponseStatus={}))},function(l,h,E){'use strict';var R=this&&this.__awaiter||function(M,I,D,L){return new(D||(D=Promise))(function(B,H){function z(J){try{Y(L.next(J))}catch(G){H(G)}}function $(J){try{Y(L['throw'](J))}catch(G){H(G)}}function Y(J){J.done?B(J.value):new D(function(G){G(J.value)}).then(z,$)}Y((L=L.apply(M,I||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const A=E(63);class N extends A.BaseStore{constructor(M,I,D){super(M,I,!1,D.xmpp.encryption),this.config=D}purgeOldPages(M=!1){return R(this,void 0,void 0,function*(){const I=new Date().getTime()-this.config.xmpp.maxMessageAge,D=[];return this.state.pages=this.state.pages.sort((L,B)=>B.openedDate-L.openedDate).reduce((L,B)=>{return B.openedDate>I?L.push(B):D.push(B),L},[]),D.length&&(this.state.pendingPages=this.state.pendingPages.reduce((L,B)=>{return D.find((H)=>H._id===B)||L.push(B),L},[])),M?yield this.saveToPersistent():Promise.resolve()})}setSelectedContacts(M){return R(this,void 0,void 0,function*(){this.state.selectedContacts=M,yield this.saveToPersistent()})}getSelectedContacts(){return R(this,void 0,void 0,function*(){const M=yield this.state.selectedContacts;return M.map((I)=>{I.contacts.map((D)=>{return D.responses=[],D})}),M})}addPage(M){return R(this,void 0,void 0,function*(){this.state.pages=[M,...this.state.pages],yield this.saveToPersistent()})}updatePage(M){return R(this,void 0,void 0,function*(){const I=this.state.pages.findIndex((D)=>D._id===M._id);-1<I&&(this.state.pages[I]=M,yield this.saveToPersistent())})}addOrUpdatePage(M){return R(this,void 0,void 0,function*(){const I=this.state.pages.findIndex((D)=>D._id===M._id);-1<I?(this.state.pages[I]=M,this.state.pages=this.state.pages.sort((D,L)=>L.openedDate-D.openedDate),yield this.saveToPersistent()):yield this.addPage(M)})}getPages(M,I=!1,D,L){const B=D||this.state.pages.length;return I?this.state.pages.slice(0,B):this.state.pages.slice(L||0,B)}getPageById(M){return R(this,void 0,void 0,function*(){return this.state.pages.find((I)=>I._id===M)})}setSelectedPage(M){return R(this,void 0,void 0,function*(){this.state.selectedPage=M,yield this.saveToPersistent()})}getSelectedPage(){return R(this,void 0,void 0,function*(){return yield this.state.selectedPage})}addToPendingPages(M){return R(this,void 0,void 0,function*(){this.state.pendingPages=[M._id,...this.state.pendingPages],yield this.saveToPersistent()})}getPendingPages(M){return R(this,void 0,void 0,function*(){return this.state.pages.reduce((I,D)=>{return this.state.pendingPages.includes(D._id)&&I.push(D),I},[]).filter((I)=>I.sender===M||I.individuals.find((D)=>D.id===M)).sort((I,D)=>D.openedDate-I.openedDate)})}deletePage(M){return R(this,void 0,void 0,function*(){const I=this.state.pages.findIndex((D)=>D._id===M._id);-1<I&&this.state.pages.splice(I,1),yield this.saveToPersistent()})}addContactResponseToPage(M,I,D){return R(this,void 0,void 0,function*(){const L=this.state.pages.find((B)=>B._id===M._id);if(L){const B=L.individuals.find((H)=>H.id===D);if(B){const H=B.responses.find((z)=>z.type===I.type);H||(B.responses.push(I),yield this.saveToPersistent())}return L}return null})}removePendingPage(M){return R(this,void 0,void 0,function*(){this.state.pendingPages=this.state.pendingPages.filter((I)=>I===M?null:I),yield this.saveToPersistent()})}addToPageResponseQueue(M){return R(this,void 0,void 0,function*(){this.state.pageResponseQueue.push(M),yield this.saveToPersistent()})}removeFromPageResponseQueue(){return R(this,void 0,void 0,function*(){})}generateInitialState(){return{_id:this.name,_rev:'',selectedContacts:[],pages:[],selectedPage:null,pendingPages:[],pageResponseQueue:[]}}}h.Store=N},function(l,h,E){'use strict';function A($=['all'],Y=1){return I(this,void 0,void 0,function*(){const J=N();if(!J)return null;const G=[],W=J.config.pageTypes.length,X=J.config.replyTemplates.length,K=yield J.getAllContacts(!0);let Q=[];$.includes('all')?Q=B.convertContacts({},K,!0):($.map((Z)=>K.find((ee)=>ee.jid===Z).selected=!0),Q=B.convertContacts({},K));for(let Z=0;Z<Y;Z++){const ee=H.randomNumberBetween(0,W),te=H.randomNumberBetween(0,X),ne={to:Q,type:ee,replyTemplate:te,subject:`Test Message Subject: ${Z}`,message:`Test Message Body: ${Z}`,image:[],audio:[]},ae=B.createNewPage(ne,J.getCurrentUserJid(),J.config.pageTypes[ee],J.config.replyTemplates[te],new Date().getTime());G.push(ae)}return G})}function N(){const $=window.__CTLayers;for(const Y in $)if($[Y].instance instanceof D.PagerLayer)return $[Y].instance;return null}var I=this&&this.__awaiter||function($,Y,J,G){return new(J||(J=Promise))(function(W,X){function K(ee){try{Z(G.next(ee))}catch(te){X(te)}}function Q(ee){try{Z(G['throw'](ee))}catch(te){X(te)}}function Z(ee){ee.done?W(ee.value):new J(function(te){te(ee.value)}).then(K,Q)}Z((G=G.apply($,Y||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const D=E(17),L=E(7),B=E(8),H=E(4),z=E(6);h.sendBatchMessages=function($=1,Y=0,J=['all']){return I(this,void 0,void 0,function*(){const G=N(),W=yield A(J,$);if(!G||!W)return;let X=0;setInterval(()=>{for(;X<W.length;){const K=W[X];G.emit(z.PagerEvents._Request_SendNewPage,new z.SendNewPageEventArgs(K)),++X}},1e3*Y)})},h.createFakePages=A,h.getPagerLayer=N,h.respondToAllPendingMessages=function(){return I(this,void 0,void 0,function*(){const $=N(),Y=yield $.getPendingPages();Y.map((J)=>I(this,void 0,void 0,function*(){const G={ts:new Date().getTime(),content:'Test Response',type:L.ContactResponseType.Response};yield $.addContactResponseToPage(J,G),$.emit(z.PagerEvents.PageResponse,new z.SendPageResponseEventArgs(J._id,G,J.sender))}))})}},function(l,h,E){'use strict';var R=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,J=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,G;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(G=B[W])&&(J=(3>Y?G(J):3<Y?G(H,z,J):G(H,z))||J);return 3<Y&&J&&Object.defineProperty(H,z,J),J},A=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,J){function G(K){try{X($.next(K))}catch(Q){J(Q)}}function W(K){try{X($['throw'](K))}catch(Q){J(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(G,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(5),I=E(26),D=E(1);class L extends N.CTLayerComponent{static get is(){return'ct-alert-modal-manager'}initialize(){return A(this,void 0,void 0,function*(){})}setupListeners(){this.addListener(M.BaseEvents._Request_RaiseAlert,(B)=>this.raiseAlert(B)),this.addListener(M.BaseEvents._Request_CloseAlert,(B)=>this.dismissAlertById(B))}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:none;width:100%;height:100%;background:var(--modal-overlay, rgba(0,0,0,0.5));position:fixed;top:0;z-index:1000;padding:20px;overflow:auto}:host .alerts{display:flex;width:100%;max-width:420px;margin:auto;position:relative}:host([alerts-to-show]){display:flex}
        `}generateComponentMarkup(){return window.__CTRender('div',{class:'alerts'},this.alerts.map((B,H)=>window.__CTRender(D.CTAlertModal,{id:B.id||I.DefaultAlerts.generateId(),raisedOn:B.raisedOn,priority:B.priority,type:B.type,title:B.title,body:B.body,buttons:B.buttons,remaining:this.alerts.length,positionInStack:H,showLoadingAnimation:B.showLoadingAnimation})))}raiseAlert(B){if(B){if(B.buttons)for(const H of B.buttons)if(!H.action)H.action=()=>this.dismissAlert();else{const z=H.action.bind(this);H.action=($)=>{z($),this.dismissAlert()}}this.alerts=[...this.alerts,B],this.alertsToShow=!0}}dismissAlert(B=0){this.alerts.splice(B,1),0===this.alerts.length?this.alertsToShow=!1:this.alerts=this.alerts.map((H)=>{return H.remaining=this.alerts.length,H})}dismissAlertById(B){const H=this.alerts.findIndex((z)=>z.id===B);-1!==H&&this.dismissAlert(H)}}R([N.prop({type:Boolean,attribute:!0,default:!1})],L.prototype,'alertsToShow',void 0),R([N.prop({type:Array,attribute:!1,default:[]})],L.prototype,'alerts',void 0),h.CTAlertModalManager=L,L.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,J=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,G;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(G=B[W])&&(J=(3>Y?G(J):3<Y?G(H,z,J):G(H,z))||J);return 3<Y&&J&&Object.defineProperty(H,z,J),J},A=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,J){function G(K){try{X($.next(K))}catch(Q){J(Q)}}function W(K){try{X($['throw'](K))}catch(Q){J(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(G,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(27),I=E(1),D=E(3);class L extends N.CTLayerComponent{static get is(){return'ct-alert-modal'}initialize(){return A(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:none;width:100%;height:100%;flex-direction:column;background-color:var(--modal-bg, #fff)}:host .alert-dialog{overflow:hidden}:host .alert-dialog .remaining{position:absolute;width:35px;height:35px;background-color:red;border-radius:50%;text-align:center;line-height:35px;color:white;right:-5%;top:-5%}:host .alert-dialog .title{display:flex;justify-content:center;text-align:center;font-size:16px;text-transform:uppercase;margin:0 auto;padding:10px}:host .alert-dialog .body{display:flex;justify-content:center;text-align:center;align-items:flex-start;font-size:18px;font-weight:300;padding:50px}:host .alert-dialog .body ct-icon{flex:none;margin:3px 10px 0 0}:host .alert-dialog .buttons{padding:10px 5px;flex:none;display:flex;flex-wrap:wrap;flex-direction:row;justify-content:space-between}:host .alert-dialog .buttons ct-button{flex:1;margin:0 5px}:host .alert-dialog .buttons ct-button.overflex{flex-basis:100%}:host .alert-dialog .buttons ct-button.overflex+ct-button{margin-top:10px}:host .alert-dialog.error .title{background-color:var(--alert-error-bg, #c80031);color:var(--alert-error-text, #fff)}:host .alert-dialog.info .title{background-color:var(--alert-info-bg, #15233b);color:var(--alert-info-text, #fff)}:host .alert-dialog.question .title{background-color:var(--alert-question-bg, #15233b);color:var(--alert-question-text, #fff)}:host .alert-dialog.success .title{background-color:var(--alert-success-bg, #bcdf90);color:var(--alert-success-text, #fff)}:host([showing]){display:flex;z-index:10}:host([stacked]){display:flex;position:absolute;bottom:5px;right:5px;z-index:1}:host([stacked]):before{content:'';display:block;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.25)}
        `}generateComponentMarkup(){const B=M.Icons.COMMON.LoadingSpinner,H=5*this.positionInStack;return this.style.right=`${H}px`,this.style.bottom=`${H}px`,this.style.zIndex=`${this.remaining-this.positionInStack}`,0===this.positionInStack?this.showing=!0:this.stacked=!0,window.__CTRender('div',{"alert-id":this.id,class:`alert-dialog ${this.type}`},1<this.remaining&&this.showing?window.__CTRender('div',{class:'remaining'},this.remaining):null,window.__CTRender('div',{class:'title'},this.renderHtml(this.title)),window.__CTRender('div',{class:'body'},D.renderIf(this.showLoadingAnimation,window.__CTRender(I.CTIcon,{class:'loading',width:'18',height:'18',spin:!0,icon:B})),window.__CTRender('div',{class:'message'},this.renderHtml(this.body))),D.renderIf(!!this.buttons&&0<this.buttons.length,window.__CTRender('div',{class:'buttons'},this.buttons.map((z,$)=>window.__CTRender(I.CTButton,{type:z.type,class:`${2<this.buttons.length?'overflex':''} ${2===this.buttons.length&&0===$?'right-border':''}`,onClick:(Y)=>z.action(Y.target.textContent)},z.text)))))}}R([N.prop({type:Boolean,attribute:!0,default:!1})],L.prototype,'showing',void 0),R([N.prop({type:String,attribute:!1,default:0})],L.prototype,'id',void 0),R([N.prop({type:Number,attribute:!1,default:0})],L.prototype,'raisedOn',void 0),R([N.prop({type:Number,attribute:!1,default:0})],L.prototype,'priority',void 0),R([N.prop({type:String,attribute:!1,default:'info'})],L.prototype,'type',void 0),R([N.prop({type:String,attribute:!1,default:''})],L.prototype,'title',void 0),R([N.prop({type:String,attribute:!1,default:''})],L.prototype,'body',void 0),R([N.prop({type:Array,attribute:!1,default:[]})],L.prototype,'buttons',void 0),R([N.prop({type:Number,attribute:!1,default:0})],L.prototype,'remaining',void 0),R([N.prop({type:Number,attribute:!1,default:0})],L.prototype,'positionInStack',void 0),R([N.prop({type:Boolean,attribute:!1,default:!1})],L.prototype,'showLoadingAnimation',void 0),R([N.prop({type:Boolean,attribute:!0,default:!1})],L.prototype,'stacked',void 0),h.CTAlertModal=L,L.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(L,B,H,z){var $=arguments.length,Y=3>$?B:null===z?z=Object.getOwnPropertyDescriptor(B,H):z,J;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)Y=Reflect.decorate(L,B,H,z);else for(var G=L.length-1;0<=G;G--)(J=L[G])&&(Y=(3>$?J(Y):3<$?J(B,H,Y):J(B,H))||Y);return 3<$&&Y&&Object.defineProperty(B,H,Y),Y},A=this&&this.__awaiter||function(L,B,H,z){return new(H||(H=Promise))(function($,Y){function J(X){try{W(z.next(X))}catch(K){Y(K)}}function G(X){try{W(z['throw'](X))}catch(K){Y(K)}}function W(X){X.done?$(X.value):new H(function(K){K(X.value)}).then(J,G)}W((z=z.apply(L,B||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(14),I=E(9);class D extends N.CTLayerComponent{constructor(){super(...arguments),this._supportedFormats=['mp3'],this._logger=null,this._$audio=null}static get is(){return'ct-audio'}initialize(){return A(this,void 0,void 0,function*(){this._logger=new I.Logger})}pause(){this._$audio&&this._$audio.pause()}setupListeners(){this.onRenderComplete(()=>{this._$audio=this.shadowRoot.querySelector('audio'),'ios'===M.getPlatformName()?window.requestFileSystem(window.LocalFileSystem.PERSISTENT,0,(L)=>{const B=this.src.split('/Documents/')[1],H=this.src.split('.'),z=H[H.length-1];this._supportedFormats.includes(z)?L.root.getFile(B,{create:!1,exclusive:!1},($)=>{$.file((Y)=>{const J=new FileReader;J.onload=(G)=>{const W=G.target.result,X=new Blob([new Uint8Array(W)],{type:`audio/mpeg`});this._$audio.setAttribute('src',window.URL.createObjectURL(X)),this._loadAudio()},J.readAsArrayBuffer(Y)},(Y)=>{this._logger.error(`Could not read file entry.`,Y)})},($)=>{this._logger.error(`Could not read file path.`,$)}):this._logger.error(`'${z}' is not a supported audio format, only ${this._supportedFormats.join(', ')} are supported.`)},(L)=>{this._logger.error(`Could not read file system.`,L)}):(this._$audio.setAttribute('src',this.src),setTimeout(()=>{this._loadAudio()},250))})}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host audio{width:100%;height:50px}
        `}_loadAudio(){this._$audio.load(),this.onLoad&&this.onLoad()}generateComponentMarkup(){return window.__CTRender('audio',{controls:!0,preload:'auto'})}}R([N.prop({type:String,attribute:!0})],D.prototype,'src',void 0),R([N.prop({type:Function,attribute:!1})],D.prototype,'onLoad',void 0),h.CTAudio=D,D.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,J=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,G;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(G=B[W])&&(J=(3>Y?G(J):3<Y?G(H,z,J):G(H,z))||J);return 3<Y&&J&&Object.defineProperty(H,z,J),J},A=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,J){function G(K){try{X($.next(K))}catch(Q){J(Q)}}function W(K){try{X($['throw'](K))}catch(Q){J(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(G,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(16),I=E(1),D=E(2);class L extends N.CTLayerComponent{constructor(){super(...arguments),this.btnClick=()=>A(this,void 0,void 0,function*(){const B=yield M.CtXmppClient.pickFile({mimeTypes:this.fileTypes});this.callback&&this.callback(B)})}static get is(){return'ct-file-picker'}initialize(){return A(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return``}generateComponentMarkup(){return window.__CTRender('div',null,window.__CTRender(I.CTButton,{icon:D.Icons.COMMON.PlusSign,iconColor:'#fff',onClick:this.btnClick}))}}R([N.prop({type:Array,attribute:!0,default:['image/jpeg','image/png','image/gif']})],L.prototype,'fileTypes',void 0),R([N.prop({type:Function,attribute:!1})],L.prototype,'callback',void 0),h.CTFilePicker=L,L.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(D,L,B,H){var z=arguments.length,$=3>z?L:null===H?H=Object.getOwnPropertyDescriptor(L,B):H,Y;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)$=Reflect.decorate(D,L,B,H);else for(var J=D.length-1;0<=J;J--)(Y=D[J])&&($=(3>z?Y($):3<z?Y(L,B,$):Y(L,B))||$);return 3<z&&$&&Object.defineProperty(L,B,$),$},A=this&&this.__awaiter||function(D,L,B,H){return new(B||(B=Promise))(function(z,$){function Y(W){try{G(H.next(W))}catch(X){$(X)}}function J(W){try{G(H['throw'](W))}catch(X){$(X)}}function G(W){W.done?z(W.value):new B(function(X){X(W.value)}).then(Y,J)}G((H=H.apply(D,L||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(3);class I extends N.CTLayerComponent{static get is(){return'ct-icon'}initialize(){return A(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:flex}:host svg{margin:auto}:host([spin]) svg{animation:spin 1s infinite linear;transform-origin:50% 50%}@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
        `}generateComponentMarkup(){if(!this.icon)return null;const D=M.buildStyles({fill:'auto'===this.color?window.getComputedStyle(this.parentElement).color:this.color,width:this.width,height:this.height}),L=this.icon.viewBox||'0 0 1024 1024',B=this.icon.paths||[];return window.__CTRender('svg',{width:this.width,height:this.height,viewBox:L,style:D},B.map((H)=>window.__CTRender('path',{d:H})))}}R([N.prop({type:String,attribute:!0})],I.prototype,'width',void 0),R([N.prop({type:String,attribute:!0})],I.prototype,'height',void 0),R([N.prop({type:String,attribute:!0,default:'auto'})],I.prototype,'color',void 0),R([N.prop({type:Boolean,attribute:!0,default:!1})],I.prototype,'spin',void 0),R([N.prop({type:Object,attribute:!1,default:null})],I.prototype,'icon',void 0),h.CTIcon=I,I.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,J=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,G;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(G=B[W])&&(J=(3>Y?G(J):3<Y?G(H,z,J):G(H,z))||J);return 3<Y&&J&&Object.defineProperty(H,z,J),J},A=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,J){function G(K){try{X($.next(K))}catch(Q){J(Q)}}function W(K){try{X($['throw'](K))}catch(Q){J(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(G,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(14),I=E(9),D=E(15);class L extends N.CTLayerComponent{constructor(){super(...arguments),this._src=null,this._logger=null}static get is(){return'ct-img'}initialize(){return A(this,void 0,void 0,function*(){if(this.src)if(this._imageLoaded=this._imageLoaded.bind(this),this._logger=new I.Logger,M.isDevice()){const B=D.getSource('thumbnail');if(!B)return void this._logger.error(`Thumbnail plugin could not be found.`);B.makeThumbnail((H)=>{this._src=H,this.forceRedraw()},(H)=>{this._logger.error(`Could not create thumbnail of image.`,H)},this.src,320,320,100)}else this._src=this.src})}setupListeners(){}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host img{width:inherit;height:inherit}
        `}_imageLoaded(){this.onLoad&&this.onLoad()}generateComponentMarkup(){return this._src?window.__CTRender('img',{src:this._src,onload:this._imageLoaded}):null}}R([N.prop({type:String,attribute:!0})],L.prototype,'src',void 0),R([N.prop({type:Function,attribute:!1})],L.prototype,'onLoad',void 0),h.CTImg=L,L.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(H,z,$,Y){var J=arguments.length,G=3>J?z:null===Y?Y=Object.getOwnPropertyDescriptor(z,$):Y,W;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)G=Reflect.decorate(H,z,$,Y);else for(var X=H.length-1;0<=X;X--)(W=H[X])&&(G=(3>J?W(G):3<J?W(z,$,G):W(z,$))||G);return 3<J&&G&&Object.defineProperty(z,$,G),G},A=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(J,G){function W(Q){try{K(Y.next(Q))}catch(Z){G(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){G(Z)}}function K(Q){Q.done?J(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(5),I=E(3),D=E(1),L=E(2);class B extends N.CTLayerComponent{static get is(){return'ct-login-form'}initialize(){return A(this,void 0,void 0,function*(){this._resetFields()})}setupListeners(){this.addListener(M.BaseEvents.ConnectionStatusChange,(H)=>{switch(H.status){case L.ConnectionStatus.Connected:this.userLoggedIn=!0;break;case L.ConnectionStatus.Connecting:this.isWaiting=!0;break;default:this.isWaiting=!1,this.userLoggedIn=!1;}},{dontSuppress:!0})}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:block;width:100%;margin:auto}:host .form{display:flex;flex-direction:column;width:100%}:host .form .form-field,:host .form .form-buttons{margin:5px 0}
        `}generateComponentMarkup(){return this.userLoggedIn?this._renderLogoutForm():this._renderLoginForm()}_renderLoginForm(){const H=I.buildStyles({display:this.hideUsername?'none':'block'});return window.__CTRender('div',{class:'form'},window.__CTRender('div',{class:'form-field',style:H},window.__CTRender(D.CTTextbox,{type:'text',placeholder:'Username',name:'username',defaultValue:this._username,disabled:this.disableUsername||this.isWaiting,callback:(z)=>this._onChange(z),returnKeypress:()=>this._login()})),window.__CTRender('div',{class:'form-field'},window.__CTRender(D.CTTextbox,{type:'password',placeholder:'Password',name:'password',defaultValue:this._password,callback:(z)=>this._onChange(z),disabled:this.isWaiting,returnKeypress:()=>this._login()})),window.__CTRender('div',{class:'form-buttons'},window.__CTRender(D.CTButton,{type:'primary',disabled:this.disabled,onClick:()=>this._login(),isWaiting:this.isWaiting},'Log In')))}_renderLogoutForm(){let H=this.layer.getCurrentUserJid();return this.autoAppendDomainName&&(H=H.split('@').shift()),window.__CTRender('div',{class:'form',style:I.buildStyles({display:'flex'})},window.__CTRender('div',{class:'form-field'},window.__CTRender(D.CTTextbox,{type:'text',placeholder:'Username',name:'username',defaultValue:H,disabled:!0})),window.__CTRender('div',{class:'form-buttons'},window.__CTRender(D.CTButton,{type:'primary',disabled:!1,onClick:()=>this._logout(),isWaiting:this.isWaiting},'Log Out')))}_onChange(H){H&&'username'===H.key&&(this._username=H.value),H&&'password'===H.key&&(this._password=H.value),this.disabled=!this._username||!this._password}_resetFields(){this._username=this.username||'',this._password='',this.disabled=!0}_login(){return A(this,void 0,void 0,function*(){if(this._username&&this._password){this.isWaiting=!0;let H=this.autoAppendDomainName?`${this._username.trim()}@${this.layer.config.xmpp.user.domain}`:this._username.trim();this.layer.config.xmpp.user&&!0===this.layer.config.xmpp.user.forceLowercaseJid&&(H=H.toLowerCase());try{yield this.layer.login(H,this._password),this.emitComponentEvent(M.BaseEvents.LoginFormResult,new M.CommsEventArgs(!0)),this.isWaiting=!1,this._resetFields()}catch(z){this.emitComponentEvent(M.BaseEvents.LoginFormResult,new M.CommsEventArgs(!1,`Could not log in as ${H}`)),this.isWaiting=!1,this._password='',this._onChange(),document.activeElement.blur()}}})}_logout(){return A(this,void 0,void 0,function*(){this.isWaiting=!0;try{yield this.layer.logout(),this.isWaiting=!1,this._resetFields()}catch(H){this.emitComponentEvent(M.BaseEvents.LoginFormResult,new M.CommsEventArgs(!1,`There was an error logging out. Please try again.`)),this.isWaiting=!1,document.activeElement.blur()}})}}R([N.prop({type:N.Stroolean,attribute:!0,default:!0})],B.prototype,'autoAppendDomainName',void 0),R([N.prop({type:String,attribute:!0,default:''})],B.prototype,'username',void 0),R([N.prop({type:N.Stroolean,attribute:!0,default:!1})],B.prototype,'hideUsername',void 0),R([N.prop({type:N.Stroolean,attribute:!0,default:!1})],B.prototype,'disableUsername',void 0),R([N.prop({type:Boolean,attribute:!1,default:!1})],B.prototype,'isWaiting',void 0),R([N.prop({type:Boolean,attribute:!1,default:!0})],B.prototype,'disabled',void 0),R([N.prop({type:Boolean,attribute:!1,default:!1})],B.prototype,'userLoggedIn',void 0),h.CTLoginForm=B,B.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(z,$,Y,J){var G=arguments.length,W=3>G?$:null===J?J=Object.getOwnPropertyDescriptor($,Y):J,X;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)W=Reflect.decorate(z,$,Y,J);else for(var K=z.length-1;0<=K;K--)(X=z[K])&&(W=(3>G?X(W):3<G?X($,Y,W):X($,Y))||W);return 3<G&&W&&Object.defineProperty($,Y,W),W},A=this&&this.__awaiter||function(z,$,Y,J){return new(Y||(Y=Promise))(function(G,W){function X(Z){try{Q(J.next(Z))}catch(ee){W(ee)}}function K(Z){try{Q(J['throw'](Z))}catch(ee){W(ee)}}function Q(Z){Z.done?G(Z.value):new Y(function(ee){ee(Z.value)}).then(X,K)}Q((J=J.apply(z,$||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(2),I=E(5),D=E(3),L=E(1),B=E(29);class H extends N.CTLayerComponent{constructor(){super(...arguments),this.attemptCount=0}static get is(){return'ct-online-indicator'}initialize(){return A(this,void 0,void 0,function*(){this.status=this.layer.getConnectionStatus()})}setupListeners(){this.addListener(I.BaseEvents.ConnectionStatusChange,(z)=>{this.status=z.status,this.reconnectTime=z.reconnectTime,this.allowReconnect=z.status===M.ConnectionStatus.Disconnected,clearInterval(this.timeoutId),z.reconnectTime&&(this.timeoutId=setInterval(()=>{this.reconnectTime-=1e3},1e3))},{dontSuppress:!0})}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:inline-flex;font-size:inherit;font-weight:inherit;color:inherit}:host .online-indicator{display:flex;align-items:center}:host .online-indicator .icon{flex:none;margin:0 5px 0 0}:host .online-indicator .label{display:flex;align-items:center;flex:1 1}@media screen and (max-width: 350px){:host .online-indicator .label .status{display:none}}:host .online-indicator .label .reconnect-detail{display:flex;align-items:center}:host .online-indicator .label .reconnect-detail .countdown{width:40px;padding:0 5px}:host .online-indicator .label .reconnect-detail ct-button{margin-top:1px;padding-right:10px}
        `}generateComponentMarkup(){const z=['online-indicator',this.status===M.ConnectionStatus.Connected?'online':'offline'],$=this.status===M.ConnectionStatus.Connecting?M.Icons.COMMON.LoadingSpinner:this.status===M.ConnectionStatus.Connected?M.Icons.COMMON.StatusOnline:M.Icons.COMMON.StatusOffline;return window.__CTRender('div',{class:z.join(' ')},D.renderIf(this.showIcon,window.__CTRender('div',{class:'icon'},window.__CTRender(L.CTIcon,{width:'16',height:'16',icon:$,spin:this.status===M.ConnectionStatus.Connecting}))),D.renderIf(this.showText,window.__CTRender('div',{class:'label'},window.__CTRender('span',{class:'status'},this._getStatusLabel()),D.renderIf(this.status===M.ConnectionStatus.Disconnected&&this.reconnectTime!==void 0&&0<this.reconnectTime,window.__CTRender('span',{class:'reconnect-detail'},window.__CTRender('span',{class:'countdown'},this._getCountdownLabel()),window.__CTRender(B.CTButton,{type:'invert-secondary',disabled:!this.allowReconnect,onClick:(Y)=>this._tryLoginNow(Y)},'Reconnect'))))))}_getStatusLabel(){switch(this.status){case M.ConnectionStatus.Connected:return'Online';case M.ConnectionStatus.Connecting:return'Reconnecting';case M.ConnectionStatus.Disconnecting:case M.ConnectionStatus.Disconnected:return'Offline';}}_getCountdownLabel(){return`(${this.reconnectTime/1e3}s)`}_tryLoginNow(){!1===this.allowReconnect||(this.allowReconnect=!1,this.status=M.ConnectionStatus.Connecting,this.layer.attemptReconnect())}}R([N.prop({type:N.Stroolean,attribute:!0,default:!0})],H.prototype,'showIcon',void 0),R([N.prop({type:N.Stroolean,attribute:!0,default:!0})],H.prototype,'showText',void 0),R([N.prop({type:String,attribute:!1,default:M.ConnectionStatus.Disconnected})],H.prototype,'status',void 0),R([N.prop({type:Number,attribute:!1,default:0})],H.prototype,'reconnectTime',void 0),R([N.prop({type:Boolean,attribute:!1,default:!1})],H.prototype,'allowReconnect',void 0),h.CTOnlineIndicator=H,H.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(L,B,H,z){var $=arguments.length,Y=3>$?B:null===z?z=Object.getOwnPropertyDescriptor(B,H):z,J;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)Y=Reflect.decorate(L,B,H,z);else for(var G=L.length-1;0<=G;G--)(J=L[G])&&(Y=(3>$?J(Y):3<$?J(B,H,Y):J(B,H))||Y);return 3<$&&Y&&Object.defineProperty(B,H,Y),Y},A=this&&this.__awaiter||function(L,B,H,z){return new(H||(H=Promise))(function($,Y){function J(X){try{W(z.next(X))}catch(K){Y(K)}}function G(X){try{W(z['throw'](X))}catch(K){Y(K)}}function W(X){X.done?$(X.value):new H(function(K){K(X.value)}).then(J,G)}W((z=z.apply(L,B||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(1),I=E(3);class D extends N.CTLayerComponent{static get is(){return'ct-selection-list'}initialize(){return A(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:block;width:100%}:host .selection-list{display:flex;flex-direction:row;flex-wrap:wrap}:host .selection-list .dropdown-contanier{flex:1 1 100%}:host .selection-list .dropdown-contanier select{width:100%;height:30px;background-color:var(--default-bg-color-light, rgba(0,0,0,0));border:0;color:var(--default-font-color, #fff);font-size:16px;outline:var(--default-select-border, none)}:host .selection-list .button-container{position:relative;flex:0 1 50%}:host .selection-list .button-container:nth-child(2n-1){padding:10px 5px 0 0}:host .selection-list .button-container:nth-child(2n-2){padding:10px 0 0 5px}:host .selection-list .button-container:nth-child(1),:host .selection-list .button-container:nth-child(2){padding-top:0}:host .selection-list.button-list{display:block}:host .selection-list.button-list .button-container{display:block;padding:0 0 1px 0}:host .selection-list.button-list .button-container:last-child{padding:0}
        `}generateComponentMarkup(){const B=!this.forceDropdown&&(this.buttonList||this.options.length<=4),H=['selection-list'];return this.buttonList&&H.push('button-list'),window.__CTRender('div',{class:H.join(' ')},I.renderIfElse(B,this._renderButtons(),this._renderDropDown()))}_renderDropDown(){return window.__CTRender('div',{class:'dropdown-contanier'},window.__CTRender('select',{onChange:(L)=>this._onMakeSelection(L),value:this.selected.toString()},this.options.map((L)=>window.__CTRender('option',{"data-key":L.key,value:L.key.toString(),defaultSelected:this.selected===L.key},L.value))))}_renderButtons(){return this.options.map((L)=>window.__CTRender('div',{class:'button-container'},window.__CTRender(M.CTButton,{"data-key":L.key,type:'secondary',selected:this.selected===L.key,onClick:(B)=>this._onMakeSelection(B)},L.value)))}_onMakeSelection(L){const B=L.target;if(!B)return;let H=null;switch(B.nodeName){case'CT-BUTTON':H=parseInt(B.getAttribute('data-key'));break;case'SELECT':H=parseInt(B.value);}if(!isNaN(H)){const z=this.options.find(($)=>$.key===H);z&&(this._makeSelection(z.key),this.selected=z.key)}}_makeSelection(L){'function'==typeof this.onSelect&&this.onSelect(L)}}R([N.prop({type:Number,attribute:!0,default:Number.MIN_VALUE})],D.prototype,'selected',void 0),R([N.prop({type:N.Stroolean,attribute:!0,default:!1})],D.prototype,'buttonList',void 0),R([N.prop({type:Boolean,attribute:!0,default:!1})],D.prototype,'forceDropdown',void 0),R([N.prop({type:Function,attribute:!0})],D.prototype,'onSelect',void 0),R([N.prop({type:Array,attribute:!1,default:[]})],D.prototype,'options',void 0),h.CTSelectionList=D,D.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,J=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,G;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(G=B[W])&&(J=(3>Y?G(J):3<Y?G(H,z,J):G(H,z))||J);return 3<Y&&J&&Object.defineProperty(H,z,J),J},A=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,J){function G(K){try{X($.next(K))}catch(Q){J(Q)}}function W(K){try{X($['throw'](K))}catch(Q){J(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(G,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(3),I=E(1),D=E(2);class L extends N.CTLayerComponent{constructor(){super(...arguments),this._returnKeypress=(B)=>{13===B.keyCode&&this.returnKeypress?this.returnKeypress():null}}static get is(){return'ct-textbox'}initialize(){return A(this,void 0,void 0,function*(){this._value=this.defaultValue||'',this._isPasswordField=this.type&&'password'===this.type.toLowerCase(),this._isPasswordField&&this._watchPasswordField()})}setupListeners(){}get generateComponentStyles(){return`:host label{color:var(--default-font-color, #9b9b9b)}:host div div.input{display:flex;flex-direction:row;margin:0 0 5px 0;border-bottom:1px solid var(--default-border-color, #9b9b9b)}:host div div.input.focus{border-color:var(--login-form-border-color, green)}:host div div.input input,:host div div.input textarea{flex:1 1;padding:5px;font-size:1em;background-color:var(--default-bg-color-light, transparent);border:none;margin:auto;outline:none;resize:none;color:var(--login-form-font-color, inherit)}:host div div.input input:focus,:host div div.input textarea:focus{border:none;outline-offset:0}:host div div.input input:focus+.clear-value,:host div div.input textarea:focus+.clear-value{opacity:0.5;cursor:pointer}:host div div.input ct-icon{flex:0 0 20px;text-align:center}:host div div.input ct-icon.show-password{opacity:0.5}:host div div.input ct-icon.show-password.show-password-enabled{opacity:1}:host div div.input ct-icon.clear-value{opacity:0}:host div div.input ct-icon+ct-icon{margin:0 0 0 5px}:host div div.input .validation{margin-bottom:1%;color:red}:host div.disabled div.input{border-bottom:none}:host([full-border]) div div.input{border:1px solid var(--default-border-color, #9b9b9b)}
        `}generateComponentMarkup(){return window.__CTRender('div',{class:this.disabled?'disabled':''},M.renderIf(this.label!==void 0,window.__CTRender('label',{htmlFor:this.name},this.label)),window.__CTRender('div',{class:'input'},M.renderIfElse('textarea'===this.type,window.__CTRender('textarea',{placeholder:this.placeholder,name:this.name,onFocus:()=>this._toggleFocus(!0),onBlur:()=>this._toggleFocus(!1),onInput:(B)=>this._updateValue({key:B.target.name,value:B.target.value}),onkeydown:this._returnKeypress,value:this.defaultValue,disabled:this.disabled,rows:5}),window.__CTRender('input',{type:this.type,placeholder:this.placeholder,name:this.name,onFocus:()=>this._toggleFocus(!0),onBlur:()=>this._toggleFocus(!1),onInput:(B)=>this._updateValue({key:B.target.name,value:B.target.value}),onkeydown:this._returnKeypress,value:this.defaultValue,disabled:this.disabled})),M.renderIf(this.showClearOptions&&!this._isPasswordField,window.__CTRender(I.CTIcon,{class:'clear-value',width:'12',height:'12',icon:D.Icons.COMMON.ClearTextbox,onClick:()=>this._clear()})),M.renderIf(this._isPasswordField,window.__CTRender(I.CTIcon,{class:`show-password ${'text'===this.type?'show-password-enabled':''}`,width:'20',height:'20',icon:D.Icons.COMMON.ShowPassword,onClick:()=>this._togglePasswordFieldType()}))),M.renderIf(!this.validated,window.__CTRender('div',{class:'validation'},window.__CTRender('span',null,'This field has a max length of ',this.max,'.'))))}_updateValue(B){this._value=B.value,this._isValidated(),this.callback({key:B.key,value:B.value,validated:this.validated})}_clear(){let B;B='textarea'===this.type?this.shadowRoot.querySelector('textarea'):this.shadowRoot.querySelector('input'),B.value='',B.focus(),B.dispatchEvent(new Event('change'))}_toggleFocus(B){const H=this.shadowRoot.querySelector('.input'),z='textarea'===this.type?H.querySelector('textarea'):H.querySelector('input');B?(H.classList.add('focus'),'scrollIntoViewIfNeeded'in z?z.scrollIntoViewIfNeeded():'scrollIntoView'in z&&z.scrollIntoView()):H.classList.remove('focus')}_isValidated(){this.validated=this._value.length<=this.max}_togglePasswordFieldType(){this._isPasswordField&&('password'===this.type?this.type='text':this.type='password')}_watchPasswordField(){const B=(H)=>{const z=this.shadowRoot.querySelector('.input');if(H.path){const $=H.path.includes(z);!1===$&&'text'===this.type&&(this.type='password')}};document.removeEventListener('click',B),document.addEventListener('click',B)}}R([N.prop({type:String,attribute:!0})],L.prototype,'placeholder',void 0),R([N.prop({type:String,attribute:!0})],L.prototype,'type',void 0),R([N.prop({type:String,attribute:!0})],L.prototype,'label',void 0),R([N.prop({type:String,attribute:!0})],L.prototype,'name',void 0),R([N.prop({type:Boolean,attribute:!0,default:!0})],L.prototype,'showClearOptions',void 0),R([N.prop({type:String,attribute:!0})],L.prototype,'defaultValue',void 0),R([N.prop({type:Boolean,attribute:!0,default:!1})],L.prototype,'disabled',void 0),R([N.prop({type:Boolean,attribute:!0,default:!1})],L.prototype,'fullBorder',void 0),R([N.prop({type:Number,attribute:!0,default:4e3})],L.prototype,'max',void 0),R([N.prop({type:Boolean,attribute:!1,default:!0})],L.prototype,'validated',void 0),h.CTTextbox=L,L.register()},function(l,h,E){'use strict';var R=this&&this.__decorate||function(H,z,$,Y){var J=arguments.length,G=3>J?z:null===Y?Y=Object.getOwnPropertyDescriptor(z,$):Y,W;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)G=Reflect.decorate(H,z,$,Y);else for(var X=H.length-1;0<=X;X--)(W=H[X])&&(G=(3>J?W(G):3<J?W(z,$,G):W(z,$))||G);return 3<J&&G&&Object.defineProperty(z,$,G),G},A=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(J,G){function W(Q){try{K(Y.next(Q))}catch(Z){G(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){G(Z)}}function K(Q){Q.done?J(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(h,'__esModule',{value:!0});const N=E(0),M=E(5),I=E(2),D=E(3),L=E(1);class B extends N.CTLayerComponent{static get is(){return'ct-user-display'}initialize(){return A(this,void 0,void 0,function*(){this.username=this.layer.getCurrentXmppDisplayName()})}setupListeners(){this.addListener(M.BaseEvents.ConnectionStatusChange,()=>{this.username=this.layer.getCurrentXmppDisplayName()}),this.addListener(M.BaseEvents.CurrentUserVCardUpdate,()=>{this.username=this.layer.getCurrentXmppDisplayName()})}get generateComponentStyles(){return`:host{color:#333536;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:inline-flex;font-size:inherit;font-weight:inherit;color:inherit}:host .user-display{display:flex;align-items:center}:host .user-display .icon{flex:none;margin:0 5px 0 0}:host .user-display .label{flex:1 1}
        `}generateComponentMarkup(){return window.__CTRender('div',{class:'user-display'},D.renderIf(this.showIcon,window.__CTRender('div',{class:'icon'},window.__CTRender(L.CTIcon,{width:'16',height:'16',icon:I.Icons.COMMON.UserIconEmpty}))),window.__CTRender('div',{class:'label'},this.username))}}R([N.prop({type:N.Stroolean,attribute:!0,default:!0})],B.prototype,'showIcon',void 0),R([N.prop({type:String,attribute:!1})],B.prototype,'username',void 0),h.CTUserDisplay=B,B.register()},function(l,h){'use strict';function N(){const I=M.LastTouchMoveX,D=M.LastTouchStartX,L=new Date().getTime(),B=M.LastTouchStartTime;return(I-D)/(L-B)}Object.defineProperty(h,'__esModule',{value:!0});class M{}M.Accelerator=2.5,M.Reset=()=>{delete M.LastTouchStartX,delete M.LastTouchStartY,delete M.LastTouchStartTime,delete M.LastTouchMoveX,delete M.LastTouchMoveY},M.NumMatch=/-?\d+/,M.X=['clientX'],M.Y=['clientY'],M.GetNumberValue=(I)=>{const D=I.match(M.NumMatch);return D?parseInt(D[0]):null},M.CheckIfFirstTouch=(I,D)=>{M.LastTouchStartX||(console.log('First X detected'),M.LastTouchStartX=I),M.LastTouchStartY||(console.log('First Y detected'),M.LastTouchStartY=D),M.LastTouchStartTime=new Date().getTime()},h.TouchTracker=M,h.slideToReveal=function(I,D,L='x'){I.stopPropagation(),I.stopImmediatePropagation();const H=I.currentTarget,z=H.style.transform;let $=0;z&&($=M.GetNumberValue(z)),M.CheckIfFirstTouch(I.changedTouches[0].clientX,I.changedTouches[0].clientY);const Y=(M.LastTouchMoveX||M.LastTouchStartX)-I.changedTouches[0].clientX,J=(M.LastTouchMoveY||M.LastTouchStartY)-I.changedTouches[0].clientY;M.LastTouchMoveX=I.changedTouches[0].clientX,M.LastTouchMoveY=I.changedTouches[0].clientY,'x'===L?0<Y?($--,$>0-(D+1)&&(H.style.transform=`translateX(${$}vw)`)):($++,1>$&&(H.style.transform=`translateX(${$}vw)`)):'y'===L&&(1<J?($-=1*M.Accelerator,H.style.transform=`translateY(${$}vh)`):-0.5>J&&($+=1*M.Accelerator,0.5<$&&($=0),H.style.transform=`translateY(${$}vh)`))},h.slideToRevealEnd=function(I,D,L='x'){I.stopPropagation(),I.stopImmediatePropagation();const B=I.currentTarget,H=B.style.transform;let z;if(H&&(z=M.GetNumberValue(B.style.transform)),'x'===L){const $=N();if(1.2<$)B.style.transform=`translateX(0vw)`;else if(-1.2>$)B.style.transform=`translateX(-${D}vw)`;else{const Y=Math.round(D/2);B.style.transform=z<-Y?`translateX(-${D}vw)`:'translateX(0vw)'}}M.Reset()}},function(l,h){'use strict';function R(G){var W=G.length;if(0<W%4)throw new Error('Invalid string. Length must be a multiple of 4');var X=G.indexOf('=');-1===X&&(X=W);var K=X===W?0:4-X%4;return[X,K]}function N(G,W,X){return 3*(W+X)/4-X}function I(G){return B[63&G>>18]+B[63&G>>12]+B[63&G>>6]+B[63&G]}function D(G,W,X){for(var Q=[],Z=W,K;Z<X;Z+=3)K=(16711680&G[Z]<<16)+(65280&G[Z+1]<<8)+(255&G[Z+2]),Q.push(I(K));return Q.join('')}h.byteLength=function(G){var W=R(G),X=W[0],K=W[1];return 3*(X+K)/4-K},h.toByteArray=function(G){var X=R(G),K=X[0],Q=X[1],Z=new z(N(G,K,Q)),ee=0,te=0<Q?K-4:K,W,ne;for(ne=0;ne<te;ne+=4)W=H[G.charCodeAt(ne)]<<18|H[G.charCodeAt(ne+1)]<<12|H[G.charCodeAt(ne+2)]<<6|H[G.charCodeAt(ne+3)],Z[ee++]=255&W>>16,Z[ee++]=255&W>>8,Z[ee++]=255&W;return 2===Q&&(W=H[G.charCodeAt(ne)]<<2|H[G.charCodeAt(ne+1)]>>4,Z[ee++]=255&W),1===Q&&(W=H[G.charCodeAt(ne)]<<10|H[G.charCodeAt(ne+1)]<<4|H[G.charCodeAt(ne+2)]>>2,Z[ee++]=255&W>>8,Z[ee++]=255&W),Z},h.fromByteArray=function(G){for(var X=G.length,K=X%3,Q=[],Z=16383,ee=0,te=X-K,W;ee<te;ee+=Z)Q.push(D(G,ee,ee+Z>te?te:ee+Z));return 1==K?(W=G[X-1],Q.push(B[W>>2]+B[63&W<<4]+'==')):2==K&&(W=(G[X-2]<<8)+G[X-1],Q.push(B[W>>10]+B[63&W>>4]+B[63&W<<2]+'=')),Q.join('')};for(var B=[],H=[],z='undefined'==typeof Uint8Array?Array:Uint8Array,$='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',Y=0,J=$.length;Y<J;++Y)B[Y]=$[Y],H[$.charCodeAt(Y)]=Y;H['-'.charCodeAt(0)]=62,H['_'.charCodeAt(0)]=63},function(l,h,E){'use strict';(function(R){function N(){return I.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function M(ke,qe){if(N()<qe)throw new RangeError('Invalid typed array length');return I.TYPED_ARRAY_SUPPORT?(ke=new Uint8Array(qe),ke.__proto__=I.prototype):(null===ke&&(ke=new I(qe)),ke.length=qe),ke}function I(ke,qe,Be){if(!I.TYPED_ARRAY_SUPPORT&&!(this instanceof I))return new I(ke,qe,Be);if('number'==typeof ke){if('string'==typeof qe)throw new Error('If encoding is specified then the first argument must be a string');return H(this,ke)}return D(this,ke,qe,Be)}function D(ke,qe,Be,je){if('number'==typeof qe)throw new TypeError('"value" argument must not be a number');return'undefined'!=typeof ArrayBuffer&&qe instanceof ArrayBuffer?Y(ke,qe,Be,je):'string'==typeof qe?z(ke,qe,Be):J(ke,qe)}function L(ke){if('number'!=typeof ke)throw new TypeError('"size" argument must be a number');else if(0>ke)throw new RangeError('"size" argument must not be negative')}function B(ke,qe,Be,je){return L(qe),0>=qe?M(ke,qe):void 0===Be?M(ke,qe):'string'==typeof je?M(ke,qe).fill(Be,je):M(ke,qe).fill(Be)}function H(ke,qe){if(L(qe),ke=M(ke,0>qe?0:0|G(qe)),!I.TYPED_ARRAY_SUPPORT)for(var Be=0;Be<qe;++Be)ke[Be]=0;return ke}function z(ke,qe,Be){if(('string'!=typeof Be||''===Be)&&(Be='utf8'),!I.isEncoding(Be))throw new TypeError('"encoding" must be a valid string encoding');var je=0|X(qe,Be);ke=M(ke,je);var Fe=ke.write(qe,Be);return Fe!==je&&(ke=ke.slice(0,Fe)),ke}function $(ke,qe){var Be=0>qe.length?0:0|G(qe.length);ke=M(ke,Be);for(var je=0;je<Be;je+=1)ke[je]=255&qe[je];return ke}function Y(ke,qe,Be,je){if(qe.byteLength,0>Be||qe.byteLength<Be)throw new RangeError('\'offset\' is out of bounds');if(qe.byteLength<Be+(je||0))throw new RangeError('\'length\' is out of bounds');return qe=void 0===Be&&void 0===je?new Uint8Array(qe):void 0===je?new Uint8Array(qe,Be):new Uint8Array(qe,Be,je),I.TYPED_ARRAY_SUPPORT?(ke=qe,ke.__proto__=I.prototype):ke=$(ke,qe),ke}function J(ke,qe){if(I.isBuffer(qe)){var Be=0|G(qe.length);return(ke=M(ke,Be),0===ke.length)?ke:(qe.copy(ke,0,0,Be),ke)}if(qe){if('undefined'!=typeof ArrayBuffer&&qe.buffer instanceof ArrayBuffer||'length'in qe)return'number'!=typeof qe.length||xe(qe.length)?M(ke,0):$(ke,qe);if('Buffer'===qe.type&&De(qe.data))return $(ke,qe.data)}throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')}function G(ke){if(ke>=N())throw new RangeError('Attempt to allocate Buffer larger than maximum size: 0x'+N().toString(16)+' bytes');return 0|ke}function X(ke,qe){if(I.isBuffer(ke))return ke.length;if('undefined'!=typeof ArrayBuffer&&'function'==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(ke)||ke instanceof ArrayBuffer))return ke.byteLength;'string'!=typeof ke&&(ke=''+ke);var Be=ke.length;if(0===Be)return 0;for(var je=!1;;)switch(qe){case'ascii':case'latin1':case'binary':return Be;case'utf8':case'utf-8':case void 0:return Re(ke).length;case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return 2*Be;case'hex':return Be>>>1;case'base64':return Ne(ke).length;default:if(je)return Re(ke).length;qe=(''+qe).toLowerCase(),je=!0;}}function K(ke,qe,Be){var je=!1;if((void 0===qe||0>qe)&&(qe=0),qe>this.length)return'';if((void 0===Be||Be>this.length)&&(Be=this.length),0>=Be)return'';if(Be>>>=0,qe>>>=0,Be<=qe)return'';for(ke||(ke='utf8');;)switch(ke){case'hex':return ge(this,qe,Be);case'utf8':case'utf-8':return le(this,qe,Be);case'ascii':return ce(this,qe,Be);case'latin1':case'binary':return pe(this,qe,Be);case'base64':return de(this,qe,Be);case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return me(this,qe,Be);default:if(je)throw new TypeError('Unknown encoding: '+ke);ke=(ke+'').toLowerCase(),je=!0;}}function Q(ke,qe,Be){var je=ke[qe];ke[qe]=ke[Be],ke[Be]=je}function Z(ke,qe,Be,je,Fe){if(0===ke.length)return-1;if('string'==typeof Be?(je=Be,Be=0):2147483647<Be?Be=2147483647:-2147483648>Be&&(Be=-2147483648),Be=+Be,isNaN(Be)&&(Be=Fe?0:ke.length-1),0>Be&&(Be=ke.length+Be),Be>=ke.length){if(Fe)return-1;Be=ke.length-1}else if(0>Be)if(Fe)Be=0;else return-1;if('string'==typeof qe&&(qe=I.from(qe,je)),I.isBuffer(qe))return 0===qe.length?-1:ee(ke,qe,Be,je,Fe);if('number'==typeof qe)return qe&=255,I.TYPED_ARRAY_SUPPORT&&'function'==typeof Uint8Array.prototype.indexOf?Fe?Uint8Array.prototype.indexOf.call(ke,qe,Be):Uint8Array.prototype.lastIndexOf.call(ke,qe,Be):ee(ke,[qe],Be,je,Fe);throw new TypeError('val must be string, number or Buffer')}function ee(ke,qe,Be,je,Fe){function Ue(We,Xe){return 1==He?We[Xe]:We.readUInt16BE(Xe*He)}var He=1,ze=ke.length,$e=qe.length;if(void 0!==je&&(je=(je+'').toLowerCase(),'ucs2'===je||'ucs-2'===je||'utf16le'===je||'utf-16le'===je)){if(2>ke.length||2>qe.length)return-1;He=2,ze/=2,$e/=2,Be/=2}var Ye;if(Fe){var Ve=-1;for(Ye=Be;Ye<ze;Ye++)if(Ue(ke,Ye)!==Ue(qe,-1==Ve?0:Ye-Ve))-1!=Ve&&(Ye-=Ye-Ve),Ve=-1;else if(-1==Ve&&(Ve=Ye),Ye-Ve+1===$e)return Ve*He}else for(Be+$e>ze&&(Be=ze-$e),Ye=Be;0<=Ye;Ye--){for(var Je=!0,Ge=0;Ge<$e;Ge++)if(Ue(ke,Ye+Ge)!==Ue(qe,Ge)){Je=!1;break}if(Je)return Ye}return-1}function te(ke,qe,Be,je){Be=+Be||0;var Fe=ke.length-Be;je?(je=+je,je>Fe&&(je=Fe)):je=Fe;var Ue=qe.length;if(0!=Ue%2)throw new TypeError('Invalid hex string');je>Ue/2&&(je=Ue/2);for(var He=0,ze;He<je;++He){if(ze=parseInt(qe.substr(2*He,2),16),isNaN(ze))return He;ke[Be+He]=ze}return He}function ne(ke,qe,Be,je){return Me(Re(qe,ke.length-Be),ke,Be,je)}function ae(ke,qe,Be,je){return Me(Pe(qe),ke,Be,je)}function se(ke,qe,Be,je){return ae(ke,qe,Be,je)}function oe(ke,qe,Be,je){return Me(Ne(qe),ke,Be,je)}function ie(ke,qe,Be,je){return Me(Ae(qe,ke.length-Be),ke,Be,je)}function de(ke,qe,Be){return 0===qe&&Be===ke.length?Ie.fromByteArray(ke):Ie.fromByteArray(ke.slice(qe,Be))}function le(ke,qe,Be){Be=Math.min(ke.length,Be);for(var je=[],Fe=qe;Fe<Be;){var Ue=ke[Fe],He=null,ze=239<Ue?4:223<Ue?3:191<Ue?2:1;if(Fe+ze<=Be){var $e,Ye,Ve,Je;1==ze?128>Ue&&(He=Ue):2==ze?($e=ke[Fe+1],128==(192&$e)&&(Je=(31&Ue)<<6|63&$e,127<Je&&(He=Je))):3==ze?($e=ke[Fe+1],Ye=ke[Fe+2],128==(192&$e)&&128==(192&Ye)&&(Je=(15&Ue)<<12|(63&$e)<<6|63&Ye,2047<Je&&(55296>Je||57343<Je)&&(He=Je))):4==ze?($e=ke[Fe+1],Ye=ke[Fe+2],Ve=ke[Fe+3],128==(192&$e)&&128==(192&Ye)&&128==(192&Ve)&&(Je=(15&Ue)<<18|(63&$e)<<12|(63&Ye)<<6|63&Ve,65535<Je&&1114112>Je&&(He=Je))):void 0}null===He?(He=65533,ze=1):65535<He&&(He-=65536,je.push(55296|1023&He>>>10),He=56320|1023&He),je.push(He),Fe+=ze}return ue(je)}function ue(ke){var qe=ke.length;if(qe<=Le)return String.fromCharCode.apply(String,ke);for(var Be='',je=0;je<qe;)Be+=String.fromCharCode.apply(String,ke.slice(je,je+=Le));return Be}function ce(ke,qe,Be){var je='';Be=Math.min(ke.length,Be);for(var Fe=qe;Fe<Be;++Fe)je+=String.fromCharCode(127&ke[Fe]);return je}function pe(ke,qe,Be){var je='';Be=Math.min(ke.length,Be);for(var Fe=qe;Fe<Be;++Fe)je+=String.fromCharCode(ke[Fe]);return je}function ge(ke,qe,Be){var je=ke.length;(!qe||0>qe)&&(qe=0),(!Be||0>Be||Be>je)&&(Be=je);for(var Fe='',Ue=qe;Ue<Be;++Ue)Fe+=ve(ke[Ue]);return Fe}function me(ke,qe,Be){for(var je=ke.slice(qe,Be),Fe='',Ue=0;Ue<je.length;Ue+=2)Fe+=String.fromCharCode(je[Ue]+256*je[Ue+1]);return Fe}function _e(ke,qe,Be){if(0!=ke%1||0>ke)throw new RangeError('offset is not uint');if(ke+qe>Be)throw new RangeError('Trying to access beyond buffer length')}function fe(ke,qe,Be,je,Fe,Ue){if(!I.isBuffer(ke))throw new TypeError('"buffer" argument must be a Buffer instance');if(qe>Fe||qe<Ue)throw new RangeError('"value" argument is out of bounds');if(Be+je>ke.length)throw new RangeError('Index out of range')}function he(ke,qe,Be,je){0>qe&&(qe=65535+qe+1);for(var Fe=0,Ue=Math.min(ke.length-Be,2);Fe<Ue;++Fe)ke[Be+Fe]=(qe&255<<8*(je?Fe:1-Fe))>>>8*(je?Fe:1-Fe)}function ye(ke,qe,Be,je){0>qe&&(qe=4294967295+qe+1);for(var Fe=0,Ue=Math.min(ke.length-Be,4);Fe<Ue;++Fe)ke[Be+Fe]=255&qe>>>8*(je?Fe:3-Fe)}function Te(ke,qe,Be,je){if(Be+je>ke.length)throw new RangeError('Index out of range');if(0>Be)throw new RangeError('Index out of range')}function Ce(ke,qe,Be,je,Fe){return Fe||Te(ke,qe,Be,4,3.4028234663852886e38,-3.4028234663852886e38),we.write(ke,qe,Be,je,23,4),Be+4}function be(ke,qe,Be,je,Fe){return Fe||Te(ke,qe,Be,8,1.7976931348623157e308,-1.7976931348623157e308),we.write(ke,qe,Be,je,52,8),Be+8}function Se(ke){if(ke=Ee(ke).replace(Oe,''),2>ke.length)return'';for(;0!=ke.length%4;)ke+='=';return ke}function Ee(ke){return ke.trim?ke.trim():ke.replace(/^\s+|\s+$/g,'')}function ve(ke){return 16>ke?'0'+ke.toString(16):ke.toString(16)}function Re(ke,qe){qe=qe||Infinity;for(var je=ke.length,Fe=null,Ue=[],He=0,Be;He<je;++He){if(Be=ke.charCodeAt(He),55295<Be&&57344>Be){if(!Fe){if(56319<Be){-1<(qe-=3)&&Ue.push(239,191,189);continue}else if(He+1===je){-1<(qe-=3)&&Ue.push(239,191,189);continue}Fe=Be;continue}if(56320>Be){-1<(qe-=3)&&Ue.push(239,191,189),Fe=Be;continue}Be=(Fe-55296<<10|Be-56320)+65536}else Fe&&-1<(qe-=3)&&Ue.push(239,191,189);if(Fe=null,128>Be){if(0>(qe-=1))break;Ue.push(Be)}else if(2048>Be){if(0>(qe-=2))break;Ue.push(192|Be>>6,128|63&Be)}else if(65536>Be){if(0>(qe-=3))break;Ue.push(224|Be>>12,128|63&Be>>6,128|63&Be)}else if(1114112>Be){if(0>(qe-=4))break;Ue.push(240|Be>>18,128|63&Be>>12,128|63&Be>>6,128|63&Be)}else throw new Error('Invalid code point')}return Ue}function Pe(ke){for(var qe=[],Be=0;Be<ke.length;++Be)qe.push(255&ke.charCodeAt(Be));return qe}function Ae(ke,qe){for(var Ue=[],He=0,Be,je,Fe;He<ke.length&&!(0>(qe-=2));++He)Be=ke.charCodeAt(He),je=Be>>8,Fe=Be%256,Ue.push(Fe),Ue.push(je);return Ue}function Ne(ke){return Ie.toByteArray(Se(ke))}function Me(ke,qe,Be,je){for(var Fe=0;Fe<je&&!(Fe+Be>=qe.length||Fe>=ke.length);++Fe)qe[Fe+Be]=ke[Fe];return Fe}function xe(ke){return ke!==ke}var Ie=E(95),we=E(97),De=E(98);h.Buffer=I,h.SlowBuffer=function(ke){return+ke!=ke&&(ke=0),I.alloc(+ke)},h.INSPECT_MAX_BYTES=50,I.TYPED_ARRAY_SUPPORT=R.TYPED_ARRAY_SUPPORT===void 0?function(){try{var ke=new Uint8Array(1);return ke.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===ke.foo()&&'function'==typeof ke.subarray&&0===ke.subarray(1,1).byteLength}catch(qe){return!1}}():R.TYPED_ARRAY_SUPPORT,h.kMaxLength=N(),I.poolSize=8192,I._augment=function(ke){return ke.__proto__=I.prototype,ke},I.from=function(ke,qe,Be){return D(null,ke,qe,Be)},I.TYPED_ARRAY_SUPPORT&&(I.prototype.__proto__=Uint8Array.prototype,I.__proto__=Uint8Array,'undefined'!=typeof Symbol&&Symbol.species&&I[Symbol.species]===I&&Object.defineProperty(I,Symbol.species,{value:null,configurable:!0})),I.alloc=function(ke,qe,Be){return B(null,ke,qe,Be)},I.allocUnsafe=function(ke){return H(null,ke)},I.allocUnsafeSlow=function(ke){return H(null,ke)},I.isBuffer=function(qe){return!!(null!=qe&&qe._isBuffer)},I.compare=function(qe,Be){if(!I.isBuffer(qe)||!I.isBuffer(Be))throw new TypeError('Arguments must be Buffers');if(qe===Be)return 0;for(var je=qe.length,Fe=Be.length,Ue=0,He=Math.min(je,Fe);Ue<He;++Ue)if(qe[Ue]!==Be[Ue]){je=qe[Ue],Fe=Be[Ue];break}return je<Fe?-1:Fe<je?1:0},I.isEncoding=function(qe){switch((qe+'').toLowerCase()){case'hex':case'utf8':case'utf-8':case'ascii':case'latin1':case'binary':case'base64':case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return!0;default:return!1;}},I.concat=function(qe,Be){if(!De(qe))throw new TypeError('"list" argument must be an Array of Buffers');if(0===qe.length)return I.alloc(0);var je;if(Be===void 0)for(Be=0,je=0;je<qe.length;++je)Be+=qe[je].length;var Fe=I.allocUnsafe(Be),Ue=0;for(je=0;je<qe.length;++je){var He=qe[je];if(!I.isBuffer(He))throw new TypeError('"list" argument must be an Array of Buffers');He.copy(Fe,Ue),Ue+=He.length}return Fe},I.byteLength=X,I.prototype._isBuffer=!0,I.prototype.swap16=function(){var qe=this.length;if(0!=qe%2)throw new RangeError('Buffer size must be a multiple of 16-bits');for(var Be=0;Be<qe;Be+=2)Q(this,Be,Be+1);return this},I.prototype.swap32=function(){var qe=this.length;if(0!=qe%4)throw new RangeError('Buffer size must be a multiple of 32-bits');for(var Be=0;Be<qe;Be+=4)Q(this,Be,Be+3),Q(this,Be+1,Be+2);return this},I.prototype.swap64=function(){var qe=this.length;if(0!=qe%8)throw new RangeError('Buffer size must be a multiple of 64-bits');for(var Be=0;Be<qe;Be+=8)Q(this,Be,Be+7),Q(this,Be+1,Be+6),Q(this,Be+2,Be+5),Q(this,Be+3,Be+4);return this},I.prototype.toString=function(){var qe=0|this.length;return 0==qe?'':0===arguments.length?le(this,0,qe):K.apply(this,arguments)},I.prototype.equals=function(qe){if(!I.isBuffer(qe))throw new TypeError('Argument must be a Buffer');return this===qe||0===I.compare(this,qe)},I.prototype.inspect=function(){var qe='',Be=h.INSPECT_MAX_BYTES;return 0<this.length&&(qe=this.toString('hex',0,Be).match(/.{2}/g).join(' '),this.length>Be&&(qe+=' ... ')),'<Buffer '+qe+'>'},I.prototype.compare=function(qe,Be,je,Fe,Ue){if(!I.isBuffer(qe))throw new TypeError('Argument must be a Buffer');if(void 0===Be&&(Be=0),void 0===je&&(je=qe?qe.length:0),void 0===Fe&&(Fe=0),void 0===Ue&&(Ue=this.length),0>Be||je>qe.length||0>Fe||Ue>this.length)throw new RangeError('out of range index');if(Fe>=Ue&&Be>=je)return 0;if(Fe>=Ue)return-1;if(Be>=je)return 1;if(Be>>>=0,je>>>=0,Fe>>>=0,Ue>>>=0,this===qe)return 0;for(var He=Ue-Fe,ze=je-Be,$e=Math.min(He,ze),Ye=this.slice(Fe,Ue),Ve=qe.slice(Be,je),Je=0;Je<$e;++Je)if(Ye[Je]!==Ve[Je]){He=Ye[Je],ze=Ve[Je];break}return He<ze?-1:ze<He?1:0},I.prototype.includes=function(qe,Be,je){return-1!==this.indexOf(qe,Be,je)},I.prototype.indexOf=function(qe,Be,je){return Z(this,qe,Be,je,!0)},I.prototype.lastIndexOf=function(qe,Be,je){return Z(this,qe,Be,je,!1)},I.prototype.write=function(qe,Be,je,Fe){if(void 0===Be)Fe='utf8',je=this.length,Be=0;else if(void 0===je&&'string'==typeof Be)Fe=Be,je=this.length,Be=0;else if(isFinite(Be))Be|=0,isFinite(je)?(je|=0,void 0===Fe&&(Fe='utf8')):(Fe=je,je=void 0);else throw new Error('Buffer.write(string, encoding, offset[, length]) is no longer supported');var Ue=this.length-Be;if((void 0===je||je>Ue)&&(je=Ue),0<qe.length&&(0>je||0>Be)||Be>this.length)throw new RangeError('Attempt to write outside buffer bounds');Fe||(Fe='utf8');for(var He=!1;;)switch(Fe){case'hex':return te(this,qe,Be,je);case'utf8':case'utf-8':return ne(this,qe,Be,je);case'ascii':return ae(this,qe,Be,je);case'latin1':case'binary':return se(this,qe,Be,je);case'base64':return oe(this,qe,Be,je);case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return ie(this,qe,Be,je);default:if(He)throw new TypeError('Unknown encoding: '+Fe);Fe=(''+Fe).toLowerCase(),He=!0;}},I.prototype.toJSON=function(){return{type:'Buffer',data:Array.prototype.slice.call(this._arr||this,0)}};var Le=4096;I.prototype.slice=function(qe,Be){var je=this.length;qe=~~qe,Be=Be===void 0?je:~~Be,0>qe?(qe+=je,0>qe&&(qe=0)):qe>je&&(qe=je),0>Be?(Be+=je,0>Be&&(Be=0)):Be>je&&(Be=je),Be<qe&&(Be=qe);var Fe;if(I.TYPED_ARRAY_SUPPORT)Fe=this.subarray(qe,Be),Fe.__proto__=I.prototype;else{var Ue=Be-qe;Fe=new I(Ue,void 0);for(var He=0;He<Ue;++He)Fe[He]=this[He+qe]}return Fe},I.prototype.readUIntLE=function(qe,Be,je){qe|=0,Be|=0,je||_e(qe,Be,this.length);for(var Fe=this[qe],Ue=1,He=0;++He<Be&&(Ue*=256);)Fe+=this[qe+He]*Ue;return Fe},I.prototype.readUIntBE=function(qe,Be,je){qe|=0,Be|=0,je||_e(qe,Be,this.length);for(var Fe=this[qe+--Be],Ue=1;0<Be&&(Ue*=256);)Fe+=this[qe+--Be]*Ue;return Fe},I.prototype.readUInt8=function(qe,Be){return Be||_e(qe,1,this.length),this[qe]},I.prototype.readUInt16LE=function(qe,Be){return Be||_e(qe,2,this.length),this[qe]|this[qe+1]<<8},I.prototype.readUInt16BE=function(qe,Be){return Be||_e(qe,2,this.length),this[qe]<<8|this[qe+1]},I.prototype.readUInt32LE=function(qe,Be){return Be||_e(qe,4,this.length),(this[qe]|this[qe+1]<<8|this[qe+2]<<16)+16777216*this[qe+3]},I.prototype.readUInt32BE=function(qe,Be){return Be||_e(qe,4,this.length),16777216*this[qe]+(this[qe+1]<<16|this[qe+2]<<8|this[qe+3])},I.prototype.readIntLE=function(qe,Be,je){qe|=0,Be|=0,je||_e(qe,Be,this.length);for(var Fe=this[qe],Ue=1,He=0;++He<Be&&(Ue*=256);)Fe+=this[qe+He]*Ue;return Ue*=128,Fe>=Ue&&(Fe-=Math.pow(2,8*Be)),Fe},I.prototype.readIntBE=function(qe,Be,je){qe|=0,Be|=0,je||_e(qe,Be,this.length);for(var Fe=Be,Ue=1,He=this[qe+--Fe];0<Fe&&(Ue*=256);)He+=this[qe+--Fe]*Ue;return Ue*=128,He>=Ue&&(He-=Math.pow(2,8*Be)),He},I.prototype.readInt8=function(qe,Be){return Be||_e(qe,1,this.length),128&this[qe]?-1*(255-this[qe]+1):this[qe]},I.prototype.readInt16LE=function(qe,Be){Be||_e(qe,2,this.length);var je=this[qe]|this[qe+1]<<8;return 32768&je?4294901760|je:je},I.prototype.readInt16BE=function(qe,Be){Be||_e(qe,2,this.length);var je=this[qe+1]|this[qe]<<8;return 32768&je?4294901760|je:je},I.prototype.readInt32LE=function(qe,Be){return Be||_e(qe,4,this.length),this[qe]|this[qe+1]<<8|this[qe+2]<<16|this[qe+3]<<24},I.prototype.readInt32BE=function(qe,Be){return Be||_e(qe,4,this.length),this[qe]<<24|this[qe+1]<<16|this[qe+2]<<8|this[qe+3]},I.prototype.readFloatLE=function(qe,Be){return Be||_e(qe,4,this.length),we.read(this,qe,!0,23,4)},I.prototype.readFloatBE=function(qe,Be){return Be||_e(qe,4,this.length),we.read(this,qe,!1,23,4)},I.prototype.readDoubleLE=function(qe,Be){return Be||_e(qe,8,this.length),we.read(this,qe,!0,52,8)},I.prototype.readDoubleBE=function(qe,Be){return Be||_e(qe,8,this.length),we.read(this,qe,!1,52,8)},I.prototype.writeUIntLE=function(qe,Be,je,Fe){if(qe=+qe,Be|=0,je|=0,!Fe){var Ue=Math.pow(2,8*je)-1;fe(this,qe,Be,je,Ue,0)}var He=1,ze=0;for(this[Be]=255&qe;++ze<je&&(He*=256);)this[Be+ze]=255&qe/He;return Be+je},I.prototype.writeUIntBE=function(qe,Be,je,Fe){if(qe=+qe,Be|=0,je|=0,!Fe){var Ue=Math.pow(2,8*je)-1;fe(this,qe,Be,je,Ue,0)}var He=je-1,ze=1;for(this[Be+He]=255&qe;0<=--He&&(ze*=256);)this[Be+He]=255&qe/ze;return Be+je},I.prototype.writeUInt8=function(qe,Be,je){return qe=+qe,Be|=0,je||fe(this,qe,Be,1,255,0),I.TYPED_ARRAY_SUPPORT||(qe=Math.floor(qe)),this[Be]=255&qe,Be+1},I.prototype.writeUInt16LE=function(qe,Be,je){return qe=+qe,Be|=0,je||fe(this,qe,Be,2,65535,0),I.TYPED_ARRAY_SUPPORT?(this[Be]=255&qe,this[Be+1]=qe>>>8):he(this,qe,Be,!0),Be+2},I.prototype.writeUInt16BE=function(qe,Be,je){return qe=+qe,Be|=0,je||fe(this,qe,Be,2,65535,0),I.TYPED_ARRAY_SUPPORT?(this[Be]=qe>>>8,this[Be+1]=255&qe):he(this,qe,Be,!1),Be+2},I.prototype.writeUInt32LE=function(qe,Be,je){return qe=+qe,Be|=0,je||fe(this,qe,Be,4,4294967295,0),I.TYPED_ARRAY_SUPPORT?(this[Be+3]=qe>>>24,this[Be+2]=qe>>>16,this[Be+1]=qe>>>8,this[Be]=255&qe):ye(this,qe,Be,!0),Be+4},I.prototype.writeUInt32BE=function(qe,Be,je){return qe=+qe,Be|=0,je||fe(this,qe,Be,4,4294967295,0),I.TYPED_ARRAY_SUPPORT?(this[Be]=qe>>>24,this[Be+1]=qe>>>16,this[Be+2]=qe>>>8,this[Be+3]=255&qe):ye(this,qe,Be,!1),Be+4},I.prototype.writeIntLE=function(qe,Be,je,Fe){if(qe=+qe,Be|=0,!Fe){var Ue=Math.pow(2,8*je-1);fe(this,qe,Be,je,Ue-1,-Ue)}var He=0,ze=1,$e=0;for(this[Be]=255&qe;++He<je&&(ze*=256);)0>qe&&0==$e&&0!==this[Be+He-1]&&($e=1),this[Be+He]=255&(qe/ze>>0)-$e;return Be+je},I.prototype.writeIntBE=function(qe,Be,je,Fe){if(qe=+qe,Be|=0,!Fe){var Ue=Math.pow(2,8*je-1);fe(this,qe,Be,je,Ue-1,-Ue)}var He=je-1,ze=1,$e=0;for(this[Be+He]=255&qe;0<=--He&&(ze*=256);)0>qe&&0==$e&&0!==this[Be+He+1]&&($e=1),this[Be+He]=255&(qe/ze>>0)-$e;return Be+je},I.prototype.writeInt8=function(qe,Be,je){return qe=+qe,Be|=0,je||fe(this,qe,Be,1,127,-128),I.TYPED_ARRAY_SUPPORT||(qe=Math.floor(qe)),0>qe&&(qe=255+qe+1),this[Be]=255&qe,Be+1},I.prototype.writeInt16LE=function(qe,Be,je){return qe=+qe,Be|=0,je||fe(this,qe,Be,2,32767,-32768),I.TYPED_ARRAY_SUPPORT?(this[Be]=255&qe,this[Be+1]=qe>>>8):he(this,qe,Be,!0),Be+2},I.prototype.writeInt16BE=function(qe,Be,je){return qe=+qe,Be|=0,je||fe(this,qe,Be,2,32767,-32768),I.TYPED_ARRAY_SUPPORT?(this[Be]=qe>>>8,this[Be+1]=255&qe):he(this,qe,Be,!1),Be+2},I.prototype.writeInt32LE=function(qe,Be,je){return qe=+qe,Be|=0,je||fe(this,qe,Be,4,2147483647,-2147483648),I.TYPED_ARRAY_SUPPORT?(this[Be]=255&qe,this[Be+1]=qe>>>8,this[Be+2]=qe>>>16,this[Be+3]=qe>>>24):ye(this,qe,Be,!0),Be+4},I.prototype.writeInt32BE=function(qe,Be,je){return qe=+qe,Be|=0,je||fe(this,qe,Be,4,2147483647,-2147483648),0>qe&&(qe=4294967295+qe+1),I.TYPED_ARRAY_SUPPORT?(this[Be]=qe>>>24,this[Be+1]=qe>>>16,this[Be+2]=qe>>>8,this[Be+3]=255&qe):ye(this,qe,Be,!1),Be+4},I.prototype.writeFloatLE=function(qe,Be,je){return Ce(this,qe,Be,!0,je)},I.prototype.writeFloatBE=function(qe,Be,je){return Ce(this,qe,Be,!1,je)},I.prototype.writeDoubleLE=function(qe,Be,je){return be(this,qe,Be,!0,je)},I.prototype.writeDoubleBE=function(qe,Be,je){return be(this,qe,Be,!1,je)},I.prototype.copy=function(qe,Be,je,Fe){if(je||(je=0),Fe||0===Fe||(Fe=this.length),Be>=qe.length&&(Be=qe.length),Be||(Be=0),0<Fe&&Fe<je&&(Fe=je),Fe===je)return 0;if(0===qe.length||0===this.length)return 0;if(0>Be)throw new RangeError('targetStart out of bounds');if(0>je||je>=this.length)throw new RangeError('sourceStart out of bounds');if(0>Fe)throw new RangeError('sourceEnd out of bounds');Fe>this.length&&(Fe=this.length),qe.length-Be<Fe-je&&(Fe=qe.length-Be+je);var Ue=Fe-je,He;if(this===qe&&je<Be&&Be<Fe)for(He=Ue-1;0<=He;--He)qe[He+Be]=this[He+je];else if(1e3>Ue||!I.TYPED_ARRAY_SUPPORT)for(He=0;He<Ue;++He)qe[He+Be]=this[He+je];else Uint8Array.prototype.set.call(qe,this.subarray(je,je+Ue),Be);return Ue},I.prototype.fill=function(qe,Be,je,Fe){if('string'==typeof qe){if('string'==typeof Be?(Fe=Be,Be=0,je=this.length):'string'==typeof je&&(Fe=je,je=this.length),1===qe.length){var Ue=qe.charCodeAt(0);256>Ue&&(qe=Ue)}if(void 0!==Fe&&'string'!=typeof Fe)throw new TypeError('encoding must be a string');if('string'==typeof Fe&&!I.isEncoding(Fe))throw new TypeError('Unknown encoding: '+Fe)}else'number'==typeof qe&&(qe&=255);if(0>Be||this.length<Be||this.length<je)throw new RangeError('Out of range index');if(je<=Be)return this;Be>>>=0,je=je===void 0?this.length:je>>>0,qe||(qe=0);var He;if('number'==typeof qe)for(He=Be;He<je;++He)this[He]=qe;else{var ze=I.isBuffer(qe)?qe:Re(new I(qe,Fe).toString()),$e=ze.length;for(He=0;He<je-Be;++He)this[He+Be]=ze[He%$e]}return this};var Oe=/[^+\/0-9A-Za-z-_]/g}).call(h,E(30))},function(l,h){h.read=function(E,R,A,N,M){var L=8*M-N-1,B=(1<<L)-1,H=B>>1,z=-7,$=A?M-1:0,Y=A?-1:1,J=E[R+$],I,D;for($+=Y,I=J&(1<<-z)-1,J>>=-z,z+=L;0<z;I=256*I+E[R+$],$+=Y,z-=8);for(D=I&(1<<-z)-1,I>>=-z,z+=N;0<z;D=256*D+E[R+$],$+=Y,z-=8);if(0===I)I=1-H;else{if(I===B)return D?NaN:(J?-1:1)*Infinity;D+=Math.pow(2,N),I-=H}return(J?-1:1)*D*Math.pow(2,I-N)},h.write=function(E,R,A,N,M,I){var H=8*I-M-1,z=(1<<H)-1,$=z>>1,Y=23===M?Math.pow(2,-24)-Math.pow(2,-77):0,J=N?0:I-1,G=N?1:-1,W=0>R||0===R&&0>1/R?1:0,D,L,B;for(R=Math.abs(R),isNaN(R)||R===Infinity?(L=isNaN(R)?1:0,D=z):(D=Math.floor(Math.log(R)/Math.LN2),1>R*(B=Math.pow(2,-D))&&(D--,B*=2),R+=1<=D+$?Y/B:Y*Math.pow(2,1-$),2<=R*B&&(D++,B/=2),D+$>=z?(L=0,D=z):1<=D+$?(L=(R*B-1)*Math.pow(2,M),D+=$):(L=R*Math.pow(2,$-1)*Math.pow(2,M),D=0));8<=M;E[A+J]=255&L,J+=G,L/=256,M-=8);for(D=D<<M|L,H+=M;0<H;E[A+J]=255&D,J+=G,D/=256,H-=8);E[A+J-G]|=128*W}},function(l){var E={}.toString;l.exports=Array.isArray||function(R){return'[object Array]'==E.call(R)}},function(l){function E(){throw new Error('setTimeout has not been defined')}function R(){throw new Error('clearTimeout has not been defined')}function A(W){if(H===setTimeout)return setTimeout(W,0);if((H===E||!H)&&setTimeout)return H=setTimeout,setTimeout(W,0);try{return H(W,0)}catch(X){try{return H.call(null,W,0)}catch(K){return H.call(this,W,0)}}}function N(W){if(z===clearTimeout)return clearTimeout(W);if((z===R||!z)&&clearTimeout)return z=clearTimeout,clearTimeout(W);try{return z(W)}catch(X){try{return z.call(null,W)}catch(K){return z.call(this,W)}}}function M(){Y&&J&&(Y=!1,J.length?$=J.concat($):G=-1,$.length&&I())}function I(){if(!Y){var W=A(M);Y=!0;for(var X=$.length;X;){for(J=$,$=[];++G<X;)J&&J[G].run();G=-1,X=$.length}J=null,Y=!1,N(W)}}function D(W,X){this.fun=W,this.array=X}function L(){}var B=l.exports={},H,z;(function(){try{H='function'==typeof setTimeout?setTimeout:E}catch(W){H=E}try{z='function'==typeof clearTimeout?clearTimeout:R}catch(W){z=R}})();var $=[],Y=!1,G=-1,J;B.nextTick=function(W){var X=Array(arguments.length-1);if(1<arguments.length)for(var K=1;K<arguments.length;K++)X[K-1]=arguments[K];$.push(new D(W,X)),1!==$.length||Y||A(I)},D.prototype.run=function(){this.fun.apply(null,this.array)},B.title='browser',B.browser=!0,B.env={},B.argv=[],B.version='',B.versions={},B.on=L,B.addListener=L,B.once=L,B.off=L,B.removeListener=L,B.removeAllListeners=L,B.emit=L,B.prependListener=L,B.prependOnceListener=L,B.listeners=function(){return[]},B.binding=function(){throw new Error('process.binding is not supported')},B.cwd=function(){return'/'},B.chdir=function(){throw new Error('process.chdir is not supported')},B.umask=function(){return 0}},function(l,h){(function(E){l.exports=E}).call(h,{})},function(l){l.exports=moment},function(l,h,E){E(0),E(1),E(17),E(19),E(20),E(31),E(32),E(33),E(34),l.exports=E(35)}]);